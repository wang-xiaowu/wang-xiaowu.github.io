<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>kafkaåŸºç¡€çŸ¥è¯† | å°äº”çš„ä¸ªäººæ‚è´§é“º</title><meta name="author" content="å°äº”"><meta name="copyright" content="å°äº”"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Kafkaæ¦‚è¿°å®šä¹‰ Kafkaä¼ ç»Ÿå®šä¹‰ï¼šKafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„åŸºäºå‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å¼çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessageQueueï¼‰ï¼Œä¸»è¦åº”ç”¨äºå¤§æ•°æ®å®æ—¶å¤„ç†é¢†åŸŸã€‚  å‘å¸ƒ&#x2F;è®¢é˜…ï¼šæ¶ˆæ¯çš„å‘å¸ƒè€…ä¸ä¼šå°†æ¶ˆæ¯ç›´æ¥å‘é€ç»™ç‰¹å®šçš„è®¢é˜…è€…ï¼Œè€Œæ˜¯å°†å‘å¸ƒçš„æ¶ˆæ¯åˆ†ä¸ºä¸åŒçš„ç±»åˆ«ï¼Œè®¢é˜…è€…åªæ¥æ”¶æ„Ÿå…´è¶£çš„æ¶ˆæ¯ã€‚ Kafkaæœ€æ–°å®šä¹‰ï¼šKafkaæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼äº‹ä»¶æµå¹³å°ï¼ˆEvent StreamingPlatform"><meta property="og:type" content="article"><meta property="og:title" content="kafkaåŸºç¡€çŸ¥è¯†"><meta property="og:url" content="https://xiaowu95.wang/posts/f351760e/"><meta property="og:site_name" content="å°äº”çš„ä¸ªäººæ‚è´§é“º"><meta property="og:description" content="Kafkaæ¦‚è¿°å®šä¹‰ Kafkaä¼ ç»Ÿå®šä¹‰ï¼šKafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„åŸºäºå‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å¼çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessageQueueï¼‰ï¼Œä¸»è¦åº”ç”¨äºå¤§æ•°æ®å®æ—¶å¤„ç†é¢†åŸŸã€‚  å‘å¸ƒ&#x2F;è®¢é˜…ï¼šæ¶ˆæ¯çš„å‘å¸ƒè€…ä¸ä¼šå°†æ¶ˆæ¯ç›´æ¥å‘é€ç»™ç‰¹å®šçš„è®¢é˜…è€…ï¼Œè€Œæ˜¯å°†å‘å¸ƒçš„æ¶ˆæ¯åˆ†ä¸ºä¸åŒçš„ç±»åˆ«ï¼Œè®¢é˜…è€…åªæ¥æ”¶æ„Ÿå…´è¶£çš„æ¶ˆæ¯ã€‚ Kafkaæœ€æ–°å®šä¹‰ï¼šKafkaæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼äº‹ä»¶æµå¹³å°ï¼ˆEvent StreamingPlatform"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://xiaowu95.wang/img/nba-logo20.jpg"><meta property="article:published_time" content="2023-03-23T16:00:00.000Z"><meta property="article:modified_time" content="2024-02-28T08:37:47.000Z"><meta property="article:author" content="å°äº”"><meta property="article:tag" content="kafka"><meta property="article:tag" content="mq"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://xiaowu95.wang/img/nba-logo20.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "kafkaåŸºç¡€çŸ¥è¯†",
  "url": "https://xiaowu95.wang/posts/f351760e/",
  "image": "https://xiaowu95.wang/img/nba-logo20.jpg",
  "datePublished": "2023-03-23T16:00:00.000Z",
  "dateModified": "2024-02-28T08:37:47.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "å°äº”",
      "url": "https://xiaowu95.wang"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://xiaowu95.wang/posts/f351760e/"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="kHfLZxYQ7y3s3AR7gyJDdJkQvGNjQsvopp6N3gEEx0s"><meta name="baidu-site-verification" content="codeva-aVS4F6wAjS"><link rel="manifest" href="/wang-xiaowu/pwa/site.webmanifest"><meta name="msapplication-TileColor" content="#fff"><link rel="apple-touch-icon" sizes="180x180" href="/wang-xiaowu/pwa/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/wang-xiaowu/pwa/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/wang-xiaowu/pwa/favicon-16x16.png"><link rel="mask-icon" href="/wang-xiaowu/pwa/safari-pinned-tab.svg" color="#5bbad5"><link rel="stylesheet" href="/css/index.css?v=5.5.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.33/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise(((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach((([e,t])=>n.setAttribute(e,t))),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)})),getCSS:(e,t)=>new Promise(((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)})),addGlobalFn:(e,t,o=!1,a=window)=>{const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),c=window.matchMedia("(prefers-color-scheme: dark)"),r=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(r.matches)a();else if(c.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}c.addEventListener("change",(()=>{void 0===t.get("theme")&&(e.matches?o():a())}))}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?86cb34987e15c900c39e12ebdf08c50d";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),btf.addGlobalFn("pjaxComplete",(()=>{_hmt.push(["_trackPageview",window.location.pathname])}),"baidu_analytics")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-1MFQ47191J"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-1MFQ47191J"),btf.addGlobalFn("pjaxComplete",(()=>{gtag("config","G-1MFQ47191J",{page_path:window.location.pathname})}),"google_analytics")</script><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"M91QAWRVY4",apiKey:"ecc30a5e06136e1cc491685e39801190",indexName:"xiaowu-blog",hitsPerPage:6,languages:{hits_empty:"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}",hits_stats:"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œè€—æ—¶ ${time} æ¯«ç§’"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"ç¹",msgToSimplifiedChinese:"ç°¡"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:400,highlightFullpage:!0,highlightMacStyle:!0},copy:{success:"å¤åˆ¶æˆåŠŸ",error:"å¤åˆ¶å¤±è´¥",noSupport:"æµè§ˆå™¨ä¸æ”¯æŒ"},relativeDate:{homepage:!0,post:!0},runtime:"å¤©",dateSuffix:{just:"åˆšåˆš",min:"åˆ†é’Ÿå‰",hour:"å°æ—¶å‰",day:"å¤©å‰",month:"ä¸ªæœˆå‰"},copyright:{limitCount:150,languages:{author:"ä½œè€…: å°äº”",link:"é“¾æ¥: ",source:"æ¥æº: å°äº”çš„ä¸ªäººæ‚è´§é“º",info:"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"å·²åˆ‡æ¢ä¸ºç¹ä½“ä¸­æ–‡",cht_to_chs:"å·²åˆ‡æ¢ä¸ºç®€ä½“ä¸­æ–‡",day_to_night:"å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼",night_to_day:"å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"åŠ è½½æ›´å¤š"},isPhotoFigcaption:!1,islazyloadPlugin:!0,isAnchor:!0,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"kafkaåŸºç¡€çŸ¥è¯†",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><script src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><link rel="stylesheet" href="/css/font.css"><style>.app-refresh{position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease}.app-refresh-wrap{display:flex;color:#fff;height:100%;align-items:center;justify-content:center}.app-refresh-wrap a{color:#fff;text-decoration:underline;cursor:pointer}</style><link rel="stylesheet" href="/css/titleStyle.css"><link rel="stylesheet" href="/css/mouse.css"><link rel="stylesheet" href="/css/custom.css"><style>.card-announcement .social-button{margin:.6rem 0 0 0;text-align:center}.card-announcement .social-button a{display:block;background-color:var(--btn-bg);color:var(--btn-color);text-align:center;line-height:2.4;margin:4px 0}.card-announcement .social-button a:hover{background-color:var(--btn-hover-color)}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiperstyle.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="alternate" href="/atom.xml" title="å°äº”çš„ä¸ªäººæ‚è´§é“º" type="application/atom+xml"></head><body><script>window.paceOptions={restartOnPushState:!1},btf.addGlobalFn("pjaxSend",(()=>{Pace.restart()}),"pace_restart")</script><link rel="stylesheet" href="/css/pace.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-lazy-src="/img/avatar.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">554</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">168</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">55</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/github/"><i class="fa-fw fa-solid fa-address-card"></i> <span>å…³äºæˆ‘</span></a></div><div class="menus_item"><a class="site-page" href="/ac/"><i class="fa-fw fa-solid fa-wind"></i> <span>ä¾¿æºå°ç©ºè°ƒ</span></a></div><div class="menus_item"><a class="site-page" href="/talking/"><i class="fa-fw fa-solid fa-walkie-talkie"></i> <span>åšå®¢çŸ­è®°</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i> <span>ç›®å½•</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-otter"></i> <span>æ‚è®°</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/songs/"><i class="fa-fw fas fa-music"></i> <span>éŸ³ä¹</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>å›¾åº“</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa-solid fa-film"></i> <span>å½±è§†|ç•ªå‰§</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book faa-fload"></i> <span>ä¹¦å•</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad faa-fload"></i> <span>æ¸¸æˆ</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-bilibili"></i> <span>BiliBiliè¿½ç•ª</span></a></li><li><a class="site-page child" href="/cinemas/"><i class="fa-fw fa-solid fa-video"></i> <span>BiliBiliè¿½å‰§</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i> <span>ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-user-group"></i> <span>å‹é“¾</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-mug-saucer"></i> <span>Website Memo</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://console.leancloud.app/apps"><span>ğŸš€ LeanCloud</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.com/dashboard"><span>ğŸš€ Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://tongji.baidu.com/main/overview/10000432799/overview/index"><span>ğŸš€ ç™¾åº¦ç»Ÿè®¡</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://ziyuan.baidu.com/dashboard/index"><span>ğŸš€ ç™¾åº¦ç«™ç‚¹ç®¡ç†</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://analytics.google.com/analytics/web/"><span>ğŸš€ è°·æ­Œåˆ†æ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://search.google.com/search-console?hl=zh-cn"><span>ğŸš€ è°·æ­Œç«™ç‚¹ç®¡ç†</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.google.com/adsense/new/u/0/pub-1375421173355613/home"><span>ğŸš€ è°·æ­Œå¹¿å‘Šè”ç›Ÿ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.algolia.com/"><span>ğŸš€ Algolia</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://sms-activate.org/cn/"><span>ğŸš€ Sms-activate</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chatgpt.com/"><span>ğŸš€ ChatGPT</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://gemini.google.com/"><span>ğŸš€ Gemini</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://poe.com/"><span>ğŸš€ Poeèšåˆ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.idc.net/clientarea"><span>ğŸš€ åæµªäº‘</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.west.cn/"><span>ğŸš€ è¥¿éƒ¨æ•°æ®</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://shandianpro.com/#/dashboard"><span>ğŸš€ é—ªç”µ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.huojian.homes/"><span>ğŸš€ å°ç«ç®­</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/winston779/gougou"><span>ğŸš€ ç‹—ç‹—åŠ é€Ÿ</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/nba-logo20.jpg)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">å°äº”çš„ä¸ªäººæ‚è´§é“º</span></a><a class="nav-page-title" href="/"><span class="site-name">kafkaåŸºç¡€çŸ¥è¯†</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i> <span>è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/github/"><i class="fa-fw fa-solid fa-address-card"></i> <span>å…³äºæˆ‘</span></a></div><div class="menus_item"><a class="site-page" href="/ac/"><i class="fa-fw fa-solid fa-wind"></i> <span>ä¾¿æºå°ç©ºè°ƒ</span></a></div><div class="menus_item"><a class="site-page" href="/talking/"><i class="fa-fw fa-solid fa-walkie-talkie"></i> <span>åšå®¢çŸ­è®°</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i> <span>ç›®å½•</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-otter"></i> <span>æ‚è®°</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/songs/"><i class="fa-fw fas fa-music"></i> <span>éŸ³ä¹</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>å›¾åº“</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa-solid fa-film"></i> <span>å½±è§†|ç•ªå‰§</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book faa-fload"></i> <span>ä¹¦å•</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad faa-fload"></i> <span>æ¸¸æˆ</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-bilibili"></i> <span>BiliBiliè¿½ç•ª</span></a></li><li><a class="site-page child" href="/cinemas/"><i class="fa-fw fa-solid fa-video"></i> <span>BiliBiliè¿½å‰§</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i> <span>ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-user-group"></i> <span>å‹é“¾</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-mug-saucer"></i> <span>Website Memo</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://console.leancloud.app/apps"><span>ğŸš€ LeanCloud</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.com/dashboard"><span>ğŸš€ Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://tongji.baidu.com/main/overview/10000432799/overview/index"><span>ğŸš€ ç™¾åº¦ç»Ÿè®¡</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://ziyuan.baidu.com/dashboard/index"><span>ğŸš€ ç™¾åº¦ç«™ç‚¹ç®¡ç†</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://analytics.google.com/analytics/web/"><span>ğŸš€ è°·æ­Œåˆ†æ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://search.google.com/search-console?hl=zh-cn"><span>ğŸš€ è°·æ­Œç«™ç‚¹ç®¡ç†</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.google.com/adsense/new/u/0/pub-1375421173355613/home"><span>ğŸš€ è°·æ­Œå¹¿å‘Šè”ç›Ÿ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.algolia.com/"><span>ğŸš€ Algolia</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://sms-activate.org/cn/"><span>ğŸš€ Sms-activate</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chatgpt.com/"><span>ğŸš€ ChatGPT</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://gemini.google.com/"><span>ğŸš€ Gemini</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://poe.com/"><span>ğŸš€ Poeèšåˆ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.idc.net/clientarea"><span>ğŸš€ åæµªäº‘</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.west.cn/"><span>ğŸš€ è¥¿éƒ¨æ•°æ®</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://shandianpro.com/#/dashboard"><span>ğŸš€ é—ªç”µ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.huojian.homes/"><span>ğŸš€ å°ç«ç®­</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/winston779/gougou"><span>ğŸš€ ç‹—ç‹—åŠ é€Ÿ</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">kafkaåŸºç¡€çŸ¥è¯†<a class="post-edit-link" href="https://github.com/wang-xiaowu/wang-xiaowu.github.io/issues/new?_posts/kafka/kafkaåŸºç¡€çŸ¥è¯†.md" rel="external nofollow noreferrer" title="ç¼–è¾‘" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2023-03-23T16:00:00.000Z" title="å‘è¡¨äº 2023-03-24 00:00:00">2023-03-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-02-28T08:37:47.000Z" title="æ›´æ–°äº 2024-02-28 16:37:47">2024-02-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/kafka/">kafka</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">24.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>92åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;è·ç¦»ä¸Šä¸€æ¬¡æ›´æ–°è¯¥æ–‡ç« å·²ç»è¿‡äº†&quot;,&quot;messageNext&quot;:&quot;å¤©ï¼Œæ–‡ç« æ‰€æè¿°çš„å…§å®¹å¯èƒ½å·²ç»å‘ç”Ÿå˜åŒ–ï¼Œè¯·ç•™æ„ã€‚&quot;,&quot;postUpdate&quot;:&quot;2024-02-28 16:37:47&quot;}" hidden></div><h1 id="Kafkaæ¦‚è¿°"><a href="#Kafkaæ¦‚è¿°" class="headerlink" title="Kafkaæ¦‚è¿°"></a>Kafkaæ¦‚è¿°</h1><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>Kafkaä¼ ç»Ÿå®šä¹‰ï¼šKafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„åŸºäºå‘å¸ƒ&#x2F;è®¢é˜…æ¨¡å¼çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessageQueueï¼‰ï¼Œä¸»è¦åº”ç”¨äºå¤§æ•°æ®å®æ—¶å¤„ç†é¢†åŸŸã€‚</p><p>å‘å¸ƒ&#x2F;è®¢é˜…ï¼šæ¶ˆæ¯çš„å‘å¸ƒè€…ä¸ä¼šå°†æ¶ˆæ¯ç›´æ¥å‘é€ç»™ç‰¹å®šçš„è®¢é˜…è€…ï¼Œè€Œæ˜¯å°†å‘å¸ƒçš„æ¶ˆæ¯åˆ†ä¸ºä¸åŒçš„ç±»åˆ«ï¼Œè®¢é˜…è€…åªæ¥æ”¶æ„Ÿå…´è¶£çš„æ¶ˆæ¯ã€‚</p><p>Kafkaæœ€æ–°å®šä¹‰ï¼šKafkaæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼äº‹ä»¶æµå¹³å°ï¼ˆEvent StreamingPlatformï¼‰ï¼Œè¢«æ•°åƒå®¶å…¬å¸ç”¨äºé«˜æ€§èƒ½æ•°æ®ç®¡é“ã€æµåˆ†æã€æ•°æ®é›†æˆå’Œå…³é”®ä»»åŠ¡åº”ç”¨ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/dfb2e94613dfe8ca28b1f786cdbd1cad.png" title="image-20220902124022501"><h2 id="æ¶ˆæ¯é˜Ÿåˆ—"><a href="#æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—"></a>æ¶ˆæ¯é˜Ÿåˆ—</h2><p>ç›®å‰ä¼ä¸šä¸­æ¯”è¾ƒå¸¸è§çš„æ¶ˆæ¯é˜Ÿåˆ—äº§å“ä¸»è¦æœ‰ Kafkaã€ActiveMQ ã€RabbitMQ ã€RocketMQ ç­‰ã€‚</p><p>åœ¨å¤§æ•°æ®åœºæ™¯ä¸»è¦é‡‡ç”¨ Kafka ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ã€‚åœ¨ JavaEE å¼€å‘ä¸­ä¸»è¦é‡‡ç”¨ ActiveMQã€RabbitMQã€RocketMQã€‚</p><h3 id="ä¼ ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—çš„åº”ç”¨åœºæ™¯"><a href="#ä¼ ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—çš„åº”ç”¨åœºæ™¯" class="headerlink" title="ä¼ ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—çš„åº”ç”¨åœºæ™¯"></a>ä¼ ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—çš„åº”ç”¨åœºæ™¯</h3><p>ä¼ ç»Ÿçš„æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸»è¦åº”ç”¨åœºæ™¯åŒ…æ‹¬ï¼š<strong>ç¼“å­˜æ¶ˆå³°</strong>ã€<strong>è§£è€¦</strong>å’Œ<strong>å¼‚æ­¥é€šä¿¡ã€‚</strong></p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/77a7834185b244829c98edb00813ac57.png" title="image-20220902124743197"> <img src="/img/loading.gif" data-lazy-src="/posts/f351760e/ef3b5d2ae3fecd1d46e41c08840024ae.png" title="image-20220902124806543"> <img src="/img/loading.gif" data-lazy-src="/posts/f351760e/56d9b13e9919a3b9d80b70f9ff98c39f.png" title="image-20220902124830120"><h3 id="æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸¤ç§æ¨¡å¼"><a href="#æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸¤ç§æ¨¡å¼" class="headerlink" title="æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸¤ç§æ¨¡å¼"></a>æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸¤ç§æ¨¡å¼</h3><p>æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸¤ç§æ¨¡å¼</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/87cbfaac48e317d6a7648b2e66f9941b.png" title="image-20220902124921601"><p>åŒºåˆ«: ç‚¹å¯¹ç‚¹æ¶ˆè´¹ -&gt; æ¶ˆæ¯åªèƒ½å‘å¸ƒåˆ°ä¸€ä¸ªä¸»é¢˜ï¼Œ æ¶ˆè´¹å®Œæˆå°±åˆ é™¤æ¶ˆæ¯ï¼Œä¸”åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€…</p><p>å‘å¸ƒè®¢é˜…æ¨¡å¼ -&gt; æ¶ˆæ¯å¯ä»¥å‘å¸ƒåˆ°å¤šä¸ªä¸»é¢˜ï¼Œ æ¶ˆæ¯ä¸€èˆ¬ä¿ç•™ä¸ƒå¤©ï¼Œä¸”æœ‰å¤šä¸ªæ¶ˆè´¹è€…</p><h2 id="åŸºç¡€æ¶æ„"><a href="#åŸºç¡€æ¶æ„" class="headerlink" title="åŸºç¡€æ¶æ„"></a>åŸºç¡€æ¶æ„</h2><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/708e86e70504f41234b05cb3cc30dea7.png" title="image-20220902125656203"><p>åœ¨Kafka2.8ç‰ˆæœ¬å‰ï¼ŒZookeeperçš„Consumeræ–‡ä»¶ä¸­å­˜æ”¾æ¶ˆæ¯è¢«æ¶ˆè´¹çš„è®°å½•ï¼ˆoffsetï¼‰</p><p>åœ¨Kafka2.8ç‰ˆæœ¬èµ°ï¼Œæ¶ˆæ¯è¢«æ¶ˆè´¹çš„è®°å½•ï¼ˆoffsetï¼‰å­˜æ”¾åœ¨Kafkaä¸­ã€‚</p><p>ï¼ˆ1ï¼‰Producerï¼šæ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå°±æ˜¯å‘ Kafka broker å‘æ¶ˆæ¯çš„å®¢æˆ·ç«¯ã€‚</p><p>ï¼ˆ2ï¼‰Consumerï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œå‘ Kafka broker å–æ¶ˆæ¯çš„å®¢æˆ·ç«¯ã€‚</p><p>ï¼ˆ3ï¼‰Consumer Groupï¼ˆCGï¼‰ï¼šæ¶ˆè´¹è€…ç»„ï¼Œç”±å¤šä¸ª consumer ç»„æˆã€‚æ¶ˆè´¹è€…ç»„å†…æ¯ä¸ªæ¶ˆè´¹è€…è´Ÿè´£æ¶ˆè´¹ä¸åŒåˆ†åŒºçš„æ•°æ®ï¼Œä¸€ä¸ªåˆ†åŒºåªèƒ½ç”±ä¸€ä¸ªç»„å†…æ¶ˆè´¹è€…æ¶ˆè´¹ï¼›æ¶ˆè´¹è€…ç»„ä¹‹é—´äº’ä¸å½±å“ã€‚æ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½å±äºæŸä¸ªæ¶ˆè´¹è€…ç»„ï¼Œå³æ¶ˆè´¹è€…ç»„æ˜¯é€»è¾‘ä¸Šçš„ä¸€ä¸ªè®¢é˜…è€…ã€‚</p><p>ï¼ˆ4ï¼‰Brokerï¼šä¸€å° Kafka æœåŠ¡å™¨å°±æ˜¯ä¸€ä¸ª brokerã€‚ä¸€ä¸ªé›†ç¾¤ç”±å¤šä¸ª broker ç»„æˆã€‚ä¸€ä¸ªbroker å¯ä»¥å®¹çº³å¤šä¸ª topicã€‚</p><p>ï¼ˆ5ï¼‰Topicï¼šå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é¢å‘çš„éƒ½æ˜¯ä¸€ä¸ª topicã€‚</p><p>ï¼ˆ6ï¼‰Partitionï¼šä¸ºäº†å®ç°æ‰©å±•æ€§ï¼Œä¸€ä¸ªéå¸¸å¤§çš„ topic å¯ä»¥åˆ†å¸ƒåˆ°å¤šä¸ª brokerï¼ˆå³æœåŠ¡å™¨ï¼‰ä¸Šï¼Œä¸€ä¸ª topic å¯ä»¥åˆ†ä¸ºå¤šä¸ª partitionï¼Œæ¯ä¸ª partition æ˜¯ä¸€ä¸ªæœ‰åºçš„é˜Ÿåˆ—ã€‚</p><p>ï¼ˆ7ï¼‰Replicaï¼šå‰¯æœ¬ã€‚ä¸€ä¸ª topic çš„æ¯ä¸ªåˆ†åŒºéƒ½æœ‰è‹¥å¹²ä¸ªå‰¯æœ¬ï¼Œä¸€ä¸ª Leader å’Œè‹¥å¹²ä¸ªFollowerã€‚</p><p>ï¼ˆ8ï¼‰Leaderï¼šæ¯ä¸ªåˆ†åŒºå¤šä¸ªå‰¯æœ¬çš„â€œä¸»â€ï¼Œ<strong>ç”Ÿäº§è€…å‘é€æ•°æ®çš„å¯¹è±¡ï¼Œä»¥åŠæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®çš„å¯¹è±¡éƒ½æ˜¯ Leaderã€‚</strong></p><p>ï¼ˆ9ï¼‰Followerï¼šæ¯ä¸ªåˆ†åŒºå¤šä¸ªå‰¯æœ¬ä¸­çš„â€œä»â€ï¼Œå®æ—¶ä» Leader ä¸­åŒæ­¥æ•°æ®ï¼Œä¿æŒå’ŒLeader æ•°æ®çš„åŒæ­¥ã€‚Leader å‘ç”Ÿæ•…éšœæ—¶ï¼ŒæŸä¸ª Follower ä¼šæˆä¸ºæ–°çš„ Leaderã€‚</p><h1 id="Kafka-å¿«é€Ÿå…¥é—¨"><a href="#Kafka-å¿«é€Ÿå…¥é—¨" class="headerlink" title="Kafka å¿«é€Ÿå…¥é—¨"></a>Kafka å¿«é€Ÿå…¥é—¨</h1><h2 id="å®‰è£…éƒ¨ç½²"><a href="#å®‰è£…éƒ¨ç½²" class="headerlink" title="å®‰è£…éƒ¨ç½²"></a>å®‰è£…éƒ¨ç½²</h2><h3 id="é›†ç¾¤è§„åˆ’"><a href="#é›†ç¾¤è§„åˆ’" class="headerlink" title="é›†ç¾¤è§„åˆ’"></a>é›†ç¾¤è§„åˆ’</h3><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/7a6de8540a14d9de14d5d3349aa6cf37.png" title="image-20220902130143941"><p><strong>2.1.2</strong> <strong>é›†ç¾¤éƒ¨ç½²</strong></p><p>0ï¼‰å®˜æ–¹ä¸‹è½½åœ°å€ï¼š<a target="_blank" rel="noopener external nofollow noreferrer" href="http://kafka.apache.org/downloads.html">http://kafka.apache.org/downloads.html</a></p><p>1ï¼‰è§£å‹å®‰è£…åŒ…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 software]$ tar -zxvf kafka_2.12-3.0.0.tgz -C /opt/module/</span><br></pre></td></tr></table></figure><p>2)ä¿®æ”¹è§£å‹åçš„æ–‡ä»¶åç§°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 module]$ mv kafka_2.12-3.0.0/ kafka</span><br></pre></td></tr></table></figure><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/1ff6b0c3ba569bdcdc10f5db72de9f25.png" title="image-20220902151810746"><p>3ï¼‰è¿›å…¥åˆ°&#x2F;opt&#x2F;module&#x2F;kafka ç›®å½•ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 kafka]$ cd config/</span><br><span class="line">[atguigu@hadoop102 config]$ vim server.properties</span><br></pre></td></tr></table></figure><p>è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">broker çš„å…¨å±€å”¯ä¸€ç¼–å·ï¼Œä¸èƒ½é‡å¤ï¼Œåªèƒ½æ˜¯æ•°å­—ã€‚</span></span><br><span class="line">broker.id=0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¤„ç†ç½‘ç»œè¯·æ±‚çš„çº¿ç¨‹æ•°é‡</span></span><br><span class="line">num.network.threads=3</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ç”¨æ¥å¤„ç†ç£ç›˜ IO çš„çº¿ç¨‹æ•°é‡</span></span><br><span class="line">num.io.threads=8</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å‘é€å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°</span></span><br><span class="line">socket.send.buffer.bytes=102400</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ¥æ”¶å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°</span></span><br><span class="line">socket.receive.buffer.bytes=102400</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¯·æ±‚å¥—æ¥å­—çš„ç¼“å†²åŒºå¤§å°</span></span><br><span class="line">socket.request.max.bytes=104857600</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">kafka è¿è¡Œæ—¥å¿—(æ•°æ®)å­˜æ”¾çš„è·¯å¾„ï¼Œè·¯å¾„ä¸éœ€è¦æå‰åˆ›å»ºï¼Œkafka è‡ªåŠ¨å¸®ä½ åˆ›å»ºï¼Œå¯ä»¥é…ç½®å¤šä¸ªç£ç›˜è·¯å¾„ï¼Œè·¯å¾„ä¸è·¯å¾„ä¹‹é—´å¯ä»¥ç”¨<span class="string">&quot;ï¼Œ&quot;</span>åˆ†éš”</span></span><br><span class="line">log.dirs=/opt/module/kafka/datas</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">topic åœ¨å½“å‰ broker ä¸Šçš„åˆ†åŒºä¸ªæ•°</span></span><br><span class="line">num.partitions=1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ç”¨æ¥æ¢å¤å’Œæ¸…ç† data ä¸‹æ•°æ®çš„çº¿ç¨‹æ•°é‡</span></span><br><span class="line">num.recovery.threads.per.data.dir=1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¯ä¸ª topic åˆ›å»ºæ—¶çš„å‰¯æœ¬æ•°ï¼Œé»˜è®¤æ—¶ 1 ä¸ªå‰¯æœ¬</span></span><br><span class="line">offsets.topic.replication.factor=1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">segment æ–‡ä»¶ä¿ç•™çš„æœ€é•¿æ—¶é—´ï¼Œè¶…æ—¶å°†è¢«åˆ é™¤</span></span><br><span class="line">log.retention.hours=168</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ¯ä¸ª segment æ–‡ä»¶çš„å¤§å°ï¼Œé»˜è®¤æœ€å¤§ 1G</span></span><br><span class="line">log.segment.bytes=1073741824</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥è¿‡æœŸæ•°æ®çš„æ—¶é—´ï¼Œé»˜è®¤ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦æ•°æ®è¿‡æœŸ</span></span><br><span class="line">log.retention.check.interval.ms=300000</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">é…ç½®è¿æ¥ Zookeeper é›†ç¾¤åœ°å€ï¼ˆåœ¨ zk æ ¹ç›®å½•ä¸‹åˆ›å»º/kafkaï¼Œæ–¹ä¾¿ç®¡ç†ï¼‰</span></span><br><span class="line">zookeeper.connect=hadoop102:2181,hadoop103:2181,hadoop104:2181/kafka</span><br></pre></td></tr></table></figure><p>4ï¼‰åˆ†å‘å®‰è£…åŒ…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 module]$ xsync kafka/</span><br></pre></td></tr></table></figure><p>5ï¼‰åˆ†åˆ«åœ¨ hadoop103 å’Œ hadoop104 ä¸Šä¿®æ”¹é…ç½®æ–‡ä»¶&#x2F;opt&#x2F;module&#x2F;kafka&#x2F;config&#x2F;server.propertiesä¸­çš„ broker.id&#x3D;1ã€broker.id&#x3D;2<br>æ³¨ï¼šbroker.id ä¸å¾—é‡å¤ï¼Œæ•´ä¸ªé›†ç¾¤ä¸­å”¯ä¸€ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop103 module]$ vim kafka/config/server.properties</span><br><span class="line">ä¿®æ”¹ï¼š</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The <span class="built_in">id</span> of the broker. This must be <span class="built_in">set</span> to a unique <span class="built_in">integer</span> <span class="keyword">for</span> each broker.</span></span><br><span class="line">broker.id=1</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop104 module]$ vim kafka/config/server.properties</span><br><span class="line">ä¿®æ”¹:</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The <span class="built_in">id</span> of the broker. This must be <span class="built_in">set</span> to a unique <span class="built_in">integer</span> <span class="keyword">for</span> each broker.</span></span><br><span class="line">broker.id=2</span><br></pre></td></tr></table></figure><p><strong>6ï¼‰é…ç½®ç¯å¢ƒå˜é‡</strong><br>ï¼ˆ1ï¼‰åœ¨&#x2F;etc&#x2F;profile.d&#x2F;my_env.sh æ–‡ä»¶ä¸­å¢åŠ  kafka ç¯å¢ƒå˜é‡é…ç½®</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/profile.d/my_env.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#KAFKA_HOME</span></span><br><span class="line"><span class="built_in">export</span> KAFKA_HOME=/opt/module/kafka</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$KAFKA_HOME</span>/bin</span><br></pre></td></tr></table></figure><p>åˆ·æ–°ç¯å¢ƒå˜é‡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><p>ï¼ˆ1ï¼‰ Zookeeperå¯åŠ¨ (é»˜è®¤å®ˆæŠ¤è¿›ç¨‹)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./zkServer.sh start</span><br></pre></td></tr></table></figure><p>ZookeeperçŠ¶æ€</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./zkServer.sh status</span><br></pre></td></tr></table></figure><p>Zookeeperåœæ­¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./zkServer.sh stop</span><br><span class="line">    </span><br><span class="line">Zookeeperå®¢æˆ·ç«¯-å¸¸â½¤å‘½ä»¤    </span><br><span class="line">./zkCli.sh â€“server ip:port  <span class="comment">//è¿æ¥ZooKeeperæœåŠ¡ç«¯  </span></span><br><span class="line">quit  			<span class="comment">//æ–­å¼€è¿æ¥    </span></span><br></pre></td></tr></table></figure><p>(2) å¯åŠ¨Kafka</p><p>Kafka å®ˆæŠ¤æ–¹å¼ (ç¯å¢ƒå˜é‡é…ç½®å‰æä¸‹)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-server-start.sh -daemon /home/environment/kafka/config/server.properties</span><br></pre></td></tr></table></figure><p>Kafkaå…³é—­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-server-stop.sh </span><br></pre></td></tr></table></figure><p>**æ³¨æ„ï¼š**åœæ­¢ Kafka é›†ç¾¤æ—¶ï¼Œä¸€å®šè¦ç­‰ Kafka æ‰€æœ‰èŠ‚ç‚¹è¿›ç¨‹å…¨éƒ¨åœæ­¢åå†åœæ­¢ Zookeeperé›†ç¾¤ã€‚å› ä¸º Zookeeper é›†ç¾¤å½“ä¸­è®°å½•ç€ Kafka é›†ç¾¤ç›¸å…³ä¿¡æ¯ï¼ŒZookeeper é›†ç¾¤ä¸€æ—¦å…ˆåœæ­¢ï¼ŒKafka é›†ç¾¤å°±æ²¡æœ‰åŠæ³•å†è·å–åœæ­¢è¿›ç¨‹çš„ä¿¡æ¯ï¼Œåªèƒ½æ‰‹åŠ¨æ€æ­» Kafka è¿›ç¨‹äº†ã€‚</p><h2 id="Kafkaå‘½ä»¤è¡Œæ“ä½œ"><a href="#Kafkaå‘½ä»¤è¡Œæ“ä½œ" class="headerlink" title="Kafkaå‘½ä»¤è¡Œæ“ä½œ"></a>Kafkaå‘½ä»¤è¡Œæ“ä½œ</h2><p><strong>åŸºç¡€ç»“æ„</strong></p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/debd1eebe9291fcd3faaf7f1e4d235a2.png" title="image-20220902153447545"><h3 id="ä¸»é¢˜å‘½ä»¤è¡Œæ“ä½œ"><a href="#ä¸»é¢˜å‘½ä»¤è¡Œæ“ä½œ" class="headerlink" title="ä¸»é¢˜å‘½ä»¤è¡Œæ“ä½œ"></a><strong>ä¸»é¢˜å‘½ä»¤è¡Œæ“ä½œ</strong></h3><p>1ï¼‰æŸ¥çœ‹æ“ä½œä¸»é¢˜å‘½ä»¤å‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh</span><br></pre></td></tr></table></figure><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/6dcbf2af45419a358733602426cbd840.png" title="image-20220902153652112"><p>2ï¼‰æŸ¥çœ‹å½“å‰æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰ topic</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics.sh --bootstrap-server 47.106.86.64:9092 --list</span><br></pre></td></tr></table></figure><p>3ï¼‰åˆ›å»º first topic</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics.sh --bootstrap-server 47.106.86.64:9092 --create --partitions 1 --replication-factor 3 --topic first</span><br></pre></td></tr></table></figure><p>é€‰é¡¹è¯´æ˜ï¼š<br><code>--topic</code> å®šä¹‰ topic å<br><code>--replication-factor</code> å®šä¹‰å‰¯æœ¬æ•°<br><code>--partitions</code> å®šä¹‰åˆ†åŒºæ•°</p><p><strong>4ï¼‰æŸ¥çœ‹ first ä¸»é¢˜çš„è¯¦æƒ…</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics.sh --bootstrap-server 47.106.86.64:9092 --alter --topic first --partitions 3</span><br></pre></td></tr></table></figure><p>5ï¼‰ä¿®æ”¹åˆ†åŒºæ•°ï¼ˆæ³¨æ„ï¼šåˆ†åŒºæ•°åªèƒ½å¢åŠ ï¼Œä¸èƒ½å‡å°‘ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics.sh --bootstrap-server 47.106.86.64:9092 --alter --topic first --partitions 3</span><br></pre></td></tr></table></figure><p>6ï¼‰å†æ¬¡æŸ¥çœ‹ first ä¸»é¢˜çš„è¯¦æƒ…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics.sh --bootstrap-server 47.106.86.64:9092 --describe --topic first</span><br></pre></td></tr></table></figure><p>7ï¼‰åˆ é™¤ topic(éœ€è¦é…ç½®ä¿¡æ¯)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics.sh --bootstrap-server 47.106.86.64:9092 --delete --topic first</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿäº§è€…å‘½ä»¤è¡Œæ“ä½œ"><a href="#ç”Ÿäº§è€…å‘½ä»¤è¡Œæ“ä½œ" class="headerlink" title="ç”Ÿäº§è€…å‘½ä»¤è¡Œæ“ä½œ"></a>ç”Ÿäº§è€…å‘½ä»¤è¡Œæ“ä½œ</h3><p>1ï¼‰æŸ¥çœ‹æ“ä½œç”Ÿäº§è€…å‘½ä»¤å‚æ•°</p><p>è¿æ¥kafkaç”Ÿäº§è€…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-console-producer.sh --bootstrap-server 47.106.86.64:9092 --topic first</span><br></pre></td></tr></table></figure><p>å‚æ•° æè¿°<br><code>--bootstrap-server &lt;String: server toconnect to&gt;</code> è¿æ¥çš„ Kafka Broker ä¸»æœºåç§°å’Œç«¯å£å·ã€‚<br><code>--topic &lt;String: topic&gt;</code> æ“ä½œçš„ topic åç§°ã€‚</p><p>2ï¼‰å‘é€æ¶ˆæ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[atguigu@hadoop102 kafka]$ bin/kafka-console-producer.sh -- bootstrap-server hadoop102:9092 --topic first</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">hello world</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">Hi HI</span></span><br></pre></td></tr></table></figure><h3 id="æ¶ˆè´¹è€…å‘½ä»¤è¡Œæ“ä½œ"><a href="#æ¶ˆè´¹è€…å‘½ä»¤è¡Œæ“ä½œ" class="headerlink" title="æ¶ˆè´¹è€…å‘½ä»¤è¡Œæ“ä½œ"></a>æ¶ˆè´¹è€…å‘½ä»¤è¡Œæ“ä½œ</h3><p>1ï¼‰æŸ¥çœ‹æ“ä½œæ¶ˆè´¹è€…å‘½ä»¤å‚æ•°</p><p>è¿æ¥kafkaæ¶ˆè´¹è€…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-console-consumer.sh</span><br></pre></td></tr></table></figure><p>å‚æ•° æè¿°<br>â€“bootstrap-server &lt;String: server toconnect to&gt; è¿æ¥çš„ Kafka Broker ä¸»æœºåç§°å’Œç«¯å£å·ã€‚<br>â€“topic &lt;String: topic&gt; æ“ä½œçš„ topic åç§°ã€‚<br>â€“from-beginning ä»å¤´å¼€å§‹æ¶ˆè´¹ã€‚<br>â€“group &lt;String: consumer group id&gt; æŒ‡å®šæ¶ˆè´¹è€…ç»„åç§°ã€‚</p><p><strong>2ï¼‰æ¶ˆè´¹æ¶ˆæ¯</strong><br>ï¼ˆ1ï¼‰æ¶ˆè´¹ first ä¸»é¢˜ä¸­çš„æ•°æ®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-console-consumer.sh --bootstrap-server 47.106.86.64:9092 --topic first</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰æŠŠä¸»é¢˜ä¸­æ‰€æœ‰çš„æ•°æ®éƒ½è¯»å–å‡ºæ¥ï¼ˆåŒ…æ‹¬å†å²æ•°æ®ï¼‰ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-console-consumer.sh --bootstrap-server 47.106.86.64:9092 --from-beginning --topic first</span><br></pre></td></tr></table></figure><h1 id="Kafka-ç”Ÿäº§è€…"><a href="#Kafka-ç”Ÿäº§è€…" class="headerlink" title="Kafka ç”Ÿäº§è€…"></a>Kafka ç”Ÿäº§è€…</h1><h2 id="ç”Ÿäº§è€…æ¶ˆæ¯å‘é€æµç¨‹"><a href="#ç”Ÿäº§è€…æ¶ˆæ¯å‘é€æµç¨‹" class="headerlink" title="ç”Ÿäº§è€…æ¶ˆæ¯å‘é€æµç¨‹"></a>ç”Ÿäº§è€…æ¶ˆæ¯å‘é€æµç¨‹</h2><h3 id="å‘é€åŸç†"><a href="#å‘é€åŸç†" class="headerlink" title="å‘é€åŸç†"></a>å‘é€åŸç†</h3><p>åœ¨æ¶ˆæ¯å‘é€çš„è¿‡ç¨‹ä¸­ï¼Œæ¶‰åŠåˆ°ä¸¤ä¸ªçº¿ç¨‹ï¼Œ<strong>mainçº¿ç¨‹</strong>å’Œ<strong>senderçº¿ç¨‹</strong>ï¼Œå…¶ä¸­mainçº¿ç¨‹æ˜¯æ¶ˆæ¯çš„ç”Ÿäº§çº¿ç¨‹ï¼Œè€Œsenderçº¿ç¨‹æ˜¯jvmå•ä¾‹çš„çº¿ç¨‹ï¼Œä¸“é—¨ç”¨äºæ¶ˆæ¯çš„å‘é€ã€‚</p><p>åœ¨jvmçš„å†…å­˜ä¸­å¼€è¾Ÿäº†ä¸€å—ç¼“å­˜ç©ºé—´å«<strong>RecordAccumulatorï¼ˆæ¶ˆæ¯ç´¯åŠ å™¨ï¼‰</strong>ï¼Œç”¨äºå°†å¤šæ¡æ¶ˆæ¯åˆå¹¶æˆä¸€ä¸ªæ‰¹æ¬¡ï¼Œç„¶åç”±senderçº¿ç¨‹å‘é€ç»™kafkaé›†ç¾¤ã€‚</p><p>æˆ‘ä»¬çš„ä¸€æ¡æ¶ˆæ¯åœ¨ç”Ÿäº§è¿‡ç¨‹ä¼šè°ƒç”¨<strong>sendæ–¹æ³•</strong>ç„¶åç»è¿‡<strong>æ‹¦æˆªå™¨</strong>ç»è¿‡<strong>åºåˆ—åŒ–å™¨</strong>ï¼Œå†ç»è¿‡<strong>åˆ†åŒºå™¨</strong>ç¡®å®šæ¶ˆæ¯å‘é€åœ¨å…·ä½“topicä¸‹çš„å“ªä¸ªåˆ†åŒºï¼Œç„¶åå‘é€åˆ°å¯¹åº”çš„<strong>æ¶ˆæ¯ç´¯åŠ å™¨</strong>ä¸­ï¼Œæ¶ˆæ¯ç´¯åŠ å™¨æ˜¯å¤šä¸ªåŒç«¯é˜Ÿåˆ—ã€‚å¹¶ä¸”æ¯ä¸ªé˜Ÿåˆ—å’Œä¸»é¢˜åˆ†åŒºéƒ½å…·æœ‰ä¸€ä¸€æ˜ å°„å…³ç³»ã€‚æ¶ˆæ¯åœ¨ç´¯åŠ å™¨ä¸­ï¼Œè¿›è¡Œåˆå¹¶ï¼Œè¾¾åˆ°äº†å¯¹åº”çš„sizeï¼ˆbatch.sizeï¼‰æˆ–è€…ç­‰å¾…è¶…è¿‡å¯¹åº”çš„ç­‰å¾…æ—¶é—´(linger.ms)ï¼Œéƒ½ä¼šè§¦å‘<strong>senderçº¿ç¨‹</strong>çš„å‘é€ã€‚senderçº¿ç¨‹æœ‰ä¸€ä¸ªè¯·æ±‚æ± ï¼Œé»˜è®¤ç¼“å­˜äº”ä¸ªè¯·æ±‚ï¼ˆ max.in.flight.requests.per.connection ï¼‰ï¼Œå‘é€æ¶ˆæ¯åï¼Œä¼šç­‰å¾…æœåŠ¡ç«¯çš„ackï¼Œå¦‚æœæ²¡æ”¶åˆ°ackå°±ä¼šé‡è¯•é»˜è®¤é‡è¯•intæœ€å¤§å€¼ï¼ˆ retries ï¼‰ã€‚å¦‚æœackæˆåŠŸå°±ä¼šåˆ é™¤ç´¯åŠ å™¨ä¸­çš„æ¶ˆæ¯æ‰¹æ¬¡ï¼Œå¹¶ç›¸åº”åˆ°ç”Ÿäº§ç«¯ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/cd41370a872e70b75435f35692925370.png" title="image-20220902155220662"><p>å½“åŒç«¯é˜Ÿåˆ—ä¸­çš„DQueueæ»¡è¶³ batch.size æˆ–è€… linger.ms æ¡ä»¶æ—¶è§¦å‘senderçº¿ç¨‹ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/8bccb405378132fdc00d8888fb3a29ea.png" title="img"><h3 id="ç”Ÿäº§è€…é‡è¦å‚æ•°åˆ—è¡¨"><a href="#ç”Ÿäº§è€…é‡è¦å‚æ•°åˆ—è¡¨" class="headerlink" title="ç”Ÿäº§è€…é‡è¦å‚æ•°åˆ—è¡¨"></a><strong>ç”Ÿäº§è€…é‡è¦å‚æ•°åˆ—è¡¨</strong></h3><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/650ad0e5593b68a62f099a9108b041c7.png" title="image-20220902160217190"><h2 id="å‘é€"><a href="#å‘é€" class="headerlink" title="å‘é€"></a>å‘é€</h2><h3 id="æ™®é€šå¼‚æ­¥å‘é€"><a href="#æ™®é€šå¼‚æ­¥å‘é€" class="headerlink" title="æ™®é€šå¼‚æ­¥å‘é€"></a>æ™®é€šå¼‚æ­¥å‘é€</h3><p>1ï¼‰éœ€æ±‚ï¼šåˆ›å»º Kafka ç”Ÿäº§è€…ï¼Œé‡‡ç”¨å¼‚æ­¥çš„æ–¹å¼å‘é€åˆ° Kafka Broker</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/d69edce620624e1bfc5b64b340933144.png" title="img"> <img src="/img/loading.gif" data-lazy-src="/posts/f351760e/834a7285a77d8c9918af763e0ceeb475.png" title="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><p>2ï¼‰ä»£ç ç¼–å†™<br>ï¼ˆ1ï¼‰åˆ›å»ºå·¥ç¨‹ kafka<br>ï¼ˆ2ï¼‰å¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kafka-clients<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰ç¼–å†™ä¸å¸¦å›è°ƒå‡½æ•°çš„ API ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomProducer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. ç»™ kafka é…ç½®å¯¹è±¡æ·»åŠ é…ç½®ä¿¡æ¯ï¼šbootstrap.servers</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="comment">//æœåŠ¡ä¿¡æ¯</span></span><br><span class="line">        properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,<span class="string">&quot;47.106.86.64:9092&quot;</span>);</span><br><span class="line">        <span class="comment">//é…ç½®åºåˆ—åŒ–</span></span><br><span class="line">        properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br><span class="line">        properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,StringSerializer.class.getName());</span><br><span class="line">        <span class="comment">// 2. åˆ›å»º kafka ç”Ÿäº§è€…çš„é…ç½®å¯¹è±¡</span></span><br><span class="line">        KafkaProducer&lt;String, String&gt; kafkaProducer = <span class="keyword">new</span> <span class="title class_">KafkaProducer</span>&lt;String,String&gt;(properties);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. åˆ›å»º kafka ç”Ÿäº§è€…å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            kafkaProducer.send(<span class="keyword">new</span> <span class="title class_">ProducerRecord</span>(<span class="string">&quot;first&quot;</span>, <span class="string">&quot;one&quot;</span> + i));</span><br><span class="line">        &#125;</span><br><span class="line">        kafkaProducer.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼šåœ¨Linuxä¸Šå¼€å¯KafkaéªŒè¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-console-consumer.sh --bootstrap-server 47.106.86.64:9092 --topic first</span><br></pre></td></tr></table></figure><h3 id="å¸¦å›è°ƒå‡½æ•°çš„å¼‚æ­¥å‘é€"><a href="#å¸¦å›è°ƒå‡½æ•°çš„å¼‚æ­¥å‘é€" class="headerlink" title="å¸¦å›è°ƒå‡½æ•°çš„å¼‚æ­¥å‘é€"></a>å¸¦å›è°ƒå‡½æ•°çš„å¼‚æ­¥å‘é€</h3><p>å›è°ƒå‡½æ•°ä¼šåœ¨ producer æ”¶åˆ° ack æ—¶è°ƒç”¨ï¼Œä¸ºå¼‚æ­¥è°ƒç”¨ï¼Œè¯¥æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯å…ƒæ•°æ®ä¿¡æ¯ï¼ˆRecord Metadataï¼‰å’Œå¼‚å¸¸ä¿¡æ¯ï¼ˆExceptionï¼‰ï¼Œå¦‚æœ Exception ä¸º nullï¼Œè¯´æ˜æ¶ˆæ¯å‘é€æˆåŠŸï¼Œå¦‚æœ Exception ä¸ä¸º nullï¼Œè¯´æ˜æ¶ˆæ¯å‘é€å¤±è´¥ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/4d4dbf3f05b9b8980f5c1e74c4346b39.png" title="image-20220902161728576"><p>æ³¨æ„ï¼šæ¶ˆæ¯å‘é€å¤±è´¥ä¼šè‡ªåŠ¨é‡è¯•ï¼Œä¸éœ€è¦æˆ‘ä»¬åœ¨å›è°ƒå‡½æ•°ä¸­æ‰‹åŠ¨é‡è¯•ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/f02ffeece212b5ebd04fb902d23bdfe0.png" title="image-20220902160941738"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomProducer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. ç»™ kafka é…ç½®å¯¹è±¡æ·»åŠ é…ç½®ä¿¡æ¯ï¼šbootstrap.servers</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="comment">//æœåŠ¡ä¿¡æ¯</span></span><br><span class="line">        properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,<span class="string">&quot;47.106.86.64:9092&quot;</span>);</span><br><span class="line">        <span class="comment">//é…ç½®åºåˆ—åŒ–</span></span><br><span class="line">        properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br><span class="line">        properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,StringSerializer.class.getName());</span><br><span class="line">        <span class="comment">// 2. åˆ›å»º kafka ç”Ÿäº§è€…çš„é…ç½®å¯¹è±¡</span></span><br><span class="line">        KafkaProducer&lt;String, String&gt; kafkaProducer = <span class="keyword">new</span> <span class="title class_">KafkaProducer</span>&lt;String,String&gt;(properties);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. åˆ›å»º kafka ç”Ÿäº§è€…å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            kafkaProducer.send(<span class="keyword">new</span> <span class="title class_">ProducerRecord</span>(<span class="string">&quot;first&quot;</span>, <span class="string">&quot;one&quot;</span> + i), <span class="keyword">new</span> <span class="title class_">Callback</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCompletion</span><span class="params">(RecordMetadata recordMetadata, Exception e)</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (e == <span class="literal">null</span>) &#123;</span><br><span class="line">                        System.out.println( <span class="string">&quot;åˆ†åŒº ï¼š &quot;</span> + recordMetadata.partition() + <span class="string">&quot; ä¸»é¢˜ï¼š &quot;</span> + recordMetadata.topic() );</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        kafkaProducer.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŒæ­¥å‘é€API"><a href="#åŒæ­¥å‘é€API" class="headerlink" title="åŒæ­¥å‘é€API"></a>åŒæ­¥å‘é€API</h3><ol><li>å…ˆå¤„ç†å·²ç»å †ç§¯åœ¨DQueueä¸­çš„æ•°æ®ã€‚</li><li>RecordAccumulatorå†å¤„ç†å¤–éƒ¨æ•°æ®ã€‚</li></ol><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/11b8f9ad434c8ea76a97b0afb7ead8aa.png" title="image-20220902162557763"><p>åªéœ€åœ¨å¼‚æ­¥å‘é€çš„åŸºç¡€ä¸Šï¼Œå†è°ƒç”¨ä¸€ä¸‹ get()æ–¹æ³•å³å¯ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/3296888f8ddde158197076fd51858ff2.png" title="image-20220902162232873"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomProducerSync</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. ç»™ kafka é…ç½®å¯¹è±¡æ·»åŠ é…ç½®ä¿¡æ¯ï¼šbootstrap.servers</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        <span class="comment">//æœåŠ¡ä¿¡æ¯</span></span><br><span class="line">        properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG,<span class="string">&quot;47.106.86.64:9092&quot;</span>);</span><br><span class="line">        <span class="comment">//é…ç½®åºåˆ—åŒ–</span></span><br><span class="line">        properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br><span class="line">        properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG,StringSerializer.class.getName());</span><br><span class="line">        <span class="comment">// 2. åˆ›å»º kafka ç”Ÿäº§è€…çš„é…ç½®å¯¹è±¡</span></span><br><span class="line">        KafkaProducer&lt;String, String&gt; kafkaProducer = <span class="keyword">new</span> <span class="title class_">KafkaProducer</span>&lt;String,String&gt;(properties);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. åˆ›å»º kafka ç”Ÿäº§è€…å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            kafkaProducer.send(<span class="keyword">new</span> <span class="title class_">ProducerRecord</span>(<span class="string">&quot;first&quot;</span>, <span class="string">&quot;one&quot;</span> + i), <span class="keyword">new</span> <span class="title class_">Callback</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCompletion</span><span class="params">(RecordMetadata recordMetadata, Exception e)</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (e == <span class="literal">null</span>) &#123;</span><br><span class="line">                        System.out.println( <span class="string">&quot;åˆ†åŒº ï¼š &quot;</span> + recordMetadata.partition() + <span class="string">&quot; ä¸»é¢˜ï¼š &quot;</span> + recordMetadata.topic() );</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).get();</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        kafkaProducer.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿäº§è€…æ‹¦æˆªå™¨"><a href="#ç”Ÿäº§è€…æ‹¦æˆªå™¨" class="headerlink" title="ç”Ÿäº§è€…æ‹¦æˆªå™¨"></a>ç”Ÿäº§è€…æ‹¦æˆªå™¨</h2><p><strong>ç”Ÿäº§è€…æ‹¦æˆªå™¨ ï¼ˆProducerInterceptorï¼‰</strong></p><p>æ‹¦æˆªå™¨æ¥å£ä¸€å…±æœ‰ä¸‰ä¸ªæ–¹æ³•ã€‚ä¸‰ä¸ªæ–¹æ³•å†…çš„å®ç°å¦‚æœæŠ›å‡ºå¼‚å¸¸ï¼Œä¼šè¢«ProducerInterceptorså†…éƒ¨æ•è·ï¼Œå¹¶ä¸ä¼šæŠ›åˆ°ä¸Šå±‚ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProducerInterceptor</span>&lt;K, V&gt; <span class="keyword">extends</span> <span class="title class_">Configurable</span> &#123;</span><br><span class="line">    ProducerRecord&lt;K, V&gt; <span class="title function_">onSend</span><span class="params">(ProducerRecord&lt;K, V&gt; record)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onAcknowledgement</span><span class="params">(RecordMetadata metadata, Exception exception)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>onSend</code> æ–¹æ³•åœ¨æ¶ˆæ¯åˆ†åŒºä¹‹å‰ï¼Œå¯ä»¥å¯¹æ¶ˆæ¯è¿›è¡Œä¸€å®šçš„ä¿®æ”¹ï¼Œæ¯”å¦‚ç»™keyæ·»åŠ å‰ç¼€ï¼Œç”šè‡³å¯ä»¥ä¿®æ”¹æˆ‘ä»¬çš„topicï¼Œå¦‚æœéœ€è¦ä½¿ç”¨kafkaå®ç°å»¶æ—¶é˜Ÿåˆ—é«˜çº§åº”ç”¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ‹¦æˆªå™¨å¯¹æ¶ˆæ¯è¿›è¡Œåˆ¤æ–­ï¼Œå¹¶ä¿®æ”¹ï¼Œæš‚æ—¶æ”¾å…¥æˆ‘ä»¬çš„å»¶æ—¶ä¸»é¢˜ä¸­ï¼Œç­‰æ—¶é—´è¾¾åˆ°å†æ”¾å›æ™®é€šä¸»é¢˜é˜Ÿåˆ—ã€‚</p><p><code>onAcknowledgement</code>è¯¥æ–¹æ³•æ˜¯åœ¨æˆ‘ä»¬æœåŠ¡ç«¯å¯¹senderçº¿ç¨‹è¿›è¡Œæ¶ˆæ¯ç¡®è®¤ï¼Œæˆ–æ¶ˆæ¯å‘é€å¤±è´¥åçš„ä¸€ä¸ªå›è°ƒã€‚ä¼˜å…ˆäºæˆ‘ä»¬sendæ–¹æ³•çš„callbackå›è°ƒã€‚æˆ‘ä»¬å¯ä»¥å¯¹å‘é€æƒ…å†µåšä¸€ä¸ªç»Ÿè®¡ã€‚ä½†æ˜¯è¯¥æ–¹æ³•åœ¨æˆ‘ä»¬çš„senderçº¿ç¨‹ä¹Ÿå°±æ˜¯å”¯ä¸€çš„IOçº¿ç¨‹æ‰§è¡Œï¼Œé€»è¾‘è¶Šå°‘è¶Šå¥½ã€‚</p><p><code>close</code>è¯¥æ–¹æ³•å¯ä»¥åœ¨å…³é—­æ‹¦æˆªå™¨æ—¶ï¼Œè¿›è¡Œä¸€äº›èµ„æºçš„é‡Šæ”¾ã€‚</p><p>ï¼ˆ1ï¼‰ å®ç°è‡ªå®šä¹‰æ‹¦æˆªå™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> MyInterceptor <span class="keyword">implements</span> <span class="title class_">ProducerInterceptor</span> &#123;</span><br><span class="line">    ProducerRecord&lt;K, V&gt; <span class="title function_">onSend</span><span class="params">(ProducerRecord&lt;K, V&gt; record)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onAcknowledgement</span><span class="params">(RecordMetadata metadata, Exception exception)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å°†è‡ªå®šä¹‰æ‹¦æˆªå™¨åŠ å…¥è®¾ç½®ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">properties.put(ProducerConfig.INTERCEPTOR_CLASSES_CONFIG,MyInterceptor.getClass.getName());</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿäº§è€…åˆ†åŒº"><a href="#ç”Ÿäº§è€…åˆ†åŒº" class="headerlink" title="ç”Ÿäº§è€…åˆ†åŒº"></a>ç”Ÿäº§è€…åˆ†åŒº</h2><h3 id="åˆ†åŒºçš„å¥½å¤„"><a href="#åˆ†åŒºçš„å¥½å¤„" class="headerlink" title="åˆ†åŒºçš„å¥½å¤„"></a>åˆ†åŒºçš„å¥½å¤„</h3><p>ä»å­˜å‚¨çš„è§’åº¦ -&gt; åˆç†ä½¿ç”¨å­˜å‚¨èµ„æºï¼Œå®ç°è´Ÿè½½å‡è¡¡</p><p>ä»è®¡ç®—çš„è§’åº¦ -&gt; æé«˜å¹¶è¡Œè®¡ç®—çš„å¯è¡Œæ€§</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/b2dbb52f914459787d686c44ebd7c3c8.png" title="image-20220902162836492"><h3 id="ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ†åŒºç­–ç•¥"><a href="#ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ†åŒºç­–ç•¥" class="headerlink" title="ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ†åŒºç­–ç•¥"></a>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ†åŒºç­–ç•¥</h3><p>1ï¼‰é»˜è®¤çš„åˆ†åŒºå™¨ DefaultPartitioner<br>åœ¨ IDEA ä¸­ ctrl +nï¼Œå…¨å±€æŸ¥æ‰¾ DefaultPartitionerã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/a37d58fcc2149fef557d391b76b98aff.png" title="image-20220902163515987"><p>Kafkaæ”¯æŒä¸‰ç§åˆ†åŒºç­–ç•¥ 1) æŒ‡å®šåˆ†åŒºï¼› 2ï¼‰æŒ‡å®škeyï¼Œè®¡ç®—hashå¾—åˆ†åŒºï¼› 3ï¼‰æŒ‡å®šéšæœºç²˜æ€§åˆ†åŒºï¼›</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/18a0b6ba56db8e5b16b3d6fac9ba7fb7.png" title="image-20220902163808502"><h3 id="è‡ªå®šä¹‰åˆ†åŒºå™¨"><a href="#è‡ªå®šä¹‰åˆ†åŒºå™¨" class="headerlink" title="è‡ªå®šä¹‰åˆ†åŒºå™¨"></a>è‡ªå®šä¹‰åˆ†åŒºå™¨</h3><p>å¦‚æœç ”å‘äººå‘˜å¯ä»¥æ ¹æ®ä¼ä¸šéœ€æ±‚ï¼Œè‡ªå·±é‡æ–°å®ç°åˆ†åŒºå™¨ã€‚</p><p>1ï¼‰éœ€æ±‚<br>ä¾‹å¦‚æˆ‘ä»¬å®ç°ä¸€ä¸ªåˆ†åŒºå™¨å®ç°ï¼Œå‘é€è¿‡æ¥çš„æ•°æ®ä¸­å¦‚æœåŒ…å« Hiï¼Œå°±å‘å¾€ 0 å·åˆ†åŒºï¼Œä¸åŒ…å« Hiï¼Œå°±å‘å¾€ 1 å·åˆ†åŒºã€‚<br>2ï¼‰å®ç°æ­¥éª¤<br>ï¼ˆ1ï¼‰å®šä¹‰ç±»å®ç° Partitioner æ¥å£ã€‚<br>ï¼ˆ2ï¼‰é‡å†™ partition()æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyPartitioner</span> <span class="keyword">implements</span> <span class="title class_">Partitioner</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> topic ä¸»é¢˜</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key æ¶ˆæ¯çš„ key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> keyBytes æ¶ˆæ¯çš„ key åºåˆ—åŒ–åçš„å­—èŠ‚æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value æ¶ˆæ¯çš„ value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> valueBytes æ¶ˆæ¯çš„ value åºåˆ—åŒ–åçš„å­—èŠ‚æ•°ç»„</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cluster é›†ç¾¤å…ƒæ•°æ®å¯ä»¥æŸ¥çœ‹åˆ†åŒºä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(String topic, Object key, <span class="type">byte</span>[] keyBytes, Object value, <span class="type">byte</span>[] valueBytes, Cluster cluster)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> value.toString();</span><br><span class="line">        <span class="keyword">if</span> (string.contains(<span class="string">&quot;vi&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰ä½¿ç”¨åˆ†åŒºå™¨çš„æ–¹æ³•ï¼Œåœ¨ç”Ÿäº§è€…çš„é…ç½®ä¸­æ·»åŠ åˆ†åŒºå™¨å‚æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰åˆ†åŒºè§„åˆ™ </span></span><br><span class="line">properties.put(ProducerConfig.PARTITIONER_CLASS_CONFIG,MyPartitioner.class.getName());</span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰å¼€å¯æµ‹è¯•</p><h2 id="ç”Ÿäº§è€…æé«˜ååé‡"><a href="#ç”Ÿäº§è€…æé«˜ååé‡" class="headerlink" title="ç”Ÿäº§è€…æé«˜ååé‡"></a>ç”Ÿäº§è€…æé«˜ååé‡</h2><p>é€šè¿‡æé«˜ååé‡è¾¾åˆ°ä½å»¶è¿Ÿçš„æ•ˆæœ</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/e29f428d28ae322918a211d256dd8b5b.png" title="image-20220902164746226"><p><strong>Batch.size ä¸ linger.ms é…åˆä½¿ç”¨ï¼Œæ ¹æ®ç”Ÿæˆæ•°æ®çš„å¤§å°æŒ‡å®šã€‚</strong></p><p><strong>RecordAccumlatorï¼šåœ¨å¼‚æ­¥å‘é€å¹¶ä¸”åˆ†åŒºå¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œ32Mçš„æ•°æ®é‡å®¹æ˜“è¢«æ»¡è¶³ï¼Œè¿›ç¨‹äº¤äº’åŠ å¤§ï¼Œå¯ä»¥é€‚å½“æé«˜åˆ°64Mã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// batch.sizeï¼šæ‰¹æ¬¡å¤§å°ï¼Œé»˜è®¤ 16K</span></span><br><span class="line">properties.put(ProducerConfig.BATCH_SIZE_CONFIG, <span class="number">16384</span>);</span><br><span class="line"><span class="comment">// linger.msï¼šç­‰å¾…æ—¶é—´ï¼Œé»˜è®¤ 0</span></span><br><span class="line">properties.put(ProducerConfig.LINGER_MS_CONFIG, <span class="number">1</span>);</span><br><span class="line"><span class="comment">// RecordAccumulatorï¼šç¼“å†²åŒºå¤§å°ï¼Œé»˜è®¤ 32Mï¼šbuffer.memory</span></span><br><span class="line">properties.put(ProducerConfig.BUFFER_MEMORY_CONFIG,<span class="number">33554432</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// compression.typeï¼šå‹ç¼©ï¼Œé»˜è®¤ noneï¼Œå¯é…ç½®å€¼ gzipã€snappyã€lz4 å’Œ zstd</span></span><br><span class="line">properties.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, <span class="string">&quot;snappy&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯ç´¯åŠ å™¨"><a href="#æ¶ˆæ¯ç´¯åŠ å™¨" class="headerlink" title="æ¶ˆæ¯ç´¯åŠ å™¨"></a>æ¶ˆæ¯ç´¯åŠ å™¨</h3><p><strong>æ¶ˆæ¯ç´¯åŠ å™¨ï¼ˆRecordAccumulatorï¼‰</strong></p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/f20e0b29414b41978048b0c263c2f6a4.png" title="image-20220902174419992"><p>ä¸ºäº†æé«˜ç”Ÿäº§è€…çš„ååé‡ï¼Œæˆ‘ä»¬é€šè¿‡ç´¯åŠ å™¨å°†å¤šæ¡æ¶ˆæ¯åˆå¹¶æˆä¸€æ‰¹ç»Ÿä¸€å‘é€ã€‚åœ¨brokerä¸­å°†æ¶ˆæ¯æ‰¹é‡å­˜å…¥ã€‚å‡å°‘å¤šæ¬¡çš„ç½‘ç»œIOã€‚</p><p>æ¶ˆæ¯ç´¯åŠ å™¨é»˜è®¤32mï¼Œå¦‚æœç”Ÿäº§è€…çš„å‘é€é€Ÿç‡å¤§äºsenderå‘é€çš„é€Ÿç‡ï¼Œæ¶ˆæ¯å°±ä¼šå †æ»¡ç´¯åŠ å™¨ã€‚ç”Ÿäº§è€…å°±ä¼šé˜»å¡ï¼Œæˆ–è€…æŠ¥é”™ï¼ŒæŠ¥é”™å–å†³äºé˜»å¡æ—¶é—´çš„é…ç½®ã€‚</p><p>ç´¯åŠ å™¨çš„å­˜å‚¨å½¢å¼ä¸º<code>ConcurrentMap&lt;TopicPartition, Deque&lt;ProducerBatch&gt;&gt;</code>ï¼Œå¯ä»¥çœ‹å‡ºæ¥å°±æ˜¯ä¸€ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ªåŒç«¯é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ä¸­å­˜å‚¨çš„æ˜¯<code>ProducerBatch</code>ä¸€èˆ¬å¤§å°æ˜¯16kæ ¹æ®batch.sizeé…ç½®ï¼Œæ–°çš„æ¶ˆæ¯ä¼šappendåˆ°<code>ProducerBatch</code>ä¸­ï¼Œæ»¡16kå°±ä¼šåˆ›å»ºæ–°çš„<code>ProducerBatch</code>ï¼Œå¹¶ä¸”è§¦å‘senderçº¿ç¨‹è¿›è¡Œå‘é€ã€‚</p><p>å¦‚æœæ¶ˆæ¯é‡éå¸¸å¤§ï¼Œç”Ÿæˆäº†å¤§é‡çš„<code>ProducerBatch</code>ï¼Œåœ¨å‘é€åï¼Œåˆéœ€è¦JVMé€šè¿‡GCå›æ”¶è¿™äº›<code>ProducerBatch</code>å°±å˜å¾—éå¸¸å½±å“æ€§èƒ½ï¼Œæ‰€ä»¥kafkaé€šè¿‡ <code>BufferPool</code>ä½œä¸ºå†…å­˜æ± æ¥ç®¡ç†<code>ProducerBatch</code>çš„åˆ›å»ºå’Œå›æ”¶ï¼Œéœ€è¦ç”³è¯·ä¸€ä¸ªæ–°çš„<code>ProducerBatch</code>ç©ºé—´æ—¶ï¼Œè°ƒç”¨ <code>free.allocate(size, maxTimeToBlock)</code>æ‰¾å†…å­˜æ± ç”³è¯·ç©ºé—´ã€‚</p><p>å¦‚æœå•æ¡æ¶ˆæ¯å¤§äº16kï¼Œé‚£ä¹ˆå°±ä¸ä¼šå¤ç”¨å†…å­˜æ± äº†ï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ›´å¤§çš„<code>ProducerBatch</code>ä¸“é—¨å­˜æ”¾å¤§æ¶ˆæ¯ï¼Œå‘é€å®ŒåGCå›æ”¶è¯¥å†…å­˜ç©ºé—´ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸ºäº†è¿›ä¸€æ­¥å‡å°ç½‘ç»œä¸­æ¶ˆæ¯ä¼ è¾“çš„å¸¦å®½ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡**æ¶ˆæ¯å‹ç¼©**çš„æ–¹å¼ï¼Œåœ¨ç”Ÿäº§ç«¯å°†æ¶ˆæ¯è¿½åŠ è¿›`ProducerBatch`å°±å¯¹æ¯ä¸€æ¡æ¶ˆæ¯è¿›è¡Œå‹ç¼©äº†ã€‚å¸¸ç”¨çš„æœ‰Gzipã€Snappyã€Lz4 å’Œ Zstdï¼Œè¿™æ˜¯æ—¶é—´æ¢ç©ºé—´çš„æ‰‹æ®µã€‚å‹ç¼©çš„æ¶ˆæ¯ä¼šåœ¨æ¶ˆè´¹ç«¯è¿›è¡Œè§£å‹ã€‚</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯å‘é€çº¿ç¨‹ï¼ˆSenderï¼‰"><a href="#æ¶ˆæ¯å‘é€çº¿ç¨‹ï¼ˆSenderï¼‰" class="headerlink" title="æ¶ˆæ¯å‘é€çº¿ç¨‹ï¼ˆSenderï¼‰"></a><strong>æ¶ˆæ¯å‘é€çº¿ç¨‹ï¼ˆSenderï¼‰</strong></h3><p>æ¶ˆæ¯ä¿å­˜åœ¨å†…å­˜åï¼ŒSenderçº¿ç¨‹å°±ä¼šæŠŠç¬¦åˆæ¡ä»¶çš„æ¶ˆæ¯æŒ‰ç…§æ‰¹æ¬¡è¿›è¡Œå‘é€ã€‚é™¤äº†å‘é€æ¶ˆæ¯ï¼Œå…ƒæ•°æ®çš„åŠ è½½ä¹Ÿæ˜¯é€šè¿‡Senderçº¿ç¨‹æ¥å¤„ç†çš„ã€‚</p><p>Senderçº¿ç¨‹å‘é€æ¶ˆæ¯ä»¥åŠæ¥æ”¶æ¶ˆæ¯ï¼Œéƒ½æ˜¯åŸºäºjava NIOçš„Selectorã€‚é€šè¿‡SelectoræŠŠæ¶ˆæ¯å‘å‡ºå»ï¼Œå¹¶é€šè¿‡Selectoræ¥æ”¶æ¶ˆæ¯ã€‚</p><p>Senderçº¿ç¨‹é»˜è®¤å®¹çº³5ä¸ªæœªç¡®è®¤çš„æ¶ˆæ¯ï¼Œæ¶ˆæ¯å‘é€å¤±è´¥åä¼šè¿›è¡Œé‡è¯•ã€‚</p><h2 id="ç”Ÿäº§ç»éªŒâ€”æ•°æ®å¯é æ€§"><a href="#ç”Ÿäº§ç»éªŒâ€”æ•°æ®å¯é æ€§" class="headerlink" title="ç”Ÿäº§ç»éªŒâ€”æ•°æ®å¯é æ€§"></a>ç”Ÿäº§ç»éªŒâ€”æ•°æ®å¯é æ€§</h2><h3 id="æ¶ˆæ¯ç¡®è®¤æœºåˆ¶-ACK"><a href="#æ¶ˆæ¯ç¡®è®¤æœºåˆ¶-ACK" class="headerlink" title="æ¶ˆæ¯ç¡®è®¤æœºåˆ¶-ACK"></a>æ¶ˆæ¯ç¡®è®¤æœºåˆ¶-ACK</h3><p>produceræä¾›äº†ä¸‰ç§æ¶ˆæ¯ç¡®è®¤çš„æ¨¡å¼ï¼Œé€šè¿‡é…ç½®<code>acks</code>æ¥å®ç°</p><p><code>acksä¸º0</code>æ—¶ï¼Œ è¡¨ç¤ºç”Ÿäº§è€…å°†æ•°æ®å‘é€å‡ºå»å°±ä¸ç®¡äº†ï¼Œä¸ç­‰å¾…ä»»ä½•è¿”å›ã€‚è¿™ç§æƒ…å†µä¸‹æ•°æ®ä¼ è¾“æ•ˆç‡æœ€é«˜ï¼Œä½†æ˜¯æ•°æ®å¯é æ€§æœ€ä½ï¼Œå½“ serveræŒ‚æ‰çš„æ—¶å€™å°±ä¼šä¸¢æ•°æ®ï¼›</p><p><code>acksä¸º1</code>æ—¶ï¼ˆé»˜è®¤ï¼‰ï¼Œè¡¨ç¤ºæ•°æ®å‘é€åˆ°Kafkaåï¼Œç»è¿‡leaderæˆåŠŸæ¥æ”¶æ¶ˆæ¯çš„çš„ç¡®è®¤ï¼Œæ‰ç®—å‘é€æˆåŠŸï¼Œå¦‚æœleaderå®•æœºäº†ï¼Œå°±ä¼šä¸¢å¤±æ•°æ®ã€‚</p><p><code>acksä¸º-1/all</code>æ—¶ï¼Œè¡¨ç¤ºç”Ÿäº§è€…éœ€è¦ç­‰å¾…ISRä¸­çš„æ‰€æœ‰followeréƒ½ç¡®è®¤æ¥æ”¶åˆ°æ•°æ®åæ‰ç®—å‘é€å®Œæˆï¼Œè¿™æ ·æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œå› æ­¤å¯é æ€§æœ€é«˜ï¼Œæ€§èƒ½æœ€ä½ã€‚</p><ul><li>æ•°æ®å®Œå…¨å¯é æ¡ä»¶ &#x3D; ACKçº§åˆ«è®¾ç½®ä¸º-1 + åˆ†åŒºå‰¯æœ¬å¤§äºç­‰äº2 + ISRé‡Œåº”ç­”çš„æœ€å°å‰¯æœ¬æ•°é‡å¤§äºç­‰äº2</li></ul><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/a5c1a40450861d56bfc5cce44746a8a6.png" title="image-20220902172535966"><p>AR &#x3D; ISR + ORS</p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæ‰€æœ‰çš„followerå‰¯æœ¬éƒ½åº”è¯¥ä¸leaderå‰¯æœ¬ä¿æŒä¸€å®šç¨‹åº¦çš„åŒæ­¥ï¼Œåˆ™AR &#x3D; ISRï¼ŒOSR &#x3D; nullã€‚</p><p>ISR è¡¨ç¤ºåœ¨æŒ‡å®šæ—¶é—´å†…å’Œleaderä¿å­˜æ•°æ®åŒæ­¥çš„é›†åˆï¼›</p><p>ORSè¡¨ç¤ºä¸èƒ½åœ¨æŒ‡å®šçš„æ—¶é—´å†…å’Œleaderä¿æŒæ•°æ®åŒæ­¥é›†åˆï¼Œç§°ä¸ºOSR(Out-Sync Relipca set)ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Ack è®¾ç½®ï¼Œé»˜è®¤æ˜¯1</span></span><br><span class="line">properties.put(ProducerConfig.ACKS_CONFIG,<span class="string">&quot;1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡è¯•æ¬¡æ•°, é»˜è®¤çš„é‡è¯•æ¬¡æ•°æ˜¯ Max.Integer</span></span><br><span class="line">properties.put(ProducerConfig.RETRIES_CONFIG,<span class="number">3</span>);</span><br></pre></td></tr></table></figure><h3 id="æ•°æ®å»é‡-å¹‚ç­‰æ€§"><a href="#æ•°æ®å»é‡-å¹‚ç­‰æ€§" class="headerlink" title="æ•°æ®å»é‡-å¹‚ç­‰æ€§"></a>æ•°æ®å»é‡-å¹‚ç­‰æ€§</h3><p>1ï¼‰å¹‚ç­‰æ€§åŸç†</p><p>åœ¨ä¸€èˆ¬çš„MQæ¨¡å‹ä¸­ï¼Œå¸¸æœ‰ä»¥ä¸‹çš„æ¶ˆæ¯é€šä¿¡æ¦‚å¿µ</p><ul><li><strong>è‡³å°‘ä¸€æ¬¡ï¼ˆAt Least Onceï¼‰ï¼š</strong> ACKçº§åˆ«è®¾ç½®ä¸º-1 + åˆ†åŒºå‰¯æœ¬å¤§äºç­‰äº2 + ISRé‡Œåº”ç­”çš„æœ€å°å‰¯æœ¬æ•°é‡&gt;&#x3D;2ã€‚å¯ä»¥ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯æ•°æ®ä¸é‡å¤ã€‚</li><li><strong>æœ€å¤šä¸€æ¬¡ï¼ˆAt Most Onceï¼‰</strong>ï¼šACKçº§åˆ«è®¾ç½®ä¸º0 ã€‚å¯ä»¥ä¿è¯æ•°æ®ä¸é‡å¤ï¼Œä½†æ˜¯ä¸èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±ã€‚â€¢</li><li><strong>ç²¾ç¡®ä¸€æ¬¡ï¼ˆExactly Onceï¼‰</strong>ï¼šè‡³å°‘ä¸€æ¬¡ + å¹‚ç­‰æ€§ ã€‚ Kafka 0.11ç‰ˆæœ¬å¼•å…¥ä¸€é¡¹é‡å¤§ç‰¹æ€§ï¼š<strong>å¹‚ç­‰æ€§å’Œäº‹åŠ¡</strong>ã€‚</li></ul><p>å¹‚ç­‰æ€§ï¼Œç®€å•åœ°è¯´å°±æ˜¯å¯¹æ¥å£çš„å¤šæ¬¡è°ƒç”¨æ‰€äº§ç”Ÿçš„ç»“æœå’Œè°ƒç”¨ä¸€æ¬¡æ˜¯ä¸€è‡´çš„ã€‚ç”Ÿäº§è€…åœ¨è¿›è¡Œé‡è¯•çš„æ—¶å€™æœ‰å¯èƒ½ä¼šé‡å¤å†™å…¥æ¶ˆæ¯ï¼Œè€Œä½¿ç”¨Kafka çš„å¹‚ç­‰æ€§åŠŸèƒ½ä¹‹åå°±å¯ä»¥é¿å…è¿™ç§æƒ…å†µã€‚ï¼ˆä¸äº§ç”Ÿé‡å¤æ•°æ®ï¼‰</p><p><strong>é‡å¤æ•°æ®çš„åˆ¤æ–­æ ‡å‡†</strong>ï¼šå…·æœ‰&lt;PID, Partition, SeqNumber&gt;ç›¸åŒä¸»é”®çš„æ¶ˆæ¯æäº¤æ—¶ï¼ŒBrokeråªä¼šæŒä¹…åŒ–ä¸€æ¡ã€‚å…¶</p><p>ä¸­ProducerIdï¼ˆpidï¼‰æ˜¯Kafkaæ¯æ¬¡é‡å¯éƒ½ä¼šåˆ†é…ä¸€ä¸ªæ–°çš„ï¼›Partition è¡¨ç¤ºåˆ†åŒºå·ï¼›Sequence Number åºåˆ—åŒ–å·ï¼Œæ˜¯å•è°ƒè‡ªå¢çš„ã€‚</p><p>brokerä¸­ä¼šåœ¨å†…å­˜ç»´æŠ¤ä¸€ä¸ªpid+åˆ†åŒºå¯¹åº”çš„åºåˆ—å·ã€‚å¦‚æœæ”¶åˆ°çš„åºåˆ—å·æ­£å¥½æ¯”å†…å­˜åºåˆ—å·å¤§ä¸€ï¼Œæ‰å­˜å‚¨æ¶ˆæ¯ï¼Œå¦‚æœå°äºå†…å­˜åºåˆ—å·ï¼Œæ„å‘³ç€æ¶ˆæ¯é‡å¤ï¼Œé‚£ä¹ˆä¼šä¸¢å¼ƒæ¶ˆæ¯ï¼Œå¹¶åº”ç­”ã€‚å¦‚æœè¿œå¤§äºå†…å­˜åºåˆ—å·ï¼Œæ„å‘³ç€æ¶ˆæ¯ä¸¢å¤±ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><p>æ‰€ä»¥å¹‚ç­‰è§£å†³çš„æ˜¯senderåˆ°brokeré—´ï¼Œç”±äºç½‘ç»œæ³¢åŠ¨å¯èƒ½é€ æˆçš„é‡å‘é—®é¢˜ã€‚ç”¨å¹‚ç­‰æ¥æ ‡è¯†å”¯ä¸€æ¶ˆæ¯ã€‚</p><p>å¹¶ä¸”å¹‚ç­‰æ€§åªèƒ½ä¿è¯çš„æ˜¯åœ¨å•åˆ†åŒºå•ä¼šè¯å†…ä¸é‡å¤ã€‚</p><p>2ï¼‰å¦‚ä½•ä½¿ç”¨å¹‚ç­‰æ€§</p><p>å¼€å¯å¹‚ç­‰æ€§åŠŸèƒ½çš„æ–¹å¼å¾ˆç®€å•ï¼Œåªéœ€è¦æ˜¾å¼åœ°å°†ç”Ÿäº§è€…å®¢æˆ·ç«¯å‚æ•°<code>enable.idempotence</code>è®¾ç½®ä¸ºtrueå³å¯(è¿™ä¸ªå‚æ•°çš„é»˜è®¤å€¼ä¸ºtrue)ï¼Œå¹¶ä¸”è¿˜éœ€è¦ç¡®ä¿ç”Ÿäº§è€…å®¢æˆ·ç«¯çš„<strong>retriesã€acksã€max.in.filght.request.per.connection</strong>å‚æ•°ä¸è¢«é…ç½®é”™ï¼Œé»˜è®¤å€¼å°±æ˜¯å¯¹çš„ã€‚</p><h3 id="æ¶ˆæ¯äº‹åŠ¡"><a href="#æ¶ˆæ¯äº‹åŠ¡" class="headerlink" title="æ¶ˆæ¯äº‹åŠ¡"></a>æ¶ˆæ¯äº‹åŠ¡</h3><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/4d210e935a7af0d15c3caa53e08f4e9e.png" title="image-20220902183826203"><p>ç”±äºå¹‚ç­‰æ€§ä¸èƒ½è·¨åˆ†åŒºè¿ä½œï¼Œä¸ºäº†ä¿è¯åŒæ—¶å‘çš„å¤šæ¡æ¶ˆæ¯ï¼Œè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥ã€‚kafkaå¼•å…¥äº†äº‹åŠ¡çš„æ¦‚å¿µã€‚</p><p>å¼€å¯äº‹åŠ¡éœ€è¦producerè®¾ç½®<code>transactional.id</code>çš„å€¼å¹¶åŒæ—¶å¼€å¯å¹‚ç­‰æ€§ã€‚</p><p>é€šè¿‡äº‹åŠ¡åè°ƒå™¨ï¼Œæ¥å®ç°äº‹åŠ¡ï¼Œå·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1 åˆå§‹åŒ–äº‹åŠ¡</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">initTransactions</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// 2 å¼€å¯äº‹åŠ¡</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">beginTransaction</span><span class="params">()</span> <span class="keyword">throws</span> ProducerFencedException;</span><br><span class="line"><span class="comment">// 3 åœ¨äº‹åŠ¡å†…æäº¤å·²ç»æ¶ˆè´¹çš„åç§»é‡ï¼ˆä¸»è¦ç”¨äºæ¶ˆè´¹è€…ï¼‰</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">sendOffsetsToTransaction</span><span class="params">(Map&lt;TopicPartition, OffsetAndMetadata&gt; offsets,</span></span><br><span class="line"><span class="params"> String consumerGroupId)</span> <span class="keyword">throws</span> </span><br><span class="line">ProducerFencedException;</span><br><span class="line"><span class="comment">// 4 æäº¤äº‹åŠ¡</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">commitTransaction</span><span class="params">()</span> <span class="keyword">throws</span> ProducerFencedException;</span><br><span class="line"><span class="comment">// 5 æ”¾å¼ƒäº‹åŠ¡ï¼ˆç±»ä¼¼äºå›æ»šäº‹åŠ¡çš„æ“ä½œï¼‰</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">abortTransaction</span><span class="params">()</span> <span class="keyword">throws</span> ProducerFencedException;</span><br></pre></td></tr></table></figure><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/95a605d47e3a21cfbc211419c3a2b0ab.png" title="image-20220902185538447"><h2 id="æ¶ˆæ¯é¡ºåº"><a href="#æ¶ˆæ¯é¡ºåº" class="headerlink" title="æ¶ˆæ¯é¡ºåº"></a>æ¶ˆæ¯é¡ºåº</h2><p>æ¶ˆæ¯åœ¨å•åˆ†åŒºå†…æœ‰åºï¼Œå¤šåˆ†åŒºå†…æ— åºï¼ˆå¦‚æœå¯¹å¤šåˆ†åŒºè¿›è¡Œæ’åºï¼Œé€ æˆåˆ†åŒºæ— æ³•å·¥ä½œéœ€è¦ç­‰å¾…æ’åºï¼Œæµªè´¹æ€§èƒ½ï¼‰</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/378373559c2bb13de4d456bde9a4f27a.png" title="image-20220902184011079"><p>kafkaåªèƒ½ä¿è¯<code>å•åˆ†åŒºä¸‹çš„æ¶ˆæ¯é¡ºåºæ€§</code>ï¼Œä¸ºäº†ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Œéœ€è¦åšåˆ°å¦‚ä¸‹å‡ ç‚¹ã€‚</p><p><code>å¦‚æœæœªå¼€å¯å¹‚ç­‰æ€§</code>ï¼Œéœ€è¦ max.in.flight.requests.per.connection è®¾ç½®ä¸º1ã€‚ï¼ˆç¼“å†²é˜Ÿåˆ—æœ€å¤šæ”¾ç½®1ä¸ªè¯·æ±‚ï¼‰</p><p><code>å¦‚æœå¼€å¯å¹‚ç­‰æ€§</code>ï¼Œéœ€è¦ max.in.flight.requests.per.connection è®¾ç½®ä¸ºå°äº5ã€‚</p><p>è¿™æ˜¯å› ä¸ºbrokerç«¯ä¼šç¼“å­˜producerä¸»é¢˜åˆ†åŒºä¸‹çš„äº”ä¸ªrequestï¼Œä¿è¯æœ€è¿‘5ä¸ªrequestæ˜¯æœ‰åºçš„ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/a3b4872eb57bd687ecfead941459546c.png" title="image-20220902184310223"><p>å¦‚æœRequest3åœ¨å¤±è´¥é‡è¯•åæ‰å‘å¾€åˆ°é›†ç¾¤ä¸­ï¼Œå¿…ç„¶ä¼šå¯¼è‡´ä¹±åºï¼Œä½†æ˜¯é›†ç¾¤ä¼šé‡æ–°æŒ‰ç…§åºåˆ—å·è¿›è¡Œæ’åºï¼ˆæœ€å¯¹ä¸€æ¬¡æ’åº5ä¸ªï¼‰ã€‚</p><h1 id="Kafka-Broker"><a href="#Kafka-Broker" class="headerlink" title="Kafka Broker"></a>Kafka Broker</h1><h2 id="Brokerè®¾è®¡"><a href="#Brokerè®¾è®¡" class="headerlink" title="Brokerè®¾è®¡"></a>Brokerè®¾è®¡</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“kafkaèƒ½å †ç§¯éå¸¸å¤§çš„æ•°æ®ï¼Œä¸€å°æœåŠ¡å™¨ï¼Œè‚¯å®šæ˜¯æ”¾ä¸ä¸‹çš„ã€‚ç”±æ­¤å‡ºç°çš„é›†ç¾¤çš„æ¦‚å¿µï¼Œé›†ç¾¤ä¸ä»…å¯ä»¥è®©æ¶ˆæ¯è´Ÿè½½å‡è¡¡ï¼Œè¿˜èƒ½æé«˜æ¶ˆæ¯å­˜å–çš„ååé‡ã€‚kafkaé›†ç¾¤ä¸­ï¼Œä¼šæœ‰å¤šå°brokerï¼Œæ¯å°brokeråˆ†åˆ«åœ¨ä¸åŒçš„æœºå™¨ä¸Šã€‚</p><p>[å¤–é“¾å›¾ç‰‡è½¬å­˜å¤±è´¥,æºç«™å¯èƒ½æœ‰é˜²ç›—é“¾æœºåˆ¶,å»ºè®®å°†å›¾ç‰‡ä¿å­˜ä¸‹æ¥ç›´æ¥ä¸Šä¼ (img-TKCzpF2O-1662356150180)(<a target="_blank" rel="noopener external nofollow noreferrer" href="http://mk-images.tagao.top/img/640?imageslim)%5D">http://mk-images.tagao.top/img/640?imageslim)]</a></p><p>ä¸ºäº†æé«˜ååé‡ï¼Œæ¯ä¸ªtopicä¹Ÿä¼šéƒ½å¤šä¸ªåˆ†åŒºï¼ŒåŒæ—¶ä¸ºäº†ä¿æŒå¯é æ€§ï¼Œæ¯ä¸ªåˆ†åŒºè¿˜ä¼šæœ‰å¤šä¸ªå‰¯æœ¬ã€‚è¿™äº›åˆ†åŒºå‰¯æœ¬è¢«å‡åŒ€çš„æ•£è½åœ¨æ¯ä¸ªbrokerä¸Šï¼Œå…¶ä¸­æ¯ä¸ªåˆ†åŒºå‰¯æœ¬ä¸­æœ‰ä¸€ä¸ªå‰¯æœ¬ä¸ºleaderï¼Œå…¶ä»–çš„ä¸ºfollowerã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/37643c8b56fe0f32a3b9d7c803f85b0b.png" title="image-20220902195939625"><h2 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h2><h3 id="Zookeeperä½œç”¨"><a href="#Zookeeperä½œç”¨" class="headerlink" title="Zookeeperä½œç”¨"></a>Zookeeperä½œç”¨</h3><p>Zookeeperåœ¨Kafkaä¸­æ‰®æ¼”äº†é‡è¦çš„è§’è‰²ï¼Œkafkaä½¿ç”¨zookeeperè¿›è¡Œå…ƒæ•°æ®ç®¡ç†ï¼Œä¿å­˜brokeræ³¨å†Œä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸»é¢˜ï¼ˆTopicï¼‰ã€åˆ†åŒºï¼ˆPartitionï¼‰ä¿¡æ¯ç­‰ï¼Œé€‰æ‹©åˆ†åŒºleaderã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/b1f0ebc535b00384be6bf81540c5f416.png" title="image-20220902200249692"><h3 id="Brokeré€‰ä¸¾Leader"><a href="#Brokeré€‰ä¸¾Leader" class="headerlink" title="Brokeré€‰ä¸¾Leader"></a>Brokeré€‰ä¸¾Leader</h3><p>è¿™é‡Œéœ€è¦å…ˆæ˜ç¡®ä¸€ä¸ªæ¦‚å¿µleaderé€‰ä¸¾ï¼Œå› ä¸ºkafkaä¸­æ¶‰åŠå¤šå¤„é€‰ä¸¾æœºåˆ¶ï¼Œå®¹æ˜“ææ··ï¼ŒKafkaç”±ä¸‰ä¸ªæ–¹é¢ä¼šæ¶‰åŠåˆ°é€‰ä¸¾ï¼š</p><ul><li>brokerï¼ˆæ§åˆ¶å™¨ï¼‰é€‰leader</li><li>åˆ†åŒºå¤šå‰¯æœ¬é€‰leader</li><li>æ¶ˆè´¹è€…é€‰Leader</li></ul><p>åœ¨kafkaé›†ç¾¤ä¸­ç”±å¾ˆå¤šçš„brokerï¼ˆä¹Ÿå«åšæ§åˆ¶å™¨ï¼‰ï¼Œä½†æ˜¯ä»–ä»¬ä¹‹é—´éœ€è¦é€‰ä¸¾å‡ºä¸€ä¸ªleaderï¼Œå…¶ä»–çš„éƒ½æ˜¯followerã€‚brokerçš„leaderæœ‰å¾ˆé‡è¦çš„ä½œç”¨ï¼Œè¯¸å¦‚ï¼šåˆ›å»ºã€åˆ é™¤ä¸»é¢˜ã€å¢åŠ åˆ†åŒºå¹¶åˆ†é…leaderåˆ†åŒºï¼›é›†ç¾¤brokerç®¡ç†ï¼ŒåŒ…æ‹¬æ–°å¢ã€å…³é—­å’Œæ•…éšœå¤„ç†ï¼›åˆ†åŒºé‡åˆ†é…ï¼ˆauto.leader.rebalance.enable&#x3D;trueï¼Œåé¢ä¼šä»‹ç»ï¼‰ï¼Œåˆ†åŒºleaderé€‰ä¸¾ã€‚</p><p>æ¯ä¸ªbrokeréƒ½æœ‰å”¯ä¸€çš„brokerIdï¼Œä»–ä»¬åœ¨å¯åŠ¨åä¼šå»ç«äº‰æ³¨å†Œzookeeperä¸Šçš„Controllerç»“ç‚¹ï¼Œè°å…ˆæŠ¢åˆ°ï¼Œè°å°±æ˜¯broker leaderã€‚è€Œå…¶ä»–brokerä¼šç›‘å¬è¯¥ç»“ç‚¹äº‹ä»¶ï¼Œä»¥ä¾¿åç»­leaderä¸‹çº¿åè§¦å‘é‡æ–°é€‰ä¸¾ã€‚</p><p>ç®€å›¾ï¼š</p><ul><li>brokerï¼ˆæ§åˆ¶å™¨ï¼‰é€‰leader</li></ul><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/12b4f076e8f82c66b00ec8782433649f.png" title="image-20220902200901222"><p>è¯¦ç»†å›¾ï¼š</p><ul><li>brokerï¼ˆæ§åˆ¶å™¨ï¼‰é€‰leader</li><li>åˆ†åŒºå¤šå‰¯æœ¬é€‰leader</li></ul><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/e5c14b9c17123faf3eefa58a22ab0668.png" title="image-20220902201352868"><p><strong>æ¨¡æ‹Ÿ Kafka ä¸Šä¸‹çº¿ï¼ŒZookeeper ä¸­æ•°æ®å˜åŒ–</strong></p><p>ï¼ˆ1ï¼‰æŸ¥çœ‹&#x2F;kafka&#x2F;brokers&#x2F;ids è·¯å¾„ä¸Šçš„èŠ‚ç‚¹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 2] ls /kafka/brokers/ids</span><br><span class="line">[0, 1, 2]</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰æŸ¥çœ‹&#x2F;kafka&#x2F;controller è·¯å¾„ä¸Šçš„æ•°æ®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 15] get /kafka/controller</span><br><span class="line">&#123;&quot;version&quot;:1,&quot;brokerid&quot;:0,&quot;timestamp&quot;:&quot;1637292471777&quot;&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰æŸ¥çœ‹&#x2F;kafka&#x2F;brokers&#x2F;topics&#x2F;first&#x2F;partitions&#x2F;0&#x2F;state è·¯å¾„ä¸Šçš„æ•°æ®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 16] get  /kafka/brokers/topics/first/partitions/0/state</span><br><span class="line">&#123;&quot;controller_epoch&quot;:24,&quot;leader&quot;:0,&quot;version&quot;:1,&quot;leader_epoch&quot;:18,&quot; isr&quot;:[0,1,2]&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰åœæ­¢ hadoop104 ä¸Šçš„ kafkaã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-server-stop.sh</span><br></pre></td></tr></table></figure><p>ï¼ˆ5ï¼‰å†æ¬¡æŸ¥çœ‹&#x2F;kafka&#x2F;brokers&#x2F;ids è·¯å¾„ä¸Šçš„èŠ‚ç‚¹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 3] ls /kafka/brokers/ids</span><br><span class="line">[0, 1]</span><br></pre></td></tr></table></figure><p>ï¼ˆ6ï¼‰å†æ¬¡æŸ¥çœ‹&#x2F;kafka&#x2F;controller è·¯å¾„ä¸Šçš„æ•°æ®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 15] get /kafka/controller</span><br><span class="line">&#123;&quot;version&quot;:1,&quot;brokerid&quot;:0,&quot;timestamp&quot;:&quot;1637292471777&quot;&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ7ï¼‰å†æ¬¡æŸ¥çœ‹&#x2F;kafka&#x2F;brokers&#x2F;topics&#x2F;first&#x2F;partitions&#x2F;0&#x2F;state è·¯å¾„ä¸Šçš„æ•°æ®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 16] get  /kafka/brokers/topics/first/partitions/0/state</span><br><span class="line">&#123;&quot;controller_epoch&quot;:24,&quot;leader&quot;:0,&quot;version&quot;:1,&quot;leader_epoch&quot;:18,&quot; isr&quot;:[0,1]&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ8ï¼‰å¯åŠ¨ hadoop104 ä¸Šçš„ kafkaã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-server-start.sh -daemon ./config/server.properties</span><br></pre></td></tr></table></figure><p>ï¼ˆ9ï¼‰å†æ¬¡è§‚å¯Ÿï¼ˆ1ï¼‰ã€ï¼ˆ2ï¼‰ã€ï¼ˆ3ï¼‰æ­¥éª¤ä¸­çš„å†…å®¹ã€‚</p><h3 id="Brokeré‡è¦å‚æ•°"><a href="#Brokeré‡è¦å‚æ•°" class="headerlink" title="Brokeré‡è¦å‚æ•°"></a>Brokeré‡è¦å‚æ•°</h3><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/3313f521671b4d9bcc6a02d30e6e2920.png" title="image-20220902203152370"> <img src="/img/loading.gif" data-lazy-src="/posts/f351760e/bc280b8c039123a6d33d66be93eb26ac.png" title="image-20220902203207882"><h2 id="èŠ‚ç‚¹æœå½¹å’Œé€€å½¹"><a href="#èŠ‚ç‚¹æœå½¹å’Œé€€å½¹" class="headerlink" title="èŠ‚ç‚¹æœå½¹å’Œé€€å½¹"></a>èŠ‚ç‚¹æœå½¹å’Œé€€å½¹</h2><h3 id="æœå½¹æ–°èŠ‚ç‚¹"><a href="#æœå½¹æ–°èŠ‚ç‚¹" class="headerlink" title="æœå½¹æ–°èŠ‚ç‚¹"></a>æœå½¹æ–°èŠ‚ç‚¹</h3><p>(1) å¯åŠ¨ä¸€å°æ–°çš„KafKaæœåŠ¡ç«¯ï¼ˆåŠ å…¥åŸæœ‰çš„Zookeeperé›†ç¾¤ï¼‰</p><p>(2) æŸ¥çœ‹åŸæœ‰çš„ åˆ†åŒºä¿¡æ¯ describe</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">kafka-topics.sh --bootstrap-server 47.106.86.64:9092 --topic first --describe</span></span><br><span class="line"></span><br><span class="line">Topic: first	TopicId: 4DtkHPe4R1KyXNF7QyVqBA	PartitionCount: 3	ReplicationFactor: 3	Configs: segment.bytes=1073741824</span><br><span class="line">	Topic: first	Partition: 0	Leader: 1	Replicas: 2,1,0	Isr: 1,0</span><br><span class="line">	Topic: first	Partition: 1	Leader: 0	Replicas: 0,1,2	Isr: 0,1</span><br><span class="line">	Topic: first	Partition: 2	Leader: 1	Replicas: 1,2,0	Isr: 1,0</span><br></pre></td></tr></table></figure><p>(3) æŒ‡å®šéœ€è¦å‡è¡¡çš„ä¸»é¢˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vim topics-to-move.json</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"> &quot;topics&quot;: [</span><br><span class="line"> &#123;&quot;topic&quot;: &quot;first&quot;&#125;</span><br><span class="line"> ],</span><br><span class="line"> &quot;version&quot;: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(4) ç”Ÿæˆè´Ÿè½½å‡è¡¡è®¡åˆ’(åªæ˜¯ç”Ÿæˆè®¡åˆ’)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-reassign-partitions.sh --bootstrap-server 47.106.86.64:9092 --topics-to-move-json-file topics-to-move.json --broker-list &quot;0,1,2,3&quot; --generate</span><br><span class="line"></span><br><span class="line">Current partition replica assignment</span><br><span class="line">&#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:0,&quot;replic</span><br><span class="line">as&quot;:[0,2,1],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]&#125;,&#123;&quot;topic&quot;:&quot;first&quot;,&quot;par</span><br><span class="line">tition&quot;:1,&quot;replicas&quot;:[2,1,0],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]&#125;,&#123;&quot;to</span><br><span class="line">pic&quot;:&quot;first&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[1,0,2],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;</span><br><span class="line">any&quot;,&quot;any&quot;]&#125;]&#125;</span><br><span class="line">Proposed partition reassignment configuration</span><br><span class="line">&#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:0,&quot;replic</span><br><span class="line">as&quot;:[2,3,0],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]&#125;,&#123;&quot;topic&quot;:&quot;first&quot;,&quot;par</span><br><span class="line">tition&quot;:1,&quot;replicas&quot;:[3,0,1],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]&#125;,&#123;&quot;to</span><br><span class="line">pic&quot;:&quot;first&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[0,1,2],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;</span><br><span class="line">any&quot;,&quot;any&quot;]&#125;]&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰åˆ›å»ºå‰¯æœ¬å­˜å‚¨è®¡åˆ’ï¼ˆæ‰€æœ‰å‰¯æœ¬å­˜å‚¨åœ¨ broker0ã€broker1ã€broker2ã€broker3 ä¸­ï¼‰ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim increase-replication-factor.json</span><br><span class="line"></span><br><span class="line">&#123;&quot;version&quot;:1,&quot;partitions&quot;:[&#123;&quot;topic&quot;:&quot;first&quot;,&quot;partition&quot;:0,&quot;replic</span><br><span class="line">as&quot;:[2,3,0],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]&#125;,&#123;&quot;topic&quot;:&quot;first&quot;,&quot;par</span><br><span class="line">tition&quot;:1,&quot;replicas&quot;:[3,0,1],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;any&quot;,&quot;any&quot;]&#125;,&#123;&quot;to</span><br><span class="line">pic&quot;:&quot;first&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[0,1,2],&quot;log_dirs&quot;:[&quot;any&quot;,&quot;</span><br><span class="line">any&quot;,&quot;any&quot;]&#125;]&#125;</span><br></pre></td></tr></table></figure><p>(5) æ‰§è¡Œå‰¯æœ¬è®¡åˆ’</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-reassign-partitions.sh --bootstrap-server 47.106.86.64:9092 --reassignment-json-file increase-replication-factor.json --execute</span><br></pre></td></tr></table></figure><p>(6) éªŒè¯è®¡åˆ’</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kafka-reassign-partitions.sh --bootstrap-server 47.106.86.64:9092 --reassignment-json-file increase-replication-factor.json --verify</span><br><span class="line"></span><br><span class="line">Status of partition reassignment:</span><br><span class="line">Reassignment of partition first-0 is complete.</span><br><span class="line">Reassignment of partition first-1 is complete.</span><br><span class="line">Reassignment of partition first-2 is complete.</span><br><span class="line">Clearing broker-level throttles on brokers 0,1,2,3</span><br><span class="line">Clearing topic-level throttles on topic first</span><br></pre></td></tr></table></figure><h3 id="é€€å½¹æ—§èŠ‚ç‚¹"><a href="#é€€å½¹æ—§èŠ‚ç‚¹" class="headerlink" title="é€€å½¹æ—§èŠ‚ç‚¹"></a>é€€å½¹æ—§èŠ‚ç‚¹</h3><p><strong>1ï¼‰æ‰§è¡Œè´Ÿè½½å‡è¡¡æ“ä½œ</strong><br>å…ˆæŒ‰ç…§é€€å½¹ä¸€å°èŠ‚ç‚¹ï¼Œç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼Œç„¶åæŒ‰ç…§æœå½¹æ—¶æ“ä½œæµç¨‹æ‰§è¡Œè´Ÿè½½å‡è¡¡ã€‚</p><p>ä¸åŒäºæœå½¹è®¡åˆ’çš„ <code>--broker-list &quot;0,1,2&quot;</code> é€€å½¹äº† Broker3 ï¼›</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-reassign-partitions.sh --bootstrap-server 47.106.86.64:9092 --topics-to-move-json-file topics-to-move.json --broker-list &quot;0,1,2&quot; --generate</span><br></pre></td></tr></table></figure><h2 id="å‰¯æœ¬æœºåˆ¶"><a href="#å‰¯æœ¬æœºåˆ¶" class="headerlink" title="å‰¯æœ¬æœºåˆ¶"></a>å‰¯æœ¬æœºåˆ¶</h2><h3 id="å‰¯æœ¬åŸºæœ¬ä¿¡æ¯"><a href="#å‰¯æœ¬åŸºæœ¬ä¿¡æ¯" class="headerlink" title="å‰¯æœ¬åŸºæœ¬ä¿¡æ¯"></a>å‰¯æœ¬åŸºæœ¬ä¿¡æ¯</h3><ul><li><strong>Replica</strong> ï¼šå‰¯æœ¬ï¼ŒåŒä¸€åˆ†åŒºçš„ä¸åŒå‰¯æœ¬ä¿å­˜çš„æ˜¯ç›¸åŒçš„æ¶ˆæ¯ï¼Œä¸ºä¿è¯é›†ç¾¤ä¸­çš„æŸä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œè¯¥èŠ‚ç‚¹ä¸Šçš„ partition <strong>æ•°æ®ä¸ä¸¢å¤± ï¼Œæé«˜å‰¯æœ¬å¯é æ€§</strong>ï¼Œä¸” kafka ä»ç„¶èƒ½å¤Ÿç»§ç»­å·¥ä½œï¼Œkafka æä¾›äº†å‰¯æœ¬æœºåˆ¶ï¼Œä¸€ä¸ª topic çš„æ¯ä¸ªåˆ†åŒºéƒ½æœ‰è‹¥å¹²ä¸ªå‰¯æœ¬ï¼Œä¸€ä¸ª leader å’Œè‹¥å¹²ä¸ª followerã€‚</li><li><strong>Leader</strong> ï¼šæ¯ä¸ªåˆ†åŒºçš„å¤šä¸ªå‰¯æœ¬ä¸­çš„&quot;ä¸»å‰¯æœ¬&quot;ï¼Œç”Ÿäº§è€…ä»¥åŠæ¶ˆè´¹è€…<strong>åªä¸ Leader äº¤äº’</strong>ã€‚</li><li><strong>Follower</strong> ï¼šæ¯ä¸ªåˆ†åŒºçš„å¤šä¸ªå‰¯æœ¬ä¸­çš„&quot;ä»å‰¯æœ¬&quot;ï¼Œè´Ÿè´£å®æ—¶ä» Leader ä¸­åŒæ­¥æ•°æ®ï¼Œä¿æŒå’Œ Leader æ•°æ®çš„åŒæ­¥ã€‚Leader å‘ç”Ÿæ•…éšœæ—¶ï¼Œä» Follower å‰¯æœ¬ä¸­é‡æ–°é€‰ä¸¾æ–°çš„ Leader å‰¯æœ¬å¯¹å¤–æä¾›æœåŠ¡ã€‚</li></ul><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/1c5cd091fee1ef3c76fcc1c13dccf7de.png" title="image-20220902201925254"><ul><li><strong>AR</strong>:åˆ†åŒºä¸­çš„æ‰€æœ‰ Replica ç»Ÿç§°ä¸º AR &#x3D; ISR +OSR</li><li><strong>ISR</strong>:æ‰€æœ‰ä¸ Leader å‰¯æœ¬ä¿æŒä¸€å®šç¨‹åº¦åŒæ­¥çš„Replica(åŒ…æ‹¬ Leader å‰¯æœ¬åœ¨å†…)ç»„æˆ ISR</li><li><strong>OSR</strong>:ä¸ Leader å‰¯æœ¬åŒæ­¥æ»åè¿‡å¤šçš„ Replica ç»„æˆäº† OSR</li><li><strong>LEO</strong>:æ¯ä¸ªå‰¯æœ¬éƒ½æœ‰å†…éƒ¨çš„LEOï¼Œä»£è¡¨å½“å‰é˜Ÿåˆ—æ¶ˆæ¯çš„æœ€åä¸€æ¡åç§»é‡offset + 1ã€‚</li><li><strong>HW</strong>:é«˜æ°´ä½ï¼Œä»£è¡¨æ‰€æœ‰ISRä¸­çš„LEOæœ€ä½çš„é‚£ä¸ªoffsetï¼Œä¹Ÿæ˜¯æ¶ˆè´¹è€…å¯è§çš„æœ€å¤§æ¶ˆæ¯offsetã€‚</li></ul><h3 id="å‰¯æœ¬é€‰ä¸¾Leader"><a href="#å‰¯æœ¬é€‰ä¸¾Leader" class="headerlink" title="å‰¯æœ¬é€‰ä¸¾Leader"></a>å‰¯æœ¬é€‰ä¸¾Leader</h3><p>Kafka é›†ç¾¤ä¸­æœ‰ä¸€ä¸ª broker çš„ Controller ä¼šè¢«é€‰ä¸¾ä¸º Controller Leader (4.2.2) ï¼Œè´Ÿè´£ç®¡ç†é›†ç¾¤Broker çš„ä¸Šä¸‹çº¿ï¼Œæ‰€æœ‰ topic çš„åˆ†åŒºå‰¯æœ¬åˆ†é…å’Œ Leader é€‰ä¸¾ç­‰å·¥ä½œã€‚</p><p>Brokerä¸­Controller çš„ä¿¡æ¯åŒæ­¥å·¥ä½œæ˜¯ä¾èµ–äº Zookeeper çš„ .&#x2F;broker&#x2F;topic ç›®å½•ä¸‹çš„ä¿¡æ¯ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/f8a5692cec80d597c164b8aea6a9b135.png" title="image-20220902205616764"><p><strong>ç»“è®ºå…ˆè¡Œï¼š å¦‚æœleaderå‰¯æœ¬ä¸‹çº¿ï¼Œ ä¼šåœ¨ISRé˜Ÿåˆ—ä¸­å­˜æ´»ä¸ºå‰æï¼ŒæŒ‰ç…§Replicasé˜Ÿåˆ—ä¸­å‰é¢ä¼˜å…ˆçš„åŸåˆ™ã€‚</strong></p><p>â†“â†“â†“</p><p>ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ªæ–°çš„ topicï¼Œ4 ä¸ªåˆ†åŒºï¼Œ4 ä¸ªå‰¯æœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics.sh --bootstrap-server 47.106.86.64:9092 --create --topic atguigu1 --partitions 4 --replication-factor 4</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰æŸ¥çœ‹ Leader åˆ†å¸ƒæƒ…å†µ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics.sh --bootstrap-server 47.106.86.64:9092 --describe --topic atguigu1</span><br><span class="line"></span><br><span class="line">Topic: atguigu1 TopicId: awpgX_7WR-OX3Vl6HE8sVg PartitionCount: 4 ReplicationFactor: 4</span><br><span class="line">Configs: segment.bytes=1073741824</span><br><span class="line">Topic: atguigu1 Partition: 0 Leader: 3 Replicas: 3,0,2,1 Isr: 3,0,2,1</span><br><span class="line">Topic: atguigu1 Partition: 1 Leader: 1 Replicas: 1,2,3,0 Isr: 1,2,3,0</span><br><span class="line">Topic: atguigu1 Partition: 2 Leader: 0 Replicas: 0,3,1,2 Isr: 0,3,1,2</span><br><span class="line">Topic: atguigu1 Partition: 3 Leader: 2 Replicas: 2,1,0,3 Isr: 2,1,0,3</span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰åœæ­¢æ‰ hadoop105 çš„ kafka è¿›ç¨‹ï¼Œå¹¶æŸ¥çœ‹ Leader åˆ†åŒºæƒ…å†µ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">kafka-server-stop.sh</span><br><span class="line"></span><br><span class="line">kafka-topics.sh --bootstrap-server 47.106.86.64:9092 --describe --topic atguigu1</span><br><span class="line"></span><br><span class="line">Topic: atguigu1 TopicId: awpgX_7WR-OX3Vl6HE8sVg PartitionCount: 4 ReplicationFactor: 4</span><br><span class="line">Configs: segment.bytes=1073741824</span><br><span class="line">Topic: atguigu1 Partition: 0 Leader: 0 Replicas: 3,0,2,1 Isr: 0,2,1</span><br><span class="line">Topic: atguigu1 Partition: 1 Leader: 1 Replicas: 1,2,3,0 Isr: 1,2,0</span><br><span class="line">Topic: atguigu1 Partition: 2 Leader: 0 Replicas: 0,3,1,2 Isr: 0,1,2</span><br><span class="line">Topic: atguigu1 Partition: 3 Leader: 2 Replicas: 2,1,0,3 Isr: 2,1,0</span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰åœæ­¢æ‰ hadoop104 çš„ kafka è¿›ç¨‹ï¼Œå¹¶æŸ¥çœ‹ Leader åˆ†åŒºæƒ…å†µ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kafka-server-stop.sh</span><br><span class="line">kafka-topics.sh --bootstrap-server 47.106.86.64:9092 --describe  --topic atguigu1</span><br><span class="line"></span><br><span class="line">Topic: atguigu1 TopicId: awpgX_7WR-OX3Vl6HE8sVg PartitionCount: 4 ReplicationFactor: 4</span><br><span class="line">Configs: segment.bytes=1073741824</span><br><span class="line">Topic: atguigu1 Partition: 0 Leader: 0 Replicas: 3,0,2,1 Isr: 0,1</span><br><span class="line">Topic: atguigu1 Partition: 1 Leader: 1 Replicas: 1,2,3,0 Isr: 1,0</span><br><span class="line">Topic: atguigu1 Partition: 2 Leader: 0 Replicas: 0,3,1,2 Isr: 0,1</span><br><span class="line">Topic: atguigu1 Partition: 3 Leader: 1 Replicas: 2,1,0,3 Isr: 1,0</span><br></pre></td></tr></table></figure><h3 id="å‰¯æœ¬æ•…éšœå¤„ç†"><a href="#å‰¯æœ¬æ•…éšœå¤„ç†" class="headerlink" title="å‰¯æœ¬æ•…éšœå¤„ç†"></a>å‰¯æœ¬æ•…éšœå¤„ç†</h3><h4 id="followeræ•…éšœæµç¨‹"><a href="#followeræ•…éšœæµç¨‹" class="headerlink" title="followeræ•…éšœæµç¨‹"></a><strong>followeræ•…éšœæµç¨‹</strong></h4><p>å¦‚æœfollowerè½åleaderè¿‡å¤šï¼Œä½“ç°åœ¨<strong>è½åæ—¶é—´</strong> repca.lag.time.max.ms ï¼Œæˆ–è€…<strong>è½ååç§»é‡</strong>repca.lag.max.messages(ç”±äºkafkaç”Ÿæˆé€Ÿåº¦ä¸å¥½ç•Œå®šï¼Œåé¢å–æ¶ˆäº†è¯¥å‚æ•°)ï¼Œfollowerå°±ä¼šè¢«ç§»é™¤ISRé˜Ÿåˆ—ï¼Œç­‰å¾…è¯¥é˜Ÿåˆ—LEOè¿½ä¸ŠHWï¼Œæ‰ä¼šé‡æ–°åŠ å…¥ISRä¸­ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/b01dad78f006b40d82e719fe71caeb78.png" title="image-20220902210759125"><h4 id="leaderæ•…éšœæµç¨‹"><a href="#leaderæ•…éšœæµç¨‹" class="headerlink" title="leaderæ•…éšœæµç¨‹"></a><strong>leaderæ•…éšœæµç¨‹</strong></h4><p>æ—§Leaderå…ˆè¢«ä»ISRé˜Ÿåˆ—ä¸­è¸¢å‡ºï¼Œç„¶åä»ISRä¸­é€‰å‡ºä¸€ä¸ªæ–°çš„Leaderæ¥ï¼›æ­¤æ—¶ä¸ºäº†ä¿è¯å¤šä¸ªå‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå…¶ä»–çš„followerä¼šå…ˆå°†å„è‡ªçš„logæ–‡ä»¶ä¸­<strong>é«˜äºHWçš„éƒ¨åˆ†æˆªå–æ‰</strong>ï¼Œç„¶åä»æ–°çš„leaderåŒæ­¥æ•°æ®ï¼ˆç”±æ­¤å¯çŸ¥è¿™åªèƒ½ä¿è¯å‰¯æœ¬ä¹‹é—´æ•°æ®ä¸€è‡´æ€§ï¼Œå¹¶ä¸èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±æˆ–è€…ä¸é‡å¤ï¼‰ã€‚ä½“ç°äº†è®¾ç½®ACK-allçš„é‡è¦æ€§ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/1f96e55810be5ff8cbf64c04b5d37315.png" title="image-20220902210830344"><h3 id="åˆ†åŒºå‰¯æœ¬åˆ†é…"><a href="#åˆ†åŒºå‰¯æœ¬åˆ†é…" class="headerlink" title="åˆ†åŒºå‰¯æœ¬åˆ†é…"></a>åˆ†åŒºå‰¯æœ¬åˆ†é…</h3><p>å¦‚æœ kafka æœåŠ¡å™¨åªæœ‰ 4 ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆè®¾ç½® kafka çš„åˆ†åŒºæ•°å¤§äºæœåŠ¡å™¨å°æ•°ï¼Œåœ¨ kafkaåº•å±‚å¦‚ä½•åˆ†é…å­˜å‚¨å‰¯æœ¬å‘¢ï¼Ÿ<br>1ï¼‰åˆ›å»º 16 åˆ†åŒºï¼Œ3 ä¸ªå‰¯æœ¬<br>ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ªæ–°çš„ topicï¼Œåç§°ä¸º secondã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics.sh --bootstrap-server 47.106.86.64:9092 --create --partitions 16 --replication-factor 3 --topic second</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰æŸ¥çœ‹åˆ†åŒºå’Œå‰¯æœ¬æƒ…å†µã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics.sh --bootstrap-server 47.106.86.64:9092  --describe --topic second</span><br><span class="line"></span><br><span class="line">Topic: second4 Partition: 0 Leader: 0 Replicas: 0,1,2 Isr: 0,1,2</span><br><span class="line">Topic: second4 Partition: 1 Leader: 1 Replicas: 1,2,3 Isr: 1,2,3</span><br><span class="line">Topic: second4 Partition: 2 Leader: 2 Replicas: 2,3,0 Isr: 2,3,0</span><br><span class="line">Topic: second4 Partition: 3 Leader: 3 Replicas: 3,0,1 Isr: 3,0,1</span><br><span class="line">Topic: second4 Partition: 4 Leader: 0 Replicas: 0,2,3 Isr: 0,2,3</span><br><span class="line">Topic: second4 Partition: 5 Leader: 1 Replicas: 1,3,0 Isr: 1,3,0</span><br><span class="line">Topic: second4 Partition: 6 Leader: 2 Replicas: 2,0,1 Isr: 2,0,1</span><br><span class="line">Topic: second4 Partition: 7 Leader: 3 Replicas: 3,1,2 Isr: 3,1,2</span><br><span class="line">Topic: second4 Partition: 8 Leader: 0 Replicas: 0,3,1 Isr: 0,3,1</span><br><span class="line">Topic: second4 Partition: 9 Leader: 1 Replicas: 1,0,2 Isr: 1,0,2</span><br><span class="line">Topic: second4 Partition: 10 Leader: 2 Replicas: 2,1,3 Isr: 2,1,3</span><br><span class="line">Topic: second4 Partition: 11 Leader: 3 Replicas: 3,2,0 Isr: 3,2,0</span><br><span class="line">Topic: second4 Partition: 12 Leader: 0 Replicas: 0,1,2 Isr: 0,1,2</span><br><span class="line">Topic: second4 Partition: 13 Leader: 1 Replicas: 1,2,3 Isr: 1,2,3</span><br><span class="line">Topic: second4 Partition: 14 Leader: 2 Replicas: 2,3,0 Isr: 2,3,0</span><br><span class="line">Topic: second4 Partition: 15 Leader: 3 Replicas: 3,0,1 Isr: 3,0,1</span><br></pre></td></tr></table></figure><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/15514da0f22aca9e3017fa2305733ba4.png" title="image-20220902211334365"><h3 id="æ‰‹åŠ¨è°ƒæ•´åˆ†åŒºå‰¯æœ¬"><a href="#æ‰‹åŠ¨è°ƒæ•´åˆ†åŒºå‰¯æœ¬" class="headerlink" title="æ‰‹åŠ¨è°ƒæ•´åˆ†åŒºå‰¯æœ¬"></a>æ‰‹åŠ¨è°ƒæ•´åˆ†åŒºå‰¯æœ¬</h3><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/b4b0afba1f2d4f558a6b36a57b20aa0e.png" title="image-20220902211501656"><p>æ‰‹åŠ¨è°ƒæ•´åˆ†åŒºå‰¯æœ¬å­˜å‚¨çš„æ­¥éª¤å¦‚ä¸‹ï¼š<br>ï¼ˆ1ï¼‰åˆ›å»ºä¸€ä¸ªæ–°çš„ topicï¼Œåç§°ä¸º threeã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics.sh --bootstrap-server  47.106.86.64:9092  --create --partitions 4 --replication-factor 2 --topic three</span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰åˆ›å»ºå‰¯æœ¬å­˜å‚¨è®¡åˆ’ï¼ˆæ‰€æœ‰å‰¯æœ¬éƒ½æŒ‡å®šå­˜å‚¨åœ¨ broker0ã€broker1 ä¸­ï¼‰ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vim increase-replication-factor.json</span></span><br><span class="line">è¾“å…¥å¦‚ä¸‹å†…å®¹ï¼š</span><br><span class="line">&#123;</span><br><span class="line">&quot;version&quot;:1,</span><br><span class="line">&quot;partitions&quot;:[</span><br><span class="line">&#123;&quot;topic&quot;:&quot;three&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[0,1]&#125;,</span><br><span class="line">&#123;&quot;topic&quot;:&quot;three&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[0,1]&#125;,</span><br><span class="line">&#123;&quot;topic&quot;:&quot;three&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[1,0]&#125;,</span><br><span class="line">&#123;&quot;topic&quot;:&quot;three&quot;,&quot;partition&quot;:3,&quot;replicas&quot;:[1,0]&#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰æ‰§è¡Œå‰¯æœ¬å­˜å‚¨è®¡åˆ’ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-reassign-partitions.sh --bootstrap-server  47.106.86.64:9092  --reassignment-json-file increase-replication-factor.json --execute</span><br></pre></td></tr></table></figure><p>ï¼ˆ5ï¼‰éªŒè¯å‰¯æœ¬å­˜å‚¨è®¡åˆ’ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-reassign-partitions.sh --bootstrap-server  47.106.86.64:9092  --reassignment-json-file increase-replication-factor.json --verify</span><br></pre></td></tr></table></figure><h3 id="åˆ†åŒºè‡ªåŠ¨è°ƒæ•´"><a href="#åˆ†åŒºè‡ªåŠ¨è°ƒæ•´" class="headerlink" title="åˆ†åŒºè‡ªåŠ¨è°ƒæ•´"></a><strong>åˆ†åŒºè‡ªåŠ¨è°ƒæ•´</strong></h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„åˆ†åŒºéƒ½æ˜¯å¹³è¡¡æ•£è½åœ¨brokerçš„ï¼Œéšç€ä¸€äº›brokeræ•…éšœï¼Œä¼šæ…¢æ…¢å‡ºç°leaderé›†ä¸­åœ¨æŸå°brokerä¸Šçš„æƒ…å†µï¼Œé€ æˆé›†ç¾¤è´Ÿè½½ä¸å‡è¡¡ï¼Œè¿™æ—¶å€™å°±éœ€è¦åˆ†åŒºå¹³è¡¡ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/6a7af1df3bfe1be9186ac95ee3bee67d.png" title="image-20220902212238315"><p>ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜kafkaå‡ºç°äº†è‡ªåŠ¨å¹³è¡¡çš„æœºåˆ¶ã€‚kafkaæä¾›äº†ä¸‹é¢å‡ ä¸ªå‚æ•°è¿›è¡Œæ§åˆ¶ï¼š</p><ul><li><code>auto.leader.rebalance.enable</code>ï¼šè‡ªåŠ¨leader paritionå¹³è¡¡ï¼Œé»˜è®¤æ˜¯true;</li><li><code>leader.imbalance.per.broker.percentage</code>ï¼šæ¯ä¸ªbrokerå…è®¸çš„ä¸å¹³è¡¡çš„leaderçš„æ¯”ç‡ï¼Œé»˜è®¤æ˜¯10%ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªå€¼ï¼Œæ§åˆ¶å™¨å°†ä¼šè§¦å‘leaderçš„å¹³è¡¡</li><li><code>leader.imbalance.check.interval.seconds</code>ï¼šæ£€æŸ¥leaderè´Ÿè½½æ˜¯å¦å¹³è¡¡çš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤æ˜¯300ç§’</li><li>ä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ˜¯ä¸å¼€å¯è¿™ä¸ªè‡ªåŠ¨å¹³è¡¡ï¼Œå› ä¸ºè§¦å‘leader partitionçš„è‡ªåŠ¨å¹³è¡¡ä¼šæŸè€—æ€§èƒ½ï¼Œæˆ–è€…å¯ä»¥å°†è§¦å‘è‡ªåŠ¨å¹³å’Œçš„å‚æ•°<code>leader.imbalance.per.broker.percentage</code>çš„å€¼è°ƒå¤§ç‚¹ã€‚</li></ul><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®ï¼Œç„¶åæ‰‹åŠ¨è§¦å‘åˆ†åŒºçš„å†å¹³è¡¡ã€‚</p><h3 id="å¢åŠ å‰¯æœ¬å› å­"><a href="#å¢åŠ å‰¯æœ¬å› å­" class="headerlink" title="å¢åŠ å‰¯æœ¬å› å­"></a>å¢åŠ å‰¯æœ¬å› å­</h3><p>åœ¨ç”Ÿäº§ç¯å¢ƒå½“ä¸­ï¼Œç”±äºæŸä¸ªä¸»é¢˜çš„é‡è¦ç­‰çº§éœ€è¦æå‡ï¼Œæˆ‘ä»¬è€ƒè™‘å¢åŠ å‰¯æœ¬ã€‚å‰¯æœ¬æ•°çš„å¢åŠ éœ€è¦å…ˆåˆ¶å®šè®¡åˆ’ï¼Œç„¶åæ ¹æ®è®¡åˆ’æ‰§è¡Œã€‚<br>ä¸èƒ½é€šè¿‡å‘½ä»¤è¡Œçš„æ–¹æ³•æ·»åŠ å‰¯æœ¬ã€‚<br>1ï¼‰åˆ›å»º topic</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --bootstrap-server 47.106.86.64:9092 --create --partitions 3 --replication-factor 1 --topic four</span><br></pre></td></tr></table></figure><p>2ï¼‰æ‰‹åŠ¨å¢åŠ å‰¯æœ¬å­˜å‚¨<br>ï¼ˆ1ï¼‰åˆ›å»ºå‰¯æœ¬å­˜å‚¨è®¡åˆ’ï¼ˆæ‰€æœ‰å‰¯æœ¬éƒ½æŒ‡å®šå­˜å‚¨åœ¨ broker0ã€broker1ã€broker2 ä¸­ï¼‰ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim increase-replication-factor.json</span><br><span class="line"></span><br><span class="line">&#123;&quot;version&quot;:1,&quot;partitions&quot;:[</span><br><span class="line">&#123;&quot;topic&quot;:&quot;four&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[0,1,2]&#125;,</span><br><span class="line">&#123;&quot;topic&quot;:&quot;four&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[0,1,2]&#125;,</span><br><span class="line">&#123;&quot;topic&quot;:&quot;four&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[0,1,2]&#125;]&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰æ‰§è¡Œå‰¯æœ¬å­˜å‚¨è®¡åˆ’ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-reassign-partitions.sh --bootstrap-server 47.106.86.64:9092 --reassignment-json-file increase-replication-factor.json --execute</span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶å­˜å‚¨"><a href="#æ–‡ä»¶å­˜å‚¨" class="headerlink" title="æ–‡ä»¶å­˜å‚¨"></a>æ–‡ä»¶å­˜å‚¨</h2><h3 id="å­˜å‚¨ç»“æ„"><a href="#å­˜å‚¨ç»“æ„" class="headerlink" title="å­˜å‚¨ç»“æ„"></a><strong>å­˜å‚¨ç»“æ„</strong></h3><p>åœ¨Kafkaä¸­ä¸»é¢˜ï¼ˆTopicï¼‰æ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œåˆ†åŒºï¼ˆpartitionï¼‰æ˜¯ç‰©ç†ä¸Šçš„å­˜åœ¨çš„ã€‚æ¯ä¸ªpartitionå¯¹åº”ä¸€ä¸ªlogæ–‡ä»¶ï¼Œè¯¥logæ–‡ä»¶ä¸­å­˜å‚¨çš„å°±æ˜¯Producerç”Ÿäº§çš„æ•°æ®ã€‚Producerç”Ÿäº§çš„æ•°æ®ä¼šè¢«ä¸æ–­è¿½åŠ åˆ°è¯¥logæ–‡ä»¶æœ«ç«¯ã€‚ä¸ºé˜²æ­¢logæ–‡ä»¶è¿‡å¤§å¯¼è‡´æ•°æ®å®šä½æ•ˆç‡ä½ä¸‹ï¼ŒKafkaé‡‡ç”¨äº†åˆ†ç‰‡å’Œç´¢å¼•æœºåˆ¶ï¼Œå°†æ¯ä¸ªpartitionåˆ†ä¸ºå¤šä¸ªsegmentï¼Œæ¯ä¸ªsegmenté»˜è®¤1Gï¼ˆ <code>log.segment.bytes</code> ï¼‰ï¼Œ æ¯ä¸ªsegmentåŒ…æ‹¬.<strong>index</strong>æ–‡ä»¶ã€<strong>.log</strong>æ–‡ä»¶å’Œ**.timeindex**ç­‰æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶ä½äºæ–‡ä»¶å¤¹ä¸‹ï¼Œè¯¥æ–‡ä»¶å‘½åè§„åˆ™ä¸ºï¼štopicåç§°+åˆ†åŒºå·ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/53141d358a80165c63374044d1bced37.png" title="image-20220902213237928"><p>Segmentçš„ä¸‰ä¸ªæ–‡ä»¶éœ€è¦é€šè¿‡ç‰¹å®šå·¥å…·æ‰“å¼€æ‰èƒ½çœ‹åˆ°ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kafka-run-class.sh kafka.tools.DumpLogSegments --files ./00000000000000000000.index</span><br><span class="line"> </span><br><span class="line">kafka-run-class.sh kafka.tools.DumpLogSegments --files ./00000000000000000000.log</span><br></pre></td></tr></table></figure><p>å½“logæ–‡ä»¶å†™å…¥4kï¼ˆè¿™é‡Œå¯ä»¥é€šè¿‡<code>log.index.interval.bytes</code>è®¾ç½®ï¼‰æ•°æ®ï¼Œå°±ä¼šå†™å…¥ä¸€æ¡ç´¢å¼•ä¿¡æ¯åˆ°indexæ–‡ä»¶ä¸­ï¼Œè¿™æ ·çš„indexç´¢å¼•æ–‡ä»¶å°±æ˜¯ä¸€ä¸ª<strong>ç¨€ç–ç´¢å¼•</strong>ï¼Œå®ƒå¹¶ä¸ä¼šæ¯æ¡æ—¥å¿—éƒ½å»ºç«‹ç´¢å¼•ä¿¡æ¯ã€‚</p><p>å½“KafkaæŸ¥è¯¢ä¸€æ¡offsetå¯¹åº”å®é™…æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥é€šè¿‡indexè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œè·å–æœ€è¿‘çš„ä½ä½offsetï¼Œç„¶åä»ä½ä½offsetå¯¹åº”çš„positionå¼€å§‹ï¼Œä»å®é™…çš„logæ–‡ä»¶ä¸­å¼€å§‹å¾€åæŸ¥æ‰¾å¯¹åº”çš„æ¶ˆæ¯ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/1fab494365192264be6926087c22b042.png" title="image-20220902213631039"><p><code>æ—¶é—´æˆ³ç´¢å¼•æ–‡ä»¶</code>ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¯ä»¥æŸ¥è¯¢æŸä¸€ä¸ªæ—¶é—´æ®µå†…çš„æ¶ˆæ¯ï¼Œå®ƒçš„æ•°æ®ç»“æ„æ˜¯ï¼šæ—¶é—´æˆ³ï¼ˆ8byteï¼‰+ ç›¸å¯¹offsetï¼ˆ4byteï¼‰ï¼Œå¦‚æœè¦ä½¿ç”¨è¿™ä¸ªç´¢å¼•æ–‡ä»¶ï¼Œå…ˆè¦é€šè¿‡æ—¶é—´èŒƒå›´æ‰¾åˆ°å¯¹åº”çš„offsetï¼Œç„¶åå†å»æ‰¾å¯¹åº”çš„indexæ–‡ä»¶æ‰¾åˆ°positionä¿¡æ¯ï¼Œæœ€ååœ¨éå†logæ–‡ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯éœ€è¦ç”¨åˆ°indexç´¢å¼•æ–‡ä»¶çš„ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/6131b946d3ce07c2a1b5640854a43b53.png" title="image-20220902213600127"><h3 id="æ–‡ä»¶æ¸…ç†ç­–ç•¥"><a href="#æ–‡ä»¶æ¸…ç†ç­–ç•¥" class="headerlink" title="****æ–‡ä»¶æ¸…ç†ç­–ç•¥"></a>****æ–‡ä»¶æ¸…ç†ç­–ç•¥</h3><p>Kafkaå°†æ¶ˆæ¯å­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œä¸ºäº†æ§åˆ¶ç£ç›˜å ç”¨ç©ºé—´çš„ä¸æ–­å¢åŠ å°±éœ€è¦å¯¹æ¶ˆæ¯åšä¸€å®šçš„æ¸…ç†æ“ä½œã€‚Kafka ä¸­æ¯ä¸€ä¸ªåˆ†åŒºå‰¯æœ¬éƒ½å¯¹åº”ä¸€ä¸ªLogï¼Œè€ŒLogåˆå¯ä»¥åˆ†ä¸ºå¤šä¸ªæ—¥å¿—åˆ†æ®µï¼Œè¿™æ ·ä¹Ÿä¾¿äºæ—¥å¿—çš„æ¸…ç†æ“ä½œã€‚Kafkaæä¾›äº†ä¸¤ç§æ—¥å¿—æ¸…ç†ç­–ç•¥ã€‚</p><ol><li>æ—¥å¿—åˆ é™¤(delete) :æŒ‰ç…§ä¸€å®šçš„ä¿ç•™ç­–ç•¥ç›´æ¥åˆ é™¤ä¸ç¬¦åˆæ¡ä»¶çš„æ—¥å¿—åˆ†æ®µã€‚</li><li>æ—¥å¿—å‹ç¼©(compact) :é’ˆå¯¹æ¯ä¸ªæ¶ˆæ¯çš„keyè¿›è¡Œæ•´åˆï¼Œå¯¹äºæœ‰ç›¸åŒkeyçš„ä¸åŒvalueå€¼ï¼Œåªä¿ç•™æœ€åä¸€ä¸ªç‰ˆæœ¬ã€‚</li></ol><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹brokerç«¯å‚æ•° <code>log.cleanup.policy</code> æ¥è¿›è¡Œé…ç½®</p><h4 id="æ—¥å¿—åˆ é™¤"><a href="#æ—¥å¿—åˆ é™¤" class="headerlink" title="æ—¥å¿—åˆ é™¤"></a>æ—¥å¿—åˆ é™¤</h4><p>kafkaä¸­é»˜è®¤çš„æ—¥å¿—ä¿å­˜æ—¶é—´ä¸º7å¤©ï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´å¦‚ä¸‹å‚æ•°ä¿®æ”¹ä¿å­˜æ—¶é—´ã€‚</p><ul><li><code>log.retention.hours</code>ï¼šæœ€ä½ä¼˜å…ˆçº§å°æ—¶ï¼Œé»˜è®¤7å¤©</li><li><code>log.retention.minutes</code>ï¼šåˆ†é’Ÿ</li><li><code>log.retention.ms</code>ï¼šæœ€é«˜ä¼˜å…ˆçº§æ¯«ç§’</li><li><code>log.retention.check.interval.ms</code>ï¼šè´Ÿè´£è®¾ç½®æ£€æŸ¥å‘¨æœŸï¼Œé»˜è®¤5åˆ†é’Ÿ</li><li><code>file.delete.delay.ms</code>ï¼šå»¶è¿Ÿæ‰§è¡Œåˆ é™¤æ—¶é—´</li><li><code>log.retention.bytes</code>ï¼šå½“è®¾ç½®ä¸º-1æ—¶è¡¨ç¤ºè¿è¡Œä¿ç•™æ—¥å¿—æœ€å¤§å€¼ï¼ˆç›¸å½“äºå…³é—­ï¼‰ï¼›å½“è®¾ç½®ä¸º1Gæ—¶ï¼Œè¡¨ç¤ºæ—¥å¿—æ–‡ä»¶æœ€å¤§å€¼</li></ul><p>å…·ä½“çš„ä¿ç•™æ—¥å¿—ç­–ç•¥æœ‰ä¸‰ç§ï¼š</p><p><strong>åŸºäºæ—¶é—´ç­–ç•¥</strong></p><p>æ—¥å¿—åˆ é™¤ä»»åŠ¡ä¼šå‘¨æœŸæ£€æŸ¥å½“å‰æ—¥å¿—æ–‡ä»¶ä¸­æ˜¯å¦æœ‰ä¿ç•™æ—¶é—´è¶…è¿‡è®¾å®šçš„é˜ˆå€¼æ¥å¯»æ‰¾å¯åˆ é™¤çš„æ—¥å¿—æ®µæ–‡ä»¶é›†åˆï¼›è¿™é‡Œéœ€è¦æ³¨æ„log.retentionå‚æ•°çš„ä¼˜å…ˆçº§ï¼š<code>log.retention.ms &gt; log.retention.minutes &gt; log.retention.hours</code>ï¼Œé»˜è®¤åªä¼šé…ç½®log.retention.hourså‚æ•°ï¼Œå€¼ä¸º168å³ä¸º<strong>7</strong>å¤©ã€‚</p><p>åˆ é™¤è¿‡æœŸçš„æ—¥å¿—æ®µæ–‡ä»¶ï¼Œå¹¶ä¸æ˜¯ç®€å•çš„æ ¹æ®æ—¥å¿—æ®µæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´è®¡ç®—ï¼Œè€Œæ˜¯è¦æ ¹æ®è¯¥æ—¥å¿—æ®µä¸­æœ€å¤§çš„æ—¶é—´æˆ³æ¥è®¡ç®—çš„ï¼Œé¦–å…ˆè¦æŸ¥è¯¢è¯¥æ—¥å¿—åˆ†æ®µæ‰€å¯¹åº”çš„æ—¶é—´æˆ³ç´¢å¼•æ–‡ä»¶ï¼ŒæŸ¥æ‰¾è¯¥æ—¶é—´æˆ³ç´¢å¼•æ–‡ä»¶çš„æœ€åä¸€æ¡ç´¢å¼•æ•°æ®ï¼Œå¦‚æœæ—¶é—´æˆ³å¤§äº0å°±å–å€¼ï¼Œå¦åˆ™æ‰ä¼šä½¿ç”¨æœ€è¿‘ä¿®æ”¹æ—¶é—´ã€‚</p><p>åœ¨åˆ é™¤çš„æ—¶å€™å…ˆä»Logå¯¹è±¡æ‰€ç»´æŠ¤çš„æ—¥å¿—æ®µçš„è·³è·ƒè¡¨ä¸­ç§»é™¤è¦åˆ é™¤çš„æ—¥å¿—æ®µï¼Œç”¨æ¥ç¡®ä¿å·²ç»æ²¡æœ‰çº¿ç¨‹æ¥è¯»å–è¿™äº›æ—¥å¿—æ®µï¼›æ¥ç€å°†æ—¥å¿—æ®µæ‰€å¯¹åº”çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬ç´¢å¼•æ–‡ä»¶éƒ½æ·»åŠ ä¸Š**.deleted<strong>çš„åç¼€ï¼›æœ€åäº¤ç»™ä¸€ä¸ªä»¥</strong>delete-file<strong>å‘½åçš„å»¶è¿Ÿä»»åŠ¡æ¥åˆ é™¤è¿™äº›ä»¥</strong>.deleted<strong>ä¸ºåç¼€çš„æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯1åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œå¯ä»¥é€šè¿‡</strong>file.delete.delay.ms**æ¥é…ç½®ã€‚</p><p><strong>åŸºäºæ—¥å¿—å¤§å°ç­–ç•¥</strong></p><p>æ—¥å¿—åˆ é™¤ä»»åŠ¡ä¼šå‘¨æœŸæ€§æ£€æŸ¥å½“å‰æ—¥å¿—å¤§å°æ˜¯å¦è¶…è¿‡è®¾å®šçš„é˜ˆå€¼ï¼ˆlog.retention.bytesï¼Œé»˜è®¤æ˜¯-1ï¼Œè¡¨ç¤ºæ— ç©·å¤§ï¼‰ï¼Œå°±ä»ç¬¬ä¸€ä¸ªæ—¥å¿—åˆ†æ®µä¸­å¯»æ‰¾å¯åˆ é™¤çš„æ—¥å¿—æ®µæ–‡ä»¶é›†åˆã€‚å¦‚æœè¶…è¿‡é˜ˆå€¼ï¼Œ</p><p><strong>åŸºäºæ—¥å¿—èµ·å§‹åç§»é‡</strong></p><p>è¯¥ç­–ç•¥åˆ¤æ–­ä¾æ®æ˜¯æ—¥å¿—æ®µçš„ä¸‹ä¸€ä¸ªæ—¥å¿—æ®µçš„èµ·å§‹åç§»é‡ baseOffsetæ˜¯å¦å°äºç­‰äº logStartOffsetï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å¯ä»¥åˆ é™¤æ­¤æ—¥å¿—åˆ†æ®µã€‚è¿™é‡Œè¯´ä¸€ä¸‹logStartOffsetï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ—¥å¿—æ–‡ä»¶çš„èµ·å§‹åç§»é‡ logStartOffsetç­‰äºç¬¬ä¸€ä¸ªæ—¥å¿—åˆ†æ®µçš„ baseOffsetï¼Œä½†è¿™å¹¶ä¸æ˜¯ç»å¯¹çš„ï¼ŒlogStartOffsetçš„å€¼å¯ä»¥é€šè¿‡ <strong>DeleteRecordsRequest</strong>è¯·æ±‚ã€ä½¿ç”¨ <strong>kafka-delete-records.sh è„šæœ¬ã€æ—¥å¿—çš„æ¸…ç†å’Œæˆªæ–­</strong>ç­‰æ“ä½œè¿›è¡Œä¿®æ”¹ã€‚</p><h4 id="æ—¥å¿—å‹ç¼©"><a href="#æ—¥å¿—å‹ç¼©" class="headerlink" title="æ—¥å¿—å‹ç¼©"></a>æ—¥å¿—å‹ç¼©</h4><p>æ—¥å¿—å‹ç¼©å¯¹äºæœ‰ç›¸åŒkeyçš„ä¸åŒvalueå€¼ï¼Œåªä¿ç•™æœ€åä¸€ä¸ªç‰ˆæœ¬ã€‚å¦‚æœåº”ç”¨åªå…³å¿ƒ keyå¯¹åº”çš„æœ€æ–° valueå€¼ï¼Œåˆ™å¯ä»¥å¼€å¯ Kafkaç›¸åº”çš„æ—¥å¿—æ¸…ç†åŠŸèƒ½ï¼ŒKafkaä¼šå®šæœŸå°†ç›¸åŒ keyçš„æ¶ˆæ¯è¿›è¡Œåˆå¹¶ï¼Œåªä¿ç•™æœ€æ–°çš„ valueå€¼ã€‚</p><ul><li>log.cleanup.policy &#x3D; compact æ‰€æœ‰æ•°æ®å¯ç”¨å‹ç¼©ç­–ç•¥</li></ul><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/33be0a0544a0cadb68ebc81b5d408dce.png" title="image-20220902214504699"><p>è¿™ç§ç­–ç•¥åªé€‚åˆç‰¹æ®Šåœºæ™¯ï¼Œæ¯”å¦‚æ¶ˆæ¯çš„keyæ˜¯ç”¨æˆ·IDï¼Œvalueæ˜¯ç”¨æˆ·çš„èµ„æ–™ï¼Œé€šè¿‡è¿™ç§å‹ç¼©ç­–ç•¥ï¼Œæ•´ä¸ªæ¶ˆæ¯é›†é‡Œå°±ä¿å­˜äº†æ‰€æœ‰ç”¨æˆ·æœ€æ–°çš„èµ„æ–™ã€‚</p><h2 id="Kafkaé«˜æ•ˆè¯»æ•°æ®"><a href="#Kafkaé«˜æ•ˆè¯»æ•°æ®" class="headerlink" title="Kafkaé«˜æ•ˆè¯»æ•°æ®"></a><strong>Kafkaé«˜æ•ˆè¯»æ•°æ®</strong></h2><p>kafkaä¹‹æ‰€ä»¥å¯ä»¥å¿«é€Ÿè¯»å†™çš„åŸå› å¦‚ä¸‹ï¼š</p><ol><li>kafkaæ˜¯åˆ†å¸ƒå¼é›†ç¾¤ï¼Œé‡‡ç”¨åˆ†åŒºæ–¹å¼ï¼Œå¹¶è¡Œæ“ä½œ</li><li>è¯»å–æ•°æ®é‡‡ç”¨ç¨€ç–ç´¢å¼•ï¼Œå¯ä»¥å¿«é€Ÿå®šä½æ¶ˆè´¹æ•°æ®</li><li>é¡ºåºå†™ç£ç›˜</li><li>é¡µç¼“å†²å’Œé›¶æ‹·è´</li></ol><h3 id="é¡ºåºå†™ç£ç›˜"><a href="#é¡ºåºå†™ç£ç›˜" class="headerlink" title="é¡ºåºå†™ç£ç›˜"></a>é¡ºåºå†™ç£ç›˜</h3><p>Kafka çš„ producer ç”Ÿäº§æ•°æ®ï¼Œè¦å†™å…¥åˆ° log æ–‡ä»¶ä¸­ï¼Œå†™çš„è¿‡ç¨‹æ˜¯ä¸€ç›´è¿½åŠ åˆ°æ–‡ä»¶æœ«ç«¯ï¼Œä¸ºé¡ºåºå†™ã€‚<strong>å®˜ç½‘æœ‰æ•°æ®è¡¨æ˜</strong>ï¼ŒåŒæ ·çš„ç£ç›˜ï¼Œé¡ºåºå†™èƒ½åˆ° 600M&#x2F;sï¼Œè€Œéšæœºå†™åªæœ‰ 100K&#x2F;sã€‚è¿™ä¸ç£ç›˜çš„æœºæ¢°æœºæ„æœ‰å…³ï¼Œé¡ºåºå†™ä¹‹æ‰€ä»¥å¿«ï¼Œæ˜¯å› ä¸ºå…¶çœå»äº†å¤§é‡ç£å¤´å¯»å€çš„æ—¶é—´ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/eeb8531c34ed091d57d9be10590839c5.png" title="image-20220902214803709"><h3 id="é¡µç¼“å­˜ä¸é›¶æ‹·è´"><a href="#é¡µç¼“å­˜ä¸é›¶æ‹·è´" class="headerlink" title="é¡µç¼“å­˜ä¸é›¶æ‹·è´"></a>é¡µç¼“å­˜ä¸é›¶æ‹·è´</h3><p>kafkaé«˜æ•ˆè¯»å†™çš„åŸå› å¾ˆå¤§ä¸€éƒ¨åˆ†å–å†³äº<strong>é¡µç¼“å­˜</strong>å’Œ<strong>é›¶æ‹·è´</strong></p><h4 id="é¡µç¼“å­˜"><a href="#é¡µç¼“å­˜" class="headerlink" title="é¡µç¼“å­˜"></a><strong>é¡µç¼“å­˜</strong></h4><p>åœ¨ Kafka ä¸­ï¼Œå¤§é‡ä½¿ç”¨äº† <code>PageCache</code>ï¼Œ è¿™ä¹Ÿæ˜¯ Kafka èƒ½å®ç°é«˜ååçš„é‡è¦å› ç´ ä¹‹ä¸€ã€‚</p><p>é¦–å…ˆçœ‹ä¸€ä¸‹è¯»æ“ä½œï¼Œå½“ä¸€ä¸ªè¿›ç¨‹è¦å»è¯»å–ç£ç›˜ä¸Šçš„æ–‡ä»¶å†…å®¹æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šå…ˆæŸ¥çœ‹è¦è¯»å–çš„æ•°æ®é¡µæ˜¯å¦ç¼“å†²åœ¨<code>PageCache</code> ä¸­ï¼Œå¦‚æœå­˜åœ¨åˆ™ç›´æ¥è¿”å›è¦è¯»å–çš„æ•°æ®ï¼Œè¿™å°±å‡å°‘äº†å¯¹äºç£ç›˜ I&#x2F;Oçš„ æ“ä½œï¼›ä½†æ˜¯å¦‚æœæ²¡æœ‰æŸ¥åˆ°ï¼Œæ“ä½œç³»ç»Ÿä¼šå‘ç£ç›˜å‘èµ·è¯»å–è¯·æ±‚å¹¶å°†è¯»å–çš„æ•°æ®é¡µå­˜å…¥ <code>PageCache</code> ä¸­ï¼Œä¹‹åå†å°†æ•°æ®è¿”å›ç»™è¿›ç¨‹ï¼Œå°±å’Œä½¿ç”¨redisç¼“å†²æ˜¯ä¸€ä¸ªé“ç†ã€‚</p><p>æ¥ç€å†™æ“ä½œå’Œè¯»æ“ä½œæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœä¸€ä¸ªè¿›ç¨‹éœ€è¦å°†æ•°æ®å†™å…¥ç£ç›˜ï¼Œæ“ä½œç³»ç»Ÿä¼šæ£€æŸ¥æ•°æ®é¡µæ˜¯å¦åœ¨PageCache ä¸­å·²ç»å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å°±åœ¨ PageCacheä¸­æ·»åŠ ç›¸åº”çš„æ•°æ®é¡µï¼Œæ¥ç€å°†æ•°æ®å†™å…¥å¯¹åº”çš„æ•°æ®é¡µã€‚å¦å¤–è¢«ä¿®æ”¹è¿‡åçš„æ•°æ®é¡µä¹Ÿå°±å˜æˆäº†è„é¡µï¼Œæ“ä½œç³»ç»Ÿä¼šåœ¨é€‚å½“æ—¶é—´å°†è„é¡µä¸­çš„æ•°æ®å†™å…¥ç£ç›˜ï¼Œä»¥ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><p>å…·ä½“çš„åˆ·ç›˜æœºåˆ¶å¯ä»¥é€šè¿‡ <code>log.flush.interval messages</code>ï¼Œ<code>log.flush .interval .ms</code> ç­‰å‚æ•°æ¥æ§åˆ¶ã€‚åŒæ­¥åˆ·ç›˜å¯ä»¥æé«˜æ¶ˆæ¯çš„å¯é æ€§ï¼Œé˜²æ­¢ç”±äºæœºå™¨ æ‰ç”µç­‰å¼‚å¸¸é€ æˆå¤„äºé¡µç¼“å­˜è€Œæ²¡æœ‰åŠæ—¶å†™å…¥ç£ç›˜çš„æ¶ˆæ¯ä¸¢å¤±ã€‚ä¸€èˆ¬å¹¶ä¸å»ºè®®è¿™ä¹ˆåšï¼Œåˆ·ç›˜ä»»åŠ¡å°±åº”<strong>äº¤ç”±æ“ä½œç³»ç»Ÿå»è°ƒé…</strong>ï¼Œæ¶ˆæ¯çš„å¯é æ€§åº”è¯¥ç”±å¤šå‰¯æœ¬æœºåˆ¶æ¥ä¿éšœï¼Œè€Œä¸æ˜¯ç”±åŒæ­¥åˆ·ç›˜è¿™ ç§ä¸¥é‡å½±å“æ€§èƒ½çš„è¡Œä¸ºæ¥ä¿éšœ ã€‚</p><h4 id="é›¶æ‹·è´"><a href="#é›¶æ‹·è´" class="headerlink" title="é›¶æ‹·è´"></a><strong>é›¶æ‹·è´</strong></h4><p>é›¶æ‹·è´å¹¶ä¸æ˜¯ä¸éœ€è¦æ‹·è´ï¼Œè€Œæ˜¯å‡å°‘ä¸å¿…è¦çš„æ‹·è´æ¬¡æ•°ï¼Œé€šå¸¸ä½¿ç”¨åœ¨IOè¯»å†™è¿‡ç¨‹ä¸­ã€‚å¸¸è§„åº”ç”¨ç¨‹åºIOè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼Œä¼šç»è¿‡å››æ¬¡æ‹·è´ï¼š</p><ol><li>æ•°æ®ä»ç£ç›˜ç»è¿‡DMA(ç›´æ¥å­˜å‚¨å™¨è®¿é—®)åˆ°å†…æ ¸çš„Read Bufferï¼›</li><li>å†…æ ¸æ€çš„Read Bufferåˆ°ç”¨æˆ·æ€åº”ç”¨å±‚çš„Buffer</li><li>ç”¨æˆ·æ€çš„Bufferåˆ°å†…æ ¸æ€çš„Socket Buffer</li><li>Socket Bufferåˆ°ç½‘å¡çš„NIC Buffer</li></ol><p>ä»ä¸Šé¢çš„æµç¨‹å¯ä»¥çŸ¥é“å†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´çš„æ‹·è´ç›¸å½“äºæ‰§è¡Œä¸¤æ¬¡æ— ç”¨çš„æ“ä½œï¼Œä¹‹é—´åˆ‡æ¢ä¹Ÿä¼šèŠ±è´¹å¾ˆå¤šèµ„æºï¼›å½“æ•°æ®ä»ç£ç›˜ç»è¿‡DMA æ‹·è´åˆ°å†…æ ¸ç¼“å­˜ï¼ˆé¡µç¼“å­˜ï¼‰åï¼Œä¸ºäº†å‡å°‘CPUæ‹·è´çš„æ€§èƒ½æŸè€—ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†è¯¥å†…æ ¸ç¼“å­˜ä¸ç”¨æˆ·å±‚è¿›è¡Œå…±äº«ï¼Œå‡å°‘ä¸€æ¬¡CPU copyè¿‡ç¨‹ï¼ŒåŒæ—¶ç”¨æˆ·å±‚çš„è¯»å†™ä¹Ÿä¼šç›´æ¥è®¿é—®è¯¥å…±äº«å­˜å‚¨ï¼Œæœ¬èº«ç”±ç”¨æˆ·å±‚åˆ°Socketç¼“å­˜çš„æ•°æ®æ‹·è´è¿‡ç¨‹ä¹Ÿå˜æˆäº†ä»å†…æ ¸åˆ°å†…æ ¸çš„CPUæ‹·è´è¿‡ç¨‹ï¼Œæ›´åŠ çš„å¿«é€Ÿï¼Œè¿™å°±æ˜¯é›¶æ‹·è´ï¼ŒIOæµç¨‹å¦‚ä¸‹å›¾ã€‚</p><p>ç”šè‡³å¦‚æœæˆ‘ä»¬çš„æ¶ˆæ¯å­˜åœ¨é¡µç¼“å­˜<code>PageCache</code>ä¸­ï¼Œè¿˜é¿å…äº†ç¡¬ç›˜åˆ°å†…æ ¸çš„æ‹·è´è¿‡ç¨‹ï¼Œæ›´åŠ ä¸€æ­¥æå‡äº†æ¶ˆæ¯çš„ååé‡ã€‚ (å¤§æ¦‚å°±ç†è§£æˆä¼ è¾“çš„æ•°æ®åªä¿å­˜åœ¨å†…æ ¸ç©ºé—´ï¼Œä¸éœ€è¦å†æ‹·è´åˆ°ç”¨æˆ·æ€çš„åº”ç”¨å±‚)</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/a023c56d8c21509914b60e5338a733af.png" title="image-20220902214906599"><hr><p>Javaçš„JDK NIOä¸­æ–¹æ³•transferTo()æ–¹æ³•å°±èƒ½å¤Ÿå®ç°é›¶æ‹·è´æ“ä½œï¼Œè¿™ä¸ªå®ç°ä¾èµ–äºæ“ä½œç³»ç»Ÿåº•å±‚çš„sendFile()å®ç°çš„</p><h1 id="Kafkaæ¶ˆè´¹è€…"><a href="#Kafkaæ¶ˆè´¹è€…" class="headerlink" title="Kafkaæ¶ˆè´¹è€…"></a>Kafkaæ¶ˆè´¹è€…</h1><h2 id="æ¶ˆè´¹æ¨¡å¼"><a href="#æ¶ˆè´¹æ¨¡å¼" class="headerlink" title="æ¶ˆè´¹æ¨¡å¼"></a><strong>æ¶ˆè´¹æ¨¡å¼</strong></h2><p>å¸¸è§çš„æ¶ˆè´¹æ¨¡å¼æœ‰ä¸¤ç§ï¼š</p><p><code>poll(æ‹‰)</code>ï¼šæ¶ˆè´¹è€…ä¸»åŠ¨å‘æœåŠ¡ç«¯æ‹‰å–æ¶ˆæ¯ã€‚</p><p><code>push(æ¨)</code>ï¼šæœåŠ¡ç«¯ä¸»åŠ¨æ¨é€æ¶ˆæ¯ç»™æ¶ˆè´¹è€…ã€‚</p><p>ç”±äºæ¨æ¨¡å¼å¾ˆéš¾è€ƒè™‘åˆ°æ¯ä¸ªå®¢æˆ·ç«¯ä¸åŒçš„æ¶ˆè´¹é€Ÿç‡,å¯¼è‡´æ¶ˆè´¹è€…æ— æ³•æ¶ˆè´¹æ¶ˆæ¯è€Œå®•æœºï¼Œå› æ­¤kafkaé‡‡ç”¨çš„æ˜¯pollçš„æ¨¡å¼ï¼Œè¯¥æ¨¡å¼æœ‰ä¸ªç¼ºç‚¹ï¼Œå¦‚æœæœåŠ¡ç«¯æ²¡æœ‰æ¶ˆæ¯ï¼Œæ¶ˆè´¹ç«¯å°±ä¼šä¸€ç›´ç©ºè½®è¯¢ã€‚ä¸ºäº†é¿å…è¿‡å¤šä¸å¿…è¦çš„ç©ºè½®è¯¢ï¼Œkafkaåšäº†æ”¹è¿›ï¼Œå¦‚æœæ²¡æ¶ˆæ¯æœåŠ¡ç«¯å°±ä¼šæš‚æ—¶ä¿æŒè¯¥è¯·æ±‚ï¼Œåœ¨ä¸€æ®µæ—¶é—´å†…æœ‰æ¶ˆæ¯å†å›åº”ç»™å®¢æˆ·ç«¯ã€‚</p><h2 id="æ¶ˆè´¹å·¥ä½œæµç¨‹"><a href="#æ¶ˆè´¹å·¥ä½œæµç¨‹" class="headerlink" title="æ¶ˆè´¹å·¥ä½œæµç¨‹"></a>æ¶ˆè´¹å·¥ä½œæµç¨‹</h2><h3 id="æ¶ˆè´¹è€…æ€»ä½“å·¥ä½œæµç¨‹"><a href="#æ¶ˆè´¹è€…æ€»ä½“å·¥ä½œæµç¨‹" class="headerlink" title="æ¶ˆè´¹è€…æ€»ä½“å·¥ä½œæµç¨‹"></a>æ¶ˆè´¹è€…æ€»ä½“å·¥ä½œæµç¨‹</h3><p>æ¶ˆè´¹è€…å¯¹æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œå¹¶ä¸”å°†å·²ç»æ¶ˆè´¹çš„æ¶ˆæ¯åŠ å…¥ _consumer_offsets ä¸­ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/bf2f3ba0edfdc7e956cb2dfb9969f7d6.png" title="image-20220903110040620"><h3 id="æ¶ˆè´¹è€…ç»„åŸç†"><a href="#æ¶ˆè´¹è€…ç»„åŸç†" class="headerlink" title="æ¶ˆè´¹è€…ç»„åŸç†"></a><strong>æ¶ˆè´¹è€…ç»„åŸç†</strong></h3><p>Consumer Groupï¼ˆCGï¼‰ï¼šæ¶ˆè´¹è€…ç»„ï¼Œç”±å¤šä¸ªconsumerç»„æˆã€‚å½¢æˆä¸€ä¸ªæ¶ˆè´¹è€…ç»„çš„æ¡ä»¶ï¼Œæ˜¯æ‰€æœ‰æ¶ˆè´¹è€…çš„groupidç›¸åŒã€‚</p><ul><li>æ¶ˆè´¹è€…ç»„å†…æ¯ä¸ªæ¶ˆè´¹è€…è´Ÿè´£æ¶ˆè´¹ä¸åŒåˆ†åŒºçš„æ•°æ®ï¼Œä¸€ä¸ªåˆ†åŒºåªèƒ½ç”±ä¸€ä¸ªç»„å†…æ¶ˆè´¹è€…æ¶ˆè´¹ã€‚</li><li>æ¶ˆè´¹è€…ç»„ä¹‹é—´äº’ä¸å½±å“ã€‚æ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½å±äºæŸä¸ªæ¶ˆè´¹è€…ç»„ï¼Œå³æ¶ˆè´¹è€…ç»„æ˜¯é€»è¾‘ä¸Šçš„ä¸€ä¸ªè®¢é˜…è€…ã€‚</li></ul><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/cd28478848b1e8a07862df32d89d186f.png" title="image-20220903103656937"><p>å¯¹äºæ¶ˆæ¯ä¸­é—´ä»¶è€Œè¨€ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ¶ˆæ¯æŠ•é€’æ¨¡å¼ï¼š<strong>ç‚¹å¯¹ç‚¹</strong>(P2P, Point-to-Point)æ¨¡å¼å’Œ<strong>å‘å¸ƒï¼è®¢é˜…</strong>(Pub&#x2F;Sub)æ¨¡å¼ã€‚ç‚¹å¯¹ç‚¹æ¨¡å¼æ˜¯åŸºäºé˜Ÿåˆ—çš„ï¼Œæ¶ˆæ¯ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ï¼Œæ¶ˆæ¯æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­æ¥æ”¶æ¶ˆæ¯ã€‚å‘å¸ƒè®¢é˜…æ¨¡å¼å®šä¹‰äº†å¦‚ä½•å‘ä¸€ä¸ªå†…å®¹èŠ‚ç‚¹å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯ï¼Œè¿™ä¸ªå†…å®¹èŠ‚ç‚¹ç§°ä¸ºä¸»é¢˜(Topic) , ä¸»é¢˜å¯ä»¥è®¤ä¸ºæ˜¯æ¶ˆæ¯ä¼ é€’çš„ä¸­ä»‹ï¼Œæ¶ˆæ¯å‘å¸ƒè€…å°†æ¶ˆæ¯å‘å¸ƒåˆ°æŸä¸ªä¸»é¢˜ï¼Œ è€Œæ¶ˆæ¯è®¢é˜…è€…ä»ä¸»é¢˜ä¸­è®¢é˜…æ¶ˆæ¯ã€‚ä¸»é¢˜ä½¿å¾—æ¶ˆæ¯çš„è®¢é˜…è€…å’Œå‘å¸ƒè€…äº’ç›¸ä¿æŒç‹¬ç«‹ï¼Œä¸éœ€è¦è¿›è¡Œ æ¥è§¦å³å¯ä¿è¯æ¶ˆæ¯çš„ä¼ é€’ï¼Œå‘å¸ƒï¼è®¢é˜…æ¨¡å¼åœ¨æ¶ˆæ¯çš„ä¸€å¯¹å¤šå¹¿æ’­æ—¶é‡‡ç”¨ã€‚KafkaåŒæ—¶æ”¯å¾…ä¸¤ç§æ¶ˆæ¯æŠ•é€’æ¨¡å¼ï¼Œè€Œè¿™æ­£æ˜¯å¾—ç›Šäºæ¶ˆè´¹è€…ä¸æ¶ˆè´¹ç»„æ¨¡å‹çš„å¥‘åˆï¼š</p><ul><li>å¦‚æœæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½éš¶å±äºåŒä¸€ä¸ªæ¶ˆè´¹ç»„ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ¶ˆæ¯éƒ½ä¼šè¢«å‡è¡¡åœ°æŠ•é€’ç»™æ¯ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå³æ¯æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†ï¼Œè¿™å°±ç›¸å½“äºç‚¹å¯¹ç‚¹æ¨¡å¼çš„åº”ç”¨ã€‚</li><li>å¦‚æœæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½éš¶å±äºä¸åŒçš„æ¶ˆè´¹ç»„ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ¶ˆæ¯éƒ½ä¼šè¢«å¹¿æ’­ç»™æ‰€æœ‰çš„æ¶ˆè´¹è€…ï¼Œå³æ¯æ¡æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰çš„æ¶ˆè´¹è€…å¤„ç†ï¼Œè¿™å°±ç›¸å½“äºå‘å¸ƒï¼è®¢é˜…æ¨¡å¼çš„åº”ç”¨ã€‚</li></ul><h3 id="æ¶ˆè´¹è€…ç»„é€‰ä¸¾Leader"><a href="#æ¶ˆè´¹è€…ç»„é€‰ä¸¾Leader" class="headerlink" title="æ¶ˆè´¹è€…ç»„é€‰ä¸¾Leader"></a>æ¶ˆè´¹è€…ç»„é€‰ä¸¾Leader</h3><p>å…·ä½“çš„æ¶ˆè´¹è€…ç»„åˆå§‹åŒ–æµç¨‹ï¼š</p><p>é€šè¿‡å¯¹GroupIdè¿›è¡ŒHashå¾—åˆ°é‚£å°æœåŠ¡å™¨çš„coordinator ï¼Œcoordinatorè´Ÿè´£é€‰å‡ºæ¶ˆè´¹ç»„ä¸­çš„Leader ï¼Œå¹¶ä¸”åè°ƒä¿¡æ¯ã€‚çœŸæ­£å­˜å‚¨æ¶ˆè´¹è®°å½•çš„æ˜¯ _consumer_offsets_partition ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/04af8e9bf63614d3036c551bb0cd6bee.png" title="image-20220903103841994"> <img src="/img/loading.gif" data-lazy-src="/posts/f351760e/51e900538b008741cbb654c47ae767d2.png" title="image-20220903112720568"> <img src="/img/loading.gif" data-lazy-src="/posts/f351760e/5f505f4ff893cff095dad1a816ee357d.png" title="image-20220903112925137"> <img src="/img/loading.gif" data-lazy-src="/posts/f351760e/8752d547e23158aa7f8d4576bca220d5.png" title="image-20220903112936658"><h2 id="æ¶ˆè´¹è€…API"><a href="#æ¶ˆè´¹è€…API" class="headerlink" title="æ¶ˆè´¹è€…API"></a>æ¶ˆè´¹è€…API</h2><p>æ¶ˆè´¹ç»„å•æ¶ˆè´¹è€…ä»¥åŠæ¶ˆè´¹è€…ç»„å¤šæ¶ˆè´¹è€…</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/5c501aa681b86866001bf6716331246d.png" title="image-20220903113854959"><p>æ³¨æ„ï¼šåœ¨æ¶ˆè´¹è€… API ä»£ç ä¸­å¿…é¡»é…ç½®æ¶ˆè´¹è€…ç»„ idã€‚å‘½ä»¤è¡Œå¯åŠ¨æ¶ˆè´¹è€…ä¸å¡«å†™æ¶ˆè´¹è€…ç»„id ä¼šè¢«è‡ªåŠ¨å¡«å†™éšæœºçš„æ¶ˆè´¹è€…ç»„ idã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomConsumer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//0.é…ç½®ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        properties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, <span class="string">&quot;47.106.86.64:9092&quot;</span>);</span><br><span class="line">        properties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());</span><br><span class="line">        properties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());</span><br><span class="line">        properties.put(ConsumerConfig.GROUP_ID_CONFIG, <span class="string">&quot;test&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.åˆ›å»ºæ¶ˆè´¹è€…</span></span><br><span class="line">        KafkaConsumer&lt;String, String&gt; kafkaConsumer = <span class="keyword">new</span> <span class="title class_">KafkaConsumer</span>&lt;&gt;(properties);</span><br><span class="line">        ArrayList&lt;String&gt; topic = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        topic.add(<span class="string">&quot;first&quot;</span>);</span><br><span class="line">        kafkaConsumer.subscribe(topic);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.æ¶ˆè´¹ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            ConsumerRecords&lt;String, String&gt; records = kafkaConsumer.poll(Duration.ofSeconds(<span class="number">1</span>));</span><br><span class="line">            records.forEach(record -&gt; &#123;</span><br><span class="line">                System.out.println(record);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.å…³é—­</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ†åŒºå¹³è¡¡ä»¥åŠå†å¹³è¡¡"><a href="#åˆ†åŒºå¹³è¡¡ä»¥åŠå†å¹³è¡¡" class="headerlink" title="åˆ†åŒºå¹³è¡¡ä»¥åŠå†å¹³è¡¡"></a>åˆ†åŒºå¹³è¡¡ä»¥åŠå†å¹³è¡¡</h2><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/33482e5e97cb53dcaf744c3da25794be.png" title="image-20220903114711746"><p>å‚æ•°åç§° æè¿°<br><code>heartbeat.interval.ms</code> Kafka æ¶ˆè´¹è€…å’Œ coordinator ä¹‹é—´çš„å¿ƒè·³æ—¶é—´ï¼Œé»˜è®¤ 3sã€‚è¯¥æ¡ç›®çš„å€¼å¿…é¡»å°äº session.timeout.msï¼Œä¹Ÿä¸åº”è¯¥é«˜äºsession.timeout.ms çš„ 1&#x2F;3ã€‚</p><p><code>session.timeout.ms</code> Kafka æ¶ˆè´¹è€…å’Œ coordinator ä¹‹é—´è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ 45sã€‚è¶…è¿‡è¯¥å€¼ï¼Œè¯¥æ¶ˆè´¹è€…è¢«ç§»é™¤ï¼Œæ¶ˆè´¹è€…ç»„æ‰§è¡Œå†å¹³è¡¡ã€‚</p><p><code>max.poll.interval.ms</code> æ¶ˆè´¹è€…å¤„ç†æ¶ˆæ¯çš„æœ€å¤§æ—¶é•¿ï¼Œé»˜è®¤æ˜¯ 5 åˆ†é’Ÿã€‚è¶…è¿‡è¯¥å€¼ï¼Œè¯¥æ¶ˆè´¹è€…è¢«ç§»é™¤ï¼Œæ¶ˆè´¹è€…ç»„æ‰§è¡Œå†å¹³è¡¡ã€‚</p><p><code>partition.assignment.strategy</code> æ¶ˆ è´¹ è€… åˆ† åŒº åˆ† é… ç­– ç•¥ ï¼Œ é»˜ è®¤ ç­– ç•¥ æ˜¯ Range + CooperativeStickyã€‚Kafka å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ªåˆ†åŒºåˆ†é…ç­–ç•¥ã€‚å¯ ä»¥ é€‰ æ‹© çš„ ç­– ç•¥ åŒ… æ‹¬ ï¼š Range ã€ RoundRobin ã€ Sticky ã€CooperativeSticky (åä½œè€…ç²˜æ€§)</p><h3 id="åˆ†åŒºåˆ†é…ç­–ç•¥"><a href="#åˆ†åŒºåˆ†é…ç­–ç•¥" class="headerlink" title="åˆ†åŒºåˆ†é…ç­–ç•¥"></a><strong>åˆ†åŒºåˆ†é…ç­–ç•¥</strong></h3><p>æˆ‘ä»¬çŸ¥é“ä¸€ä¸ª Consumer Group ä¸­æœ‰å¤šä¸ª Consumerï¼Œä¸€ä¸ª Topic ä¹Ÿæœ‰å¤šä¸ª Partitionï¼Œæ‰€ä»¥å¿…ç„¶ä¼šæ¶‰åŠåˆ° Partition çš„åˆ†é…é—®é¢˜: ç¡®å®šå“ªä¸ª Partition ç”±å“ªä¸ª Consumer æ¥æ¶ˆè´¹çš„é—®é¢˜ã€‚</p><p>Kafka å®¢æˆ·ç«¯æä¾›äº†3 ç§åˆ†åŒºåˆ†é…ç­–ç•¥ï¼š<strong>RangeAssignor</strong>ã€<strong>RoundRobinAssignor</strong> å’Œ <strong>StickyAssignor</strong>ï¼Œå‰ä¸¤ç§ åˆ†é…æ–¹æ¡ˆç›¸å¯¹ç®€å•ä¸€äº›StickyAssignoråˆ†é…æ–¹æ¡ˆç›¸å¯¹å¤æ‚ä¸€äº›ã€‚</p><h3 id="Range"><a href="#Range" class="headerlink" title="Range"></a><strong>Range</strong></h3><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/a2ae2716aaa6c40e6192344eb4039ea2.png" title="image-20220903104029564"><p>Range åˆ†åŒºåˆ†é…å†å¹³è¡¡æ¡ˆä¾‹<br>ï¼ˆ1ï¼‰åœæ­¢æ‰ 0 å·æ¶ˆè´¹è€…ï¼Œå¿«é€Ÿé‡æ–°å‘é€æ¶ˆæ¯è§‚çœ‹ç»“æœï¼ˆ45s ä»¥å†…ï¼Œè¶Šå¿«è¶Šå¥½ï¼‰ã€‚<br>1 å·æ¶ˆè´¹è€…ï¼šæ¶ˆè´¹åˆ° 3ã€4 å·åˆ†åŒºæ•°æ®ã€‚<br>2 å·æ¶ˆè´¹è€…ï¼šæ¶ˆè´¹åˆ° 5ã€6 å·åˆ†åŒºæ•°æ®ã€‚<br>0 å·æ¶ˆè´¹è€…çš„ä»»åŠ¡ä¼šæ•´ä½“è¢«åˆ†é…åˆ° 1 å·æ¶ˆè´¹è€…æˆ–è€… 2 å·æ¶ˆè´¹è€…ã€‚ (è¢«æ•´ä½“åˆ†é…)<br>è¯´æ˜ï¼š0 å·æ¶ˆè´¹è€…æŒ‚æ‰åï¼Œæ¶ˆè´¹è€…ç»„éœ€è¦æŒ‰ç…§è¶…æ—¶æ—¶é—´ 45s æ¥åˆ¤æ–­å®ƒæ˜¯å¦é€€å‡ºï¼Œæ‰€ä»¥éœ€è¦ç­‰å¾…ï¼Œæ—¶é—´åˆ°äº† 45s åï¼Œåˆ¤æ–­å®ƒçœŸçš„é€€å‡ºå°±ä¼šæŠŠä»»åŠ¡åˆ†é…ç»™å…¶ä»– broker æ‰§è¡Œã€‚</p><p>ï¼ˆ2ï¼‰å†æ¬¡é‡æ–°å‘é€æ¶ˆæ¯è§‚çœ‹ç»“æœï¼ˆ45s ä»¥åï¼‰ã€‚<br>1 å·æ¶ˆè´¹è€…ï¼šæ¶ˆè´¹åˆ° 0ã€1ã€2ã€3 å·åˆ†åŒºæ•°æ®ã€‚<br>2 å·æ¶ˆè´¹è€…ï¼šæ¶ˆè´¹åˆ° 4ã€5ã€6 å·åˆ†åŒºæ•°æ®ã€‚<br>è¯´æ˜ï¼šæ¶ˆè´¹è€… 0 å·²ç»è¢«è¸¢å‡ºæ¶ˆè´¹è€…ç»„ï¼Œæ‰€ä»¥é‡æ–°æŒ‰ç…§ range æ–¹å¼åˆ†é…ã€‚</p><h3 id="RoundRobin"><a href="#RoundRobin" class="headerlink" title="RoundRobin"></a><strong>RoundRobin</strong></h3><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/26d3849b324e10e6356382d88877af11.png" title="image-20220903104000261"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®æ”¹åˆ†åŒºåˆ†é…ç­–ç•¥</span></span><br><span class="line">properties.put(ConsumerConfig.PARTITION_ASSIGNMENT_STRATEGY_CONFIG, <span class="string">&quot;org.apache.kafka.clients.consumer.RoundRobinAssignor&quot;</span>);</span><br></pre></td></tr></table></figure><p>ï¼ˆ1ï¼‰åœæ­¢æ‰ 0 å·æ¶ˆè´¹è€…ï¼Œå¿«é€Ÿé‡æ–°å‘é€æ¶ˆæ¯è§‚çœ‹ç»“æœï¼ˆ45s ä»¥å†…ï¼Œè¶Šå¿«è¶Šå¥½ï¼‰ã€‚<br>1 å·æ¶ˆè´¹è€…ï¼šæ¶ˆè´¹åˆ° 2ã€5 å·åˆ†åŒºæ•°æ®<br>2 å·æ¶ˆè´¹è€…ï¼šæ¶ˆè´¹åˆ° 4ã€1 å·åˆ†åŒºæ•°æ®<br>0 å·æ¶ˆè´¹è€…çš„ä»»åŠ¡ä¼šæŒ‰ç…§ RoundRobin çš„æ–¹å¼ï¼ŒæŠŠæ•°æ®è½®è¯¢åˆ†æˆ 0 ã€6 å’Œ 3 å·åˆ†åŒºæ•°æ®ï¼Œåˆ†åˆ«ç”± 1 å·æ¶ˆè´¹è€…æˆ–è€… 2 å·æ¶ˆè´¹è€…æ¶ˆè´¹ã€‚ï¼ˆé‡‡ç”¨è½®è®­ï¼‰<br>è¯´æ˜ï¼š0 å·æ¶ˆè´¹è€…æŒ‚æ‰åï¼Œæ¶ˆè´¹è€…ç»„éœ€è¦æŒ‰ç…§è¶…æ—¶æ—¶é—´ 45s æ¥åˆ¤æ–­å®ƒæ˜¯å¦é€€å‡ºï¼Œæ‰€ä»¥éœ€è¦ç­‰å¾…ï¼Œæ—¶é—´åˆ°äº† 45s åï¼Œåˆ¤æ–­å®ƒçœŸçš„é€€å‡ºå°±ä¼šæŠŠä»»åŠ¡åˆ†é…ç»™å…¶ä»– broker æ‰§è¡Œã€‚</p><p>ï¼ˆ2ï¼‰å†æ¬¡é‡æ–°å‘é€æ¶ˆæ¯è§‚çœ‹ç»“æœï¼ˆ45s ä»¥åï¼‰ã€‚<br>1 å·æ¶ˆè´¹è€…ï¼šæ¶ˆè´¹åˆ° 0ã€2ã€4ã€6 å·åˆ†åŒºæ•°æ®<br>2 å·æ¶ˆè´¹è€…ï¼šæ¶ˆè´¹åˆ° 1ã€3ã€5 å·åˆ†åŒºæ•°æ®<br>è¯´æ˜ï¼šæ¶ˆè´¹è€… 0 å·²ç»è¢«è¸¢å‡ºæ¶ˆè´¹è€…ç»„ï¼Œæ‰€ä»¥é‡æ–°æŒ‰ç…§ RoundRobin æ–¹å¼åˆ†é…ã€‚</p><h3 id="Stickyï¼š"><a href="#Stickyï¼š" class="headerlink" title="Stickyï¼š"></a><strong>Stickyï¼š</strong></h3><p><strong>StickyAssignor</strong> åˆ†åŒºåˆ†é…ç®—æ³•æ˜¯ Kafka å®¢æˆ·ç«¯æä¾›çš„åˆ†é…ç­–ç•¥ä¸­æœ€å¤æ‚çš„ä¸€ç§ï¼Œå¯ä»¥é€šè¿‡ partition.assignment.strategy å‚æ•°å»è®¾ç½®ï¼Œä» 0.11 ç‰ˆæœ¬å¼€å§‹å¼•å…¥ï¼Œç›®çš„å°±æ˜¯åœ¨æ‰§è¡Œæ–°åˆ†é…æ—¶ï¼Œå°½é‡åœ¨ä¸Šä¸€æ¬¡åˆ†é…ç»“æœä¸Šå°‘åšè°ƒæ•´ï¼Œå…¶ä¸»è¦å®ç°äº†ä»¥ä¸‹2ä¸ªç›®æ ‡ï¼š</p><p>1)ã€<strong>Topic Partition</strong> çš„åˆ†é…è¦å°½é‡å‡è¡¡ã€‚</p><p>2)ã€å½“ <strong>Rebalance</strong>(é‡åˆ†é…ï¼Œåé¢ä¼šè¯¦ç»†åˆ†æ) å‘ç”Ÿæ—¶ï¼Œå°½é‡ä¸ä¸Šä¸€æ¬¡åˆ†é…ç»“æœä¿æŒä¸€è‡´ã€‚</p><p>è¯¥ç®—æ³•çš„ç²¾é«“åœ¨äºï¼Œé‡åˆ†é…åï¼Œè¿˜èƒ½å°½é‡ä¸ä¸Šä¸€æ¬¡ç»“æœä¿æŒä¸€è‡´ï¼Œè¿›è€Œè¾¾åˆ°æ¶ˆè´¹è€…æ•…éšœä¸‹çº¿ï¼Œæ•…éšœæ¢å¤åçš„å‡è¡¡é—®é¢˜ï¼Œåœ¨æ­¤å°±ä¸ä¸¾ä¾‹äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿®æ”¹åˆ†åŒºåˆ†é…ç­–ç•¥</span></span><br><span class="line">properties.put(ConsumerConfig.PARTITION_ASSIGNMENT_STRATEGY_CONFIG, <span class="string">&quot;org.apache.kafka.clients.consumer.StickyAssignor&quot;</span>);</span><br></pre></td></tr></table></figure><h2 id="offsetä½ç§»æäº¤"><a href="#offsetä½ç§»æäº¤" class="headerlink" title="offsetä½ç§»æäº¤"></a><strong>offsetä½ç§»æäº¤</strong></h2><h3 id="offset-çš„é»˜è®¤ç»´æŠ¤ä½ç½®"><a href="#offset-çš„é»˜è®¤ç»´æŠ¤ä½ç½®" class="headerlink" title="offset çš„é»˜è®¤ç»´æŠ¤ä½ç½®"></a>offset çš„é»˜è®¤ç»´æŠ¤ä½ç½®</h3><p>Kafka 0.9 ç‰ˆæœ¬ä¹‹å‰consumeré»˜è®¤å°†offsetä¿å­˜åœ¨Zookeeperä¸­ï¼Œä»0.9ç‰ˆæœ¬ä¹‹åconsumeré»˜è®¤ä¿å­˜åœ¨Kafkaä¸€ä¸ªå†…ç½®çš„topicä¸­ï¼Œè¯¥topicä¸º_consumer_offsetsã€‚</p><p>æ¶ˆè´¹è€…æäº¤çš„offsetå€¼ç»´æŠ¤åœ¨**__consumer_offsets<strong>è¿™ä¸ªTopicä¸­ï¼Œå…·ä½“ç»´æŠ¤åœ¨å“ªä¸ªåˆ†åŒºä¸­ï¼Œæ˜¯ç”±æ¶ˆè´¹è€…æ‰€åœ¨çš„æ¶ˆè´¹è€…ç»„</strong>groupid**å†³å®šï¼Œè®¡ç®—æ–¹å¼æ˜¯ï¼šgroupidçš„hashCodeå€¼å¯¹50å–ä½™ã€‚å½“kafkaç¯å¢ƒæ­£å¸¸è€Œæ¶ˆè´¹è€…ä¸èƒ½æ¶ˆè´¹æ—¶ï¼Œæœ‰å¯èƒ½æ˜¯å¯¹åº”çš„__consumer_offsetsåˆ†åŒºleaderä¸ºnoneæˆ–-1ï¼Œæˆ–è€…åˆ†åŒºä¸­çš„æ—¥å¿—æ–‡ä»¶æŸåå¯¼è‡´ã€‚</p><p>__consumer_offsets ä¸»é¢˜é‡Œé¢é‡‡ç”¨ key å’Œ value çš„æ–¹å¼å­˜å‚¨æ•°æ®ã€‚key æ˜¯ group.id+topic+ åˆ†åŒºå·ï¼Œvalue å°±æ˜¯å½“å‰ offset çš„å€¼ã€‚æ¯éš”ä¸€æ®µæ—¶é—´ï¼Œkafka å†…éƒ¨ä¼šå¯¹è¿™ä¸ª topic è¿›è¡Œ compactï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ª group.id+topic+åˆ†åŒºå·å°±ä¿ç•™æœ€æ–°æ•°æ®ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ å½“é›†ç¾¤ä¸­ç¬¬ä¸€æ¬¡æœ‰æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºä¸»é¢˜_ consumer_ offsets, ä¸è¿‡å®ƒçš„å‰¯æœ¬å› å­è¿˜å—offsets.topic .replication.factorå‚æ•°çš„çº¦æŸï¼Œè¿™ä¸ªå‚æ•°çš„é»˜è®¤å€¼ä¸º3 (ä¸‹è½½å®‰è£…çš„åŒ…ä¸­æ­¤å€¼å¯èƒ½ä¸º1)ï¼Œåˆ†åŒºæ•°å¯ä»¥é€šè¿‡offsets.topic.num.partitionså‚æ•°è®¾ç½®ï¼Œé»˜è®¤ä¸º50ã€‚</p><p>åœ¨é…ç½®æ–‡ä»¶ config&#x2F;consumer.properties ä¸­æ·»åŠ é…ç½® exclude.internal.topics&#x3D;falseï¼Œé»˜è®¤æ˜¯ trueï¼Œè¡¨ç¤ºä¸èƒ½æ¶ˆè´¹ç³»ç»Ÿä¸»é¢˜ã€‚ä¸ºäº†æŸ¥çœ‹è¯¥ç³»ç»Ÿä¸»é¢˜æ•°æ®ï¼Œæ‰€ä»¥è¯¥å‚æ•°ä¿®æ”¹ä¸º falseã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kafka-console-consumer.sh --topic __consumer_offsets --bootstrap-server 47.106.86.64:9092 --consumer.config config/consumer.properties --formatter &quot;kafka.coordinator.group.GroupMetadataManager\$OffsetsMessageFormatter&quot; --from-beginning</span><br><span class="line">1</span><br><span class="line">[offset,atguigu,1]::OffsetAndMetadata(offset=7, </span><br><span class="line">leaderEpoch=Optional[0], metadata=, commitTimestamp=1622442520203, </span><br><span class="line">expireTimestamp=None)</span><br><span class="line">[offset,atguigu,0]::OffsetAndMetadata(offset=8, </span><br><span class="line">leaderEpoch=Optional[0], metadata=, commitTimestamp=1622442520203, </span><br><span class="line">expireTimestamp=None)</span><br></pre></td></tr></table></figure><p>æ¶ˆè´¹è€…æäº¤offsetçš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œ<strong>è‡ªåŠ¨æäº¤</strong>å’Œ<strong>æ‰‹åŠ¨æäº¤</strong></p><h3 id="è‡ªåŠ¨æäº¤"><a href="#è‡ªåŠ¨æäº¤" class="headerlink" title="è‡ªåŠ¨æäº¤"></a>è‡ªåŠ¨æäº¤</h3><p>ä¸ºäº†ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸“æ³¨äºè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼ŒKafkaæä¾›äº†è‡ªåŠ¨æäº¤offsetçš„åŠŸèƒ½ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/2ab1b519114fc0e895726f632ecd7d87.png" title="image-20220903122129755"><ul><li><code>enable.auto.commit</code>ï¼šæ˜¯å¦å¼€å¯è‡ªåŠ¨æäº¤offsetåŠŸèƒ½ï¼Œé»˜è®¤æ˜¯true</li><li><code>auto.commit.interval.ms</code>ï¼šè‡ªåŠ¨æäº¤offsetçš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤æ˜¯5s</li></ul><p>è‡ªåŠ¨æäº¤æœ‰å¯èƒ½å‡ºç°æ¶ˆæ¯æ¶ˆè´¹å¤±è´¥ï¼Œä½†æ˜¯å´æäº¤äº†offsetçš„æƒ…å†µï¼Œå¯¼è‡´<strong>æ¶ˆæ¯ä¸¢å¤±</strong>ã€‚ä¸ºäº†èƒ½å¤Ÿå®ç°æ¶ˆæ¯æ¶ˆè´¹offsetçš„ç²¾ç¡®æ§åˆ¶ï¼Œæ›´æ¨èæ‰‹åŠ¨æäº¤ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è‡ªåŠ¨æäº¤</span></span><br><span class="line">properties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">// æäº¤æ—¶é—´é—´éš”</span></span><br><span class="line">properties.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG,<span class="number">1000</span>);</span><br></pre></td></tr></table></figure><h3 id="æ‰‹åŠ¨æäº¤"><a href="#æ‰‹åŠ¨æäº¤" class="headerlink" title="æ‰‹åŠ¨æäº¤"></a>æ‰‹åŠ¨æäº¤</h3><p>è™½ç„¶è‡ªåŠ¨æäº¤offsetååˆ†ç®€å•ä¾¿åˆ©ï¼Œä½†ç”±äºå…¶æ˜¯åŸºäºæ—¶é—´æäº¤çš„ï¼Œå¼€å‘äººå‘˜éš¾ä»¥æŠŠæ¡offsetæäº¤çš„æ—¶æœºã€‚å›  æ­¤Kafkaè¿˜æä¾›äº†æ‰‹åŠ¨æäº¤offsetçš„APIã€‚æ‰‹åŠ¨æäº¤offsetçš„æ–¹æ³•æœ‰ä¸¤ç§ï¼šåˆ†åˆ«æ˜¯commitSyncï¼ˆ<strong>åŒæ­¥æäº¤</strong>ï¼‰å’ŒcommitAsyncï¼ˆ<strong>å¼‚æ­¥æäº¤</strong>ï¼‰ã€‚ä¸¤è€…çš„ç›¸åŒç‚¹æ˜¯ï¼Œéƒ½ä¼šå°†<strong>æœ¬æ¬¡æäº¤çš„ä¸€æ‰¹æ•°æ®æœ€é«˜çš„åç§»é‡æäº¤</strong>ï¼›ä¸åŒç‚¹æ˜¯ï¼Œ<strong>åŒæ­¥æäº¤é˜»å¡å½“å‰çº¿ç¨‹</strong>ï¼Œä¸€ç›´åˆ°æäº¤æˆåŠŸï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨å¤±è´¥é‡è¯•ï¼ˆç”±ä¸å¯æ§å› ç´ å¯¼è‡´ï¼Œä¹Ÿä¼šå‡ºç°æäº¤å¤±è´¥ï¼‰ï¼›è€Œ<strong>å¼‚æ­¥æäº¤åˆ™æ²¡æœ‰å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œæ•…æœ‰å¯èƒ½æäº¤å¤±è´¥</strong>ã€‚</p><ul><li>commitSyncï¼ˆåŒæ­¥æäº¤ï¼‰ï¼šå¿…é¡»ç­‰å¾…offsetæäº¤å®Œæ¯•ï¼Œå†å»æ¶ˆè´¹ä¸‹ä¸€æ‰¹æ•°æ®ã€‚ é˜»å¡çº¿ç¨‹ï¼Œä¸€ç›´åˆ°æäº¤åˆ°æˆåŠŸï¼Œä¼šè¿›è¡Œå¤±è´¥é‡è¯•</li><li>commitAsyncï¼ˆå¼‚æ­¥æäº¤ï¼‰ ï¼šå‘é€å®Œæäº¤offsetè¯·æ±‚åï¼Œå°±å¼€å§‹æ¶ˆè´¹ä¸‹ä¸€æ‰¹æ•°æ®äº†ã€‚æ²¡æœ‰å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œä¼šæäº¤å¤±è´¥</li></ul><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/d3f45411f09af44343af1387a32c9034.png" title="image-20220903122747576"><h3 id="æŒ‡å®šæ¶ˆè´¹ä½ç½®"><a href="#æŒ‡å®šæ¶ˆè´¹ä½ç½®" class="headerlink" title="æŒ‡å®šæ¶ˆè´¹ä½ç½®"></a><strong>æŒ‡å®šæ¶ˆè´¹ä½ç½®</strong></h3><p>åœ¨kafkaä¸­å½“æ¶ˆè´¹è€…<strong>æŸ¥æ‰¾ä¸åˆ°æ‰€è®°å½•çš„æ¶ˆè´¹ä½ç§»</strong>æ—¶ï¼Œä¼šæ ¹æ®auto.offset.resetçš„é…ç½®ï¼Œå†³å®šä»ä½•å¤„æ¶ˆè´¹ã€‚</p><p><code>auto.offset.reset = earliest | latest | none</code> é»˜è®¤æ˜¯ latestã€‚</p><ul><li><code>earliest</code>ï¼šä¸ç®¡ä½ çš„offsetï¼Œå§‹ç»ˆä»æœ€æ—©çš„ä½ç½®å¼€å§‹æ‹‰å–ã€‚</li><li><code>latest</code>ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šè‡ªåŠ¨å°†åç§»é‡é‡ç½®ä¸ºæœ€æ–°åç§»é‡ï¼Œä»æœ€åæäº¤çš„offsetçš„ä½ç½®æ‹‰å–ã€‚</li><li><code>none</code>ï¼šå¦‚æœæœªæ‰¾åˆ°æ¶ˆè´¹è€…ç»„çš„å…ˆå‰åç§»é‡ï¼Œåˆ™å‘æ¶ˆè´¹è€…æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/bcc93d66821e2f1ac22c74c3eb00d9a3.png" title="image-20220903123232954"><p>Kafkaä¸­çš„æ¶ˆè´¹ä½ç§»æ˜¯å­˜å‚¨åœ¨ä¸€ä¸ªå†…éƒ¨ä¸»é¢˜ä¸­çš„ï¼Œ è€Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨**seek()**æ–¹æ³•å¯ä»¥çªç ´è¿™ä¸€é™åˆ¶ï¼šæ¶ˆè´¹ä½ç§»å¯ä»¥ä¿å­˜åœ¨ä»»æ„çš„å­˜å‚¨ä»‹è´¨ä¸­ï¼Œ ä¾‹å¦‚æ•°æ®åº“ã€ æ–‡ä»¶ç³»ç»Ÿç­‰ã€‚ä»¥æ•°æ®åº“ä¸ºä¾‹ï¼Œ æˆ‘ä»¬å°†æ¶ˆè´¹ä½ç§»ä¿å­˜åœ¨å…¶ä¸­çš„ä¸€ä¸ªè¡¨ä¸­ï¼Œ åœ¨ä¸‹æ¬¡æ¶ˆè´¹çš„æ—¶å€™å¯ä»¥è¯»å–å­˜å‚¨åœ¨æ•°æ®è¡¨ä¸­çš„æ¶ˆè´¹ä½ç§»å¹¶é€šè¿‡seek()æ–¹æ³•æŒ‡å‘è¿™ä¸ªå…·ä½“çš„ä½ç½® ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">properties.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, <span class="string">&quot;latest&quot;</span>);</span><br></pre></td></tr></table></figure><p><strong>æŒ‡å®šä½ç§»æ¶ˆè´¹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‡å®šä½ç½®è¿›è¡Œæ¶ˆè´¹</span></span><br><span class="line">Set&lt;TopicPartition&gt; assignment = kafkaConsumer.assignment();</span><br><span class="line"></span><br><span class="line"><span class="comment">//  ä¿è¯åˆ†åŒºåˆ†é…æ–¹æ¡ˆå·²ç»åˆ¶å®šå®Œæ¯•</span></span><br><span class="line"><span class="keyword">while</span> (assignment.size() == <span class="number">0</span>)&#123;</span><br><span class="line">    kafkaConsumer.poll(Duration.ofSeconds(<span class="number">1</span>));</span><br><span class="line">    assignment = kafkaConsumer.assignment();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šæ¶ˆè´¹çš„offset</span></span><br><span class="line"><span class="keyword">for</span> (TopicPartition topicPartition : assignment) &#123;</span><br><span class="line">    kafkaConsumer.seek(topicPartition,<span class="number">600</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3  æ¶ˆè´¹æ•°æ®</span></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line"></span><br><span class="line">    ConsumerRecords&lt;String, String&gt; consumerRecords = kafkaConsumer.poll(Duration.ofSeconds(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; consumerRecord : consumerRecords) &#123;</span><br><span class="line">        System.out.println(consumerRecord);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æŒ‡å®šæ—¶é—´æ¶ˆè´¹</strong></p><p>åŸç†å°±æ˜¯æŸ¥åˆ°æ—¶é—´å¯¹åº”çš„offsetå†å»æŒ‡å®šä½ç§»æ¶ˆè´¹ï¼Œä¸ºäº†ç¡®ä¿åŒæ­¥åˆ°åˆ†åŒºä¿¡æ¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç¡®ä¿èƒ½è·å–åˆ°åˆ†åŒºï¼Œå†å»æŸ¥è¯¢åˆ†åŒºæ—¶é—´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‡å®šä½ç½®è¿›è¡Œæ¶ˆè´¹</span></span><br><span class="line">Set&lt;TopicPartition&gt; assignment = kafkaConsumer.assignment();</span><br><span class="line"></span><br><span class="line"><span class="comment">//  ä¿è¯åˆ†åŒºåˆ†é…æ–¹æ¡ˆå·²ç»åˆ¶å®šå®Œæ¯•</span></span><br><span class="line"><span class="keyword">while</span> (assignment.size() == <span class="number">0</span>)&#123;</span><br><span class="line">    kafkaConsumer.poll(Duration.ofSeconds(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    assignment = kafkaConsumer.assignment();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸Œæœ›æŠŠæ—¶é—´è½¬æ¢ä¸ºå¯¹åº”çš„offset</span></span><br><span class="line">HashMap&lt;TopicPartition, Long&gt; topicPartitionLongHashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è£…å¯¹åº”é›†åˆ</span></span><br><span class="line"><span class="keyword">for</span> (TopicPartition topicPartition : assignment) &#123;</span><br><span class="line">    topicPartitionLongHashMap.put(topicPartition,System.currentTimeMillis() - <span class="number">1</span> * <span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Map&lt;TopicPartition, OffsetAndTimestamp&gt; topicPartitionOffsetAndTimestampMap = kafkaConsumer.offsetsForTimes(topicPartitionLongHashMap);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šæ¶ˆè´¹çš„offset</span></span><br><span class="line"><span class="keyword">for</span> (TopicPartition topicPartition : assignment) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">OffsetAndTimestamp</span> <span class="variable">offsetAndTimestamp</span> <span class="operator">=</span> topicPartitionOffsetAndTimestampMap.get(topicPartition);</span><br><span class="line"></span><br><span class="line">    kafkaConsumer.seek(topicPartition,offsetAndTimestamp.offset());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3  æ¶ˆè´¹æ•°æ®</span></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line"></span><br><span class="line">    ConsumerRecords&lt;String, String&gt; consumerRecords = kafkaConsumer.poll(Duration.ofSeconds(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (ConsumerRecord&lt;String, String&gt; consumerRecord : consumerRecords) &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(consumerRecord);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¼æ¶ˆè´¹å’Œé‡å¤æ¶ˆè´¹"><a href="#æ¼æ¶ˆè´¹å’Œé‡å¤æ¶ˆè´¹" class="headerlink" title="æ¼æ¶ˆè´¹å’Œé‡å¤æ¶ˆè´¹"></a>æ¼æ¶ˆè´¹å’Œé‡å¤æ¶ˆè´¹</h3><p>é‡å¤æ¶ˆè´¹ï¼šå·²ç»æ¶ˆè´¹äº†æ•°æ®ï¼Œä½†æ˜¯ offset æ²¡æäº¤ã€‚<br>æ¼æ¶ˆè´¹ï¼šå…ˆæäº¤ offset åæ¶ˆè´¹ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆæ•°æ®çš„æ¼æ¶ˆè´¹ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/e9052c6bfd3e5507ccd65eea215b1df6.png" title="image-20220903123840273"><h2 id="æ¶ˆè´¹è€…äº‹åŠ¡"><a href="#æ¶ˆè´¹è€…äº‹åŠ¡" class="headerlink" title="æ¶ˆè´¹è€…äº‹åŠ¡"></a><strong>æ¶ˆè´¹è€…äº‹åŠ¡</strong></h2><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/00ebe6445117fa1089fcb5f935c142d3.png" title="image-20220903123934358"><h2 id="æ•°æ®ç§¯å‹ï¼ˆæé«˜ååé‡ï¼‰"><a href="#æ•°æ®ç§¯å‹ï¼ˆæé«˜ååé‡ï¼‰" class="headerlink" title="æ•°æ®ç§¯å‹ï¼ˆæé«˜ååé‡ï¼‰"></a><strong>æ•°æ®ç§¯å‹ï¼ˆæé«˜ååé‡ï¼‰</strong></h2><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/d2a6d5fea05e3b26f1a2c51f71bea99c.png" title="image-20220903124022229"><p>å‚æ•°åç§° æè¿°<br><code>fetch.max.bytes</code> é»˜è®¤Default: 52428800ï¼ˆ50 mï¼‰ã€‚æ¶ˆè´¹è€…è·å–æœåŠ¡å™¨ç«¯ä¸€æ‰¹æ¶ˆæ¯æœ€å¤§çš„å­—èŠ‚æ•°ã€‚å¦‚æœæœåŠ¡å™¨ç«¯ä¸€æ‰¹æ¬¡çš„æ•°æ®å¤§äºè¯¥å€¼ï¼ˆ50mï¼‰ä»ç„¶å¯ä»¥æ‹‰å–å›æ¥è¿™æ‰¹æ•°æ®ï¼Œå› æ­¤ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªç»å¯¹æœ€å¤§å€¼ã€‚ä¸€æ‰¹æ¬¡çš„å¤§å°å— message.max.bytes ï¼ˆbroker configï¼‰ormax.message.bytes ï¼ˆtopic configï¼‰å½±å“ã€‚</p><p><code>max.poll.records</code> ä¸€æ¬¡ poll æ‹‰å–æ•°æ®è¿”å›æ¶ˆæ¯çš„æœ€å¤§æ¡æ•°ï¼Œé»˜è®¤æ˜¯ 500 æ¡</p><h2 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="headerlink" title="æ‹¦æˆªå™¨"></a><strong>æ‹¦æˆªå™¨</strong></h2><p>ä¸ç”Ÿäº§è€…å¯¹åº”ï¼Œæ¶ˆè´¹è€…ä¹Ÿæœ‰æ‹¦æˆªå™¨ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹æ‹¦æˆªå™¨å…·ä½“çš„æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ConsumerInterceptor</span>&lt;K, V&gt; <span class="keyword">extends</span> <span class="title class_">Configurable</span>, AutoCloseable &#123;</span><br><span class="line"></span><br><span class="line">    ConsumerRecords&lt;K, V&gt; <span class="title function_">onConsume</span><span class="params">(ConsumerRecords&lt;K, V&gt; records)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">onCommit</span><span class="params">(Map&lt;TopicPartition, OffsetAndMetadata&gt; offsets)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Kafka Consumerä¼šåœ¨**poll()**æ–¹æ³•è¿”å›ä¹‹å‰è°ƒç”¨æ‹¦æˆªå™¨çš„**onConsume()*<em>æ–¹æ³•æ¥å¯¹æ¶ˆæ¯è¿›è¡Œç›¸åº”çš„å®šåˆ¶åŒ–æ“ä½œï¼Œæ¯”å¦‚*<em>ä¿®æ”¹è¿”å›çš„æ¶ˆæ¯å†…å®¹</em></em>ã€<strong>æŒ‰ç…§æŸç§è§„åˆ™è¿‡æ»¤æ¶ˆæ¯</strong>ï¼ˆå¯èƒ½ä¼šå‡å°‘poll()æ–¹æ³•è¿”å› çš„æ¶ˆæ¯çš„ä¸ªæ•°ï¼‰ã€‚å¦‚æœonConsume()æ–¹æ³•ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œ é‚£ä¹ˆä¼šè¢«æ•è·å¹¶è®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œ ä½†æ˜¯å¼‚å¸¸ä¸ä¼šå†å‘ä¸Šä¼ é€’ã€‚</p><p>Kafka Consumerä¼šåœ¨æäº¤å®Œæ¶ˆè´¹ä½ç§»ä¹‹åè°ƒç”¨æ‹¦æˆªå™¨çš„**onCommit()**æ–¹æ³•ï¼Œ å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥è®°å½•è·Ÿè¸ªæ‰€æäº¤çš„ä½ç§»ä¿¡æ¯ï¼Œæ¯”å¦‚å½“æ¶ˆè´¹è€…ä½¿ç”¨commitSyncçš„æ— å‚æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬ä¸çŸ¥é“æäº¤çš„æ¶ˆè´¹ä½ç§»çš„å…·ä½“ç»†èŠ‚ï¼Œ è€Œä½¿ç”¨æ‹¦æˆªå™¨çš„onCommit()æ–¹æ³•å´å¯ä»¥åšåˆ°è¿™ ä¸€ç‚¹ã€‚</p><h1 id="Kafkaæ•´åˆSpring-Boot"><a href="#Kafkaæ•´åˆSpring-Boot" class="headerlink" title="Kafkaæ•´åˆSpring Boot"></a>Kafkaæ•´åˆSpring Boot</h1><ol><li>å¯¼åŒ… -é™¤äº†Spring Boot ä¹‹å¤–è¿˜éœ€è¦é¢å¤–å¯¼å…¥ Spring Webã€Kafka</li></ol><img src="/img/loading.gif" data-lazy-src="/posts/f351760e/f8dad88ad0584fdf0307aabffabe8713.png" title="image-20220903182633431"><p>2, ç¼–å†™é…ç½®æ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">kafka:</span></span><br><span class="line">    <span class="attr">bootstrap-servers:</span> <span class="number">47.106</span><span class="number">.86</span><span class="number">.64</span><span class="string">:9092</span></span><br><span class="line">    <span class="attr">consumer:</span></span><br><span class="line">      <span class="attr">group-id:</span> <span class="string">test2</span></span><br><span class="line">      <span class="comment"># #åºåˆ—åŒ–å™¨ ä»¥åŠååºåˆ—åŒ–å™¨</span></span><br><span class="line">      <span class="attr">key-deserializer:</span> <span class="string">org.apache.kafka.common.serialization.StringDeserializer</span></span><br><span class="line">      <span class="attr">value-deserializer:</span> <span class="string">org.apache.kafka.common.serialization.StringDeserializer</span></span><br><span class="line">    <span class="attr">producer:</span></span><br><span class="line">      <span class="comment"># #åºåˆ—åŒ–å™¨ ä»¥åŠååºåˆ—åŒ–å™¨</span></span><br><span class="line">      <span class="attr">key-serializer:</span> <span class="string">org.apache.kafka.common.serialization.StringSerializer</span></span><br><span class="line">      <span class="attr">value-serializer:</span> <span class="string">org.apache.kafka.common.serialization.StringSerializer</span></span><br></pre></td></tr></table></figure><p>3ã€å®šä¹‰ç®€å•ç”Ÿäº§è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    KafkaTemplate&lt;String, String&gt; kafkaTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hi&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String  <span class="title function_">data</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">        kafkaTemplate.send(<span class="string">&quot;first&quot;</span>,msg);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–å†™å…·æœ‰å›è°ƒå‡½æ•°çš„ç”Ÿäº§è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/kafka/callbackOne/&#123;message&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage2</span><span class="params">(<span class="meta">@PathVariable(&quot;message&quot;)</span> String callbackMessage)</span> &#123;</span><br><span class="line">    kafkaTemplate.send(<span class="string">&quot;first&quot;</span>, callbackMessage).addCallback(success -&gt; &#123;</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯å‘é€åˆ°çš„topic</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">topic</span> <span class="operator">=</span> success.getRecordMetadata().topic();</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯å‘é€åˆ°çš„åˆ†åŒº</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">partition</span> <span class="operator">=</span> success.getRecordMetadata().partition();</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯åœ¨åˆ†åŒºå†…çš„offset</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> success.getRecordMetadata().offset();</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘é€æ¶ˆæ¯æˆåŠŸ:&quot;</span> + topic + <span class="string">&quot;-&quot;</span> + partition + <span class="string">&quot;-&quot;</span> + offset);</span><br><span class="line">    &#125;, failure -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘é€æ¶ˆæ¯å¤±è´¥:&quot;</span> + failure.getMessage());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/kafka/callbackTwo/&#123;message&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage3</span><span class="params">(<span class="meta">@PathVariable(&quot;message&quot;)</span> String callbackMessage)</span> &#123;</span><br><span class="line">    kafkaTemplate.send(<span class="string">&quot;first&quot;</span>, callbackMessage).addCallback(</span><br><span class="line">        (ListenableFutureCallback&lt;? <span class="built_in">super</span> SendResult&lt;String, String&gt;&gt;) <span class="keyword">new</span> <span class="title class_">ListenableFutureCallback</span>&lt;SendResult&lt;String, Object&gt;&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFailure</span><span class="params">(Throwable ex)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;å‘é€æ¶ˆæ¯å¤±è´¥ï¼š&quot;</span>+ex.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSuccess</span><span class="params">(SendResult&lt;String, Object&gt; result)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;å‘é€æ¶ˆæ¯æˆåŠŸï¼š&quot;</span> + result.getRecordMetadata().topic() + <span class="string">&quot;-&quot;</span></span><br><span class="line">                                   + result.getRecordMetadata().partition() + <span class="string">&quot;-&quot;</span> + result.getRecordMetadata().offset());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ã€å®šä¹‰æ¶ˆè´¹è€… -&gt;å¯åŠ¨ç›‘å¬çº¿ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KafkaConfiguration</span>&#123;</span><br><span class="line">    <span class="meta">@KafkaListener(topics = &#123;&quot;first&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">message1</span><span class="params">(ConsumerRecord&lt;?, ?&gt; record)</span>&#123;</span><br><span class="line">        <span class="comment">// æ¶ˆè´¹çš„å“ªä¸ªtopicã€partitionçš„æ¶ˆæ¯,æ‰“å°å‡ºæ¶ˆæ¯å†…å®¹</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ç‚¹å¯¹ç‚¹æ¶ˆè´¹1ï¼š&quot;</span>+record.topic()+<span class="string">&quot;-&quot;</span>+record.partition()+<span class="string">&quot;-&quot;</span>+record.value());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/hi&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String  <span class="title function_">data</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    kafkaTemplate.send(<span class="string">&quot;first&quot;</span>,msg);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">ç¼–å†™å…·æœ‰å›è°ƒå‡½æ•°çš„ç”Ÿäº§è€…</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line"><span class="meta">@GetMapping(&quot;/kafka/callbackOne/&#123;message&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage2</span><span class="params">(<span class="meta">@PathVariable(&quot;message&quot;)</span> String callbackMessage)</span> &#123;</span><br><span class="line">    kafkaTemplate.send(<span class="string">&quot;first&quot;</span>, callbackMessage).addCallback(success -&gt; &#123;</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯å‘é€åˆ°çš„topic</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">topic</span> <span class="operator">=</span> success.getRecordMetadata().topic();</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯å‘é€åˆ°çš„åˆ†åŒº</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">partition</span> <span class="operator">=</span> success.getRecordMetadata().partition();</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯åœ¨åˆ†åŒºå†…çš„offset</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> success.getRecordMetadata().offset();</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘é€æ¶ˆæ¯æˆåŠŸ:&quot;</span> + topic + <span class="string">&quot;-&quot;</span> + partition + <span class="string">&quot;-&quot;</span> + offset);</span><br><span class="line">    &#125;, failure -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‘é€æ¶ˆæ¯å¤±è´¥:&quot;</span> + failure.getMessage());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/kafka/callbackTwo/&#123;message&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage3</span><span class="params">(<span class="meta">@PathVariable(&quot;message&quot;)</span> String callbackMessage)</span> &#123;</span><br><span class="line">    kafkaTemplate.send(<span class="string">&quot;first&quot;</span>, callbackMessage).addCallback(</span><br><span class="line">        (ListenableFutureCallback&lt;? <span class="built_in">super</span> SendResult&lt;String, String&gt;&gt;) <span class="keyword">new</span> <span class="title class_">ListenableFutureCallback</span>&lt;SendResult&lt;String, Object&gt;&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFailure</span><span class="params">(Throwable ex)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;å‘é€æ¶ˆæ¯å¤±è´¥ï¼š&quot;</span>+ex.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSuccess</span><span class="params">(SendResult&lt;String, Object&gt; result)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;å‘é€æ¶ˆæ¯æˆåŠŸï¼š&quot;</span> + result.getRecordMetadata().topic() + <span class="string">&quot;-&quot;</span></span><br><span class="line">                                   + result.getRecordMetadata().partition() + <span class="string">&quot;-&quot;</span> + result.getRecordMetadata().offset());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ã€å®šä¹‰æ¶ˆè´¹è€… -&gt;å¯åŠ¨ç›‘å¬çº¿ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KafkaConfiguration</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@KafkaListener(topics = &#123;&quot;first&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">message1</span><span class="params">(ConsumerRecord&lt;?, ?&gt; record)</span>&#123;</span><br><span class="line">        <span class="comment">// æ¶ˆè´¹çš„å“ªä¸ªtopicã€partitionçš„æ¶ˆæ¯,æ‰“å°å‡ºæ¶ˆæ¯å†…å®¹</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ç‚¹å¯¹ç‚¹æ¶ˆè´¹1ï¼š&quot;</span>+record.topic()+<span class="string">&quot;-&quot;</span>+record.partition()+<span class="string">&quot;-&quot;</span>+record.value());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒ ï¼š<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.csdn.net/prague6695/article/details/123869202">https://blog.csdn.net/prague6695/article/details/123869202</a></p><h1 id="Kafka-Consumeré…ç½®"><a href="#Kafka-Consumeré…ç½®" class="headerlink" title="Kafka Consumeré…ç½®"></a>Kafka Consumeré…ç½®</h1><p>åœ¨0.9.0.0ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº†æ–°çš„Javaæ¶ˆè´¹è€…æ¥æ›¿ä»£æ—©æœŸåŸºäºScalaçš„ç®€å•å’Œé«˜çº§æ¶ˆè´¹è€…ã€‚æ–°è€å®¢æˆ·ç«¯çš„é…ç½®å¦‚ä¸‹ã€‚</p><h2 id="æ–°æ¶ˆè´¹è€…é…ç½®"><a href="#æ–°æ¶ˆè´¹è€…é…ç½®" class="headerlink" title="æ–°æ¶ˆè´¹è€…é…ç½®"></a>æ–°æ¶ˆè´¹è€…é…ç½®</h2><p>æ–°æ¶ˆè´¹è€…é…ç½®ï¼šï¼ˆæ³¨æ„ï¼Œå³é¢æ˜¯å¯æ‹–åŠ¨çš„ï¼‰</p><table><thead><tr><th>NAME</th><th>DESCRIPTION</th><th>TYPE</th><th>DEFAULT</th><th>VALID VALUES</th><th>IMPORTANCE</th></tr></thead><tbody><tr><td>bootstrap.servers</td><td>host&#x2F;port,ç”¨äºå’Œkafkaé›†ç¾¤å»ºç«‹åˆå§‹åŒ–è¿æ¥ã€‚å› ä¸ºè¿™äº›æœåŠ¡å™¨åœ°å€ä»…ç”¨äºåˆå§‹åŒ–è¿æ¥ï¼Œå¹¶é€šè¿‡ç°æœ‰é…ç½®çš„æ¥å‘ç°å…¨éƒ¨çš„kafkaé›†ç¾¤æˆå‘˜ï¼ˆé›†ç¾¤éšæ—¶ä¼šå˜åŒ–ï¼‰ï¼Œæ‰€ä»¥æ­¤åˆ—è¡¨ä¸éœ€è¦åŒ…å«å®Œæ•´çš„é›†ç¾¤åœ°å€ï¼ˆä½†å°½é‡å¤šé…ç½®å‡ ä¸ªï¼Œä»¥é˜²æ­¢é…ç½®çš„æœåŠ¡å™¨å®•æœºï¼‰ã€‚</td><td>list</td><td></td><td></td><td>high</td></tr><tr><td>key.deserializer</td><td>keyçš„è§£æåºåˆ—åŒ–æ¥å£å®ç°ç±»ï¼ˆDeserializerï¼‰ã€‚</td><td>class</td><td></td><td></td><td>high</td></tr><tr><td>value.deserializer</td><td>valueçš„è§£æåºåˆ—åŒ–æ¥å£å®ç°ç±»ï¼ˆDeserializerï¼‰</td><td>class</td><td></td><td></td><td>high</td></tr><tr><td>fetch.min.bytes</td><td>æœåŠ¡å™¨å“¦æ‹‰å–è¯·æ±‚è¿”å›çš„æœ€å°æ•°æ®é‡ï¼Œå¦‚æœæ•°æ®ä¸è¶³ï¼Œè¯·æ±‚å°†ç­‰å¾…æ•°æ®ç§¯ç´¯ã€‚é»˜è®¤è®¾ç½®ä¸º1å­—èŠ‚ï¼Œè¡¨ç¤ºåªè¦å•ä¸ªå­—èŠ‚çš„æ•°æ®å¯ç”¨æˆ–è€…è¯»å–ç­‰å¾…è¯·æ±‚è¶…æ—¶ï¼Œå°±ä¼šåº”ç­”è¯»å–è¯·æ±‚ã€‚å°†æ­¤å€¼è®¾ç½®çš„è¶Šå¤§å°†å¯¼è‡´æœåŠ¡å™¨ç­‰å¾…æ•°æ®ç´¯ç§¯çš„è¶Šé•¿ï¼Œè¿™å¯èƒ½ä»¥ä¸€äº›é¢å¤–å»¶è¿Ÿä¸ºä»£ä»·æé«˜æœåŠ¡å™¨ååé‡ã€‚</td><td>int</td><td>1</td><td>[0,...]</td><td>high</td></tr><tr><td>group.id</td><td>æ­¤æ¶ˆè´¹è€…æ‰€å±æ¶ˆè´¹è€…ç»„çš„å”¯ä¸€æ ‡è¯†ã€‚å¦‚æœæ¶ˆè´¹è€…ç”¨äºè®¢é˜…æˆ–offsetç®¡ç†ç­–ç•¥çš„ç»„ç®¡ç†åŠŸèƒ½ï¼Œåˆ™æ­¤å±æ€§æ˜¯å¿…é¡»çš„ã€‚</td><td>string</td><td>&quot;&quot;</td><td></td><td>high</td></tr><tr><td>heartbeat.interval.ms</td><td>å½“ä½¿ç”¨Kafkaçš„åˆ†ç»„ç®¡ç†åŠŸèƒ½æ—¶ï¼Œå¿ƒè·³åˆ°æ¶ˆè´¹è€…åè°ƒå™¨ä¹‹é—´çš„é¢„è®¡æ—¶é—´ã€‚å¿ƒè·³ç”¨äºç¡®ä¿æ¶ˆè´¹è€…çš„ä¼šè¯ä¿æŒæ´»åŠ¨çŠ¶æ€ï¼Œå¹¶å½“æœ‰æ–°æ¶ˆè´¹è€…åŠ å…¥æˆ–ç¦»å¼€ç»„æ—¶æ–¹ä¾¿é‡æ–°å¹³è¡¡ã€‚è¯¥å€¼å¿…é¡»å¿…æ¯”session.timeout.mså°ï¼Œé€šå¸¸ä¸é«˜äº1&#x2F;3ã€‚å®ƒå¯ä»¥è°ƒæ•´çš„æ›´ä½ï¼Œä»¥æ§åˆ¶æ­£å¸¸é‡æ–°å¹³è¡¡çš„é¢„æœŸæ—¶é—´ã€‚</td><td>int</td><td>3000(3ç§’)</td><td></td><td>high</td></tr><tr><td>max.partition.fetch.bytes</td><td>æœåŠ¡å™¨å°†è¿”å›æ¯ä¸ªåˆ†åŒºçš„æœ€å¤§æ•°æ®é‡ã€‚å¦‚æœæ‹‰å–çš„ç¬¬ä¸€ä¸ªéç©ºåˆ†åŒºä¸­ç¬¬ä¸€ä¸ªæ¶ˆæ¯å¤§äºæ­¤é™åˆ¶ï¼Œåˆ™ä»ç„¶ä¼šè¿”å›æ¶ˆæ¯ï¼Œä»¥ç¡®ä¿æ¶ˆè´¹è€…å¯ä»¥æ­£å¸¸çš„å·¥ä½œã€‚brokeræ¥å—çš„æœ€å¤§æ¶ˆæ¯å¤§å°é€šè¿‡<code>message.max.bytes</code>ï¼ˆbroker configï¼‰æˆ–<code>max.message.bytes</code> (topic config)å®šä¹‰ã€‚å‚é˜…fetch.max.bytesä»¥é™åˆ¶æ¶ˆè´¹è€…è¯·æ±‚å¤§å°ã€‚</td><td>int</td><td>1048576</td><td>[0,...]</td><td>high</td></tr><tr><td>session.timeout.ms</td><td>ç”¨äºå‘ç°æ¶ˆè´¹è€…æ•…éšœçš„è¶…æ—¶æ—¶é—´ã€‚æ¶ˆè´¹è€…å‘¨æœŸæ€§çš„å‘é€å¿ƒè·³åˆ°brokerï¼Œè¡¨ç¤ºå…¶è¿˜æ´»ç€ã€‚å¦‚æœä¼šè¯è¶…æ—¶æœŸæ»¡ä¹‹å‰æ²¡æœ‰æ”¶åˆ°å¿ƒè·³ï¼Œé‚£ä¹ˆbrokerå°†ä»åˆ†ç»„ä¸­ç§»é™¤æ¶ˆè´¹è€…ï¼Œå¹¶å¯åŠ¨é‡æ–°å¹³è¡¡ã€‚è¯·æ³¨æ„ï¼Œè¯¥å€¼å¿…é¡»åœ¨brokeré…ç½®çš„<code>group.min.session.timeout.ms</code>å’Œ<code>group.max.session.timeout.ms</code>å…è®¸çš„èŒƒå›´å†…ã€‚</td><td>int</td><td>45000(45s)</td><td></td><td>high</td></tr><tr><td>ssl.key.password</td><td>å¯†é’¥å­˜å‚¨æ–‡ä»¶ä¸­çš„ç§é’¥çš„å¯†ç ã€‚ å®¢æˆ·ç«¯å¯é€‰</td><td>password</td><td>null</td><td></td><td>high</td></tr><tr><td>ssl.keystore.location</td><td>å¯†é’¥å­˜å‚¨æ–‡ä»¶çš„ä½ç½®ï¼Œ è¿™å¯¹äºå®¢æˆ·ç«¯æ˜¯å¯é€‰çš„ï¼Œå¹¶ä¸”å¯ä»¥ç”¨äºå®¢æˆ·ç«¯çš„åŒå‘è®¤è¯ã€‚</td><td>string</td><td>null</td><td></td><td>high</td></tr><tr><td>ssl.keystore.password</td><td>å¯†é’¥ä»“åº“æ–‡ä»¶çš„ä»“åº“å¯†ç ã€‚å®¢æˆ·ç«¯å¯é€‰ï¼Œåªæœ‰ssl.keystore.locationé…ç½®äº†æ‰éœ€è¦ã€‚</td><td>password</td><td>null</td><td></td><td>high</td></tr><tr><td>ssl.truststore.location</td><td>ä¿¡ä»»ä»“åº“æ–‡ä»¶çš„ä½ç½®</td><td>string</td><td>null</td><td></td><td>high</td></tr><tr><td>ssl.truststore.password</td><td>ä¿¡ä»»ä»“åº“æ–‡ä»¶çš„å¯†ç </td><td>password</td><td>null</td><td></td><td>high</td></tr><tr><td>auto.offset.reset</td><td>å½“Kafkaä¸­æ²¡æœ‰åˆå§‹offsetæˆ–å¦‚æœå½“å‰çš„offsetä¸å­˜åœ¨æ—¶ï¼ˆä¾‹å¦‚ï¼Œè¯¥æ•°æ®è¢«åˆ é™¤äº†ï¼‰ï¼Œè¯¥æ€ä¹ˆåŠã€‚ *earliestï¼šè‡ªåŠ¨å°†åç§»é‡ç½®ä¸ºæœ€æ—©çš„åç§» * latestï¼šè‡ªåŠ¨å°†åç§»é‡ç½®ä¸ºæœ€æ–°åç§» *noneï¼šå¦‚æœæ¶ˆè´¹è€…ç»„æ‰¾åˆ°ä¹‹å‰çš„offsetï¼Œåˆ™å‘æ¶ˆè´¹è€…æŠ›å‡ºå¼‚å¸¸ * å…¶ä»–ï¼šæŠ›å‡ºå¼‚å¸¸ç»™æ¶ˆè´¹è€…ã€‚</td><td>string</td><td>latest</td><td>[latest, earliest, none]</td><td>medium</td></tr><tr><td>connections.max.idle.ms</td><td>æŒ‡å®šåœ¨å¤šå°‘æ¯«ç§’ä¹‹åå…³é—­é—²ç½®çš„è¿æ¥</td><td>long</td><td>540000</td><td></td><td>medium</td></tr><tr><td>enable.auto.commit</td><td>å¦‚æœä¸ºtrueï¼Œæ¶ˆè´¹è€…çš„offsetå°†åœ¨åå°å‘¨æœŸæ€§çš„æäº¤</td><td>boolean</td><td>true</td><td></td><td>medium</td></tr><tr><td>exclude.internal.topics</td><td>å†…éƒ¨topicçš„è®°å½•ï¼ˆå¦‚åç§»é‡ï¼‰æ˜¯å¦åº”å‘æ¶ˆè´¹è€…å…¬å¼€ã€‚å¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™ä»å†…éƒ¨topicæ¥å—è®°å½•çš„å”¯ä¸€æ–¹æ³•æ˜¯è®¢é˜…å®ƒã€‚</td><td>boolean</td><td>true</td><td></td><td>medium</td></tr><tr><td>fetch.max.bytes</td><td>æœåŠ¡å™¨ä¸ºæ‹‰å–è¯·æ±‚è¿”å›çš„æœ€å¤§æ•°æ®å€¼ã€‚è¿™ä¸æ˜¯ç»å¯¹çš„æœ€å¤§å€¼ï¼Œå¦‚æœåœ¨ç¬¬ä¸€æ¬¡éç©ºåˆ†åŒºæ‹‰å–çš„ç¬¬ä¸€æ¡æ¶ˆæ¯å¤§äºè¯¥å€¼ï¼Œè¯¥æ¶ˆæ¯å°†ä»ç„¶è¿”å›ï¼Œä»¥ç¡®ä¿æ¶ˆè´¹è€…ç»§ç»­å·¥ä½œã€‚æ¥æ”¶çš„æœ€å¤§æ¶ˆæ¯å¤§å°é€šè¿‡message.max.bytes (broker config) æˆ– max.message.bytes (topic config)å®šä¹‰ã€‚æ³¨æ„ï¼Œæ¶ˆè´¹è€…æ˜¯å¹¶è¡Œæ‰§è¡Œå¤šä¸ªæå–çš„ã€‚</td><td>int</td><td>52428800</td><td>[0,...]</td><td>medium</td></tr><tr><td>max.poll.interval.ms</td><td>ä½¿ç”¨æ¶ˆè´¹è€…ç»„ç®¡ç†æ—¶poll()è°ƒç”¨ä¹‹é—´çš„æœ€å¤§å»¶è¿Ÿã€‚æ¶ˆè´¹è€…åœ¨è·å–æ›´å¤šè®°å½•ä¹‹å‰å¯ä»¥ç©ºé—²çš„æ—¶é—´é‡çš„ä¸Šé™ã€‚å¦‚æœæ­¤è¶…æ—¶æ—¶é—´æœŸæ»¡ä¹‹å‰poll()æ²¡æœ‰è°ƒç”¨ï¼Œåˆ™æ¶ˆè´¹è€…è¢«è§†ä¸ºå¤±è´¥ï¼Œå¹¶ä¸”åˆ†ç»„å°†é‡æ–°å¹³è¡¡ï¼Œä»¥ä¾¿å°†åˆ†åŒºé‡æ–°åˆ†é…ç»™åˆ«çš„æˆå‘˜ã€‚</td><td>int</td><td>300000</td><td>[1,...]</td><td>medium</td></tr><tr><td>max.poll.records</td><td>åœ¨å•æ¬¡è°ƒç”¨<code>poll()</code>ä¸­è¿”å›çš„æœ€å¤§æ¶ˆæ¯æ•°ã€‚</td><td>int</td><td>500</td><td>[1,...]</td><td>medium</td></tr><tr><td>partition.assignment.strategy</td><td>å½“ä½¿ç”¨ç»„ç®¡ç†æ—¶ï¼Œå®¢æˆ·ç«¯å°†ä½¿ç”¨åˆ†åŒºåˆ†é…ç­–ç•¥çš„ç±»åæ¥åˆ†é…æ¶ˆè´¹è€…å®ä¾‹ä¹‹é—´çš„åˆ†åŒºæ‰€æœ‰æƒ</td><td>list</td><td>class org.apache.kafka .clients.consumer .RangeAssignor</td><td></td><td>medium</td></tr><tr><td>receive.buffer.bytes</td><td>è¯»å–æ•°æ®æ—¶ä½¿ç”¨çš„TCPæ¥æ”¶ç¼“å†²åŒºï¼ˆSO_RCVBUFï¼‰çš„å¤§å°ã€‚ å¦‚æœå€¼ä¸º-1ï¼Œåˆ™å°†ä½¿ç”¨OSé»˜è®¤å€¼ã€‚</td><td>int</td><td>65536</td><td>[-1,...]</td><td>medium</td></tr><tr><td>request.timeout.ms</td><td>é…ç½®æ§åˆ¶å®¢æˆ·ç«¯ç­‰å¾…è¯·æ±‚å“åº”çš„æœ€é•¿æ—¶é—´ã€‚ å¦‚æœåœ¨è¶…æ—¶ä¹‹å‰æœªæ”¶åˆ°å“åº”ï¼Œå®¢æˆ·ç«¯å°†åœ¨å¿…è¦æ—¶é‡æ–°å‘é€è¯·æ±‚ï¼Œå¦‚æœé‡è¯•è€—å°½åˆ™å®¢æˆ·ç«¯å°†é‡æ–°å‘é€è¯·æ±‚ã€‚</td><td>int</td><td>305000</td><td>[0,...]</td><td>medium</td></tr><tr><td>sasl.jaas.config</td><td>JAASé…ç½®æ–‡ä»¶ä¸­SASLè¿æ¥ç™»å½•ä¸Šä¸‹æ–‡å‚æ•°ã€‚ è¿™é‡Œæè¿°JAASé…ç½®æ–‡ä»¶æ ¼å¼ã€‚ è¯¥å€¼çš„æ ¼å¼ä¸ºï¼š &#39;(&#x3D;)*;&#39;</td><td>password</td><td>null</td><td></td><td>medium</td></tr><tr><td>sasl.kerberos.service.name</td><td>Kafkaè¿è¡ŒKerberos principalåã€‚å¯ä»¥åœ¨Kafkaçš„JAASé…ç½®æ–‡ä»¶æˆ–åœ¨Kafkaçš„é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ã€‚</td><td>string</td><td>null</td><td></td><td>medium</td></tr><tr><td>sasl.mechanism</td><td>ç”¨äºå®¢æˆ·ç«¯è¿æ¥çš„SASLæœºåˆ¶ã€‚å®‰å…¨æä¾›è€…å¯ç”¨çš„æœºåˆ¶ã€‚GSSAPIæ˜¯é»˜è®¤æœºåˆ¶ã€‚</td><td>string</td><td>GSSAPI</td><td></td><td>medium</td></tr><tr><td>security.protocol</td><td>ç”¨äºä¸brokeré€šè®¯çš„åè®®ã€‚ æœ‰æ•ˆå€¼ä¸ºï¼šPLAINTEXTï¼ŒSSLï¼ŒSASL_PLAINTEXTï¼ŒSASL_SSLã€‚</td><td>string</td><td>PLAINTEXT</td><td></td><td>medium</td></tr><tr><td>send.buffer.bytes</td><td>å‘é€æ•°æ®æ—¶è¦ä½¿ç”¨çš„TCPå‘é€ç¼“å†²åŒºï¼ˆSO_SNDBUFï¼‰çš„å¤§å°ã€‚ å¦‚æœå€¼ä¸º-1ï¼Œåˆ™å°†ä½¿ç”¨OSé»˜è®¤å€¼ã€‚</td><td>int</td><td>131072</td><td>[-1,...]</td><td>medium</td></tr><tr><td>ssl.enabled.protocols</td><td>å¯ç”¨SSLè¿æ¥çš„åè®®åˆ—è¡¨ã€‚</td><td>list</td><td>TLSv1.2,TLSv1.1,TLSv1</td><td></td><td>medium</td></tr><tr><td>ssl.keystore.type</td><td>keyä»“åº“æ–‡ä»¶çš„æ–‡ä»¶æ ¼å¼ï¼Œå®¢æˆ·ç«¯å¯é€‰ã€‚</td><td>string</td><td>JKS</td><td></td><td>medium</td></tr><tr><td>ssl.protocol</td><td>ç”¨äºç”ŸæˆSSLContextçš„SSLåè®®ã€‚ é»˜è®¤è®¾ç½®æ˜¯TLSï¼Œè¿™å¯¹å¤§å¤šæ•°æƒ…å†µéƒ½æ˜¯é€‚ç”¨çš„ã€‚ æœ€æ–°çš„JVMä¸­çš„å…è®¸å€¼ä¸ºTLSï¼ŒTLSv1.1å’ŒTLSv1.2ã€‚ è¾ƒæ—§çš„JVMå¯èƒ½æ”¯æŒSSLï¼ŒSSLv2å’ŒSSLv3ï¼Œä½†ç”±äºå·²çŸ¥çš„å®‰å…¨æ¼æ´ï¼Œä¸å»ºè®®ä½¿ç”¨SSLã€‚</td><td>string</td><td>TLS</td><td></td><td>medium</td></tr><tr><td>ssl.provider</td><td>ç”¨äºSSLè¿æ¥çš„å®‰å…¨æä¾›ç¨‹åºçš„åç§°ã€‚ é»˜è®¤å€¼æ˜¯JVMçš„é»˜è®¤å®‰å…¨æä¾›ç¨‹åºã€‚</td><td>string</td><td>null</td><td></td><td>medium</td></tr><tr><td>ssl.truststore.type</td><td>ä¿¡ä»»å­˜å‚¨æ–‡ä»¶çš„æ–‡ä»¶æ ¼å¼ã€‚</td><td>string</td><td>JKS</td><td></td><td>medium</td></tr><tr><td>auto.commit.interval.ms</td><td>å¦‚æœenable.auto.commitè®¾ç½®ä¸ºtrueï¼Œåˆ™æ¶ˆè´¹è€…åç§»é‡è‡ªåŠ¨æäº¤ç»™Kafkaçš„é¢‘ç‡ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚</td><td>int</td><td>5000</td><td>[0,...]</td><td>low</td></tr><tr><td>check.crcs</td><td>è‡ªåŠ¨æ£€æŸ¥CRC32è®°å½•çš„æ¶ˆè€—ã€‚ è¿™æ ·å¯ä»¥ç¡®ä¿æ¶ˆæ¯å‘ç”Ÿæ—¶ä¸ä¼šåœ¨çº¿æˆ–ç£ç›˜æŸåã€‚ æ­¤æ£€æŸ¥å¢åŠ äº†ä¸€äº›å¼€é”€ï¼Œå› æ­¤åœ¨å¯»æ±‚æè‡´æ€§èƒ½çš„æƒ…å†µä¸‹å¯èƒ½ä¼šè¢«ç¦ç”¨ã€‚</td><td>boolean</td><td>true</td><td></td><td>low</td></tr><tr><td>client.id</td><td>åœ¨å‘å‡ºè¯·æ±‚æ—¶ä¼ é€’ç»™æœåŠ¡å™¨çš„idå­—ç¬¦ä¸²ã€‚ è¿™æ ·åšçš„ç›®çš„æ˜¯é€šè¿‡å…è®¸å°†é€»è¾‘åº”ç”¨ç¨‹åºåç§°åŒ…å«åœ¨æœåŠ¡å™¨ç«¯è¯·æ±‚æ—¥å¿—è®°å½•ä¸­ï¼Œæ¥è·Ÿè¸ªip&#x2F;portçš„è¯·æ±‚æºã€‚</td><td>string</td><td>&quot;&quot;</td><td></td><td>low</td></tr><tr><td>fetch.max.wait.ms</td><td>å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®æ»¡è¶³fetch.min.bytesï¼ŒæœåŠ¡å™¨å°†åœ¨æ¥æ”¶åˆ°æå–è¯·æ±‚ä¹‹å‰é˜»æ­¢çš„æœ€å¤§æ—¶é—´ã€‚</td><td>int</td><td>500</td><td>[0,...]</td><td>low</td></tr><tr><td>interceptor.classes</td><td>ç”¨ä½œæ‹¦æˆªå™¨çš„ç±»çš„åˆ—è¡¨ã€‚ ä½ å¯å®ç°ConsumerInterceptoræ¥å£ä»¥å…è®¸æ‹¦æˆªï¼ˆä¹Ÿå¯èƒ½å˜åŒ–ï¼‰æ¶ˆè´¹è€…æ¥æ”¶çš„æ¶ˆæ¯ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ²¡æœ‰æ‹¦æˆªå™¨ã€‚</td><td>list</td><td>null</td><td></td><td>low</td></tr><tr><td>metadata.max.age.ms</td><td>åœ¨ä¸€å®šæ—¶é—´æ®µä¹‹åï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½çš„ï¼‰ï¼Œå¼ºåˆ¶æ›´æ–°å…ƒæ•°æ®ï¼Œå³ä½¿æ²¡æœ‰ä»»ä½•åˆ†åŒºé¢†å¯¼å˜åŒ–ï¼Œä»»ä½•æ–°çš„brokeræˆ–åˆ†åŒºã€‚</td><td>long</td><td>300000</td><td>[0,...]</td><td>low</td></tr><tr><td>metric.reporters</td><td>ç”¨ä½œåº¦é‡è®°å½•å‘˜ç±»çš„åˆ—è¡¨ã€‚å®ç°MetricReporteræ¥å£ä»¥å…è®¸æ’å…¥é€šçŸ¥æ–°çš„åº¦é‡åˆ›å»ºçš„ç±»ã€‚JmxReporterå§‹ç»ˆåŒ…å«åœ¨æ³¨å†ŒJMXç»Ÿè®¡ä¿¡æ¯ä¸­ã€‚</td><td>list</td><td>&quot;&quot;</td><td></td><td>low</td></tr><tr><td>metrics.num.samples</td><td>ä¿æŒçš„æ ·æœ¬æ•°ä»¥è®¡ç®—åº¦é‡ã€‚</td><td>int</td><td>2</td><td>[1,...]</td><td>low</td></tr><tr><td>metrics.recording.level</td><td>æœ€é«˜çš„è®°å½•çº§åˆ«ã€‚</td><td>string</td><td>INFO</td><td>[INFO, DEBUG]</td><td>low</td></tr><tr><td>metrics.sample.window.ms</td><td>The window of time a metrics sample is computed over.</td><td>long</td><td>30000</td><td>[0,...]</td><td>low</td></tr><tr><td>reconnect.backoff.ms</td><td>å°è¯•é‡æ–°è¿æ¥æŒ‡å®šä¸»æœºä¹‹å‰ç­‰å¾…çš„æ—¶é—´ï¼Œé¿å…é¢‘ç¹çš„è¿æ¥ä¸»æœºï¼Œè¿™ç§æœºåˆ¶é€‚ç”¨äºæ¶ˆè´¹è€…å‘brokerå‘é€çš„æ‰€æœ‰è¯·æ±‚ã€‚</td><td>long</td><td>50</td><td>[0,...]</td><td>low</td></tr><tr><td>retry.backoff.ms</td><td>å°è¯•é‡æ–°å‘é€å¤±è´¥çš„è¯·æ±‚åˆ°æŒ‡å®štopicåˆ†åŒºä¹‹å‰çš„ç­‰å¾…æ—¶é—´ã€‚é¿å…åœ¨æŸäº›æ•…éšœæƒ…å†µä¸‹ï¼Œé¢‘ç¹çš„é‡å¤å‘é€ã€‚</td><td>long</td><td>100</td><td>[0,...]</td><td>low</td></tr><tr><td>sasl.kerberos.kinit.cmd Kerberos</td><td>kinitå‘½ä»¤è·¯å¾„ã€‚</td><td>string</td><td>&#x2F;usr&#x2F;bin&#x2F;kinit</td><td></td><td>low</td></tr><tr><td>sasl.kerberos.min.time.before.relogin</td><td>å°è¯•&#x2F;æ¢å¤ä¹‹é—´çš„ç™»å½•çº¿ç¨‹çš„ä¼‘çœ æ—¶é—´ã€‚</td><td>long</td><td>60000</td><td></td><td>low</td></tr><tr><td>sasl.kerberos.ticket.renew.jitter</td><td>æ·»åŠ åˆ°æ›´æ–°æ—¶é—´çš„éšæœºæŠ–åŠ¨ç™¾åˆ†æ¯”ã€‚</td><td>double</td><td>0.05</td><td></td><td>low</td></tr><tr><td>sasl.kerberos.ticket.renew.window.factor</td><td>ç™»å½•çº¿ç¨‹å°†ä¼‘çœ ï¼Œç›´åˆ°ä»ä¸Šæ¬¡åˆ·æ–°åˆ°ticketçš„æŒ‡å®šçš„æ—¶é—´çª—å£å› å­åˆ°æœŸï¼Œæ­¤æ—¶å°†å°è¯•ç»­è®¢ticketã€‚</td><td>double</td><td>0.8</td><td></td><td>low</td></tr><tr><td>ssl.cipher.suites</td><td>å¯†ç å¥—ä»¶åˆ—è¡¨ï¼Œç”¨äºTLSæˆ–SSLç½‘ç»œåè®®çš„å®‰å…¨è®¾ç½®ï¼Œè®¤è¯ï¼ŒåŠ å¯†ï¼ŒMACå’Œå¯†é’¥äº¤æ¢ç®—æ³•çš„æ˜æ˜ç»„åˆã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ”¯æŒæ‰€æœ‰å¯ç”¨çš„å¯†ç å¥—ä»¶ã€‚</td><td>list</td><td>null</td><td></td><td>low</td></tr><tr><td>ssl.endpoint.identification.algorithm</td><td>ä½¿ç”¨æœåŠ¡å™¨è¯ä¹¦éªŒè¯æœåŠ¡å™¨ä¸»æœºåçš„ç«¯ç‚¹è¯†åˆ«ç®—æ³•ã€‚</td><td>string</td><td>null</td><td></td><td>low</td></tr><tr><td>ssl.keymanager.algorithm</td><td>å¯†é’¥ç®¡ç†å™¨å·¥å‚ç”¨äºSSLè¿æ¥çš„ç®—æ³•ã€‚ é»˜è®¤å€¼æ˜¯ä¸ºJavaè™šæ‹Ÿæœºé…ç½®çš„å¯†é’¥ç®¡ç†å™¨å·¥å‚ç®—æ³•ã€‚</td><td>string</td><td>SunX509</td><td></td><td>low</td></tr><tr><td>ssl.secure.random.implementation</td><td>ç”¨äºSSLåŠ å¯†æ“ä½œçš„SecureRandom PRNGå®ç°ã€‚</td><td>string</td><td>null</td><td></td><td>low</td></tr><tr><td>ssl.trustmanager.algorithm</td><td>ä¿¡ä»»ç®¡ç†å™¨å·¥å‚ç”¨äºSSLè¿æ¥çš„ç®—æ³•ã€‚ é»˜è®¤å€¼æ˜¯ä¸ºJavaè™šæ‹Ÿæœºé…ç½®çš„ä¿¡ä»»ç®¡ç†å™¨å·¥å‚ç®—æ³•ã€‚</td><td>string</td><td>PKIX</td><td></td><td>low</td></tr></tbody></table><h2 id="kafka-2-0-0"><a href="#kafka-2-0-0" class="headerlink" title="kafka &gt;&#x3D; 2.0.0"></a>kafka &gt;&#x3D; 2.0.0</h2><table><thead><tr><th>åç§°</th><th>æè¿°</th><th>ç±»å‹</th><th>é»˜è®¤</th><th>æœ‰æ•ˆå€¼</th><th>é‡è¦ç¨‹åº¦</th></tr></thead><tbody><tr><td>sasl.client.callback.handler.class</td><td>å®ç°AuthenticateCallbackHandleræ¥å£çš„SASLå®¢æˆ·ç«¯å›è°ƒå¤„ç†ç¨‹åºç±»çš„å…¨ç§°ã€‚</td><td>class</td><td>null</td><td></td><td>ä¸­é—´</td></tr><tr><td>sasl.login.callback.handler.class</td><td>å®ç°AuthenticateCallbackHandleræ¥å£çš„SASLç™»å½•å›è°ƒå¤„ç†ç¨‹åºç±»çš„å…¨ç§°ã€‚å¯¹äºbrokeræ¥è¯´ï¼Œç™»å½•å›è°ƒå¤„ç†ç¨‹åºé…ç½®å¿…é¡»ä»¥ç›‘å¬å™¨å‰ç¼€å’Œå°å†™çš„SASLæœºåˆ¶åç§°ä¸ºå‰ç¼€ã€‚ä¾‹å¦‚ï¼Œ<code>listener.name.sasl_ssl.scram-sha-256.sasl.login.callback.handler.class=com.example.CustomScramLoginCallbackHandler</code></td><td>class</td><td>null</td><td></td><td>ä¸­é—´</td></tr><tr><td>sasl.login.class</td><td>å®ç°Loginæ¥å£çš„ç±»çš„å…¨ç§°ã€‚å¯¹äºbrokeræ¥è¯´ï¼Œlogin configå¿…é¡»ä»¥ç›‘å¬å™¨å‰ç¼€å’ŒSASLæœºåˆ¶åç§°ä¸ºå‰ç¼€ï¼Œå¹¶ä½¿ç”¨å°å†™ã€‚ä¾‹å¦‚ï¼Œ<code>listener.name.sasl_ssl.scram-sha-256.sasl.login.class=com.example.CustomScramLogin</code>ã€‚</td><td>class</td><td>null</td><td></td><td>ä¸­é—´</td></tr></tbody></table><h2 id="kafka-2-1-0"><a href="#kafka-2-1-0" class="headerlink" title="kafka &gt;&#x3D; 2.1.0"></a>kafka &gt;&#x3D; 2.1.0</h2><table><thead><tr><th>åç§°</th><th>æè¿°</th><th>ç±»å‹</th><th>é»˜è®¤</th><th>æœ‰æ•ˆå€¼</th><th>é‡è¦ç¨‹åº¦</th></tr></thead><tbody><tr><td>client.dns.lookup</td><td>æ§åˆ¶å®¢æˆ·ç«¯å¦‚ä½•ä½¿ç”¨DNSæŸ¥è¯¢ã€‚å¦‚æœè®¾ç½®ä¸º <code>use_all_dns_ips</code>ï¼Œåˆ™ä¾æ¬¡è¿æ¥åˆ°æ¯ä¸ªè¿”å›çš„IPåœ°å€ï¼Œç›´åˆ°æˆåŠŸå»ºç«‹è¿æ¥ã€‚æ–­å¼€è¿æ¥åï¼Œä½¿ç”¨ä¸‹ä¸€ä¸ªIPã€‚ä¸€æ—¦æ‰€æœ‰çš„IPéƒ½è¢«ä½¿ç”¨è¿‡ä¸€æ¬¡ï¼Œå®¢æˆ·ç«¯å°±ä¼šå†æ¬¡ä»ä¸»æœºåä¸­è§£æIP(s)(ç„¶è€Œï¼ŒJVMå’Œæ“ä½œç³»ç»Ÿéƒ½ä¼šç¼“å­˜DNSåç§°æŸ¥è¯¢)ã€‚å¦‚æœè®¾ç½®ä¸º <code>resolve_canonical_bootstrap_servers_only</code>ï¼Œåˆ™å°†æ¯ä¸ªå¼•å¯¼åœ°å€è§£ææˆä¸€ä¸ªcanonicalåç§°åˆ—è¡¨ã€‚åœ¨bootstrapé˜¶æ®µä¹‹åï¼Œè¿™å’Œ<code>use_all_dns_ips</code>çš„è¡Œä¸ºæ˜¯ä¸€æ ·çš„ã€‚å¦‚æœè®¾ç½®ä¸º <code>default</code>(å·²å¼ƒç”¨)ï¼Œåˆ™å°è¯•è¿æ¥åˆ°æŸ¥æ‰¾è¿”å›çš„ç¬¬ä¸€ä¸ªIPåœ°å€ï¼Œå³ä½¿æŸ¥æ‰¾è¿”å›å¤šä¸ªIPåœ°å€ã€‚</td><td>string</td><td>use_all_dns_ips</td><td><code>[default, use_all_dns_ips, resolve_canonical_bootstrap_servers_only]</code></td><td>ä¸­é—´</td></tr></tbody></table><h2 id="kafka-2-7"><a href="#kafka-2-7" class="headerlink" title="kafka &gt;&#x3D; 2.7"></a>kafka &gt;&#x3D; 2.7</h2><table><thead><tr><th>åç§°</th><th>æè¿°</th><th>ç±»å‹</th><th>é»˜è®¤</th><th>æœ‰æ•ˆå€¼</th><th>é‡è¦ç¨‹åº¦</th></tr></thead><tbody><tr><td>ssl.truststore.certificates</td><td>å¯ä¿¡è¯ä¹¦çš„æ ¼å¼ç”±&#39;ssl.truststore.type&#39;æŒ‡å®šã€‚é»˜è®¤çš„SSLå¼•æ“å·¥å‚åªæ”¯æŒå¸¦X.509è¯ä¹¦çš„PEMæ ¼å¼ã€‚</td><td>password</td><td>null</td><td></td><td>é«˜</td></tr><tr><td>socket.connection.setup.timeout.max.ms</td><td>å®¢æˆ·ç«¯ç­‰å¾…å»ºç«‹socketè¿æ¥çš„æœ€å¤§æ—¶é—´ã€‚è¿æ¥è®¾ç½®è¶…æ—¶æ—¶é—´å°†éšç€æ¯ä¸€æ¬¡è¿ç»­çš„è¿æ¥å¤±è´¥è€Œæˆå€å¢åŠ ï¼Œç›´åˆ°è¿™ä¸ªæœ€å¤§å€¼ã€‚ä¸ºäº†é¿å…è¿æ¥é£æš´ï¼Œè¶…æ—¶æ—¶é—´å°†è¢«åº”ç”¨ä¸€ä¸ª0.2çš„éšæœºå› å­ï¼Œå¯¼è‡´è®¡ç®—å€¼åœ¨20%ä»¥ä¸‹å’Œ20%ä»¥ä¸Šçš„éšæœºèŒƒå›´ã€‚</td><td>long</td><td>127000 (127 seconds)</td><td></td><td>ä¸­é—´</td></tr><tr><td>socket.connection.setup.timeout.ms</td><td>å®¢æˆ·ç«¯ç­‰å¾…å»ºç«‹socketè¿æ¥çš„æ—¶é—´ã€‚å¦‚æœåœ¨è¶…æ—¶ä¹‹å‰æ²¡æœ‰å»ºç«‹è¿æ¥ï¼Œå®¢æˆ·ç«¯å°†å…³é—­socketé€šé“ã€‚</td><td>long</td><td>10000 (10 seconds)</td><td></td><td>ä¸­é—´</td></tr></tbody></table><h2 id="æ—§æ¶ˆè´¹è€…é…ç½®"><a href="#æ—§æ¶ˆè´¹è€…é…ç½®" class="headerlink" title="æ—§æ¶ˆè´¹è€…é…ç½®"></a>æ—§æ¶ˆè´¹è€…é…ç½®</h2><p>æ—§æ¶ˆè´¹è€…é…ç½®å¦‚ä¸‹ï¼š</p><ul><li>group.id</li><li>zookeeper.connect</li></ul><table><thead><tr><th>PROPERTY</th><th>DEFAULT</th><th>DESCRIPTION</th></tr></thead><tbody><tr><td>group.id</td><td></td><td>æ ‡è¯†æ¶ˆè´¹è€…æ‰€å±æ¶ˆè´¹è€…ç»„(ç‹¬ä¸€çš„)ã€‚é€šè¿‡è®¾ç½®ç›¸åŒçš„ç»„IDï¼Œå¤šä¸ªæ¶ˆè´¹è€…è¡¨æ˜å±äºè¯¥æ¶ˆè´¹è€…ç»„çš„ä¸€éƒ¨åˆ†ã€‚</td></tr><tr><td>zookeeper.connect</td><td></td><td>æŒ‡å®šZooKeeperè¿æ¥å­—ç¬¦ä¸²ï¼Œæ ¼å¼ä¸ºhostnameï¼športï¼Œå…¶ä¸­hostå’Œportæ˜¯ZooKeeperæœåŠ¡å™¨çš„ä¸»æœºå’Œç«¯å£ã€‚ ä¸ºäº†ä½¿ZooKeeperå®•æœºæ—¶è¿æ¥åˆ°å…¶ä»–ZooKeeperèŠ‚ç‚¹ï¼Œä½ è¿˜å¯ä»¥ä»¥hostname1:host1ï¼Œhostname2:port2ï¼Œhostname3:port3çš„å½¢å¼æŒ‡å®šå¤šä¸ªä¸»æœºã€‚ è¿˜å¯ä»¥è®¾ç½®ZooKeeper chrootè·¯å¾„ï¼Œä½œä¸ºå…¶ZooKeeperè¿æ¥å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œå°†å…¶æ•°æ®æ”¾ç½®åœ¨å…¨å±€ZooKeeperå‘½åç©ºé—´ä¸­çš„æŸä¸ªè·¯å¾„ä¸‹ã€‚ å¦‚æœæ˜¯è¿™æ ·ï¼Œæ¶ˆè´¹è€…åº”è¯¥åœ¨å…¶è¿æ¥å­—ç¬¦ä¸²ä¸­ä½¿ç”¨ç›¸åŒçš„chrootè·¯å¾„ã€‚ ä¾‹å¦‚ï¼Œè¦ç»™å‡º&#x2F;chroot&#x2F;pathçš„chrootè·¯å¾„ï¼Œä½ éœ€è¦å°†è¯¥å€¼è®¾ç½®ä¸ºï¼š<code>hostname1:port1,hostname2:port2,hostname3:port3/chroot/path</code>ã€‚</td></tr><tr><td>consumer.id</td><td>null</td><td>å¦‚æœæœªè®¾ç½®å°†è‡ªåŠ¨ç”Ÿæˆã€‚</td></tr><tr><td>socket.timeout.ms</td><td>30 * 1000</td><td>ç½‘ç»œè¯·æ±‚sockerçš„è¶…æ—¶æ—¶é—´ã€‚å®é™…çš„è¶…æ—¶æ˜¯ max.fetch.wait+socket.timeout.msçš„æ—¶é—´ã€‚</td></tr><tr><td>socket.receive.buffer.bytes</td><td>64 * 1024</td><td>ç½‘ç»œè¯·æ±‚sockerçš„æ¥æ”¶ç¼“å­˜å¤§å°</td></tr><tr><td>fetch.message.max.bytes</td><td>1024 * 1024</td><td>æ¯ä¸ªæ‹‰å–è¯·æ±‚çš„æ¯ä¸ªtopicåˆ†åŒºå°è¯•è·å–çš„æ¶ˆæ¯çš„å­—èŠ‚å¤§å°ã€‚è¿™äº›å­—èŠ‚å°†è¢«è¯»å…¥æ¯ä¸ªåˆ†åŒºçš„å†…å­˜ï¼Œå› æ­¤è¿™æœ‰åŠ©äºæ§åˆ¶æ¶ˆè´¹è€…ä½¿ç”¨çš„å†…å­˜ã€‚ æ‹‰å–è¯·æ±‚çš„å¤§å°è‡³å°‘ä¸æœåŠ¡å™¨å…è®¸çš„æœ€å¤§æ¶ˆæ¯çš„å¤§å°ä¸€æ ·å¤§ï¼Œå¦åˆ™ç”Ÿäº§è€…å¯èƒ½å‘é€å¤§äºæ¶ˆè´¹è€…å¯ä»¥æ‹‰å–çš„æ¶ˆæ¯ã€‚</td></tr><tr><td>num.consumer.fetchers</td><td>1</td><td>ç”¨äºæ‹‰å–æ•°æ®çš„æ‹‰å–çº¿ç¨‹æ•°ã€‚</td></tr><tr><td>auto.commit.enable</td><td>true</td><td>å¦‚æœä¸ºtrueï¼Œè¯·å®šæœŸå‘ZooKeeperæäº¤æ¶ˆè´¹è€…å·²ç»è·å–çš„æ¶ˆæ¯çš„åç§»é‡ã€‚ å½“è¿›ç¨‹å¤±è´¥æ—¶ï¼Œå°†ä½¿ç”¨è¿™ç§æ‰¿è¯ºåç§»é‡ä½œä¸ºæ–°æ¶ˆè´¹è€…å¼€å§‹çš„ä½ç½®ã€‚</td></tr><tr><td>auto.commit.interval.ms</td><td>60 * 1000</td><td>æ¶ˆè´¹è€…offsetæäº¤åˆ°zookeeperçš„é¢‘ç‡ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰</td></tr><tr><td>queued.max.message.chunks</td><td>2</td><td>æ¶ˆè´¹ç¼“å­˜æ¶ˆæ¯å—çš„æœ€å¤§å¤§å°ã€‚æ¯ä¸ªå—å¯ä»¥è¾¾åˆ°fetch.message.max.bytesã€‚</td></tr><tr><td>rebalance.max.retries</td><td>4</td><td>å½“æ–°çš„æ¶ˆè´¹è€…åŠ å…¥æ¶ˆè´¹è€…ç»„æ—¶ï¼Œæ¶ˆè´¹è€…é›†åˆå°è¯•â€œé‡æ–°å¹³è¡¡â€è´Ÿè½½ï¼Œå¹¶ä¸ºæ¯ä¸ªæ¶ˆè´¹è€…åˆ†é…åˆ†åŒºã€‚å¦‚æœæ¶ˆè´¹è€…é›†åˆåœ¨åˆ†é…æ—¶å‘ç”Ÿæ—¶å‘ç”Ÿå˜åŒ–ï¼Œåˆ™é‡æ–°å¹³è¡¡å°†å¤±è´¥å¹¶é‡è¯•ã€‚æ­¤è®¾ç½®æ§åˆ¶å°è¯•ä¹‹å‰çš„æœ€å¤§å°è¯•æ¬¡æ•°ã€‚</td></tr><tr><td>fetch.min.bytes</td><td>1</td><td>æ‹‰å–è¯·æ±‚è¿”å›æœ€å°çš„æ•°æ®é‡ã€‚å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®ï¼Œè¯·æ±‚å°†ç­‰å¾…æ•°æ®ç§¯ç´¯ï¼Œç„¶ååº”ç­”è¯·æ±‚ã€‚</td></tr><tr><td>fetch.wait.max.ms</td><td>100</td><td>å¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®ï¼ˆfetch.min.bytesï¼‰ï¼ŒæœåŠ¡å™¨å°†åœ¨è¿”å›è¯·æ±‚æ•°æ®ä¹‹å‰é˜»å¡çš„æœ€é•¿æ—¶é—´ã€‚</td></tr><tr><td>rebalance.backoff.ms</td><td>2000</td><td>é‡æ–°å¹³è¡¡æ—¶é‡è¯•ä¹‹é—´çš„å›é€€æ—¶é—´ã€‚å¦‚æœæœªè®¾ç½®ï¼Œåˆ™ä½¿ç”¨zookeeper.sync.time.msä¸­çš„å€¼ã€‚</td></tr><tr><td>refresh.leader.backoff.ms</td><td>200</td><td>å›é€€æ—¶é—´ç­‰å¾…ï¼Œç„¶åå†å°è¯•é€‰ä¸¾ä¸€ä¸ªåˆšåˆšå¤±å»leaderçš„åˆ†åŒºã€‚</td></tr><tr><td>auto.offset.reset</td><td>largest</td><td>å¦‚æœZooKeeperä¸­æ²¡æœ‰åˆå§‹åç§»é‡ï¼Œæˆ–åç§»å€¼è¶…å‡ºèŒƒå›´ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ *æœ€å°ï¼šè‡ªåŠ¨å°†åç§»é‡ç½®ä¸ºæœ€å°åç§» * æœ€å¤§ï¼šè‡ªåŠ¨å°†åç§»é‡ç½®ä¸ºæœ€å¤§åç§» * å…¶ä»–ä»»ä½•äº‹æƒ…ï¼šæŠ›å‡ºå¼‚å¸¸æ¶ˆè´¹è€…</td></tr><tr><td>consumer.timeout.ms</td><td>-1</td><td>å¦‚æœåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”åæ²¡æœ‰æ¶ˆæ¯å¯ç”¨ï¼Œåˆ™å‘ç”¨æˆ·å‘å‡ºè¶…æ—¶å¼‚å¸¸</td></tr><tr><td>exclude.internal.topics</td><td>true</td><td>æ¥è‡ªå†…éƒ¨topicçš„æ¶ˆæ¯ï¼ˆå¦‚åç§»é‡ï¼‰æ˜¯å¦åº”è¯¥æš´éœ²ç»™æ¶ˆè´¹è€…ã€‚</td></tr><tr><td>client.id</td><td>group id value</td><td>å®¢æˆ·ç«¯IDæ˜¯æ¯ä¸ªè¯·æ±‚ä¸­å‘é€çš„ç”¨æˆ·æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼Œç”¨äºå¸®åŠ©è·Ÿè¸ªè°ƒç”¨ã€‚ å®ƒåº”è¯¥é€»è¾‘åœ°æ ‡è¯†å‘å‡ºè¯·æ±‚çš„åº”ç”¨ç¨‹åºã€‚</td></tr><tr><td>zookeeper.session.timeout.ms</td><td>6000</td><td>ZooKeeperä¼šè¯è¶…æ—¶ã€‚å¦‚æœæ¶ˆè´¹è€…åœ¨è¿™æ®µæ—¶é—´å†…æ²¡æœ‰å¯¹ZooKeeperå¿ƒè·³ï¼Œé‚£ä¹ˆå®ƒè¢«è®¤ä¸ºæ˜¯æ­»äº¡çš„ï¼Œå¹¶ä¸”ä¼šå‘ç”Ÿé‡æ–°å¹³è¡¡ã€‚</td></tr><tr><td>zookeeper.connection.timeout.ms</td><td>6000</td><td>ä¸zookeeperå»ºç«‹è¿æ¥æ—¶å®¢æˆ·ç«¯ç­‰å¾…çš„æœ€é•¿æ—¶é—´ã€‚</td></tr><tr><td>zookeeper.sync.time.ms</td><td>2000</td><td>ZK followerå¯ä»¥ç½—ZK leaderå¤šä¹…</td></tr><tr><td>offsets.storage</td><td>zookeeper</td><td>é€‰æ‹©å­˜å‚¨åç§»é‡çš„ä½ç½®ï¼ˆzookeeperæˆ–kafkaï¼‰ã€‚</td></tr><tr><td>offsets.channel.backoff.ms</td><td>1000</td><td>é‡æ–°è¿æ¥offseté€šé“æˆ–é‡è¯•å¤±è´¥çš„åç§»æå–&#x2F;æäº¤è¯·æ±‚æ—¶çš„å›é€€å‘¨æœŸã€‚</td></tr><tr><td>offsets.channel.socket.timeout.ms</td><td>10000</td><td>è¯»å–offsetæ‹‰å–&#x2F;æäº¤å“åº”çš„Sockerçš„è¶…æ—¶æ—¶é—´ã€‚æ­¤è¶…æ—¶ä¹Ÿç”¨äºæŸ¥è¯¢offset managerçš„ConsumerMetadataè¯·æ±‚ã€‚</td></tr><tr><td>offsets.commit.max.retries</td><td>5</td><td>å¤±è´¥æ—¶é‡è¯•åç§»æäº¤çš„æœ€å¤§æ¬¡æ•°ã€‚æ­¤é‡è¯•è®¡æ•°ä»…é€‚ç”¨äºåœæœºæœŸé—´çš„offsetæäº¤ï¼Œå®ƒä¸é€‚ç”¨äºè‡ªåŠ¨æäº¤çº¿ç¨‹çš„æäº¤ã€‚å®ƒä¹Ÿä¸é€‚ç”¨äºåœ¨æäº¤offsetä¹‹å‰æŸ¥è¯¢åç§»åè°ƒå™¨çš„å°è¯•ã€‚å³å¦‚æœæ¶ˆè´¹è€…å…ƒæ•°æ®è¯·æ±‚ç”±äºä»»ä½•åŸå› è€Œå¤±è´¥ï¼Œåˆ™å°†é‡è¯•å®ƒï¼Œå¹¶ä¸”é‡è¯•ä¸è®¡å…¥è¯¥é™åˆ¶ã€‚</td></tr><tr><td>dual.commit.enabled</td><td>true</td><td>å¦‚æœä½¿ç”¨â€œkafkaâ€ä½œä¸ºoffsets.storageï¼Œåˆ™å¯ä»¥å‘ZooKeeperï¼ˆé™¤Kafkaä¹‹å¤–ï¼‰è¿›è¡ŒåŒé‡æäº¤offsetã€‚åœ¨ä»åŸºäºzookeeperçš„offsetå­˜å‚¨è¿ç§»åˆ°kafkaå­˜å‚¨çš„æ—¶å€™å¯ä»¥è¿™ä¹ˆåšã€‚å¯¹äºä»»ä½•ç»™å®šçš„æ¶ˆè´¹è€…ç»„ï¼Œåœ¨è¯¥ç»„ä¸­çš„æ‰€æœ‰å®ä¾‹å·²è¿ç§»åˆ°æäº¤åˆ°brokerï¼ˆè€Œä¸æ˜¯ç›´æ¥åˆ°ZooKeeperï¼‰çš„æ–°çš„ç‰ˆæœ¬ä¹‹åï¼Œå¯ä»¥å…³é—­è¿™ä¸ªã€‚</td></tr><tr><td>partition.assignment.strategy</td><td>range</td><td>åœ¨â€œrangeâ€æˆ–â€œroundrobinâ€ç­–ç•¥ä¹‹é—´é€‰æ‹©å°†åˆ†åŒºåˆ†é…ç»™æ¶ˆè´¹è€…æµã€‚ å¾ªç¯åˆ†åŒºåˆ†é…å™¨åˆ†é…æ‰€æœ‰å¯ç”¨çš„åˆ†åŒºå’Œæ‰€æœ‰å¯ç”¨çš„æ¶ˆè´¹è€…çº¿ç¨‹ã€‚ç„¶åï¼Œç»§ç»­ä»åˆ†åŒºåˆ°æ¶ˆè´¹è€…çº¿ç¨‹è¿›è¡Œå¾ªç¯ä»»åŠ¡ã€‚å¦‚æœæ‰€æœ‰æ¶ˆè´¹è€…å®ä¾‹çš„è®¢é˜…æ˜¯ç›¸åŒçš„ï¼Œåˆ™åˆ†åŒºå°†è¢«å‡åŒ€åˆ†å¸ƒã€‚ï¼ˆå³ï¼Œåˆ†åŒºæ‰€æœ‰æƒè®¡æ•°å°†åœ¨æ‰€æœ‰æ¶ˆè´¹è€…çº¿ç¨‹ä¹‹é—´çš„å·®å¼‚ä»…åœ¨ä¸€ä¸ªdeltaä¹‹å†…ã€‚ï¼‰å¾ªç¯åˆ†é…ä»…åœ¨ä»¥ä¸‹æƒ…å†µä¸‹è¢«å…è®¸ï¼šï¼ˆaï¼‰æ¯ä¸ªä¸»é¢˜åœ¨æ¶ˆè´¹è€…å®ä¾‹ä¸­å…·æœ‰ç›¸åŒæ•°é‡çš„æµï¼ˆbï¼‰è®¢é˜…çš„topicçš„å¯¹äºç»„å†…çš„æ¯ä¸ªæ¶ˆè´¹è€…å®ä¾‹éƒ½æ˜¯ç›¸åŒçš„ã€‚ èŒƒå›´(Range)åˆ†åŒºåŸºäºæ¯ä¸ªtopicã€‚å¯¹äºæ¯ä¸ªä¸»é¢˜ï¼Œæˆ‘ä»¬æŒ‰æ•°å­—é¡ºåºæ’åˆ—å¯ç”¨çš„åˆ†åŒºï¼Œå¹¶ä»¥å­—å…¸é¡ºåºæ’åˆ—æ¶ˆè´¹è€…çº¿ç¨‹ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†åˆ†åŒºæ•°é™¤ä»¥æ¶ˆè´¹è€…æµï¼ˆçº¿ç¨‹ï¼‰çš„æ€»æ•°æ¥ç¡®å®šåˆ†é…ç»™æ¯ä¸ªæ¶ˆè´¹è€…çš„åˆ†åŒºæ•°ã€‚å¦‚æœä¸å‡åŒ€åˆ†å‰²ï¼Œé‚£ä¹ˆå‰å‡ ä¸ªæ¶ˆè´¹è€…å°†ä¼šæœ‰å¤šçš„åˆ†åŒºã€‚</td></tr></tbody></table><p>æœ‰å…³æ¶ˆè´¹è€…é…ç½®çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§scafç±»kafka.consumer.ConsumerConfigã€‚</p><h1 id="Kafka-Produceré…ç½®"><a href="#Kafka-Produceré…ç½®" class="headerlink" title="Kafka Produceré…ç½®"></a>Kafka Produceré…ç½®</h1><h2 id="ç”Ÿäº§è€…é…ç½®"><a href="#ç”Ÿäº§è€…é…ç½®" class="headerlink" title="ç”Ÿäº§è€…é…ç½®"></a>ç”Ÿäº§è€…é…ç½®</h2><p>javaç”Ÿäº§è€…é…ç½®ï¼š</p><table><thead><tr><th>NAME</th><th>DESCRIPTION</th><th>TYPE</th><th>DEFAULT</th><th>VALID VALUES</th><th>IMPORTANCE</th></tr></thead><tbody><tr><td>bootstrap.servers</td><td>host&#x2F;portåˆ—è¡¨ï¼Œç”¨äºåˆå§‹åŒ–å»ºç«‹å’ŒKafkaé›†ç¾¤çš„è¿æ¥ã€‚åˆ—è¡¨æ ¼å¼ä¸ºhost1:port1,host2:port2,....ï¼Œæ— éœ€æ·»åŠ æ‰€æœ‰çš„é›†ç¾¤åœ°å€ï¼Œkafkaä¼šæ ¹æ®æä¾›çš„åœ°å€å‘ç°å…¶ä»–çš„åœ°å€ï¼ˆä½ å¯ä»¥å¤šæä¾›å‡ ä¸ªï¼Œä»¥é˜²æä¾›çš„æœåŠ¡å™¨å…³é—­ï¼‰</td><td>list</td><td></td><td></td><td>high</td></tr><tr><td>key.serializer</td><td>å®ç° org.apache.kafka.common.serialization.Serializer æ¥å£çš„ key çš„ Serializer ç±»ã€‚</td><td>class</td><td></td><td></td><td>high</td></tr><tr><td>value.serializer</td><td>å®ç° org.apache.kafka.common.serialization.Serializer æ¥å£çš„value çš„ Serializer ç±»ã€‚</td><td>class</td><td></td><td></td><td>high</td></tr><tr><td>acks</td><td>ç”Ÿäº§è€…éœ€è¦leaderç¡®è®¤è¯·æ±‚å®Œæˆä¹‹å‰æ¥æ”¶çš„åº”ç­”æ•°ã€‚æ­¤é…ç½®æ§åˆ¶äº†å‘é€æ¶ˆæ¯çš„è€ç”¨æ€§ï¼Œæ”¯æŒä»¥ä¸‹é…ç½®ï¼š acks&#x3D;0 å¦‚æœè®¾ç½®ä¸º0ï¼Œé‚£ä¹ˆç”Ÿäº§è€…å°†ä¸ç­‰å¾…ä»»ä½•æ¶ˆæ¯ç¡®è®¤ã€‚æ¶ˆæ¯å°†ç«‹åˆ»æ·»åŠ åˆ°socketç¼“å†²åŒºå¹¶è€ƒè™‘å‘é€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ä¸èƒ½ä¿éšœæ¶ˆæ¯è¢«æœåŠ¡å™¨æ¥æ”¶åˆ°ã€‚å¹¶ä¸”é‡è¯•æœºåˆ¶ä¸ä¼šç”Ÿæ•ˆï¼ˆå› ä¸ºå®¢æˆ·ç«¯ä¸çŸ¥é“æ•…éšœäº†æ²¡æœ‰ï¼‰ã€‚æ¯ä¸ªæ¶ˆæ¯è¿”å›çš„offsetå§‹ç»ˆè®¾ç½®ä¸º-1ã€‚ acks&#x3D;1ï¼Œè¿™æ„å‘³ç€leaderå†™å…¥æ¶ˆæ¯åˆ°æœ¬åœ°æ—¥å¿—å°±ç«‹å³å“åº”ï¼Œè€Œä¸ç­‰å¾…æ‰€æœ‰followeråº”ç­”ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœå“åº”æ¶ˆæ¯ä¹‹åä½†followerè¿˜æœªå¤åˆ¶ä¹‹å‰leaderç«‹å³æ•…éšœï¼Œé‚£ä¹ˆæ¶ˆæ¯å°†ä¼šä¸¢å¤±ã€‚ acks&#x3D;all è¿™æ„å‘³ç€leaderå°†ç­‰å¾…æ‰€æœ‰å‰¯æœ¬åŒæ­¥ååº”ç­”æ¶ˆæ¯ã€‚æ­¤é…ç½®ä¿éšœæ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼ˆåªè¦è‡³å°‘æœ‰ä¸€ä¸ªåŒæ­¥çš„å‰¯æœ¬æˆ–è€…ï¼‰ã€‚è¿™æ˜¯æœ€å¼ºå£®çš„å¯ç”¨æ€§ä¿éšœã€‚ç­‰ä»·äºacks&#x3D;-1ã€‚</td><td>string</td><td>1</td><td>[all, -1, 0, 1]</td><td>high</td></tr><tr><td>buffer.memory</td><td>ç”Ÿäº§è€…ç”¨æ¥ç¼“å­˜ç­‰å¾…å‘é€åˆ°æœåŠ¡å™¨çš„æ¶ˆæ¯çš„å†…å­˜æ€»å­—èŠ‚æ•°ã€‚å¦‚æœæ¶ˆæ¯å‘é€æ¯”å¯ä¼ é€’åˆ°æœåŠ¡å™¨çš„å¿«ï¼Œç”Ÿäº§è€…å°†é˜»å¡<code>max.block.ms</code>ä¹‹åï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚ æ­¤è®¾ç½®åº”è¯¥å¤§è‡´çš„å¯¹åº”ç”Ÿäº§è€…å°†è¦ä½¿ç”¨çš„æ€»å†…å­˜ï¼Œä½†ä¸æ˜¯ç¡¬çº¦æŸï¼Œå› ä¸ºç”Ÿäº§è€…æ‰€ä½¿ç”¨çš„æ‰€æœ‰å†…å­˜éƒ½ç”¨äºç¼“å†²ã€‚ä¸€äº›é¢å¤–çš„å†…å­˜å°†ç”¨äºå‹ç¼©ï¼ˆå¦‚æœå¯åŠ¨å‹ç¼©ï¼‰ï¼Œä»¥åŠç”¨äºä¿æŒå‘é€ä¸­çš„è¯·æ±‚ã€‚</td><td>long</td><td>33554432</td><td>[0,...]</td><td>high</td></tr><tr><td>compression.type</td><td>æ•°æ®å‹ç¼©çš„ç±»å‹ã€‚é»˜è®¤ä¸ºç©ºï¼ˆå°±æ˜¯ä¸å‹ç¼©ï¼‰ã€‚æœ‰æ•ˆçš„å€¼æœ‰ noneï¼Œgzipï¼Œsnappy, æˆ– lz4ã€‚å‹ç¼©å…¨éƒ¨çš„æ•°æ®æ‰¹ï¼Œå› æ­¤æ‰¹çš„æ•ˆæœä¹Ÿå°†å½±å“å‹ç¼©çš„æ¯”ç‡ï¼ˆæ›´å¤šçš„æ‰¹æ¬¡æ„å‘³ç€æ›´å¥½çš„å‹ç¼©ï¼‰ã€‚</td><td>string</td><td>none</td><td></td><td>high</td></tr><tr><td>retries</td><td>è®¾ç½®ä¸€ä¸ªæ¯”é›¶å¤§çš„å€¼ï¼Œå®¢æˆ·ç«¯å¦‚æœå‘é€å¤±è´¥åˆ™ä¼šé‡æ–°å‘é€ã€‚æ³¨æ„ï¼Œè¿™ä¸ªé‡è¯•åŠŸèƒ½å’Œå®¢æˆ·ç«¯åœ¨æ¥åˆ°é”™è¯¯ä¹‹åé‡æ–°å‘é€æ²¡ä»€ä¹ˆä¸åŒã€‚å¦‚æœmax.in.flight.requests.per.connectionæ²¡æœ‰è®¾ç½®ä¸º1ï¼Œæœ‰å¯èƒ½æ”¹å˜æ¶ˆæ¯å‘é€çš„é¡ºåºï¼Œå› ä¸ºå¦‚æœ2ä¸ªæ‰¹æ¬¡å‘é€åˆ°ä¸€ä¸ªåˆ†åŒºä¸­ï¼Œå¹¶ç¬¬ä¸€ä¸ªå¤±è´¥äº†å¹¶é‡è¯•ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªæˆåŠŸäº†ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªæ‰¹æ¬¡å°†è¶…è¿‡ç¬¬ä¸€ä¸ªã€‚</td><td>int</td><td>0</td><td>[0,...,2147483647]</td><td>high</td></tr><tr><td>ssl.key.password</td><td>å¯†é’¥ä»“åº“æ–‡ä»¶ä¸­çš„ç§é’¥çš„å¯†ç ã€‚</td><td>password</td><td>null</td><td></td><td>high</td></tr><tr><td>ssl.keystore.location</td><td>å¯†é’¥ä»“åº“æ–‡ä»¶çš„ä½ç½®ã€‚å¯ç”¨äºå®¢æˆ·ç«¯çš„åŒå‘è®¤è¯ã€‚</td><td>string</td><td>null</td><td></td><td>high</td></tr><tr><td>ssl.keystore.password</td><td>å¯†é’¥ä»“åº“æ–‡ä»¶çš„ä»“åº“å¯†ç ã€‚åªæœ‰é…ç½®äº†ssl.keystore.locationæ—¶æ‰éœ€è¦ã€‚</td><td>password</td><td>null</td><td></td><td>high</td></tr><tr><td>ssl.truststore.location</td><td>ä¿¡ä»»ä»“åº“çš„ä½ç½®</td><td>string</td><td>null</td><td></td><td>high</td></tr><tr><td>ssl.truststore.password</td><td>ä¿¡ä»»ä»“åº“æ–‡ä»¶çš„å¯†ç </td><td>password</td><td>null</td><td></td><td>high</td></tr><tr><td>batch.size</td><td>å½“å¤šä¸ªæ¶ˆæ¯è¦å‘é€åˆ°ç›¸åŒåˆ†åŒºçš„æ—¶ï¼Œç”Ÿäº§è€…å°è¯•å°†æ¶ˆæ¯æ‰¹é‡æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œä»¥å‡å°‘è¯·æ±‚äº¤äº’ã€‚è¿™æ ·æœ‰åŠ©äºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ€§èƒ½æå‡ã€‚è¯¥é…ç½®çš„é»˜è®¤æ‰¹æ¬¡å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼š ä¸ä¼šæ‰“åŒ…å¤§äºæ­¤é…ç½®å¤§å°çš„æ¶ˆæ¯ã€‚ å‘é€åˆ°brokerçš„è¯·æ±‚å°†åŒ…å«å¤šä¸ªæ‰¹æ¬¡ï¼Œæ¯ä¸ªåˆ†åŒºä¸€ä¸ªï¼Œç”¨äºå‘é€æ•°æ®ã€‚ è¾ƒå°çš„æ‰¹æ¬¡å¤§å°æœ‰å¯èƒ½é™ä½ååé‡ï¼ˆæ‰¹æ¬¡å¤§å°ä¸º0åˆ™å®Œå…¨ç¦ç”¨æ‰¹å¤„ç†ï¼‰ã€‚ä¸€ä¸ªéå¸¸å¤§çš„æ‰¹æ¬¡å¤§å°å¯èƒ½æ›´æµªè´¹å†…å­˜ã€‚å› ä¸ºæˆ‘ä»¬ä¼šé¢„å…ˆåˆ†é…è¿™ä¸ªèµ„æºã€‚</td><td>int</td><td>16384</td><td>[0,...]</td><td>medium</td></tr><tr><td>client.id</td><td>å½“å‘å‡ºè¯·æ±‚æ—¶ä¼ é€’ç»™æœåŠ¡å™¨çš„idå­—ç¬¦ä¸²ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯å…è®¸æœåŠ¡å™¨è¯·æ±‚è®°å½•è®°å½•è¿™ä¸ªã€é€»è¾‘åº”ç”¨åã€‘ï¼Œè¿™æ ·èƒ½å¤Ÿè¿½è¸ªè¯·æ±‚çš„æºï¼Œè€Œä¸ä»…ä»…åªæ˜¯ip&#x2F;protã€‚</td><td>string</td><td>&quot;&quot;</td><td></td><td>medium</td></tr><tr><td>connections.max.idle.ms</td><td>å¤šå°‘æ¯«ç§’ä¹‹åå…³é—­é—²ç½®çš„è¿æ¥ã€‚</td><td>long</td><td>540000</td><td></td><td>medium</td></tr><tr><td>linger.ms</td><td>ç”Ÿäº§è€…ç»„å°†å‘é€çš„æ¶ˆæ¯ç»„åˆæˆå•ä¸ªæ‰¹é‡è¯·æ±‚ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œåªæœ‰æ¶ˆæ¯åˆ°è¾¾çš„é€Ÿåº¦æ¯”å‘é€é€Ÿåº¦å¿«çš„æƒ…å†µä¸‹æ‰ä¼šå‡ºç°ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå³ä½¿åœ¨é€‚åº¦çš„è´Ÿè½½ä¸‹ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯èƒ½å¸Œæœ›å‡å°‘è¯·æ±‚æ•°é‡ã€‚æ­¤è®¾ç½®é€šè¿‡æ·»åŠ å°‘é‡äººä¸ºå»¶è¿Ÿæ¥å®ç°ã€‚- ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸æ˜¯ç«‹å³å‘å‡ºä¸€ä¸ªæ¶ˆæ¯ï¼Œç”Ÿäº§è€…å°†ç­‰å¾…ä¸€ä¸ªç»™å®šçš„å»¶è¿Ÿï¼Œä»¥ä¾¿å’Œå…¶ä»–çš„æ¶ˆæ¯å¯ä»¥ç»„åˆæˆä¸€ä¸ªæ‰¹æ¬¡ã€‚è¿™ç±»ä¼¼äºNagleåœ¨TCPä¸­çš„ç®—æ³•ã€‚æ­¤è®¾ç½®ç»™å‡ºæ‰¹é‡å»¶è¿Ÿçš„ä¸Šé™ï¼šä¸€æ—¦æˆ‘ä»¬è¾¾åˆ°åˆ†åŒºçš„batch.sizeå€¼çš„è®°å½•ï¼Œå°†ç«‹å³å‘é€ï¼Œä¸ç®¡è¿™ä¸ªè®¾ç½®å¦‚ä½•ï¼Œä½†æ˜¯ï¼Œå¦‚æœæ¯”è¿™ä¸ªå°ï¼Œæˆ‘ä»¬å°†åœ¨æŒ‡å®šçš„â€œlingerâ€æ—¶é—´å†…ç­‰å¾…æ›´å¤šçš„æ¶ˆæ¯åŠ å…¥ã€‚æ­¤è®¾ç½®é»˜è®¤ä¸º0ï¼ˆå³æ— å»¶è¿Ÿï¼‰ã€‚å‡è®¾ï¼Œè®¾ç½® linger.ms&#x3D;5ï¼Œå°†è¾¾åˆ°å‡å°‘å‘é€çš„è¯·æ±‚æ•°é‡çš„æ•ˆæœï¼Œä½†å¯¹äºåœ¨æ²¡æœ‰è´Ÿè½½æƒ…å†µï¼Œå°†å¢åŠ 5msçš„å»¶è¿Ÿã€‚</td><td>long</td><td>0</td><td>[0,...]</td><td>medium</td></tr><tr><td>max.block.ms</td><td>è¯¥é…ç½®æ§åˆ¶ KafkaProducer.send() å’Œ KafkaProducer.partitionsFor() å°†é˜»å¡å¤šé•¿æ—¶é—´ã€‚æ­¤å¤–è¿™äº›æ–¹æ³•è¢«é˜»æ­¢ï¼Œä¹Ÿå¯èƒ½æ˜¯å› ä¸ºç¼“å†²åŒºå·²æ»¡æˆ–å…ƒæ•°æ®ä¸å¯ç”¨ã€‚åœ¨ç”¨æˆ·æä¾›çš„åºåˆ—åŒ–ç¨‹åºæˆ–åˆ†åŒºå™¨ä¸­çš„é”å®šä¸ä¼šè®¡å…¥æ­¤è¶…æ—¶ã€‚</td><td>long</td><td>60000</td><td>[0,...]</td><td>medium</td></tr><tr><td>max.request.size</td><td>è¯·æ±‚çš„æœ€å¤§å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚æ­¤è®¾ç½®å°†é™åˆ¶ç”Ÿäº§è€…çš„å•ä¸ªè¯·æ±‚ä¸­å‘é€çš„æ¶ˆæ¯æ‰¹æ¬¡æ•°ï¼Œä»¥é¿å…å‘é€è¿‡å¤§çš„è¯·æ±‚ã€‚è¿™ä¹Ÿæ˜¯æœ€å¤§æ¶ˆæ¯æ‰¹é‡å¤§å°çš„ä¸Šé™ã€‚è¯·æ³¨æ„ï¼ŒæœåŠ¡å™¨æ‹¥æœ‰è‡ªå·±çš„æ‰¹é‡å¤§å°ï¼Œå¯èƒ½ä¸æ­¤ä¸åŒã€‚</td><td>int</td><td>1048576</td><td>[0,...]</td><td>medium</td></tr><tr><td>partitioner.class</td><td>å®ç°Partitioneræ¥å£çš„çš„Partitionerç±»ã€‚</td><td>class</td><td>org.apache.kafka.clients.producer.internals.DefaultPartitioner</td><td></td><td>medium</td></tr><tr><td>receive.buffer.bytes</td><td>è¯»å–æ•°æ®æ—¶ä½¿ç”¨çš„TCPæ¥æ”¶ç¼“å†²åŒº(SO_RCVBUF)çš„å¤§å°ã€‚å¦‚æœå€¼ä¸º-1ï¼Œåˆ™å°†ä½¿ç”¨OSé»˜è®¤å€¼ã€‚</td><td>int</td><td>32768</td><td>[-1,...]</td><td>medium</td></tr><tr><td>request.timeout.ms</td><td>è¯¥é…ç½®æ§åˆ¶å®¢æˆ·ç«¯ç­‰å¾…è¯·æ±‚å“åº”çš„æœ€é•¿æ—¶é—´ã€‚å¦‚æœåœ¨è¶…æ—¶ä¹‹å‰æœªæ”¶åˆ°å“åº”ï¼Œå®¢æˆ·ç«¯å°†åœ¨å¿…è¦æ—¶é‡æ–°å‘é€è¯·æ±‚ï¼Œå¦‚æœé‡è¯•è€—å°½ï¼Œåˆ™è¯¥è¯·æ±‚å°†å¤±è´¥ã€‚ è¿™åº”è¯¥å¤§äºreplica.lag.time.max.msï¼Œä»¥å‡å°‘ç”±äºä¸å¿…è¦çš„ç”Ÿäº§è€…é‡è¯•å¼•èµ·çš„æ¶ˆæ¯é‡å¤çš„å¯èƒ½æ€§ã€‚</td><td>int</td><td>30000</td><td>[0,...]</td><td>medium</td></tr><tr><td>sasl.jaas.config</td><td>JAASé…ç½®æ–‡ä»¶ä½¿ç”¨çš„æ ¼å¼çš„SASLè¿æ¥çš„JAASç™»å½•ä¸Šä¸‹æ–‡å‚æ•°ã€‚<a href="/fwd?link=https://docs.oracle.com/javase/8/docs/technotes/guides/security/jgss/tutorials/LoginConfigFile.html">è¿™é‡Œ</a>æè¿°JAASé…ç½®æ–‡ä»¶æ ¼å¼ã€‚è¯¥å€¼çš„æ ¼å¼ä¸ºï¼š&#39;ï¼ˆ&#x3D;ï¼‰*;&#39;</td><td>password</td><td>null</td><td></td><td>medium</td></tr><tr><td>sasl.kerberos.service.name</td><td>Kafkaè¿è¡Œçš„Kerberosä¸»ä½“åç§°ã€‚å¯ä»¥åœ¨Kafkaçš„JAASé…ç½®æˆ–Kafkaçš„é…ç½®ä¸­å®šä¹‰ã€‚</td><td>string</td><td>null</td><td></td><td>medium</td></tr><tr><td>sasl.mechanism</td><td>SASLæœºåˆ¶ç”¨äºå®¢æˆ·ç«¯è¿æ¥ã€‚è¿™æ˜¯å®‰å…¨æä¾›è€…å¯ç”¨ä¸ä»»ä½•æœºåˆ¶ã€‚GSSAPIæ˜¯é»˜è®¤æœºåˆ¶ã€‚</td><td>string</td><td>GSSAPI</td><td></td><td>medium</td></tr><tr><td>security.protocol</td><td>ç”¨äºä¸brokeré€šè®¯çš„åè®®ã€‚ æœ‰æ•ˆå€¼ä¸ºï¼šPLAINTEXTï¼ŒSSLï¼ŒSASL_PLAINTEXTï¼ŒSASL_SSLã€‚</td><td>string</td><td>PLAINTEXT</td><td></td><td>medium</td></tr><tr><td>send.buffer.bytes</td><td>å‘é€æ•°æ®æ—¶ï¼Œç”¨äºTCPå‘é€ç¼“å­˜ï¼ˆSO_SNDBUFï¼‰çš„å¤§å°ã€‚å¦‚æœå€¼ä¸º -1ï¼Œå°†é»˜è®¤ä½¿ç”¨ç³»ç»Ÿçš„ã€‚</td><td>int</td><td>131072</td><td>[-1,...]</td><td>medium</td></tr><tr><td>ssl.enabled.protocols</td><td>å¯ç”¨SSLè¿æ¥çš„åè®®åˆ—è¡¨ã€‚</td><td>list</td><td>TLSv1.2,TLSv1.1,TLSv1</td><td></td><td>medium</td></tr><tr><td>ssl.keystore.type</td><td>å¯†é’¥å­˜å‚¨æ–‡ä»¶çš„æ–‡ä»¶æ ¼å¼ã€‚å¯¹äºå®¢æˆ·ç«¯æ˜¯å¯é€‰çš„ã€‚</td><td>string</td><td>JKS</td><td></td><td>medium</td></tr><tr><td>ssl.protocol</td><td>æœ€è¿‘çš„JVMä¸­å…è®¸çš„å€¼æ˜¯TLSï¼ŒTLSv1.1å’ŒTLSv1.2ã€‚ è¾ƒæ—§çš„JVMå¯èƒ½æ”¯æŒSSLï¼ŒSSLv2å’ŒSSLv3ï¼Œä½†ç”±äºå·²çŸ¥çš„å®‰å…¨æ¼æ´ï¼Œä¸å»ºè®®ä½¿ç”¨SSLã€‚</td><td>string</td><td>TLS</td><td></td><td>medium</td></tr><tr><td>ssl.provider</td><td>ç”¨äºSSLè¿æ¥çš„å®‰å…¨æä¾›ç¨‹åºçš„åç§°ã€‚é»˜è®¤å€¼æ˜¯JVMçš„é»˜è®¤å®‰å…¨æä¾›ç¨‹åºã€‚</td><td>string</td><td>null</td><td></td><td>medium</td></tr><tr><td>ssl.truststore.type</td><td>ä¿¡ä»»ä»“åº“æ–‡ä»¶çš„æ–‡ä»¶æ ¼å¼ã€‚</td><td>string</td><td>JKS</td><td></td><td>medium</td></tr><tr><td>enable.idempotence</td><td>å½“è®¾ç½®ä¸ºâ€˜trueâ€™ï¼Œç”Ÿäº§è€…å°†ç¡®ä¿æ¯ä¸ªæ¶ˆæ¯æ­£å¥½ä¸€æ¬¡å¤åˆ¶å†™å…¥åˆ°streamã€‚å¦‚æœâ€˜falseâ€™ï¼Œç”±äºbrokeræ•…éšœï¼Œç”Ÿäº§è€…é‡è¯•ã€‚å³ï¼Œå¯ä»¥åœ¨æµä¸­å†™å…¥é‡è¯•çš„æ¶ˆæ¯ã€‚æ­¤è®¾ç½®é»˜è®¤æ˜¯â€˜falseâ€™ã€‚è¯·æ³¨æ„ï¼Œå¯ç”¨å¹‚ç­‰å¼éœ€è¦å°†max.in.flight.requests.per.connectionè®¾ç½®ä¸º1ï¼Œé‡è¯•æ¬¡æ•°ä¸èƒ½ä¸ºé›¶ã€‚å¦å¤–ackså¿…é¡»è®¾ç½®ä¸ºâ€œå…¨éƒ¨â€ã€‚å¦‚æœè¿™äº›å€¼ä¿æŒé»˜è®¤å€¼ï¼Œæˆ‘ä»¬å°†è¦†ç›–é»˜è®¤å€¼ã€‚ å¦‚æœè¿™äº›å€¼è®¾ç½®ä¸ºä¸å¹‚ç­‰ç”Ÿæˆå™¨ä¸å…¼å®¹çš„å€¼ï¼Œåˆ™å°†æŠ›å‡ºä¸€ä¸ªConfigExceptionå¼‚å¸¸ã€‚å¦‚æœè¿™äº›å€¼è®¾ç½®ä¸ºä¸å¹‚ç­‰ç”Ÿæˆå™¨ä¸å…¼å®¹çš„å€¼ï¼Œåˆ™å°†æŠ›å‡ºä¸€ä¸ªConfigExceptionå¼‚å¸¸ã€‚</td><td>boolean</td><td>false</td><td></td><td>low</td></tr><tr><td>interceptor.classes</td><td>å®ç°ProducerInterceptoræ¥å£ï¼Œä½ å¯ä»¥åœ¨ç”Ÿäº§è€…å‘å¸ƒåˆ°Kafkaç¾¤é›†ä¹‹å‰æ‹¦æˆªï¼ˆä¹Ÿå¯å˜æ›´ï¼‰ç”Ÿäº§è€…æ”¶åˆ°çš„æ¶ˆæ¯ã€‚é»˜è®¤æƒ…å†µä¸‹æ²¡æœ‰æ‹¦æˆªå™¨ã€‚</td><td>list</td><td>null</td><td></td><td>low</td></tr><tr><td>max.in.flight.requests.per.connection</td><td>é˜»å¡ä¹‹å‰ï¼Œå®¢æˆ·ç«¯å•ä¸ªè¿æ¥ä¸Šå‘é€çš„æœªåº”ç­”è¯·æ±‚çš„æœ€å¤§æ•°é‡ã€‚æ³¨æ„ï¼Œå¦‚æœæ­¤è®¾ç½®è®¾ç½®å¤§äº1ä¸”å‘é€å¤±è´¥ï¼Œåˆ™ä¼šç”±äºé‡è¯•ï¼ˆå¦‚æœå¯ç”¨äº†é‡è¯•ï¼‰ä¼šå¯¼è‡´æ¶ˆæ¯é‡æ–°æ’åºçš„é£é™©ã€‚</td><td>int</td><td>5</td><td>[1,...]</td><td>low</td></tr><tr><td>metadata.max.age.ms</td><td>åœ¨ä¸€æ®µæ—¶é—´æ®µä¹‹åï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ï¼Œå¼ºåˆ¶æ›´æ–°å…ƒæ•°æ®ï¼Œå³ä½¿æˆ‘ä»¬æ²¡æœ‰çœ‹åˆ°ä»»ä½•åˆ†åŒºleaderçš„å˜åŒ–ï¼Œä¹Ÿä¼šä¸»åŠ¨å»å‘ç°æ–°çš„brokeræˆ–åˆ†åŒºã€‚</td><td>long</td><td>300000</td><td>[0,...]</td><td>low</td></tr><tr><td>metric.reporters</td><td>ç”¨ä½œmetrics reportersï¼ˆæŒ‡æ ‡è®°å½•å‘˜ï¼‰çš„ç±»çš„åˆ—è¡¨ã€‚å®ç°MetricReporteræ¥å£ï¼Œå°†å—åˆ°æ–°å¢åŠ çš„åº¦é‡æ ‡å‡†åˆ›å»ºç±»æ’å…¥çš„é€šçŸ¥ã€‚ JmxReporterå§‹ç»ˆåŒ…å«åœ¨æ³¨å†ŒJMXç»Ÿè®¡ä¿¡æ¯ä¸­ã€‚</td><td>list</td><td>&quot;&quot;</td><td></td><td>low</td></tr><tr><td>metrics.num.samples</td><td>ç»´æŠ¤ç”¨äºè®¡ç®—åº¦é‡çš„æ ·ä¾‹æ•°é‡ã€‚</td><td>int</td><td>2</td><td>[1,...]</td><td>low</td></tr><tr><td>metrics.recording.level</td><td>æŒ‡æ ‡çš„æœ€é«˜è®°å½•çº§åˆ«ã€‚</td><td>string</td><td>INFO</td><td>[INFO, DEBUG]</td><td>low</td></tr><tr><td>metrics.sample.window.ms</td><td>åº¦é‡æ ·ä¾‹è®¡ç®—ä¸Š</td><td>long</td><td>30000</td><td>[0,...]</td><td>low</td></tr><tr><td>reconnect.backoff.max.ms</td><td>é‡æ–°è¿æ¥åˆ°é‡å¤æ— æ³•è¿æ¥çš„ä»£ç†ç¨‹åºæ—¶ç­‰å¾…çš„æœ€å¤§æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚ å¦‚æœæä¾›ï¼Œæ¯ä¸ªä¸»æœºçš„å›é€€å°†ä¼šè¿ç»­å¢åŠ ï¼Œç›´åˆ°è¾¾åˆ°æœ€å¤§å€¼ã€‚ è®¡ç®—åé€€å¢åŠ åï¼Œå¢åŠ 20ï¼…çš„éšæœºæŠ–åŠ¨ä»¥é¿å…è¿æ¥é£æš´ã€‚</td><td>long</td><td>1000</td><td>[0,...]</td><td>low</td></tr><tr><td>reconnect.backoff.ms</td><td>å°è¯•é‡æ–°è¿æ¥åˆ°ç»™å®šä¸»æœºä¹‹å‰ç­‰å¾…çš„åŸºæœ¬æ—¶é—´é‡ã€‚è¿™é¿å…äº†åœ¨å¾ªç¯ä¸­é«˜é¢‘ç‡çš„é‡å¤è¿æ¥åˆ°ä¸»æœºã€‚è¿™ç§å›é€€é€‚åº”äºå®¢æˆ·ç«¯å¯¹brokerçš„æ‰€æœ‰è¿æ¥å°è¯•ã€‚</td><td>long</td><td>50</td><td>[0,...]</td><td>low</td></tr><tr><td>retry.backoff.ms</td><td>å°è¯•é‡è¯•æŒ‡å®štopicåˆ†åŒºçš„å¤±è´¥è¯·æ±‚ä¹‹å‰ç­‰å¾…çš„æ—¶é—´ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨æŸäº›æ•…éšœæƒ…å†µä¸‹é«˜é¢‘æ¬¡çš„é‡å¤å‘é€è¯·æ±‚ã€‚</td><td>long</td><td>100</td><td>[0,...]</td><td>low</td></tr><tr><td>sasl.kerberos.kinit.cmd</td><td>Kerberos kinit å‘½ä»¤è·¯å¾„ã€‚</td><td>string</td><td>&#x2F;usr&#x2F;bin&#x2F;kinit</td><td></td><td>low</td></tr><tr><td>sasl.kerberos.min.time.before.relogin</td><td>Loginçº¿ç¨‹åˆ·æ–°å°è¯•ä¹‹é—´çš„ä¼‘çœ æ—¶é—´ã€‚</td><td>long</td><td>60000</td><td></td><td>low</td></tr><tr><td>sasl.kerberos.ticket.renew.jitter</td><td>æ·»åŠ æ›´æ–°æ—¶é—´çš„éšæœºæŠ–åŠ¨ç™¾åˆ†æ¯”ã€‚</td><td>double</td><td>0.05</td><td></td><td>low</td></tr><tr><td>sasl.kerberos.ticket.renew.window.factor</td><td>ç™»å½•çº¿ç¨‹å°†ç¡çœ ï¼Œç›´åˆ°ä»ä¸Šæ¬¡åˆ·æ–°ticketåˆ°æœŸæ—¶é—´çš„æŒ‡å®šçª—å£å› å­ä¸ºæ­¢ï¼Œæ­¤æ—¶å°†å°è¯•ç»­è®¢ticketã€‚</td><td>double</td><td>0.8</td><td></td><td>low</td></tr><tr><td>ssl.cipher.suites</td><td>å¯†ç å¥—ä»¶åˆ—è¡¨ã€‚è¿™æ˜¯ä½¿ç”¨TLSæˆ–SSLç½‘ç»œåè®®æ¥åå•†ç”¨äºç½‘ç»œè¿æ¥çš„å®‰å…¨è®¾ç½®çš„è®¤è¯ï¼ŒåŠ å¯†ï¼ŒMACå’Œå¯†é’¥äº¤æ¢ç®—æ³•çš„å‘½åç»„åˆã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ”¯æŒæ‰€æœ‰å¯ç”¨çš„å¯†ç å¥—ä»¶ã€‚</td><td>list</td><td>null</td><td></td><td>low</td></tr><tr><td>ssl.endpoint.identification.algorithm</td><td>ä½¿ç”¨æœåŠ¡å™¨è¯ä¹¦éªŒè¯æœåŠ¡å™¨ä¸»æœºåçš„ç«¯ç‚¹è¯†åˆ«ç®—æ³•ã€‚</td><td>string</td><td>null</td><td></td><td>low</td></tr><tr><td>ssl.keymanager.algorithm</td><td>ç”¨äºSSLè¿æ¥çš„å¯†é’¥ç®¡ç†å› å­ç®—æ³•ã€‚é»˜è®¤å€¼æ˜¯ä¸ºJavaè™šæ‹Ÿæœºé…ç½®çš„å¯†é’¥ç®¡ç†å™¨å·¥å‚ç®—æ³•ã€‚</td><td>string</td><td>SunX509</td><td></td><td>low</td></tr><tr><td>ssl.secure.random.implementation</td><td>ç”¨äºSSLåŠ å¯†æ“ä½œçš„SecureRandom PRNGå®ç°ã€‚</td><td>string</td><td>null</td><td></td><td>low</td></tr><tr><td>ssl.trustmanager.algorithm</td><td>ç”¨äºSSLè¿æ¥çš„ä¿¡ä»»ç®¡ç†å› å­ç®—æ³•ã€‚é»˜è®¤å€¼æ˜¯JAVAè™šæ‹Ÿæœºé…ç½®çš„ä¿¡ä»»ç®¡ç†å·¥å‚ç®—æ³•ã€‚</td><td>string</td><td>PKIX</td><td></td><td>low</td></tr><tr><td>transaction.timeout.ms</td><td>ç”Ÿäº§è€…åœ¨ä¸»åŠ¨ä¸­æ­¢æ­£åœ¨è¿›è¡Œçš„äº¤æ˜“ä¹‹å‰ï¼Œäº¤æ˜“åè°ƒå™¨ç­‰å¾…äº‹åŠ¡çŠ¶æ€æ›´æ–°çš„æœ€å¤§æ—¶é—´ï¼ˆä»¥msä¸ºå•ä½ï¼‰ã€‚å¦‚æœæ­¤å€¼å¤§äºbrokerä¸­çš„max.transaction.timeout.msè®¾ç½®ï¼Œåˆ™è¯·æ±‚å°†å¤±è´¥ï¼Œå¹¶æŠ¥â€œInvalidTransactionTimeoutâ€é”™è¯¯ã€‚</td><td>int</td><td>60000</td><td></td><td>low</td></tr><tr><td>transactional.id</td><td>ç”¨äºäº‹åŠ¡ä¼ é€’çš„TransactionalIdã€‚è¿™æ ·å¯ä»¥è·¨å¤šä¸ªç”Ÿäº§è€…ä¼šè¯çš„å¯é æ€§è¯­ä¹‰ï¼Œå› ä¸ºå®ƒå…è®¸å®¢æˆ·ç«¯ä¿è¯åœ¨å¼€å§‹ä»»ä½•æ–°äº‹åŠ¡ä¹‹å‰ä½¿ç”¨ç›¸åŒçš„TransactionalIdçš„äº‹åŠ¡å·²ç»å®Œæˆã€‚å¦‚æœæ²¡æœ‰æä¾›TransactionalIdï¼Œåˆ™ç”Ÿäº§è€…è¢«é™åˆ¶ä¸ºå¹‚ç­‰ä¼ é€’ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœé…ç½®äº†TransactionalIdï¼Œåˆ™å¿…é¡»å¯ç”¨enable.idempotenceã€‚ é»˜è®¤å€¼ä¸ºç©ºï¼Œè¿™æ„å‘³ç€æ— æ³•ä½¿ç”¨äº‹åŠ¡ã€‚</td><td>string</td><td>null</td><td>non-empty string</td><td>low</td></tr></tbody></table><h2 id="kafka-2-0-0-1"><a href="#kafka-2-0-0-1" class="headerlink" title="kafka &gt;&#x3D; 2.0.0"></a>kafka &gt;&#x3D; 2.0.0</h2><table><thead><tr><th>åç§°</th><th>æè¿°</th><th>ç±»å‹</th><th>é»˜è®¤</th><th>æœ‰æ•ˆå€¼</th><th>é‡è¦ç¨‹åº¦</th></tr></thead><tbody><tr><td>sasl.client.callback.handler.class</td><td>å®ç°AuthenticateCallbackHandleræ¥å£çš„SASLå®¢æˆ·ç«¯å›è°ƒå¤„ç†ç¨‹åºç±»çš„å…¨ç§°ã€‚</td><td>class</td><td>null</td><td></td><td>ä¸­é—´</td></tr><tr><td>sasl.login.callback.handler.class</td><td>å®ç°AuthenticateCallbackHandleræ¥å£çš„SASLç™»å½•å›è°ƒå¤„ç†ç¨‹åºç±»çš„å…¨ç§°ã€‚å¯¹äºbrokeræ¥è¯´ï¼Œç™»å½•å›è°ƒå¤„ç†ç¨‹åºé…ç½®å¿…é¡»ä»¥ç›‘å¬å™¨å‰ç¼€å’Œå°å†™çš„SASLæœºåˆ¶åç§°ä¸ºå‰ç¼€ã€‚ä¾‹å¦‚ï¼Œ<code>listener.name.sasl_ssl.scram-sha-256.sasl.login.callback.handler.class=com.example.CustomScramLoginCallbackHandler</code></td><td>class</td><td>null</td><td></td><td>ä¸­é—´</td></tr><tr><td>sasl.login.class</td><td>å®ç°Loginæ¥å£çš„ç±»çš„å…¨ç§°ã€‚å¯¹äºbrokeræ¥è¯´ï¼Œlogin configå¿…é¡»ä»¥ç›‘å¬å™¨å‰ç¼€å’ŒSASLæœºåˆ¶åç§°ä¸ºå‰ç¼€ï¼Œå¹¶ä½¿ç”¨å°å†™ã€‚ä¾‹å¦‚ï¼Œ<code>listener.name.sasl_ssl.scram-sha-256.sasl.login.class=com.example.CustomScramLogin</code>ã€‚</td><td>class</td><td>null</td><td></td><td>ä¸­é—´</td></tr></tbody></table><h2 id="kafka-2-1-0-1"><a href="#kafka-2-1-0-1" class="headerlink" title="kafka &gt;&#x3D; 2.1.0"></a>kafka &gt;&#x3D; 2.1.0</h2><table><thead><tr><th>åç§°</th><th>æè¿°</th><th>ç±»å‹</th><th>é»˜è®¤</th><th>æœ‰æ•ˆå€¼</th><th>é‡è¦ç¨‹åº¦</th></tr></thead><tbody><tr><td>client.dns.lookup</td><td>æ§åˆ¶å®¢æˆ·ç«¯å¦‚ä½•ä½¿ç”¨DNSæŸ¥è¯¢ã€‚å¦‚æœè®¾ç½®ä¸º <code>use_all_dns_ips</code>ï¼Œåˆ™ä¾æ¬¡è¿æ¥åˆ°æ¯ä¸ªè¿”å›çš„IPåœ°å€ï¼Œç›´åˆ°æˆåŠŸå»ºç«‹è¿æ¥ã€‚æ–­å¼€è¿æ¥åï¼Œä½¿ç”¨ä¸‹ä¸€ä¸ªIPã€‚ä¸€æ—¦æ‰€æœ‰çš„IPéƒ½è¢«ä½¿ç”¨è¿‡ä¸€æ¬¡ï¼Œå®¢æˆ·ç«¯å°±ä¼šå†æ¬¡ä»ä¸»æœºåä¸­è§£æIP(s)(ç„¶è€Œï¼ŒJVMå’Œæ“ä½œç³»ç»Ÿéƒ½ä¼šç¼“å­˜DNSåç§°æŸ¥è¯¢)ã€‚å¦‚æœè®¾ç½®ä¸º <code>resolve_canonical_bootstrap_servers_only</code>ï¼Œåˆ™å°†æ¯ä¸ªå¼•å¯¼åœ°å€è§£ææˆä¸€ä¸ªcanonicalåç§°åˆ—è¡¨ã€‚åœ¨bootstrapé˜¶æ®µä¹‹åï¼Œè¿™å’Œ<code>use_all_dns_ips</code>çš„è¡Œä¸ºæ˜¯ä¸€æ ·çš„ã€‚å¦‚æœè®¾ç½®ä¸º <code>default</code>(å·²å¼ƒç”¨)ï¼Œåˆ™å°è¯•è¿æ¥åˆ°æŸ¥æ‰¾è¿”å›çš„ç¬¬ä¸€ä¸ªIPåœ°å€ï¼Œå³ä½¿æŸ¥æ‰¾è¿”å›å¤šä¸ªIPåœ°å€ã€‚</td><td>string</td><td>use_all_dns_ips</td><td><code>[default, use_all_dns_ips, resolve_canonical_bootstrap_servers_only]</code></td><td>ä¸­é—´</td></tr><tr><td>delivery.timeout.ms</td><td>è°ƒç”¨<code>send()</code>è¿”å›åæŠ¥å‘ŠæˆåŠŸæˆ–å¤±è´¥çš„æ—¶é—´ä¸Šé™ã€‚è¿™é™åˆ¶äº†æ¶ˆæ¯åœ¨å‘é€å‰è¢«å»¶è¿Ÿçš„æ€»æ—¶é—´ï¼Œç­‰å¾…brokerç¡®è®¤çš„æ—¶é—´ï¼ˆå¦‚æœæœŸæœ›çš„è¯ï¼‰ï¼Œä»¥åŠå…è®¸é‡è¯•å‘é€å¤±è´¥çš„æ—¶é—´ã€‚å¦‚æœé‡åˆ°ä¸å¯æ¢å¤çš„é”™è¯¯ï¼Œé‡è¯•æ¬¡æ•°å·²ç»ç”¨å°½ï¼Œæˆ–è€…æ¶ˆæ¯è¢«æ·»åŠ åˆ°ä¸€ä¸ªè¾¾åˆ°è¾ƒæ—©å‘é€åˆ°æœŸæœŸé™çš„æ‰¹æ¬¡ä¸­ï¼Œç”Ÿäº§è€…å¯èƒ½ä¼šæŠ¥å‘Šæœªèƒ½åœ¨è¿™ä¸ªé…ç½®ä¹‹å‰å‘é€è®°å½•ã€‚è¿™ä¸ªé…ç½®çš„å€¼åº”è¯¥å¤§äºæˆ–ç­‰äº<code>request.timeout.ms</code>å’Œ<code>linger.ms</code>ä¹‹å’Œã€‚</td><td>int</td><td>120000 (2 minutes)</td><td><code>[0,...]</code></td><td>ä¸­é—´</td></tr></tbody></table><h2 id="kafka-2-7-1"><a href="#kafka-2-7-1" class="headerlink" title="kafka &gt;&#x3D; 2.7"></a>kafka &gt;&#x3D; 2.7</h2><table><thead><tr><th>åç§°</th><th>æè¿°</th><th>ç±»å‹</th><th>é»˜è®¤</th><th>æœ‰æ•ˆå€¼</th><th>é‡è¦ç¨‹åº¦</th></tr></thead><tbody><tr><td>ssl.truststore.certificates</td><td>å¯ä¿¡è¯ä¹¦çš„æ ¼å¼ç”±&#39;ssl.truststore.type&#39;æŒ‡å®šã€‚é»˜è®¤çš„SSLå¼•æ“å·¥å‚åªæ”¯æŒå¸¦X.509è¯ä¹¦çš„PEMæ ¼å¼ã€‚</td><td>password</td><td>null</td><td></td><td>é«˜</td></tr><tr><td>socket.connection.setup.timeout.max.ms</td><td>å®¢æˆ·ç«¯ç­‰å¾…å»ºç«‹socketè¿æ¥çš„æœ€å¤§æ—¶é—´ã€‚è¿æ¥è®¾ç½®è¶…æ—¶æ—¶é—´å°†éšç€æ¯ä¸€æ¬¡è¿ç»­çš„è¿æ¥å¤±è´¥è€Œæˆå€å¢åŠ ï¼Œç›´åˆ°è¿™ä¸ªæœ€å¤§å€¼ã€‚ä¸ºäº†é¿å…è¿æ¥é£æš´ï¼Œè¶…æ—¶æ—¶é—´å°†è¢«åº”ç”¨ä¸€ä¸ª0.2çš„éšæœºå› å­ï¼Œå¯¼è‡´è®¡ç®—å€¼åœ¨20%ä»¥ä¸‹å’Œ20%ä»¥ä¸Šçš„éšæœºèŒƒå›´ã€‚</td><td>long</td><td>127000 (127 seconds)</td><td></td><td>ä¸­é—´</td></tr><tr><td>socket.connection.setup.timeout.ms</td><td>å®¢æˆ·ç«¯ç­‰å¾…å»ºç«‹socketè¿æ¥çš„æ—¶é—´ã€‚å¦‚æœåœ¨è¶…æ—¶ä¹‹å‰æ²¡æœ‰å»ºç«‹è¿æ¥ï¼Œå®¢æˆ·ç«¯å°†å…³é—­socketé€šé“ã€‚</td><td>long</td><td>10000 (10 seconds)</td><td></td><td>ä¸­é—´</td></tr></tbody></table></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…:</span> <span class="post-copyright-info"><a href="https://xiaowu95.wang">å°äº”</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥:</span> <span class="post-copyright-info"><a href="https://xiaowu95.wang/posts/f351760e/">https://xiaowu95.wang/posts/f351760e/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜:</span> <span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://xiaowu95.wang" target="_blank">å°äº”çš„ä¸ªäººæ‚è´§é“º</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/kafka/">kafka</a><a class="post-meta__tags" href="/tags/mq/">mq</a></div><div class="post-share"><div class="social-share" data-image="/img/nba-logo20.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>æ„Ÿè°¢æ”¯æŒ</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wxpay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-lazy-src="/img/wxpay.jpg" alt="å¾®ä¿¡"></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-lazy-src="/img/alipay.jpg" alt="æ”¯ä»˜å®"></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/a3d4c6bc/" title="Kafkaé›†ç¾¤æ­å»º(å«ZKæ¨¡å¼å’ŒKraftæ¨¡å¼)"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo24.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">Kafkaé›†ç¾¤æ­å»º(å«ZKæ¨¡å¼å’ŒKraftæ¨¡å¼)</div></div><div class="info-2"><div class="info-item-1">å‰è¨€ç¯å¢ƒä»‹ç»è™šæ‹Ÿæœºè½¯ä»¶ï¼šVirtualBox Linux å‘è¡Œç‰ˆæœ¬ï¼šUbuntu 20.04.4 è™šæ‹Ÿæœºæ ¸å¿ƒæ•°ï¼š1 core è™šæ‹Ÿæœºå†…å­˜ï¼š2 GB JDK ç‰ˆæœ¬ï¼š1.8.0_202 ZK ç‰ˆæœ¬ï¼š3.8.0 Kafka ç‰ˆæœ¬ï¼š3.2.0 Kafka - ZK æ¨¡å¼Kafka 2.8.0 ä¹‹å‰ï¼Œæ‰€æœ‰å…ƒæ•°æ®ä¿¡æ¯éƒ½å­˜å‚¨åœ¨ ZKã€‚ ZK æˆä¸º Kafka ç“¶é¢ˆã€‚ä» 2.8.0 å¼€å§‹ï¼Œå¯ä»¥å°†å…ƒæ•°æ®ä¿¡æ¯å­˜å‚¨åœ¨ Kafkaï¼Œè„±ç¦» ZKã€‚ é›†ç¾¤è§„åˆ’ node01 node02 node03 zk zk zk kafka kafka kafka ZK é›†ç¾¤éƒ¨ç½²å¯ä»¥å‚è€ƒ ã€ŠHadoop HA æ­å»ºã€‹ ä¸­çš„ ZK é›†ç¾¤æ­å»º Kafka é›†ç¾¤éƒ¨ç½²Kafka ç¯å¢ƒå˜é‡1234567$ vim /etc/profile# å°¾éƒ¨æ·»åŠ ä»¥ä¸‹å†…å®¹export KAFKA_HOME=/opt/kafka-3.2.0export PATH=$PATH:$KAFKA_HOME/bin$ xsync $KAFKA_HOME$ xsync /etc/profile é…ç½® server.properties1...</div></div></div></a><a class="pagination-related" href="/posts/221dce9c/" title="kafkaç”Ÿäº§è°ƒä¼˜"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo18.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">kafkaç”Ÿäº§è°ƒä¼˜</div></div><div class="info-2"><div class="info-item-1">ä¸€ã€Kafka ç¡¬ä»¶ é…ç½®é€‰æ‹©1ã€åœºæ™¯è¯´æ˜ 2ã€æœåŠ¡å™¨å°æ•°é€‰æ‹© 3ã€ç£ç›˜é€‰æ‹© 4ã€å†…å­˜é€‰æ‹©Kafka å†…å­˜ç»„æˆï¼šå †å†…å­˜ + é¡µç¼“å­˜ 1ï¼‰Kafka å †å†…å­˜å»ºè®®æ¯ä¸ªèŠ‚ç‚¹ï¼š10g ~ 15g åœ¨ kafka-server-start.sh ä¸­ä¿®æ”¹ 123if [ &quot;x$KAFKA_HEAP_OPTS&quot; = &quot;x&quot; ]; then export KAFKA_HEAP_OPTS=&quot;-Xmx10G -Xms10G&quot;fi æŸ¥çœ‹ Kafka è¿›ç¨‹å·: 1234[atguigu@hadoop102 kafka]$ jps2321 Kafka5255 Jps1931 QuorumPeerMain æ ¹æ® Kafka è¿›ç¨‹å·ï¼ŒæŸ¥çœ‹ Kafka çš„ GC æƒ…å†µ: 1jstat -gc 2321 1s 10 æ–°ç”Ÿä»£GCæ¬¡æ•° æ ¹æ® Kafka è¿›ç¨‹å·ï¼ŒæŸ¥çœ‹ Kafka çš„å †å†…å­˜ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/96b6e5e9/" title="Kafka-Eagleç›‘æ§&amp;Kraftæ¨¡å¼"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo6.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2023-06-15</div><div class="info-item-2">Kafka-Eagleç›‘æ§&amp;Kraftæ¨¡å¼</div></div><div class="info-2"><div class="info-item-1">Kafka-Eagleç›‘æ§Kafka-Eagleæ¡†æ¶å¯ä»¥ç›‘æ§ Kafka é›†ç¾¤çš„æ•´ä½“è¿è¡Œæƒ…å†µï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç»å¸¸ä½¿ç”¨ã€‚ åœ¨æ­¤ä¹‹å‰ç›‘æ§å·¥å…·éœ€è¦MySQLä½œä¸ºæŒä¹…åŒ–æ‰‹æ®µã€‚ ä¸€ã€Kafkaç¯å¢ƒå‡†å¤‡1ã€å…³é—­ Kafka é›†ç¾¤12# åœæ­¢é›†ç¾¤kf.sh stop 2ã€ä¿®æ”¹&#x2F;opt&#x2F;module&#x2F;kafka&#x2F;bin&#x2F;kafka-server-start.sh1vim bin/kafka-server-start.sh ä¿®æ”¹å¦‚ä¸‹å‚æ•°å€¼ï¼š 123if [ &quot;x$KAFKA_HEAP_OPTS&quot; = &quot;x&quot; ]; then export KAFKA_HEAP_OPTS=&quot;-Xmx1G -Xms1G&quot;fi ä¸º 12345if [ &quot;x$KAFKA_HEAP_OPTS&quot; = &quot;x&quot; ]; then export KAFKA_HEAP_OPTS=&quot;-server -Xms2G -Xmx2G -XX:PermSize=128m -XX...</div></div></div></a><a class="pagination-related" href="/posts/a3d4c6bc/" title="Kafkaé›†ç¾¤æ­å»º(å«ZKæ¨¡å¼å’ŒKraftæ¨¡å¼)"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo24.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2023-06-15</div><div class="info-item-2">Kafkaé›†ç¾¤æ­å»º(å«ZKæ¨¡å¼å’ŒKraftæ¨¡å¼)</div></div><div class="info-2"><div class="info-item-1">å‰è¨€ç¯å¢ƒä»‹ç»è™šæ‹Ÿæœºè½¯ä»¶ï¼šVirtualBox Linux å‘è¡Œç‰ˆæœ¬ï¼šUbuntu 20.04.4 è™šæ‹Ÿæœºæ ¸å¿ƒæ•°ï¼š1 core è™šæ‹Ÿæœºå†…å­˜ï¼š2 GB JDK ç‰ˆæœ¬ï¼š1.8.0_202 ZK ç‰ˆæœ¬ï¼š3.8.0 Kafka ç‰ˆæœ¬ï¼š3.2.0 Kafka - ZK æ¨¡å¼Kafka 2.8.0 ä¹‹å‰ï¼Œæ‰€æœ‰å…ƒæ•°æ®ä¿¡æ¯éƒ½å­˜å‚¨åœ¨ ZKã€‚ ZK æˆä¸º Kafka ç“¶é¢ˆã€‚ä» 2.8.0 å¼€å§‹ï¼Œå¯ä»¥å°†å…ƒæ•°æ®ä¿¡æ¯å­˜å‚¨åœ¨ Kafkaï¼Œè„±ç¦» ZKã€‚ é›†ç¾¤è§„åˆ’ node01 node02 node03 zk zk zk kafka kafka kafka ZK é›†ç¾¤éƒ¨ç½²å¯ä»¥å‚è€ƒ ã€ŠHadoop HA æ­å»ºã€‹ ä¸­çš„ ZK é›†ç¾¤æ­å»º Kafka é›†ç¾¤éƒ¨ç½²Kafka ç¯å¢ƒå˜é‡1234567$ vim /etc/profile# å°¾éƒ¨æ·»åŠ ä»¥ä¸‹å†…å®¹export KAFKA_HOME=/opt/kafka-3.2.0export PATH=$PATH:$KAFKA_HOME/bin$ xsync $KAFKA_HOME$ xsync /etc/profile é…ç½® server.properties1...</div></div></div></a><a class="pagination-related" href="/posts/221dce9c/" title="kafkaç”Ÿäº§è°ƒä¼˜"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo18.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2023-06-15</div><div class="info-item-2">kafkaç”Ÿäº§è°ƒä¼˜</div></div><div class="info-2"><div class="info-item-1">ä¸€ã€Kafka ç¡¬ä»¶ é…ç½®é€‰æ‹©1ã€åœºæ™¯è¯´æ˜ 2ã€æœåŠ¡å™¨å°æ•°é€‰æ‹© 3ã€ç£ç›˜é€‰æ‹© 4ã€å†…å­˜é€‰æ‹©Kafka å†…å­˜ç»„æˆï¼šå †å†…å­˜ + é¡µç¼“å­˜ 1ï¼‰Kafka å †å†…å­˜å»ºè®®æ¯ä¸ªèŠ‚ç‚¹ï¼š10g ~ 15g åœ¨ kafka-server-start.sh ä¸­ä¿®æ”¹ 123if [ &quot;x$KAFKA_HEAP_OPTS&quot; = &quot;x&quot; ]; then export KAFKA_HEAP_OPTS=&quot;-Xmx10G -Xms10G&quot;fi æŸ¥çœ‹ Kafka è¿›ç¨‹å·: 1234[atguigu@hadoop102 kafka]$ jps2321 Kafka5255 Jps1931 QuorumPeerMain æ ¹æ® Kafka è¿›ç¨‹å·ï¼ŒæŸ¥çœ‹ Kafka çš„ GC æƒ…å†µ: 1jstat -gc 2321 1s 10 æ–°ç”Ÿä»£GCæ¬¡æ•° æ ¹æ® Kafka è¿›ç¨‹å·ï¼ŒæŸ¥çœ‹ Kafka çš„å †å†…å­˜ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-lazy-src="/img/avatar.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">å°äº”</div><div class="author-info-description">Tomorrow will be better,Everything will be fine</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">554</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">168</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">55</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/wang-xiaowu"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons"><a class="social-icon" href="/random" target="_blank" title="éšä¾¿é€›é€›"><i class="fa-solid fa-shuffle"></i></a><a class="social-icon" href="mailto:wangxiaowu950330@foxmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/30655189?spm_id_from=333.1007.0.0" rel="external nofollow noreferrer" target="_blank" title="BiliBili"><i class="fa-brands fa-bilibili"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa-solid fa-rss"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">Kafkaæ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-number">1.1.</span> <span class="toc-text">å®šä¹‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97"><span class="toc-number">1.2.</span> <span class="toc-text">æ¶ˆæ¯é˜Ÿåˆ—</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9F%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.2.1.</span> <span class="toc-text">ä¼ ç»Ÿæ¶ˆæ¯é˜Ÿåˆ—çš„åº”ç”¨åœºæ™¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.2.2.</span> <span class="toc-text">æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸¤ç§æ¨¡å¼</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">åŸºç¡€æ¶æ„</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">2.</span> <span class="toc-text">Kafka å¿«é€Ÿå…¥é—¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="toc-number">2.1.</span> <span class="toc-text">å®‰è£…éƒ¨ç½²</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E8%A7%84%E5%88%92"><span class="toc-number">2.1.1.</span> <span class="toc-text">é›†ç¾¤è§„åˆ’</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8"><span class="toc-number">2.1.2.</span> <span class="toc-text">å¯åŠ¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kafka%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%93%8D%E4%BD%9C"><span class="toc-number">2.2.</span> <span class="toc-text">Kafkaå‘½ä»¤è¡Œæ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%A2%98%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%93%8D%E4%BD%9C"><span class="toc-number">2.2.1.</span> <span class="toc-text">ä¸»é¢˜å‘½ä»¤è¡Œæ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%93%8D%E4%BD%9C"><span class="toc-number">2.2.2.</span> <span class="toc-text">ç”Ÿäº§è€…å‘½ä»¤è¡Œæ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%93%8D%E4%BD%9C"><span class="toc-number">2.2.3.</span> <span class="toc-text">æ¶ˆè´¹è€…å‘½ä»¤è¡Œæ“ä½œ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka-%E7%94%9F%E4%BA%A7%E8%80%85"><span class="toc-number">3.</span> <span class="toc-text">Kafka ç”Ÿäº§è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E6%B5%81%E7%A8%8B"><span class="toc-number">3.1.</span> <span class="toc-text">ç”Ÿäº§è€…æ¶ˆæ¯å‘é€æµç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E5%8E%9F%E7%90%86"><span class="toc-number">3.1.1.</span> <span class="toc-text">å‘é€åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85%E9%87%8D%E8%A6%81%E5%8F%82%E6%95%B0%E5%88%97%E8%A1%A8"><span class="toc-number">3.1.2.</span> <span class="toc-text">ç”Ÿäº§è€…é‡è¦å‚æ•°åˆ—è¡¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E9%80%81"><span class="toc-number">3.2.</span> <span class="toc-text">å‘é€</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E5%BC%82%E6%AD%A5%E5%8F%91%E9%80%81"><span class="toc-number">3.2.1.</span> <span class="toc-text">æ™®é€šå¼‚æ­¥å‘é€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E7%9A%84%E5%BC%82%E6%AD%A5%E5%8F%91%E9%80%81"><span class="toc-number">3.2.2.</span> <span class="toc-text">å¸¦å›è°ƒå‡½æ•°çš„å¼‚æ­¥å‘é€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E5%8F%91%E9%80%81API"><span class="toc-number">3.2.3.</span> <span class="toc-text">åŒæ­¥å‘é€API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">3.3.</span> <span class="toc-text">ç”Ÿäº§è€…æ‹¦æˆªå™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85%E5%88%86%E5%8C%BA"><span class="toc-number">3.4.</span> <span class="toc-text">ç”Ÿäº§è€…åˆ†åŒº</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-number">3.4.1.</span> <span class="toc-text">åˆ†åŒºçš„å¥½å¤„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E5%88%86%E5%8C%BA%E7%AD%96%E7%95%A5"><span class="toc-number">3.4.2.</span> <span class="toc-text">ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ†åŒºç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E5%8C%BA%E5%99%A8"><span class="toc-number">3.4.3.</span> <span class="toc-text">è‡ªå®šä¹‰åˆ†åŒºå™¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85%E6%8F%90%E9%AB%98%E5%90%9E%E5%90%90%E9%87%8F"><span class="toc-number">3.5.</span> <span class="toc-text">ç”Ÿäº§è€…æé«˜ååé‡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E7%B4%AF%E5%8A%A0%E5%99%A8"><span class="toc-number">3.5.1.</span> <span class="toc-text">æ¶ˆæ¯ç´¯åŠ å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E7%BA%BF%E7%A8%8B%EF%BC%88Sender%EF%BC%89"><span class="toc-number">3.5.2.</span> <span class="toc-text">æ¶ˆæ¯å‘é€çº¿ç¨‹ï¼ˆSenderï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E7%BB%8F%E9%AA%8C%E2%80%94%E6%95%B0%E6%8D%AE%E5%8F%AF%E9%9D%A0%E6%80%A7"><span class="toc-number">3.6.</span> <span class="toc-text">ç”Ÿäº§ç»éªŒâ€”æ•°æ®å¯é æ€§</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E7%A1%AE%E8%AE%A4%E6%9C%BA%E5%88%B6-ACK"><span class="toc-number">3.6.1.</span> <span class="toc-text">æ¶ˆæ¯ç¡®è®¤æœºåˆ¶-ACK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8E%BB%E9%87%8D-%E5%B9%82%E7%AD%89%E6%80%A7"><span class="toc-number">3.6.2.</span> <span class="toc-text">æ•°æ®å»é‡-å¹‚ç­‰æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E4%BA%8B%E5%8A%A1"><span class="toc-number">3.6.3.</span> <span class="toc-text">æ¶ˆæ¯äº‹åŠ¡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E9%A1%BA%E5%BA%8F"><span class="toc-number">3.7.</span> <span class="toc-text">æ¶ˆæ¯é¡ºåº</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka-Broker"><span class="toc-number">4.</span> <span class="toc-text">Kafka Broker</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Broker%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.1.</span> <span class="toc-text">Brokerè®¾è®¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Zookeeper"><span class="toc-number">4.2.</span> <span class="toc-text">Zookeeper</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Zookeeper%E4%BD%9C%E7%94%A8"><span class="toc-number">4.2.1.</span> <span class="toc-text">Zookeeperä½œç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Broker%E9%80%89%E4%B8%BELeader"><span class="toc-number">4.2.2.</span> <span class="toc-text">Brokeré€‰ä¸¾Leader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Broker%E9%87%8D%E8%A6%81%E5%8F%82%E6%95%B0"><span class="toc-number">4.2.3.</span> <span class="toc-text">Brokeré‡è¦å‚æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%E6%9C%8D%E5%BD%B9%E5%92%8C%E9%80%80%E5%BD%B9"><span class="toc-number">4.3.</span> <span class="toc-text">èŠ‚ç‚¹æœå½¹å’Œé€€å½¹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%BD%B9%E6%96%B0%E8%8A%82%E7%82%B9"><span class="toc-number">4.3.1.</span> <span class="toc-text">æœå½¹æ–°èŠ‚ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%80%E5%BD%B9%E6%97%A7%E8%8A%82%E7%82%B9"><span class="toc-number">4.3.2.</span> <span class="toc-text">é€€å½¹æ—§èŠ‚ç‚¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%AF%E6%9C%AC%E6%9C%BA%E5%88%B6"><span class="toc-number">4.4.</span> <span class="toc-text">å‰¯æœ¬æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%AF%E6%9C%AC%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="toc-number">4.4.1.</span> <span class="toc-text">å‰¯æœ¬åŸºæœ¬ä¿¡æ¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%AF%E6%9C%AC%E9%80%89%E4%B8%BELeader"><span class="toc-number">4.4.2.</span> <span class="toc-text">å‰¯æœ¬é€‰ä¸¾Leader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%AF%E6%9C%AC%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86"><span class="toc-number">4.4.3.</span> <span class="toc-text">å‰¯æœ¬æ•…éšœå¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#follower%E6%95%85%E9%9A%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">4.4.3.1.</span> <span class="toc-text">followeræ•…éšœæµç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#leader%E6%95%85%E9%9A%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">4.4.3.2.</span> <span class="toc-text">leaderæ•…éšœæµç¨‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E5%89%AF%E6%9C%AC%E5%88%86%E9%85%8D"><span class="toc-number">4.4.4.</span> <span class="toc-text">åˆ†åŒºå‰¯æœ¬åˆ†é…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E8%B0%83%E6%95%B4%E5%88%86%E5%8C%BA%E5%89%AF%E6%9C%AC"><span class="toc-number">4.4.5.</span> <span class="toc-text">æ‰‹åŠ¨è°ƒæ•´åˆ†åŒºå‰¯æœ¬</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E8%87%AA%E5%8A%A8%E8%B0%83%E6%95%B4"><span class="toc-number">4.4.6.</span> <span class="toc-text">åˆ†åŒºè‡ªåŠ¨è°ƒæ•´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E%E5%8A%A0%E5%89%AF%E6%9C%AC%E5%9B%A0%E5%AD%90"><span class="toc-number">4.4.7.</span> <span class="toc-text">å¢åŠ å‰¯æœ¬å› å­</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8"><span class="toc-number">4.5.</span> <span class="toc-text">æ–‡ä»¶å­˜å‚¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="toc-number">4.5.1.</span> <span class="toc-text">å­˜å‚¨ç»“æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%B8%85%E7%90%86%E7%AD%96%E7%95%A5"><span class="toc-number">4.5.2.</span> <span class="toc-text">****æ–‡ä»¶æ¸…ç†ç­–ç•¥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E5%88%A0%E9%99%A4"><span class="toc-number">4.5.2.1.</span> <span class="toc-text">æ—¥å¿—åˆ é™¤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E5%8E%8B%E7%BC%A9"><span class="toc-number">4.5.2.2.</span> <span class="toc-text">æ—¥å¿—å‹ç¼©</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kafka%E9%AB%98%E6%95%88%E8%AF%BB%E6%95%B0%E6%8D%AE"><span class="toc-number">4.6.</span> <span class="toc-text">Kafkaé«˜æ•ˆè¯»æ•°æ®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%BA%E5%BA%8F%E5%86%99%E7%A3%81%E7%9B%98"><span class="toc-number">4.6.1.</span> <span class="toc-text">é¡ºåºå†™ç£ç›˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B5%E7%BC%93%E5%AD%98%E4%B8%8E%E9%9B%B6%E6%8B%B7%E8%B4%9D"><span class="toc-number">4.6.2.</span> <span class="toc-text">é¡µç¼“å­˜ä¸é›¶æ‹·è´</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B5%E7%BC%93%E5%AD%98"><span class="toc-number">4.6.2.1.</span> <span class="toc-text">é¡µç¼“å­˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%B6%E6%8B%B7%E8%B4%9D"><span class="toc-number">4.6.2.2.</span> <span class="toc-text">é›¶æ‹·è´</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka%E6%B6%88%E8%B4%B9%E8%80%85"><span class="toc-number">5.</span> <span class="toc-text">Kafkaæ¶ˆè´¹è€…</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.1.</span> <span class="toc-text">æ¶ˆè´¹æ¨¡å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">5.2.</span> <span class="toc-text">æ¶ˆè´¹å·¥ä½œæµç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85%E6%80%BB%E4%BD%93%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">5.2.1.</span> <span class="toc-text">æ¶ˆè´¹è€…æ€»ä½“å·¥ä½œæµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85%E7%BB%84%E5%8E%9F%E7%90%86"><span class="toc-number">5.2.2.</span> <span class="toc-text">æ¶ˆè´¹è€…ç»„åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85%E7%BB%84%E9%80%89%E4%B8%BELeader"><span class="toc-number">5.2.3.</span> <span class="toc-text">æ¶ˆè´¹è€…ç»„é€‰ä¸¾Leader</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85API"><span class="toc-number">5.3.</span> <span class="toc-text">æ¶ˆè´¹è€…API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E5%B9%B3%E8%A1%A1%E4%BB%A5%E5%8F%8A%E5%86%8D%E5%B9%B3%E8%A1%A1"><span class="toc-number">5.4.</span> <span class="toc-text">åˆ†åŒºå¹³è¡¡ä»¥åŠå†å¹³è¡¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5"><span class="toc-number">5.4.1.</span> <span class="toc-text">åˆ†åŒºåˆ†é…ç­–ç•¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Range"><span class="toc-number">5.4.2.</span> <span class="toc-text">Range</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RoundRobin"><span class="toc-number">5.4.3.</span> <span class="toc-text">RoundRobin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Sticky%EF%BC%9A"><span class="toc-number">5.4.4.</span> <span class="toc-text">Stickyï¼š</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#offset%E4%BD%8D%E7%A7%BB%E6%8F%90%E4%BA%A4"><span class="toc-number">5.5.</span> <span class="toc-text">offsetä½ç§»æäº¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#offset-%E7%9A%84%E9%BB%98%E8%AE%A4%E7%BB%B4%E6%8A%A4%E4%BD%8D%E7%BD%AE"><span class="toc-number">5.5.1.</span> <span class="toc-text">offset çš„é»˜è®¤ç»´æŠ¤ä½ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BA%A4"><span class="toc-number">5.5.2.</span> <span class="toc-text">è‡ªåŠ¨æäº¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E6%8F%90%E4%BA%A4"><span class="toc-number">5.5.3.</span> <span class="toc-text">æ‰‹åŠ¨æäº¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E6%B6%88%E8%B4%B9%E4%BD%8D%E7%BD%AE"><span class="toc-number">5.5.4.</span> <span class="toc-text">æŒ‡å®šæ¶ˆè´¹ä½ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B6%88%E8%B4%B9%E5%92%8C%E9%87%8D%E5%A4%8D%E6%B6%88%E8%B4%B9"><span class="toc-number">5.5.5.</span> <span class="toc-text">æ¼æ¶ˆè´¹å’Œé‡å¤æ¶ˆè´¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%88%E8%B4%B9%E8%80%85%E4%BA%8B%E5%8A%A1"><span class="toc-number">5.6.</span> <span class="toc-text">æ¶ˆè´¹è€…äº‹åŠ¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%A7%AF%E5%8E%8B%EF%BC%88%E6%8F%90%E9%AB%98%E5%90%9E%E5%90%90%E9%87%8F%EF%BC%89"><span class="toc-number">5.7.</span> <span class="toc-text">æ•°æ®ç§¯å‹ï¼ˆæé«˜ååé‡ï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">5.8.</span> <span class="toc-text">æ‹¦æˆªå™¨</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka%E6%95%B4%E5%90%88Spring-Boot"><span class="toc-number">6.</span> <span class="toc-text">Kafkaæ•´åˆSpring Boot</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka-Consumer%E9%85%8D%E7%BD%AE"><span class="toc-number">7.</span> <span class="toc-text">Kafka Consumeré…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E6%B6%88%E8%B4%B9%E8%80%85%E9%85%8D%E7%BD%AE"><span class="toc-number">7.1.</span> <span class="toc-text">æ–°æ¶ˆè´¹è€…é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kafka-2-0-0"><span class="toc-number">7.2.</span> <span class="toc-text">kafka &gt;&#x3D; 2.0.0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kafka-2-1-0"><span class="toc-number">7.3.</span> <span class="toc-text">kafka &gt;&#x3D; 2.1.0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kafka-2-7"><span class="toc-number">7.4.</span> <span class="toc-text">kafka &gt;&#x3D; 2.7</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A7%E6%B6%88%E8%B4%B9%E8%80%85%E9%85%8D%E7%BD%AE"><span class="toc-number">7.5.</span> <span class="toc-text">æ—§æ¶ˆè´¹è€…é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kafka-Producer%E9%85%8D%E7%BD%AE"><span class="toc-number">8.</span> <span class="toc-text">Kafka Produceré…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85%E9%85%8D%E7%BD%AE"><span class="toc-number">8.1.</span> <span class="toc-text">ç”Ÿäº§è€…é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kafka-2-0-0-1"><span class="toc-number">8.2.</span> <span class="toc-text">kafka &gt;&#x3D; 2.0.0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kafka-2-1-0-1"><span class="toc-number">8.3.</span> <span class="toc-text">kafka &gt;&#x3D; 2.1.0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kafka-2-7-1"><span class="toc-number">8.4.</span> <span class="toc-text">kafka &gt;&#x3D; 2.7</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/d31147a5/" title="Clawdbotå®Œæ•´é…ç½®æŒ‡å—"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo16.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Clawdbotå®Œæ•´é…ç½®æŒ‡å—"></a><div class="content"><a class="title" href="/posts/d31147a5/" title="Clawdbotå®Œæ•´é…ç½®æŒ‡å—">Clawdbotå®Œæ•´é…ç½®æŒ‡å—</a><time datetime="2026-02-11T10:15:08.000Z" title="å‘è¡¨äº 2026-02-11 18:15:08">2026-02-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4d3a9a89/" title="å¤„ç† Rancher è¿æ¥èŠ‚ç‚¹ &quot;Cluster agent is not connected&quot;"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo29.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="å¤„ç† Rancher è¿æ¥èŠ‚ç‚¹ &quot;Cluster agent is not connected&quot;"></a><div class="content"><a class="title" href="/posts/4d3a9a89/" title="å¤„ç† Rancher è¿æ¥èŠ‚ç‚¹ &quot;Cluster agent is not connected&quot;">å¤„ç† Rancher è¿æ¥èŠ‚ç‚¹ &quot;Cluster agent is not connected&quot;</a><time datetime="2026-02-03T06:02:28.000Z" title="å‘è¡¨äº 2026-02-03 14:02:28">2026-02-03</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/nba-logo20.jpg)"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2019 - 2026 By å°äº”</span><span class="framework-info"><span>æ¡†æ¶</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.1</a></span></div><div class="footer_custom_text"><a href="https://www.foreverblog.cn/" rel="external nofollow noreferrer" target="_blank"><img src="/img/loading.gif" data-lazy-src="https://img.foreverblog.cn/logo_en_default.png" alt="åå¹´ä¹‹çº¦" style="width:auto;height:16px"></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.1/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.1/source/js/main.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.1/source/js/tw_cn.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(()=>{const e=()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");if(0===e.length)return;const t=()=>(e=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";e.forEach(((e,n)=>{const d=e.firstElementChild,a=`mermaid-${n}`,r=`%%{init:{ 'theme':'${t}'}}%%\n`+d.textContent,i=mermaid.render(a,r),m=e=>{d.insertAdjacentHTML("afterend",e)};"string"==typeof i?m(i):i.then((({svg:e})=>m(e)))}))})(e);btf.addGlobalFn("themeChange",t,"mermaid"),window.loadMermaid?t():btf.getScript("https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js").then(t)};btf.addGlobalFn("encrypt",e,"mermaid"),window.pjax?e():document.addEventListener("DOMContentLoaded",e)})()</script><script>(()=>{const t=(e,a)=>{"object"==typeof e&&null!==e&&Object.keys(e).forEach((r=>{const n=e[r];"object"==typeof n&&null!==n&&(n[a]?e[r]=n[a]:t(n,a))}))},e=e=>{window.loadChartJS=!0,Array.from(e).forEach(((e,a)=>{const r=e.firstElementChild,n=e.getAttribute("data-chartjs-id")||"chartjs-"+a,d=e.getAttribute("data-width"),o=document.getElementById(n);o&&o.parentNode.remove();const c=r.textContent,l=document.createElement("canvas");l.id=n;const s=document.createElement("div");s.className="chartjs-wrap",d&&(s.style.width=d),s.appendChild(l),r.insertAdjacentElement("afterend",s);const h=document.getElementById(n).getContext("2d"),i=JSON.parse(c),m="dark"===document.documentElement.getAttribute("data-theme")?"dark-mode":"light-mode";(t=>{"dark-mode"===t?(Chart.defaults.color="rgba(255, 255, 255, 0.8)",Chart.defaults.borderColor="rgba(255, 255, 255, 0.2)",Chart.defaults.scale.ticks.backdropColor="transparent"):(Chart.defaults.color="rgba(0, 0, 0, 0.8)",Chart.defaults.borderColor="rgba(0, 0, 0, 0.1)",Chart.defaults.scale.ticks.backdropColor="transparent")})(m),t(i,m),new Chart(h,i)}))},a=()=>{const t=document.querySelectorAll("#article-container .chartjs-container");0!==t.length&&(window.loadChartJS?e(t):btf.getScript("https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js").then((()=>e(t))))};btf.addGlobalFn("themeChange",a,"chartjs"),btf.addGlobalFn("encrypt",a,"chartjs"),window.pjax?a():document.addEventListener("DOMContentLoaded",a)})()</script></div><div class="aplayer no-destroy" data-id="9061017364" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listfolded="false" data-order="random" data-lrctype="1" data-preload="none" data-autoplay="false" muted></div><div class="app-refresh" id="app-refresh"><div class="app-refresh-wrap"><label>ç½‘ç«™å·²æ›´æ–°æœ€æ–°ç‰ˆæœ¬</label> <a href="javascript:void(0)" rel="external nofollow noreferrer" onclick="location.reload()">ç‚¹å‡»åˆ·æ–°</a></div></div><script>function showNotification(){if(GLOBAL_CONFIG.Snackbar){var t="light"===document.documentElement.getAttribute("data-theme")?GLOBAL_CONFIG.Snackbar.bgLight:GLOBAL_CONFIG.Snackbar.bgDark,e=GLOBAL_CONFIG.Snackbar.position;Snackbar.show({text:"å·²æ›´æ–°æœ€æ–°ç‰ˆæœ¬",backgroundColor:t,duration:5e5,pos:e,actionText:"ç‚¹å‡»åˆ·æ–°",actionTextColor:"#fff",onActionClick:function(t){location.reload()}})}else{var o=`top: 0; background: ${"light"===document.documentElement.getAttribute("data-theme")?"#49b1f5":"#1f1f1f"};`;document.getElementById("app-refresh").style.cssText=o}}"serviceWorker"in navigator&&(navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("controllerchange",(function(){showNotification()})),window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js")})))</script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="/js/diytitle.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!0,document.body.addEventListener("input",POWERMODE)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/metingjs/dist/Meting.min.js"></script><script>btf.addGlobalFn("pjaxSend",(()=>{if(window.aplayers)for(let a=0;a<window.aplayers.length;a++)window.aplayers[a].options.fixed||window.aplayers[a].destroy()}),"destroyAplayer"),btf.addGlobalFn("pjaxComplete",loadMeting,"runMetingJS")</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>(()=>{window.pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/talking/"]):not([href="/artitalk/"])',selectors:['meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]','meta[property="og:description"]','link[rel="canonical"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"],cacheBust:!1,analytics:!0,scrollRestoration:!1});const e=e=>{e&&Object.values(e).forEach((e=>{try{e()}catch(e){console.debug("Pjax callback failed:",e)}}))};document.addEventListener("pjax:send",(()=>{btf.removeGlobalFnEvent("pjaxSendOnce"),btf.removeGlobalFnEvent("themeChange");const t=document.body.classList;t.contains("read-mode")&&t.remove("read-mode"),e(window.globalFn.pjaxSend)})),document.addEventListener("pjax:complete",(()=>{btf.removeGlobalFnEvent("pjaxCompleteOnce"),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),a=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(a)),e.parentNode.replaceChild(t,e)})),e(window.globalFn.pjaxComplete)})),document.addEventListener("pjax:error",(e=>{if(404===e.request.status){!0?pjax.loadUrl("/404"):window.location.href="/404"}}))})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div id="algolia-search-input"><div class="ais-SearchBox"><form class="ais-SearchBox-form" action="" role="search" novalidate><input class="ais-SearchBox-input" type="search" placeholder="æœç´¢æ–‡ç« " autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" maxlength="512" aria-label="Search"><button class="ais-SearchBox-submit" type="submit" title="Submit the search query" style="display:none"><svg class="ais-SearchBox-submitIcon" width="10" height="10" viewBox="0 0 40 40" aria-hidden="true"><path d="M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z"></path></svg></button></form></div><hr><div id="algolia-search-results"><div id="algolia-hits"><div id="algolia-hits-empty" style="display:none"></div><div class="ais-Hits" style="display:none"><ol class="ais-Hits-list"></ol></div></div><div class="ais-Pagination" id="algolia-pagination" style="display:none"><ul class="ais-Pagination-list"></ul></div><div id="algolia-info"><span class="ais-Stats-text"></span><a class="algolia-poweredBy" href="https://www.algolia.com/?utm_source=algoliasearch.js&amp;utm_medium=website&amp;utm_content=localhost&amp;utm_campaign=poweredby" target="_blank" aria-label="Search by Algolia" rel="noopener noreferrer"><svg class="ais-PoweredBy-logo" height="1.2em" viewBox="0 0 572 64" style="width:auto"><path fill="#36395A" d="M16 48.3c-3.4 0-6.3-.6-8.7-1.7A12.4 12.4 0 0 1 1.9 42C.6 40 0 38 0 35.4h6.5a6.7 6.7 0 0 0 3.9 6c1.4.7 3.3 1.1 5.6 1.1 2.2 0 4-.3 5.4-1a7 7 0 0 0 3-2.4 6 6 0 0 0 1-3.4c0-1.5-.6-2.8-1.9-3.7-1.3-1-3.3-1.6-5.9-1.8l-4-.4c-3.7-.3-6.6-1.4-8.8-3.4a10 10 0 0 1-3.3-7.9c0-2.4.6-4.6 1.8-6.4a12 12 0 0 1 5-4.3c2.2-1 4.7-1.6 7.5-1.6s5.5.5 7.6 1.6a12 12 0 0 1 5 4.4c1.2 1.8 1.8 4 1.8 6.7h-6.5a6.4 6.4 0 0 0-3.5-5.9c-1-.6-2.6-1-4.4-1s-3.2.3-4.4 1c-1.1.6-2 1.4-2.6 2.4-.5 1-.8 2-.8 3.1a5 5 0 0 0 1.5 3.6c1 1 2.6 1.7 4.7 1.9l4 .3c2.8.2 5.2.8 7.2 1.8 2.1 1 3.7 2.2 4.9 3.8a9.7 9.7 0 0 1 1.7 5.8c0 2.5-.7 4.7-2 6.6a13 13 0 0 1-5.6 4.4c-2.4 1-5.2 1.6-8.4 1.6Zm35.6 0c-2.6 0-4.8-.4-6.7-1.3a13 13 0 0 1-4.7-3.5 17.1 17.1 0 0 1-3.6-10.4v-1c0-2 .3-3.8 1-5.6a13 13 0 0 1 7.3-8.3 15 15 0 0 1 6.3-1.4A13.2 13.2 0 0 1 64 24.3c1 2.2 1.6 4.6 1.6 7.2V34H39.4v-4.3h21.8l-1.8 2.2c0-2-.3-3.7-.9-5.1a7.3 7.3 0 0 0-2.7-3.4c-1.2-.7-2.7-1.1-4.6-1.1s-3.4.4-4.7 1.3a8 8 0 0 0-2.9 3.6c-.6 1.5-.9 3.3-.9 5.4 0 2 .3 3.7 1 5.3a7.9 7.9 0 0 0 2.8 3.7c1.3.8 3 1.3 5 1.3s3.8-.5 5.1-1.3c1.3-1 2.1-2 2.4-3.2h6a11.8 11.8 0 0 1-7 8.7 16 16 0 0 1-6.4 1.2ZM80 48c-2.2 0-4-.3-5.7-1a8.4 8.4 0 0 1-3.7-3.3 9.7 9.7 0 0 1-1.3-5.2c0-2 .5-3.8 1.5-5.2a9 9 0 0 1 4.3-3.1c1.8-.7 4-1 6.7-1H89v4.1h-7.5c-2 0-3.4.5-4.4 1.4-1 1-1.6 2.1-1.6 3.6s.5 2.7 1.6 3.6c1 1 2.5 1.4 4.4 1.4 1.1 0 2.2-.2 3.2-.7 1-.4 1.9-1 2.6-2 .6-1 1-2.4 1-4.2l1.7 2.1c-.2 2-.7 3.8-1.5 5.2a9 9 0 0 1-3.4 3.3 12 12 0 0 1-5.3 1Zm9.5-.7v-8.8h-1v-10c0-1.8-.5-3.2-1.4-4.1-1-1-2.4-1.4-4.2-1.4a142.9 142.9 0 0 0-10.2.4v-5.6a74.8 74.8 0 0 1 8.6-.4c3 0 5.5.4 7.5 1.2s3.4 2 4.4 3.6c1 1.7 1.4 4 1.4 6.7v18.4h-5Zm12.9 0V17.8h5v12.3h-.2c0-4.2 1-7.4 2.8-9.5a11 11 0 0 1 8.3-3.1h1v5.6h-2a9 9 0 0 0-6.3 2.2c-1.5 1.5-2.2 3.6-2.2 6.4v15.6h-6.4Zm34.4 1a15 15 0 0 1-6.6-1.3c-1.9-.9-3.4-2-4.7-3.5a15.5 15.5 0 0 1-2.7-5c-.6-1.7-1-3.6-1-5.4v-1c0-2 .4-3.8 1-5.6a15 15 0 0 1 2.8-4.9c1.3-1.5 2.8-2.6 4.6-3.5a16.4 16.4 0 0 1 13.3.2c2 1 3.5 2.3 4.8 4a12 12 0 0 1 2 6H144c-.2-1.6-1-3-2.2-4.1a7.5 7.5 0 0 0-5.2-1.7 8 8 0 0 0-4.7 1.3 8 8 0 0 0-2.8 3.6 13.8 13.8 0 0 0 0 10.3c.6 1.5 1.5 2.7 2.8 3.6s2.8 1.3 4.8 1.3c1.5 0 2.7-.2 3.8-.8a7 7 0 0 0 2.6-2c.7-1 1-2 1.2-3.2h6.2a11 11 0 0 1-2 6.2 15.1 15.1 0 0 1-11.8 5.5Zm19.7-1v-40h6.4V31h-1.3c0-3 .4-5.5 1.1-7.6a9.7 9.7 0 0 1 3.5-4.8A9.9 9.9 0 0 1 172 17h.3c3.5 0 6 1.1 7.9 3.5 1.7 2.3 2.6 5.7 2.6 10v16.8h-6.4V29.6c0-2.1-.6-3.8-1.8-5a6.4 6.4 0 0 0-4.8-1.8c-2 0-3.7.7-5 2a7.8 7.8 0 0 0-1.9 5.5v17h-6.4Zm63.8 1a12.2 12.2 0 0 1-10.9-6.2 19 19 0 0 1-1.8-7.3h1.4v12.5h-5.1v-40h6.4v19.8l-2 3.5c.2-3.1.8-5.7 1.9-7.7a11 11 0 0 1 4.4-4.5c1.8-1 3.9-1.5 6.1-1.5a13.4 13.4 0 0 1 12.8 9.1c.7 1.9 1 3.8 1 6v1c0 2.2-.3 4.1-1 6a13.6 13.6 0 0 1-13.2 9.4Zm-1.2-5.5a8.4 8.4 0 0 0 7.9-5c.7-1.5 1.1-3.3 1.1-5.3s-.4-3.8-1.1-5.3a8.7 8.7 0 0 0-3.2-3.6 9.6 9.6 0 0 0-9.2-.2 8.5 8.5 0 0 0-3.3 3.2c-.8 1.4-1.3 3-1.3 5v2.3a9 9 0 0 0 1.3 4.8 9 9 0 0 0 3.4 3c1.4.7 2.8 1 4.4 1Zm27.3 3.9-10-28.9h6.5l9.5 28.9h-6Zm-7.5 12.2v-5.7h4.9c1 0 2-.1 2.9-.4a4 4 0 0 0 2-1.4c.4-.7.9-1.6 1.2-2.7l8.6-30.9h6.2l-9.3 32.4a14 14 0 0 1-2.5 5 8.9 8.9 0 0 1-4 2.8c-1.5.6-3.4.9-5.6.9h-4.4Zm9-12.2v-5.2h6.4v5.2H248Z"></path><path fill="#003DFF" d="M534.4 9.1H528a.8.8 0 0 1-.7-.7V1.8c0-.4.2-.7.6-.8l6.5-1c.4 0 .8.2.9.6v7.8c0 .4-.4.7-.8.7zM428 35.2V.8c0-.5-.3-.8-.7-.8h-.2l-6.4 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.5 0 .8-.4.8-.8V43c0-.4-.3-.7-.6-.8-4.5-.5-4.5-6-4.5-7zm106.5-21.8H528c-.4 0-.7.4-.7.8v34c0 .4.3.8.7.8h6.5c.4 0 .8-.4.8-.8v-34c0-.5-.4-.8-.8-.8zm-17.7 21.8V.8c0-.5-.3-.8-.8-.8l-6.5 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.4 0 .8-.4.8-.8V43c0-.4-.3-.7-.7-.8-4.4-.5-4.4-6-4.4-7zm-22.2-20.6a16.5 16.5 0 0 1 8.6 9.3c.8 2.2 1.3 4.8 1.3 7.5a19.4 19.4 0 0 1-4.6 12.6 14.8 14.8 0 0 1-5.2 3.6c-2 .9-5.2 1.4-6.8 1.4a21 21 0 0 1-6.7-1.4 15.4 15.4 0 0 1-8.6-9.3 21.3 21.3 0 0 1 0-14.4 15.2 15.2 0 0 1 8.6-9.3c2-.8 4.3-1.2 6.7-1.2s4.6.4 6.7 1.2zm-6.7 27.6c2.7 0 4.7-1 6.2-3s2.2-4.3 2.2-7.8-.7-6.3-2.2-8.3-3.5-3-6.2-3-4.7 1-6.1 3c-1.5 2-2.2 4.8-2.2 8.3s.7 5.8 2.2 7.8 3.5 3 6.2 3zm-88.8-28.8c-6.2 0-11.7 3.3-14.8 8.2a18.6 18.6 0 0 0 4.8 25.2c1.8 1.2 4 1.8 6.2 1.7s.1 0 .1 0h.9c4.2-.7 8-4 9.1-8.1v7.4c0 .4.3.7.8.7h6.4a.7.7 0 0 0 .7-.7V14.2c0-.5-.3-.8-.7-.8h-13.5zm6.3 26.5a9.8 9.8 0 0 1-5.7 2h-.5a10 10 0 0 1-9.2-14c1.4-3.7 5-6.3 9-6.3h6.4v18.3zm152.3-26.5h13.5c.5 0 .8.3.8.7v33.7c0 .4-.3.7-.8.7h-6.4a.7.7 0 0 1-.8-.7v-7.4c-1.2 4-4.8 7.4-9 8h-.1a4.2 4.2 0 0 1-.5.1h-.9a10.3 10.3 0 0 1-7-2.6c-4-3.3-6.5-8.4-6.5-14.2 0-3.7 1-7.2 3-10 3-5 8.5-8.3 14.7-8.3zm.6 28.4c2.2-.1 4.2-.6 5.7-2V21.7h-6.3a9.8 9.8 0 0 0-9 6.4 10.2 10.2 0 0 0 9.1 13.9h.5zM452.8 13.4c-6.2 0-11.7 3.3-14.8 8.2a18.5 18.5 0 0 0 3.6 24.3 10.4 10.4 0 0 0 13 .6c2.2-1.5 3.8-3.7 4.5-6.1v7.8c0 2.8-.8 5-2.2 6.3-1.5 1.5-4 2.2-7.5 2.2l-6-.3c-.3 0-.7.2-.8.5l-1.6 5.5c-.1.4.1.8.5 1h.1c2.8.4 5.5.6 7 .6 6.3 0 11-1.4 14-4.1 2.7-2.5 4.2-6.3 4.5-11.4V14.2c0-.5-.4-.8-.8-.8h-13.5zm6.3 8.2v18.3a9.6 9.6 0 0 1-5.6 2h-1a10.3 10.3 0 0 1-8.8-14c1.4-3.7 5-6.3 9-6.3h6.4zM291 31.5A32 32 0 0 1 322.8 0h30.8c.6 0 1.2.5 1.2 1.2v61.5c0 1.1-1.3 1.7-2.2 1l-19.2-17a18 18 0 0 1-11 3.4 18.1 18.1 0 1 1 18.2-14.8c-.1.4-.5.7-.9.6-.1 0-.3 0-.4-.2l-3.8-3.4c-.4-.3-.6-.8-.7-1.4a12 12 0 1 0-2.4 8.3c.4-.4 1-.5 1.6-.2l14.7 13.1v-46H323a26 26 0 1 0 10 49.7c.8-.4 1.6-.2 2.3.3l3 2.7c.3.2.3.7 0 1l-.2.2a32 32 0 0 1-47.2-28.6z"></path></svg></a></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@5.39.0/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.1/source/js/search/algolia.min.js"></script></div></div><script data-pjax>if(document.getElementById("recent-posts")&&"/"==location.pathname){var parent=document.getElementById("recent-posts"),child='<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo3.jpg" alt="/img/nba-logo3.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2024-02-02</span><a class="blog-slider__title" href="posts/1bcb0ad4/">å•ç¯å¢ƒ,å¤šåˆ†æ”¯å¹¶è¡Œå¼€å‘æ–¹æ¡ˆ(æµé‡æŸ“è‰²/istio)</a><div class="blog-slider__text">å•ç¯å¢ƒ,å¤šåˆ†æ”¯å¹¶è¡Œå¼€å‘æ–¹æ¡ˆ(æµé‡æŸ“è‰²/istio)</div><a class="blog-slider__button" href="posts/1bcb0ad4/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="/img/nba-logo22.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-06-14</span><a class="blog-slider__title" href="posts/aa43cc95/">è®°å½•k8sç¯å¢ƒä¸‹ç»“åˆalinodeçš„ä½¿ç”¨</a><div class="blog-slider__text">è®°å½•k8sç¯å¢ƒä¸‹ç»“åˆalinodeçš„ä½¿ç”¨</div><a class="blog-slider__button" href="posts/aa43cc95/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo29.jpg" alt="/img/nba-logo29.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-12-13</span><a class="blog-slider__title" href="posts/15957791/">k8sç¯å¢ƒä¸‹,nginxåšwebsocketè´Ÿè½½çš„æ–¹æ¡ˆæ¢³ç†</a><div class="blog-slider__text">k8sç¯å¢ƒä¸‹,nginxåšwebsocketè´Ÿè½½çš„æ–¹æ¡ˆæ¢³ç†</div><a class="blog-slider__button" href="posts/15957791/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="/img/nba-logo22.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-09-26</span><a class="blog-slider__title" href="posts/4ecfb081/">è®°å½•ä¸€æ¬¡k8sç½‘ç»œDNSé—®é¢˜æ’æŸ¥è¿‡ç¨‹</a><div class="blog-slider__text">è®°å½•ä¸€æ¬¡k8sç½‘ç»œDNSé—®é¢˜æ’æŸ¥è¿‡ç¨‹</div><a class="blog-slider__button" href="posts/4ecfb081/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="/img/nba-logo22.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-09-26</span><a class="blog-slider__title" href="posts/37032a87/">k3sé«˜å¯ç”¨å®‰è£…</a><div class="blog-slider__text">k3sé«˜å¯ç”¨å®‰è£…</div><a class="blog-slider__button" href="posts/37032a87/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo5.jpg" alt="/img/nba-logo5.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-11-27</span><a class="blog-slider__title" href="posts/20b19ed4/">åˆ†è¯æœç´¢éœ€æ±‚æ•´ç†</a><div class="blog-slider__text">åˆ†è¯æœç´¢éœ€æ±‚æ•´ç†</div><a class="blog-slider__button" href="posts/20b19ed4/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo26.jpg" alt="/img/nba-logo26.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-12-02</span><a class="blog-slider__title" href="posts/6de14387/">æ•´ç†wsl2é…åˆå¼€å‘çš„ä¸€äº›é…ç½®</a><div class="blog-slider__text">æ•´ç†wsl2é…åˆå¼€å‘çš„ä¸€äº›é…ç½®</div><a class="blog-slider__button" href="posts/6de14387/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="/img/nba-logo22.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-12-11</span><a class="blog-slider__title" href="posts/fb9adcb6/">è®°å½•windows11+wsl2ç¯å¢ƒæ­é…</a><div class="blog-slider__text">windows11+wsl2å¼€å‘ç¯å¢ƒé…ç½®</div><a class="blog-slider__button" href="posts/fb9adcb6/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo26.jpg" alt="/img/nba-logo26.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2026-01-28</span><a class="blog-slider__title" href="posts/2a9d73ff/">æ•™ä½ å¦‚ä½•é›¶æˆæœ¬ä»0åˆ°1ï¼Œå¼€å‘ä¸Šçº¿ä¸€ä¸ªå¯¹æ¥äº†openAIçš„æœºå™¨äºº</a><div class="blog-slider__text">æ•™ä½ å¦‚ä½•é›¶æˆæœ¬ä»0åˆ°1ï¼Œå¼€å‘ä¸Šçº¿ä¸€ä¸ªå¯¹æ¥äº†openAIçš„æœºå™¨äºº</div><a class="blog-slider__button" href="posts/2a9d73ff/">è¯¦æƒ…</a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';console.log("å·²æŒ‚è½½swiper"),parent.insertAdjacentHTML("afterbegin",child)}</script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper@0.18/swiper/swiperindex.js"></script><style></style><script data-pjax>function history_calendar_injector_config(){var i=document.getElementsByClassName("sticky_layout")[0];console.log("å·²æŒ‚è½½history_calendar"),i.insertAdjacentHTML("afterbegin",'<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>é‚£å¹´ä»Šæ—¥</span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>')}document.getElementsByClassName("sticky_layout")[0]&&"/"===location.pathname&&history_calendar_injector_config()</script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"right",width:150,height:300,hOffset:20,vOffset:-20},mobile:{show:!0},log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/"})</script></body></html>