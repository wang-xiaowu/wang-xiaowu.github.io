<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Pod/Nodeäº²å’Œæ€§å’Œåäº²å’Œæ€§éƒ¨ç½² | å°äº”çš„ä¸ªäººæ‚è´§é“º</title><meta name="author" content="å°äº”"><meta name="copyright" content="å°äº”"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="å‚è€ƒï¼šhttps:&#x2F;&#x2F;cloud.tencent.com&#x2F;developer&#x2F;article&#x2F;1746649   Kubernetes K8Sä¹‹NodeèŠ‚ç‚¹äº²å’Œæ€§ä¸åäº²å’Œæ€§ä»¥åŠPodäº²å’Œæ€§ä¸åäº²å’Œæ€§è¯¦è§£ä¸ç¤ºä¾‹   ä¸»æœºé…ç½®è§„åˆ’   æœåŠ¡å™¨åç§°(hostname) ç³»ç»Ÿç‰ˆæœ¬ é…ç½® å†…ç½‘IP å¤–ç½‘IP(æ¨¡æ‹Ÿ)    k8s-master CentOS7.7 2C&#x2F;4G&#x2F;20G 17"><meta property="og:type" content="article"><meta property="og:title" content="Pod&#x2F;Nodeäº²å’Œæ€§å’Œåäº²å’Œæ€§éƒ¨ç½²"><meta property="og:url" content="https://xiaowu95.wang/posts/90513b00/"><meta property="og:site_name" content="å°äº”çš„ä¸ªäººæ‚è´§é“º"><meta property="og:description" content="å‚è€ƒï¼šhttps:&#x2F;&#x2F;cloud.tencent.com&#x2F;developer&#x2F;article&#x2F;1746649   Kubernetes K8Sä¹‹NodeèŠ‚ç‚¹äº²å’Œæ€§ä¸åäº²å’Œæ€§ä»¥åŠPodäº²å’Œæ€§ä¸åäº²å’Œæ€§è¯¦è§£ä¸ç¤ºä¾‹   ä¸»æœºé…ç½®è§„åˆ’   æœåŠ¡å™¨åç§°(hostname) ç³»ç»Ÿç‰ˆæœ¬ é…ç½® å†…ç½‘IP å¤–ç½‘IP(æ¨¡æ‹Ÿ)    k8s-master CentOS7.7 2C&#x2F;4G&#x2F;20G 17"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://xiaowu95.wang/img/nba-logo17.jpg"><meta property="article:published_time" content="2023-11-03T10:04:07.000Z"><meta property="article:modified_time" content="2023-11-06T07:44:08.000Z"><meta property="article:author" content="å°äº”"><meta property="article:tag" content="k8s"><meta property="article:tag" content="å®¹å™¨åŒ–"><meta property="article:tag" content="k3s"><meta property="article:tag" content="rancher"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://xiaowu95.wang/img/nba-logo17.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Pod/Nodeäº²å’Œæ€§å’Œåäº²å’Œæ€§éƒ¨ç½²",
  "url": "https://xiaowu95.wang/posts/90513b00/",
  "image": "https://xiaowu95.wang/img/nba-logo17.jpg",
  "datePublished": "2023-11-03T10:04:07.000Z",
  "dateModified": "2023-11-06T07:44:08.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "å°äº”",
      "url": "https://xiaowu95.wang"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://xiaowu95.wang/posts/90513b00/"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="kHfLZxYQ7y3s3AR7gyJDdJkQvGNjQsvopp6N3gEEx0s"><meta name="baidu-site-verification" content="codeva-aVS4F6wAjS"><link rel="manifest" href="/wang-xiaowu/pwa/site.webmanifest"><meta name="msapplication-TileColor" content="#fff"><link rel="apple-touch-icon" sizes="180x180" href="/wang-xiaowu/pwa/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/wang-xiaowu/pwa/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/wang-xiaowu/pwa/favicon-16x16.png"><link rel="mask-icon" href="/wang-xiaowu/pwa/safari-pinned-tab.svg" color="#5bbad5"><link rel="stylesheet" href="/css/index.css?v=5.5.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.33/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise(((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach((([e,t])=>n.setAttribute(e,t))),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)})),getCSS:(e,t)=>new Promise(((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)})),addGlobalFn:(e,t,o=!1,a=window)=>{const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),c=window.matchMedia("(prefers-color-scheme: dark)"),r=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(r.matches)a();else if(c.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}c.addEventListener("change",(()=>{void 0===t.get("theme")&&(e.matches?o():a())}))}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?86cb34987e15c900c39e12ebdf08c50d";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),btf.addGlobalFn("pjaxComplete",(()=>{_hmt.push(["_trackPageview",window.location.pathname])}),"baidu_analytics")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-1MFQ47191J"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-1MFQ47191J"),btf.addGlobalFn("pjaxComplete",(()=>{gtag("config","G-1MFQ47191J",{page_path:window.location.pathname})}),"google_analytics")</script><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"M91QAWRVY4",apiKey:"ecc30a5e06136e1cc491685e39801190",indexName:"xiaowu-blog",hitsPerPage:6,languages:{hits_empty:"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}",hits_stats:"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œè€—æ—¶ ${time} æ¯«ç§’"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"ç¹",msgToSimplifiedChinese:"ç°¡"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:400,highlightFullpage:!0,highlightMacStyle:!0},copy:{success:"å¤åˆ¶æˆåŠŸ",error:"å¤åˆ¶å¤±è´¥",noSupport:"æµè§ˆå™¨ä¸æ”¯æŒ"},relativeDate:{homepage:!0,post:!0},runtime:"å¤©",dateSuffix:{just:"åˆšåˆš",min:"åˆ†é’Ÿå‰",hour:"å°æ—¶å‰",day:"å¤©å‰",month:"ä¸ªæœˆå‰"},copyright:{limitCount:150,languages:{author:"ä½œè€…: å°äº”",link:"é“¾æ¥: ",source:"æ¥æº: å°äº”çš„ä¸ªäººæ‚è´§é“º",info:"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"å·²åˆ‡æ¢ä¸ºç¹ä½“ä¸­æ–‡",cht_to_chs:"å·²åˆ‡æ¢ä¸ºç®€ä½“ä¸­æ–‡",day_to_night:"å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼",night_to_day:"å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"åŠ è½½æ›´å¤š"},isPhotoFigcaption:!1,islazyloadPlugin:!0,isAnchor:!0,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Pod/Nodeäº²å’Œæ€§å’Œåäº²å’Œæ€§éƒ¨ç½²",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><script src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><link rel="stylesheet" href="/css/font.css"><style>.app-refresh{position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease}.app-refresh-wrap{display:flex;color:#fff;height:100%;align-items:center;justify-content:center}.app-refresh-wrap a{color:#fff;text-decoration:underline;cursor:pointer}</style><link rel="stylesheet" href="/css/titleStyle.css"><link rel="stylesheet" href="/css/mouse.css"><link rel="stylesheet" href="/css/custom.css"><style>.card-announcement .social-button{margin:.6rem 0 0 0;text-align:center}.card-announcement .social-button a{display:block;background-color:var(--btn-bg);color:var(--btn-color);text-align:center;line-height:2.4;margin:4px 0}.card-announcement .social-button a:hover{background-color:var(--btn-hover-color)}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiperstyle.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="alternate" href="/atom.xml" title="å°äº”çš„ä¸ªäººæ‚è´§é“º" type="application/atom+xml"></head><body><script>window.paceOptions={restartOnPushState:!1},btf.addGlobalFn("pjaxSend",(()=>{Pace.restart()}),"pace_restart")</script><link rel="stylesheet" href="/css/pace.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-lazy-src="/img/avatar.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">554</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">168</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">55</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/github/"><i class="fa-fw fa-solid fa-address-card"></i> <span>å…³äºæˆ‘</span></a></div><div class="menus_item"><a class="site-page" href="/ac/"><i class="fa-fw fa-solid fa-wind"></i> <span>ä¾¿æºå°ç©ºè°ƒ</span></a></div><div class="menus_item"><a class="site-page" href="/talking/"><i class="fa-fw fa-solid fa-walkie-talkie"></i> <span>åšå®¢çŸ­è®°</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i> <span>ç›®å½•</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-otter"></i> <span>æ‚è®°</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/songs/"><i class="fa-fw fas fa-music"></i> <span>éŸ³ä¹</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>å›¾åº“</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa-solid fa-film"></i> <span>å½±è§†|ç•ªå‰§</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book faa-fload"></i> <span>ä¹¦å•</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad faa-fload"></i> <span>æ¸¸æˆ</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-bilibili"></i> <span>BiliBiliè¿½ç•ª</span></a></li><li><a class="site-page child" href="/cinemas/"><i class="fa-fw fa-solid fa-video"></i> <span>BiliBiliè¿½å‰§</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i> <span>ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-user-group"></i> <span>å‹é“¾</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-mug-saucer"></i> <span>Website Memo</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://console.leancloud.app/apps"><span>ğŸš€ LeanCloud</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.com/dashboard"><span>ğŸš€ Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://tongji.baidu.com/main/overview/10000432799/overview/index"><span>ğŸš€ ç™¾åº¦ç»Ÿè®¡</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://ziyuan.baidu.com/dashboard/index"><span>ğŸš€ ç™¾åº¦ç«™ç‚¹ç®¡ç†</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://analytics.google.com/analytics/web/"><span>ğŸš€ è°·æ­Œåˆ†æ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://search.google.com/search-console?hl=zh-cn"><span>ğŸš€ è°·æ­Œç«™ç‚¹ç®¡ç†</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.google.com/adsense/new/u/0/pub-1375421173355613/home"><span>ğŸš€ è°·æ­Œå¹¿å‘Šè”ç›Ÿ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.algolia.com/"><span>ğŸš€ Algolia</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://sms-activate.org/cn/"><span>ğŸš€ Sms-activate</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chatgpt.com/"><span>ğŸš€ ChatGPT</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://gemini.google.com/"><span>ğŸš€ Gemini</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://poe.com/"><span>ğŸš€ Poeèšåˆ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.idc.net/clientarea"><span>ğŸš€ åæµªäº‘</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.west.cn/"><span>ğŸš€ è¥¿éƒ¨æ•°æ®</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://shandianpro.com/#/dashboard"><span>ğŸš€ é—ªç”µ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.huojian.homes/"><span>ğŸš€ å°ç«ç®­</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/winston779/gougou"><span>ğŸš€ ç‹—ç‹—åŠ é€Ÿ</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/nba-logo17.jpg)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">å°äº”çš„ä¸ªäººæ‚è´§é“º</span></a><a class="nav-page-title" href="/"><span class="site-name">Pod/Nodeäº²å’Œæ€§å’Œåäº²å’Œæ€§éƒ¨ç½²</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i> <span>è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/github/"><i class="fa-fw fa-solid fa-address-card"></i> <span>å…³äºæˆ‘</span></a></div><div class="menus_item"><a class="site-page" href="/ac/"><i class="fa-fw fa-solid fa-wind"></i> <span>ä¾¿æºå°ç©ºè°ƒ</span></a></div><div class="menus_item"><a class="site-page" href="/talking/"><i class="fa-fw fa-solid fa-walkie-talkie"></i> <span>åšå®¢çŸ­è®°</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i> <span>ç›®å½•</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-otter"></i> <span>æ‚è®°</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/songs/"><i class="fa-fw fas fa-music"></i> <span>éŸ³ä¹</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>å›¾åº“</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa-solid fa-film"></i> <span>å½±è§†|ç•ªå‰§</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book faa-fload"></i> <span>ä¹¦å•</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad faa-fload"></i> <span>æ¸¸æˆ</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-bilibili"></i> <span>BiliBiliè¿½ç•ª</span></a></li><li><a class="site-page child" href="/cinemas/"><i class="fa-fw fa-solid fa-video"></i> <span>BiliBiliè¿½å‰§</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i> <span>ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-user-group"></i> <span>å‹é“¾</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-mug-saucer"></i> <span>Website Memo</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://console.leancloud.app/apps"><span>ğŸš€ LeanCloud</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.com/dashboard"><span>ğŸš€ Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://tongji.baidu.com/main/overview/10000432799/overview/index"><span>ğŸš€ ç™¾åº¦ç»Ÿè®¡</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://ziyuan.baidu.com/dashboard/index"><span>ğŸš€ ç™¾åº¦ç«™ç‚¹ç®¡ç†</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://analytics.google.com/analytics/web/"><span>ğŸš€ è°·æ­Œåˆ†æ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://search.google.com/search-console?hl=zh-cn"><span>ğŸš€ è°·æ­Œç«™ç‚¹ç®¡ç†</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.google.com/adsense/new/u/0/pub-1375421173355613/home"><span>ğŸš€ è°·æ­Œå¹¿å‘Šè”ç›Ÿ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.algolia.com/"><span>ğŸš€ Algolia</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://sms-activate.org/cn/"><span>ğŸš€ Sms-activate</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chatgpt.com/"><span>ğŸš€ ChatGPT</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://gemini.google.com/"><span>ğŸš€ Gemini</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://poe.com/"><span>ğŸš€ Poeèšåˆ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.idc.net/clientarea"><span>ğŸš€ åæµªäº‘</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.west.cn/"><span>ğŸš€ è¥¿éƒ¨æ•°æ®</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://shandianpro.com/#/dashboard"><span>ğŸš€ é—ªç”µ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.huojian.homes/"><span>ğŸš€ å°ç«ç®­</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/winston779/gougou"><span>ğŸš€ ç‹—ç‹—åŠ é€Ÿ</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Pod/Nodeäº²å’Œæ€§å’Œåäº²å’Œæ€§éƒ¨ç½²<a class="post-edit-link" href="https://github.com/wang-xiaowu/wang-xiaowu.github.io/issues/new?_posts/kubernetes/Pod,Nodeäº²å’Œæ€§å’Œåäº²å’Œæ€§éƒ¨ç½².md" rel="external nofollow noreferrer" title="ç¼–è¾‘" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2023-11-03T10:04:07.000Z" title="å‘è¡¨äº 2023-11-03 18:04:07">2023-11-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-11-06T07:44:08.000Z" title="æ›´æ–°äº 2023-11-06 15:44:08">2023-11-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/k8s/">k8s</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">7.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>37åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;è·ç¦»ä¸Šä¸€æ¬¡æ›´æ–°è¯¥æ–‡ç« å·²ç»è¿‡äº†&quot;,&quot;messageNext&quot;:&quot;å¤©ï¼Œæ–‡ç« æ‰€æè¿°çš„å…§å®¹å¯èƒ½å·²ç»å‘ç”Ÿå˜åŒ–ï¼Œè¯·ç•™æ„ã€‚&quot;,&quot;postUpdate&quot;:&quot;2023-11-06 15:44:08&quot;}" hidden></div><p>å‚è€ƒï¼š<a target="_blank" rel="noopener external nofollow noreferrer" href="https://cloud.tencent.com/developer/article/1746649">https://cloud.tencent.com/developer/article/1746649</a></p><blockquote><p>Kubernetes K8Sä¹‹NodeèŠ‚ç‚¹äº²å’Œæ€§ä¸åäº²å’Œæ€§ä»¥åŠPodäº²å’Œæ€§ä¸åäº²å’Œæ€§è¯¦è§£ä¸ç¤ºä¾‹</p></blockquote><h1 id="ä¸»æœºé…ç½®è§„åˆ’"><a href="#ä¸»æœºé…ç½®è§„åˆ’" class="headerlink" title="ä¸»æœºé…ç½®è§„åˆ’"></a>ä¸»æœºé…ç½®è§„åˆ’</h1><table><thead><tr><th align="left">æœåŠ¡å™¨åç§°(hostname)</th><th align="left">ç³»ç»Ÿç‰ˆæœ¬</th><th align="left">é…ç½®</th><th align="left">å†…ç½‘IP</th><th align="left">å¤–ç½‘IP(æ¨¡æ‹Ÿ)</th></tr></thead><tbody><tr><td align="left">k8s-master</td><td align="left">CentOS7.7</td><td align="left">2C&#x2F;4G&#x2F;20G</td><td align="left">172.16.1.110</td><td align="left">10.0.0.110</td></tr><tr><td align="left">k8s-node01</td><td align="left">CentOS7.7</td><td align="left">2C&#x2F;4G&#x2F;20G</td><td align="left">172.16.1.111</td><td align="left">10.0.0.111</td></tr><tr><td align="left">k8s-node02</td><td align="left">CentOS7.7</td><td align="left">2C&#x2F;4G&#x2F;20G</td><td align="left">172.16.1.112</td><td align="left">10.0.0.112</td></tr></tbody></table><h1 id="äº²å’Œæ€§å’Œåäº²å’Œæ€§"><a href="#äº²å’Œæ€§å’Œåäº²å’Œæ€§" class="headerlink" title="äº²å’Œæ€§å’Œåäº²å’Œæ€§"></a>äº²å’Œæ€§å’Œåäº²å’Œæ€§</h1><p>nodeSelectoræä¾›äº†ä¸€ç§éå¸¸ç®€å•çš„æ–¹æ³•ï¼Œå°†podsçº¦æŸåˆ°å…·æœ‰ç‰¹å®šæ ‡ç­¾çš„èŠ‚ç‚¹ã€‚è€Œäº²å’Œæ€§&#x2F;åäº²å’Œæ€§æå¤§åœ°æ‰©å±•äº†å¯è¡¨è¾¾çš„çº¦æŸç±»å‹ã€‚å…³é”®çš„å¢å¼ºæ˜¯ï¼š</p><p>1ã€äº²å’Œæ€§&#x2F;åäº²å’Œæ€§è¯­è¨€æ›´å…·è¡¨è¾¾æ€§ã€‚é™¤äº†ä½¿ç”¨é€»è¾‘ANDæ“ä½œåˆ›å»ºçš„ç²¾ç¡®åŒ¹é…ä¹‹å¤–ï¼Œè¯¥è¯­è¨€è¿˜æä¾›äº†æ›´å¤šçš„åŒ¹é…è§„åˆ™ï¼›</p><p>2ã€å¯ä»¥æŒ‡ç¤ºè§„åˆ™æ˜¯ä¼˜é€‰é¡¹è€Œä¸æ˜¯ç¡¬è¦æ±‚ï¼Œå› æ­¤å¦‚æœè°ƒåº¦å™¨ä¸èƒ½æ»¡è¶³ï¼Œpodä»å°†è¢«è°ƒåº¦ï¼›</p><p>3ã€å¯ä»¥é’ˆå¯¹èŠ‚ç‚¹ï¼ˆæˆ–å…¶ä»–æ‹“æ‰‘åŸŸï¼‰ä¸Šè¿è¡Œçš„podsçš„æ ‡ç­¾è¿›è¡Œçº¦æŸï¼Œè€Œä¸æ˜¯é’ˆå¯¹èŠ‚ç‚¹çš„è‡ªèº«æ ‡ç­¾ï¼Œè¿™å½±å“å“ªäº›Podå¯ä»¥æˆ–ä¸å¯ä»¥å…±å¤„ã€‚</p><p>äº²å’Œç‰¹æ€§åŒ…æ‹¬ä¸¤ç§ç±»å‹ï¼šnodeèŠ‚ç‚¹äº²å’Œæ€§&#x2F;åäº²å’Œæ€§ å’Œ podäº²å’Œæ€§&#x2F;åäº²å’Œæ€§ã€‚podäº²å’Œæ€§&#x2F;åäº²å’Œæ€§çº¦æŸé’ˆå¯¹çš„æ˜¯podæ ‡ç­¾è€Œä¸æ˜¯èŠ‚ç‚¹æ ‡ç­¾ã€‚</p><p>æ‹“æ‰‘åŸŸæ˜¯ä»€ä¹ˆï¼šå¤šä¸ªnodeèŠ‚ç‚¹ï¼Œæ‹¥æœ‰ç›¸åŒçš„labelæ ‡ç­¾ã€èŠ‚ç‚¹æ ‡ç­¾çš„é”®å€¼ç›¸åŒã€‘ï¼Œé‚£ä¹ˆè¿™äº›èŠ‚ç‚¹å°±å¤„äºåŒä¸€ä¸ªæ‹“æ‰‘åŸŸã€‚</p><h1 id="nodeèŠ‚ç‚¹äº²å’Œæ€§"><a href="#nodeèŠ‚ç‚¹äº²å’Œæ€§" class="headerlink" title="nodeèŠ‚ç‚¹äº²å’Œæ€§"></a>nodeèŠ‚ç‚¹äº²å’Œæ€§</h1><p>å½“å‰æœ‰ä¸¤ç§ç±»å‹çš„èŠ‚ç‚¹äº²å’Œæ€§ï¼Œç§°ä¸ºrequiredDuringSchedulingIgnoredDuringExecutionå’Œ preferredDuringSchedulingIgnoredDuringExecutionï¼Œå¯ä»¥å°†å®ƒä»¬åˆ†åˆ«è§†ä¸ºâ€œç¡¬â€ã€å¿…é¡»æ»¡è¶³æ¡ä»¶ã€‘å’Œâ€œè½¯â€ã€ä¼˜é€‰æ»¡è¶³æ¡ä»¶ã€‘è¦æ±‚ã€‚</p><p>å‰è€…è¡¨ç¤ºPodè¦è°ƒåº¦åˆ°çš„èŠ‚ç‚¹å¿…é¡»æ»¡è¶³è§„åˆ™æ¡ä»¶ï¼Œä¸æ»¡è¶³åˆ™ä¸ä¼šè°ƒåº¦ï¼Œpodä¼šä¸€ç›´å¤„äºPendingçŠ¶æ€ï¼›åè€…è¡¨ç¤ºä¼˜å…ˆè°ƒåº¦åˆ°æ»¡è¶³è§„åˆ™æ¡ä»¶çš„èŠ‚ç‚¹ï¼Œå¦‚æœä¸èƒ½æ»¡è¶³å†è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚</p><p>åç§°ä¸­çš„ IgnoredDuringExecution éƒ¨åˆ†æ„å‘³ç€ï¼Œä¸nodeSelectorçš„å·¥ä½œæ–¹å¼ç±»ä¼¼ï¼Œå¦‚æœèŠ‚ç‚¹ä¸Šçš„æ ‡ç­¾åœ¨Podè¿è¡Œæ—¶å‘ç”Ÿæ›´æ”¹ï¼Œä½¿å¾—podä¸Šçš„äº²å’Œæ€§è§„åˆ™ä¸å†æ»¡è¶³ï¼Œé‚£ä¹ˆpodä»å°†ç»§ç»­åœ¨è¯¥èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚</p><p>åœ¨æœªæ¥ï¼Œä¼šè®¡åˆ’æä¾›requiredDuringSchedulingRequiredDuringExecutionï¼Œç±»ä¼¼requiredDuringSchedulingIgnoredDuringExecutionã€‚ä¸åŒä¹‹å¤„å°±æ˜¯podè¿è¡Œè¿‡ç¨‹ä¸­å¦‚æœèŠ‚ç‚¹ä¸å†æ»¡è¶³podçš„äº²å’Œæ€§ï¼Œåˆ™podä¼šåœ¨è¯¥èŠ‚ç‚¹ä¸­é€å‡ºã€‚</p><p>èŠ‚ç‚¹äº²å’Œæ€§è¯­æ³•æ”¯æŒä»¥ä¸‹è¿ç®—ç¬¦ï¼šInï¼ŒNotInï¼ŒExistsï¼ŒDoesNotExistï¼ŒGtï¼ŒLtã€‚å¯ä»¥ä½¿ç”¨NotInå’ŒDoesNotExistå®ç°èŠ‚ç‚¹çš„åäº²å’Œè¡Œä¸ºã€‚</p><p>è¿ç®—ç¬¦å…³ç³»ï¼š</p><ul><li>Inï¼šlabelçš„å€¼åœ¨æŸä¸ªåˆ—è¡¨ä¸­</li><li>NotInï¼šlabelçš„å€¼ä¸åœ¨æŸä¸ªåˆ—è¡¨ä¸­</li><li>Gtï¼šlabelçš„å€¼å¤§äºæŸä¸ªå€¼</li><li>Ltï¼šlabelçš„å€¼å°äºæŸä¸ªå€¼</li><li>Existsï¼šæŸä¸ªlabelå­˜åœ¨</li><li>DoesNotExistï¼šæŸä¸ªlabelä¸å­˜åœ¨</li></ul><p><strong>å…¶ä»–é‡è¦è¯´æ˜ï¼š</strong></p><p>1ã€å¦‚æœåŒæ—¶æŒ‡å®šnodeSelectorå’ŒnodeAffinityï¼Œåˆ™å¿…é¡»æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼Œæ‰èƒ½å°†Podè°ƒåº¦åˆ°å€™é€‰èŠ‚ç‚¹ä¸Šã€‚</p><p>2ã€å¦‚æœåœ¨nodeAffinityç±»å‹ä¸‹æŒ‡å®šäº†å¤šä¸ªnodeSelectorTermså¯¹è±¡ã€å¯¹è±¡ä¸èƒ½æœ‰å¤šä¸ªï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªåªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‘ï¼Œé‚£ä¹ˆåªæœ‰æœ€åä¸€ä¸ªnodeSelectorTermså¯¹è±¡ç”Ÿæ•ˆã€‚</p><p>3ã€å¦‚æœåœ¨nodeSelectorTermsä¸‹æŒ‡å®šäº†å¤šä¸ªmatchExpressionsåˆ—è¡¨ï¼Œé‚£ä¹ˆåªè¦èƒ½æ»¡è¶³å…¶ä¸­ä¸€ä¸ªmatchExpressionsï¼Œå°±å¯ä»¥å°†podè°ƒåº¦åˆ°æŸä¸ªèŠ‚ç‚¹ä¸Šã€é’ˆå¯¹èŠ‚ç‚¹ç¡¬äº²å’Œã€‘ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/90513b00/gfgav3o45n.png" title="img"><p>4ã€å¦‚æœåœ¨matchExpressionsä¸‹æœ‰å¤šä¸ªkeyåˆ—è¡¨ï¼Œé‚£ä¹ˆåªæœ‰å½“æ‰€æœ‰keyæ»¡è¶³æ—¶ï¼Œæ‰èƒ½å°†podè°ƒåº¦åˆ°æŸä¸ªèŠ‚ç‚¹ã€é’ˆå¯¹ç¡¬äº²å’Œã€‘ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/90513b00/55t057vb4p.png" title="img"><p>5ã€åœ¨keyä¸‹çš„valuesåªè¦æœ‰ä¸€ä¸ªæ»¡è¶³æ¡ä»¶ï¼Œé‚£ä¹ˆå½“å‰çš„keyå°±æ»¡è¶³æ¡ä»¶</p><img src="/img/loading.gif" data-lazy-src="/posts/90513b00/1g9trkaox2.png" title="img"><p>6ã€å¦‚æœpodå·²ç»è°ƒåº¦åœ¨è¯¥èŠ‚ç‚¹ï¼Œå½“æˆ‘ä»¬åˆ é™¤æˆ–ä¿®è¯¥èŠ‚ç‚¹çš„æ ‡ç­¾æ—¶ï¼Œpodä¸ä¼šè¢«ç§»é™¤ã€‚æ¢å¥è¯è¯´ï¼Œäº²å’Œæ€§é€‰æ‹©åªæœ‰åœ¨podè°ƒåº¦æœŸé—´æœ‰æ•ˆã€‚</p><p>7ã€preferredDuringSchedulingIgnoredDuringExecutionä¸­çš„weightï¼ˆæƒé‡ï¼‰å­—æ®µåœ¨1-100èŒƒå›´å†…ã€‚å¯¹äºæ¯ä¸ªæ»¡è¶³æ‰€æœ‰è°ƒåº¦éœ€æ±‚çš„èŠ‚ç‚¹(èµ„æºè¯·æ±‚ã€RequiredDuringSchedulingäº²å’Œè¡¨è¾¾å¼ç­‰)ï¼Œè°ƒåº¦å™¨å°†é€šè¿‡è¿­ä»£è¯¥å­—æ®µçš„å…ƒç´ æ¥è®¡ç®—ä¸€ä¸ªæ€»å’Œï¼Œå¦‚æœèŠ‚ç‚¹ä¸ç›¸åº”çš„åŒ¹é…è¡¨è¾¾å¼åŒ¹é…ï¼Œåˆ™å‘è¯¥æ€»å’Œæ·»åŠ â€œæƒé‡â€ã€‚ç„¶åå°†è¯¥åˆ†æ•°ä¸èŠ‚ç‚¹çš„å…¶ä»–ä¼˜å…ˆçº§å‡½æ•°çš„åˆ†æ•°ç»“åˆèµ·æ¥ã€‚æ€»å¾—åˆ†æœ€é«˜çš„èŠ‚ç‚¹æ˜¯æœ€å—æ¬¢è¿çš„ã€‚</p><p><strong>è¡¥å……ï¼š</strong></p><blockquote><p>å…³äºweight, å–å€¼èŒƒå›´æ˜¯ 1 åˆ° 100. å…¶å®šä¹‰ä¸ºï¼šå‡å¦‚å­˜åœ¨ä¸¤ä¸ªå€™é€‰èŠ‚ç‚¹ï¼Œéƒ½æ»¡è¶³ <code>preferredDuringSchedulingIgnoredDuringExecution</code> è§„åˆ™ï¼Œ å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹å…·æœ‰æ ‡ç­¾ <code>label-1:key-1</code>ï¼Œå¦ä¸€ä¸ªèŠ‚ç‚¹å…·æœ‰æ ‡ç­¾ <code>label-2:key-2</code>ï¼Œ è°ƒåº¦å™¨ä¼šè€ƒå¯Ÿå„ä¸ªèŠ‚ç‚¹çš„ <code>weight</code> å–å€¼ï¼Œå¹¶å°†è¯¥æƒé‡å€¼æ·»åŠ åˆ°èŠ‚ç‚¹çš„å…¶ä»–å¾—åˆ†å€¼ä¹‹ä¸Š</p><p><strong>å¦‚æœåªè¦ä¸€æ¡é…ç½®è§„åˆ™, è¿™ä¸ªå±æ€§å°±æ²¡å•¥æ„ä¹‰äº†</strong></p></blockquote><h1 id="nodeèŠ‚ç‚¹äº²å’Œæ€§ç¤ºä¾‹"><a href="#nodeèŠ‚ç‚¹äº²å’Œæ€§ç¤ºä¾‹" class="headerlink" title="nodeèŠ‚ç‚¹äº²å’Œæ€§ç¤ºä¾‹"></a>nodeèŠ‚ç‚¹äº²å’Œæ€§ç¤ºä¾‹</h1><h2 id="å‡†å¤‡äº‹é¡¹"><a href="#å‡†å¤‡äº‹é¡¹" class="headerlink" title="å‡†å¤‡äº‹é¡¹"></a>å‡†å¤‡äº‹é¡¹</h2><p>ç»™nodeèŠ‚ç‚¹æ‰“labelæ ‡ç­¾</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##  --overwriteè¦†ç›–å·²å­˜åœ¨çš„æ ‡ç­¾ä¿¡æ¯</span></span></span><br><span class="line">kubectl label nodes k8s-node01 disk-type=ssd --overwrite</span><br><span class="line">kubectl label nodes k8s-node01 cpu-num=12</span><br><span class="line"></span><br><span class="line">kubectl label nodes k8s-node02 disk-type=sata</span><br><span class="line">kubectl label nodes k8s-node02 cpu-num=24</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æ‰€æœ‰èŠ‚ç‚¹æ ‡ç­¾ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]# kubectl get node -o wide --show-labels</span><br><span class="line">NAME         STATUS   ROLES    AGE   VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION           CONTAINER-RUNTIME   LABELS</span><br><span class="line">k8s-master   Ready    master   43d   v1.17.4   172.16.1.110   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-1062.el7.x86_64   docker://19.3.8     beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-master,kubernetes.io/os=linux,node-role.kubernetes.io/master=</span><br><span class="line">k8s-node01   Ready    &lt;none&gt;   43d   v1.17.4   172.16.1.111   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-1062.el7.x86_64   docker://19.3.8     beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,cpu-num=12,disk-type=ssd,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-node01,kubernetes.io/os=linux</span><br><span class="line">k8s-node02   Ready    &lt;none&gt;   43d   v1.17.4   172.16.1.112   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-1062.el7.x86_64   docker://19.3.8     beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,cpu-num=24,disk-type=sata,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-node02,kubernetes.io/os=linux</span><br></pre></td></tr></table></figure><p>å‚è§ä¸Šé¢ï¼Œç»™k8s-node01æ‰“äº†cpu-num&#x3D;12,disk-type&#x3D;ssdæ ‡ç­¾ï¼›ç»™k8s-node02æ‰“äº†cpu-num&#x3D;24,disk-type&#x3D;sataæ ‡ç­¾ã€‚</p><h2 id="nodeç¡¬äº²å’Œæ€§ç¤ºä¾‹"><a href="#nodeç¡¬äº²å’Œæ€§ç¤ºä¾‹" class="headerlink" title="nodeç¡¬äº²å’Œæ€§ç¤ºä¾‹"></a>nodeç¡¬äº²å’Œæ€§ç¤ºä¾‹</h2><p>å¿…é¡»æ»¡è¶³æ¡ä»¶æ‰èƒ½è°ƒåº¦ï¼Œå¦åˆ™ä¸ä¼šè°ƒåº¦</p><p>è¦è¿è¡Œçš„yamlæ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@k8s-master</span> <span class="string">nodeAffinity</span>]<span class="comment"># pwd</span></span><br><span class="line"><span class="string">/root/k8s_practice/scheduler/nodeAffinity</span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">nodeAffinity</span>]<span class="comment"># cat node_required_affinity.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">node-affinity-deploy</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nodeaffinity-deploy</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">nodeAffinity:</span></span><br><span class="line">          <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">            <span class="attr">nodeSelectorTerms:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">matchExpressions:</span></span><br><span class="line">              <span class="comment"># è¡¨ç¤ºnodeæ ‡ç­¾å­˜åœ¨ disk-type=ssd æˆ– disk-type=sas</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">disk-type</span></span><br><span class="line">                <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                <span class="attr">values:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">ssd</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">sas</span></span><br><span class="line">              <span class="comment"># è¡¨ç¤ºnodeæ ‡ç­¾å­˜åœ¨ cpu-numä¸”å€¼å¤§äº6</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">cpu-num</span></span><br><span class="line">                <span class="attr">operator:</span> <span class="string">Gt</span></span><br><span class="line">                <span class="attr">values:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&quot;6&quot;</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œyamlæ–‡ä»¶å¹¶æŸ¥çœ‹çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master nodeAffinity]# kubectl apply -f node_required_affinity.yaml </span><br><span class="line">deployment.apps/node-affinity-deploy created</span><br><span class="line">[root@k8s-master nodeAffinity]# </span><br><span class="line">[root@k8s-master nodeAffinity]# kubectl get deploy -o wide</span><br><span class="line">NAME                   READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                                                      SELECTOR</span><br><span class="line">node-affinity-deploy   5/5     5            5           6s    myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp</span><br><span class="line">[root@k8s-master nodeAffinity]# </span><br><span class="line">[root@k8s-master nodeAffinity]# kubectl get rs -o wide</span><br><span class="line">NAME                              DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES                                                      SELECTOR</span><br><span class="line">node-affinity-deploy-5c88ffb8ff   5         5         5       11s   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp,pod-template-hash=5c88ffb8ff</span><br><span class="line">[root@k8s-master nodeAffinity]# </span><br><span class="line">[root@k8s-master nodeAffinity]# kubectl get pod -o wide</span><br><span class="line">NAME                                    READY   STATUS    RESTARTS   AGE   IP             NODE         NOMINATED NODE   READINESS GATES</span><br><span class="line">node-affinity-deploy-5c88ffb8ff-2mbfl   1/1     Running   0          15s   10.244.4.237   k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">node-affinity-deploy-5c88ffb8ff-9hjhk   1/1     Running   0          15s   10.244.4.235   k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">node-affinity-deploy-5c88ffb8ff-9rg75   1/1     Running   0          15s   10.244.4.239   k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">node-affinity-deploy-5c88ffb8ff-pqtfh   1/1     Running   0          15s   10.244.4.236   k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">node-affinity-deploy-5c88ffb8ff-zqpl8   1/1     Running   0          15s   10.244.4.238   k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><p>ç”±ä¸Šå¯è§ï¼Œå†æ ¹æ®ä¹‹å‰æ‰“çš„æ ‡ç­¾ï¼Œå¾ˆå®¹æ˜“æ¨æ–­å‡ºå½“å‰podåªèƒ½è°ƒåº¦åœ¨k8s-node01èŠ‚ç‚¹ã€‚</p><p>å³ä½¿æˆ‘ä»¬åˆ é™¤åŸæ¥çš„rsï¼Œé‡æ–°ç”Ÿæˆrsåpodä¾æ—§ä¼šè°ƒåº¦åˆ°k8s-node01èŠ‚ç‚¹ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master nodeAffinity]# kubectl delete rs node-affinity-deploy-5c88ffb8ff</span><br><span class="line">replicaset.apps &quot;node-affinity-deploy-5c88ffb8ff&quot; deleted</span><br><span class="line">[root@k8s-master nodeAffinity]# </span><br><span class="line">[root@k8s-master nodeAffinity]# kubectl get rs -o wide</span><br><span class="line">NAME                              DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES                                                      SELECTOR</span><br><span class="line">node-affinity-deploy-5c88ffb8ff   5         5         2       4s    myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp,pod-template-hash=5c88ffb8ff</span><br><span class="line">[root@k8s-master nodeAffinity]# </span><br><span class="line">[root@k8s-master nodeAffinity]# kubectl get pod -o wide</span><br><span class="line">NAME                                    READY   STATUS    RESTARTS   AGE   IP             NODE         NOMINATED NODE   READINESS GATES</span><br><span class="line">node-affinity-deploy-5c88ffb8ff-2v2tb   1/1     Running   0          11s   10.244.4.241   k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">node-affinity-deploy-5c88ffb8ff-gl4fm   1/1     Running   0          11s   10.244.4.240   k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">node-affinity-deploy-5c88ffb8ff-j26rg   1/1     Running   0          11s   10.244.4.244   k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">node-affinity-deploy-5c88ffb8ff-vhzmn   1/1     Running   0          11s   10.244.4.243   k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">node-affinity-deploy-5c88ffb8ff-xxj8m   1/1     Running   0          11s   10.244.4.242   k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><h2 id="nodeè½¯äº²å’Œæ€§ç¤ºä¾‹"><a href="#nodeè½¯äº²å’Œæ€§ç¤ºä¾‹" class="headerlink" title="nodeè½¯äº²å’Œæ€§ç¤ºä¾‹"></a>nodeè½¯äº²å’Œæ€§ç¤ºä¾‹</h2><p>ä¼˜å…ˆè°ƒåº¦åˆ°æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ï¼Œå¦‚æœéƒ½ä¸æ»¡è¶³ä¹Ÿä¼šè°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚</p><p>è¦è¿è¡Œçš„yamlæ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@k8s-master</span> <span class="string">nodeAffinity</span>]<span class="comment"># pwd</span></span><br><span class="line"><span class="string">/root/k8s_practice/scheduler/nodeAffinity</span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">nodeAffinity</span>]<span class="comment"># cat node_preferred_affinity.yaml </span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">node-affinity-deploy</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nodeaffinity-deploy</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">nodeAffinity:</span></span><br><span class="line">          <span class="attr">preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">preference:</span></span><br><span class="line">              <span class="attr">matchExpressions:</span></span><br><span class="line">              <span class="comment"># è¡¨ç¤ºnodeæ ‡ç­¾å­˜åœ¨ disk-type=ssd æˆ– disk-type=sas</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">disk-type</span></span><br><span class="line">                <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                <span class="attr">values:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">ssd</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">sas</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">50</span></span><br><span class="line">            <span class="attr">preference:</span></span><br><span class="line">              <span class="attr">matchExpressions:</span></span><br><span class="line">              <span class="comment"># è¡¨ç¤ºnodeæ ‡ç­¾å­˜åœ¨ cpu-numä¸”å€¼å¤§äº16</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">cpu-num</span></span><br><span class="line">                <span class="attr">operator:</span> <span class="string">Gt</span></span><br><span class="line">                <span class="attr">values:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&quot;16&quot;</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œyamlæ–‡ä»¶å¹¶æŸ¥çœ‹çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master nodeAffinity]# kubectl apply -f node_preferred_affinity.yaml </span><br><span class="line">deployment.apps/node-affinity-deploy created</span><br><span class="line">[root@k8s-master nodeAffinity]# </span><br><span class="line">[root@k8s-master nodeAffinity]# kubectl get deploy -o wide</span><br><span class="line">NAME                   READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                                                      SELECTOR</span><br><span class="line">node-affinity-deploy   5/5     5            5           9s    myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp</span><br><span class="line">[root@k8s-master nodeAffinity]# </span><br><span class="line">[root@k8s-master nodeAffinity]# kubectl get rs -o wide</span><br><span class="line">NAME                             DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES                                                      SELECTOR</span><br><span class="line">node-affinity-deploy-d5d9cbc8d   5         5         5       13s   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp,pod-template-hash=d5d9cbc8d</span><br><span class="line">[root@k8s-master nodeAffinity]# </span><br><span class="line">[root@k8s-master nodeAffinity]# kubectl get pod -o wide</span><br><span class="line">NAME                                   READY   STATUS    RESTARTS   AGE   IP             NODE         NOMINATED NODE   READINESS GATES</span><br><span class="line">node-affinity-deploy-d5d9cbc8d-bv86t   1/1     Running   0          18s   10.244.2.243   k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">node-affinity-deploy-d5d9cbc8d-dnbr8   1/1     Running   0          18s   10.244.2.244   k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">node-affinity-deploy-d5d9cbc8d-ldq82   1/1     Running   0          18s   10.244.2.246   k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">node-affinity-deploy-d5d9cbc8d-nt74q   1/1     Running   0          18s   10.244.4.2     k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">node-affinity-deploy-d5d9cbc8d-rt5nb   1/1     Running   0          18s   10.244.2.245   k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><p>ç”±ä¸Šå¯è§ï¼Œå†æ ¹æ®ä¹‹å‰æ‰“çš„æ ‡ç­¾ï¼Œå¾ˆå®¹æ˜“æ¨æ–­å‡ºå½“å‰podä¼šã€ä¼˜å…ˆã€‘è°ƒåº¦åœ¨k8s-node02èŠ‚ç‚¹ã€‚</p><h2 id="nodeè½¯ç¡¬äº²å’Œæ€§è”åˆç¤ºä¾‹"><a href="#nodeè½¯ç¡¬äº²å’Œæ€§è”åˆç¤ºä¾‹" class="headerlink" title="nodeè½¯ç¡¬äº²å’Œæ€§è”åˆç¤ºä¾‹"></a>nodeè½¯ç¡¬äº²å’Œæ€§è”åˆç¤ºä¾‹</h2><p>ç¡¬äº²å’Œæ€§ä¸è½¯äº²å’Œæ€§ä¸€èµ·ä½¿ç”¨</p><p>è¦è¿è¡Œçš„yamlæ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@k8s-master</span> <span class="string">nodeAffinity</span>]<span class="comment"># pwd</span></span><br><span class="line"><span class="string">/root/k8s_practice/scheduler/nodeAffinity</span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">nodeAffinity</span>]<span class="comment"># cat node_affinity.yaml </span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">node-affinity-deploy</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nodeaffinity-deploy</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">nodeAffinity:</span></span><br><span class="line">          <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">            <span class="attr">nodeSelectorTerms:</span></span><br><span class="line">              <span class="comment"># è¡¨ç¤ºnodeæ ‡ç­¾å­˜åœ¨ cpu-numä¸”å€¼å¤§äº10</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">matchExpressions:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">cpu-num</span></span><br><span class="line">                <span class="attr">operator:</span> <span class="string">Gt</span></span><br><span class="line">                <span class="attr">values:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">&quot;10&quot;</span></span><br><span class="line">          <span class="attr">preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">50</span></span><br><span class="line">            <span class="attr">preference:</span></span><br><span class="line">              <span class="attr">matchExpressions:</span></span><br><span class="line">                <span class="comment"># è¡¨ç¤ºnodeæ ‡ç­¾å­˜åœ¨ disk-type=ssd æˆ– disk-type=sas</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">disk-type</span></span><br><span class="line">                <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                <span class="attr">values:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">ssd</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">sas</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œyamlæ–‡ä»¶å¹¶æŸ¥çœ‹çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master nodeAffinity]# kubectl apply -f node_affinity.yaml </span><br><span class="line">deployment.apps/node-affinity-deploy created</span><br><span class="line">[root@k8s-master nodeAffinity]# </span><br><span class="line">[root@k8s-master nodeAffinity]# kubectl get deploy -o wide</span><br><span class="line">NAME                   READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                                                      SELECTOR</span><br><span class="line">node-affinity-deploy   5/5     5            5           9s    myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp</span><br><span class="line">[root@k8s-master nodeAffinity]# </span><br><span class="line">[root@k8s-master nodeAffinity]# kubectl get rs -o wide</span><br><span class="line">NAME                             DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES                                                      SELECTOR</span><br><span class="line">node-affinity-deploy-f9cb9b99b   5         5         5       13s   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp,pod-template-hash=f9cb9b99b</span><br><span class="line">[root@k8s-master nodeAffinity]# </span><br><span class="line">[root@k8s-master nodeAffinity]# kubectl get pod -o wide</span><br><span class="line">NAME                                   READY   STATUS    RESTARTS   AGE   IP             NODE         NOMINATED NODE   READINESS GATES</span><br><span class="line">node-affinity-deploy-f9cb9b99b-8w2nc   1/1     Running   0          17s   10.244.4.10    k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">node-affinity-deploy-f9cb9b99b-csk2s   1/1     Running   0          17s   10.244.4.9     k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">node-affinity-deploy-f9cb9b99b-g42kq   1/1     Running   0          17s   10.244.4.8     k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">node-affinity-deploy-f9cb9b99b-m6xbv   1/1     Running   0          17s   10.244.4.7     k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">node-affinity-deploy-f9cb9b99b-mxbdp   1/1     Running   0          17s   10.244.2.253   k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><p>ç”±ä¸Šå¯è§ï¼Œå†æ ¹æ®ä¹‹å‰æ‰“çš„æ ‡ç­¾ï¼Œå¾ˆå®¹æ˜“æ¨æ–­å‡ºk8s-node01ã€k8s-node02éƒ½æ»¡è¶³å¿…è¦æ¡ä»¶ï¼Œä½†å½“å‰podä¼šã€ä¼˜å…ˆã€‘è°ƒåº¦åœ¨k8s-node01èŠ‚ç‚¹ã€‚</p><h1 id="Podäº²å’Œæ€§"><a href="#Podäº²å’Œæ€§" class="headerlink" title="Podäº²å’Œæ€§"></a>Podäº²å’Œæ€§</h1><p>ä¸èŠ‚ç‚¹äº²å’Œæ€§ä¸€æ ·ï¼Œå½“å‰æœ‰Podäº²å’Œæ€§&#x2F;åäº²å’Œæ€§éƒ½æœ‰ä¸¤ç§ç±»å‹ï¼Œç§°ä¸ºrequiredDuringSchedulingIgnoredDuringExecutionå’Œ preferredDuringSchedulingIgnoredDuringExecutionï¼Œåˆ†åˆ«è¡¨ç¤ºâ€œç¡¬â€ä¸â€œè½¯â€è¦æ±‚ã€‚å¯¹äºç¡¬è¦æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³åˆ™podä¼šä¸€ç›´å¤„äºPendingçŠ¶æ€ã€‚</p><p>Podçš„äº²å’Œæ€§ä¸åäº²å’Œæ€§æ˜¯åŸºäºNodeèŠ‚ç‚¹ä¸Šå·²ç»è¿è¡Œpodçš„æ ‡ç­¾(è€Œä¸æ˜¯èŠ‚ç‚¹ä¸Šçš„æ ‡ç­¾)å†³å®šçš„ï¼Œä»è€Œçº¦æŸå“ªäº›èŠ‚ç‚¹é€‚åˆè°ƒåº¦ä½ çš„podã€‚</p><p>è§„åˆ™çš„å½¢å¼æ˜¯ï¼šå¦‚æœXå·²ç»è¿è¡Œäº†ä¸€ä¸ªæˆ–å¤šä¸ªç¬¦åˆè§„åˆ™Yçš„podï¼Œåˆ™æ­¤podåº”è¯¥åœ¨Xä¸­è¿è¡Œ(å¦‚æœæ˜¯åäº²å’Œçš„æƒ…å†µä¸‹ï¼Œåˆ™ä¸åº”è¯¥åœ¨Xä¸­è¿è¡Œï¼‰ã€‚å½“ç„¶podå¿…é¡»å¤„åœ¨åŒä¸€åç§°ç©ºé—´ï¼Œä¸ç„¶äº²å’Œæ€§&#x2F;åäº²å’Œæ€§æ— ä½œç”¨ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼ŒXæ˜¯ä¸€ä¸ªæ‹“æ‰‘åŸŸã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨topologyKeyæ¥è¡¨ç¤ºå®ƒï¼ŒtopologyKey çš„å€¼æ˜¯nodeèŠ‚ç‚¹æ ‡ç­¾çš„é”®ä»¥ä¾¿ç³»ç»Ÿç”¨æ¥è¡¨ç¤ºè¿™æ ·çš„æ‹“æ‰‘åŸŸã€‚å½“ç„¶è¿™é‡Œä¹Ÿæœ‰ä¸ªéšè—æ¡ä»¶ï¼Œå°±æ˜¯nodeèŠ‚ç‚¹æ ‡ç­¾çš„é”®å€¼ç›¸åŒæ—¶ï¼Œæ‰æ˜¯åœ¨åŒä¸€æ‹“æ‰‘åŸŸä¸­ï¼›å¦‚æœåªæ˜¯èŠ‚ç‚¹æ ‡ç­¾åç›¸åŒï¼Œä½†æ˜¯å€¼ä¸åŒï¼Œé‚£ä¹ˆä¹Ÿä¸åœ¨åŒä¸€æ‹“æ‰‘åŸŸã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼šPodçš„äº²å’Œæ€§&#x2F;åäº²å’Œæ€§è°ƒåº¦æ˜¯æ ¹æ®æ‹“æ‰‘åŸŸæ¥ç•Œå®šè°ƒåº¦çš„ï¼Œè€Œä¸æ˜¯æ ¹æ®nodeèŠ‚ç‚¹ã€‚</p><p><strong>æ³¨æ„äº‹é¡¹</strong></p><p>1ã€podä¹‹é—´äº²å’Œæ€§&#x2F;åäº²å’Œæ€§éœ€è¦å¤§é‡çš„å¤„ç†ï¼Œè¿™ä¼šæ˜æ˜¾é™ä½å¤§å‹é›†ç¾¤ä¸­çš„è°ƒåº¦é€Ÿåº¦ã€‚ä¸å»ºè®®åœ¨å¤§äºå‡ ç™¾ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ä¸­ä½¿ç”¨å®ƒä»¬ã€‚</p><p>2ã€Podåäº²å’Œæ€§è¦æ±‚å¯¹èŠ‚ç‚¹è¿›è¡Œä¸€è‡´çš„æ ‡è®°ã€‚æ¢å¥è¯è¯´ï¼Œé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¿…é¡»æœ‰ä¸€ä¸ªåŒ¹é…topologyKeyçš„é€‚å½“æ ‡ç­¾ã€‚å¦‚æœæŸäº›æˆ–æ‰€æœ‰èŠ‚ç‚¹ç¼ºå°‘æŒ‡å®šçš„topologyKeyæ ‡ç­¾ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ„å¤–è¡Œä¸ºã€‚</p><p>requiredDuringSchedulingIgnoredDuringExecutionä¸­äº²å’Œæ€§çš„ä¸€ä¸ªç¤ºä¾‹æ˜¯â€œå°†æœåŠ¡Aå’ŒæœåŠ¡Bçš„Podæ”¾ç½®åœ¨åŒä¸€åŒºåŸŸã€æ‹“æ‰‘åŸŸã€‘ä¸­ï¼Œå› ä¸ºå®ƒä»¬ä¹‹é—´æœ‰å¾ˆå¤šäº¤æµâ€ï¼›preferredDuringSchedulingIgnoredDuringExecutionä¸­åäº²å’Œæ€§çš„ç¤ºä¾‹æ˜¯â€œå°†æ­¤æœåŠ¡çš„ pod è·¨åŒºåŸŸã€æ‹“æ‰‘åŸŸã€‘åˆ†å¸ƒâ€ã€æ­¤æ—¶ç¡¬æ€§è¦æ±‚æ˜¯è¯´ä¸é€šçš„ï¼Œå› ä¸ºä½ å¯èƒ½æ‹¥æœ‰çš„ pod æ•°å¤šäºåŒºåŸŸæ•°ã€‘ã€‚</p><p>Podäº²å’Œæ€§&#x2F;åäº²å’Œæ€§è¯­æ³•æ”¯æŒä»¥ä¸‹è¿ç®—ç¬¦ï¼šInï¼ŒNotInï¼ŒExistsï¼ŒDoesNotExistã€‚</p><p><strong>åŸåˆ™ä¸Šï¼ŒtopologyKeyå¯ä»¥æ˜¯ä»»ä½•åˆæ³•çš„æ ‡ç­¾é”®ã€‚ä½†æ˜¯ï¼Œå‡ºäºæ€§èƒ½å’Œå®‰å…¨æ–¹é¢çš„åŸå› ï¼ŒtopologyKeyæœ‰ä¸€äº›é™åˆ¶ï¼š</strong></p><p>1ã€å¯¹äºPodäº²å’Œæ€§ï¼Œåœ¨requiredDuringSchedulingIgnoredDuringExecutionå’ŒpreferredDuringSchedulingIgnoredDuringExecutionä¸­topologyKeyéƒ½ä¸å…è®¸ä¸ºç©ºã€‚</p><p>2ã€å¯¹äºPodåäº²å’Œæ€§ï¼Œåœ¨requiredDuringSchedulingIgnoredDuringExecutionå’ŒpreferredDuringSchedulingIgnoredDuringExecutionä¸­topologyKeyä¹Ÿéƒ½ä¸å…è®¸ä¸ºç©ºã€‚</p><p>3ã€å¯¹äºrequiredDuringSchedulingIgnoredDuringExecutionçš„podåäº²å’Œæ€§ï¼Œå¼•å…¥äº†å…è®¸æ§åˆ¶å™¨LimitPodHardAntiAffinityTopologyæ¥é™åˆ¶topologyKeyçš„kubernet.io&#x2F;hostnameã€‚å¦‚æœä½ æƒ³è®©å®ƒå¯¹è‡ªå®šä¹‰æ‹“æ‰‘å¯ç”¨ï¼Œä½ å¯ä»¥ä¿®æ”¹è®¸å¯æ§åˆ¶å™¨ï¼Œæˆ–è€…å¹²è„†ç¦ç”¨å®ƒã€‚</p><p>4ã€é™¤ä¸Šè¿°æƒ…å†µå¤–ï¼ŒtopologyKeyå¯ä»¥æ˜¯ä»»ä½•åˆæ³•çš„æ ‡ç­¾é”®ã€‚</p><p>Pod é—´äº²å’Œé€šè¿‡ PodSpec ä¸­ affinity å­—æ®µä¸‹çš„ podAffinity å­—æ®µè¿›è¡ŒæŒ‡å®šã€‚è€Œ pod é—´åäº²å’Œé€šè¿‡ PodSpec ä¸­ affinity å­—æ®µä¸‹çš„ podAntiAffinity å­—æ®µè¿›è¡ŒæŒ‡å®šã€‚</p><p>Podäº²å’Œæ€§&#x2F;åäº²å’Œæ€§çš„requiredDuringSchedulingIgnoredDuringExecutionæ‰€å…³è”çš„matchExpressionsä¸‹æœ‰å¤šä¸ªkeyåˆ—è¡¨ï¼Œé‚£ä¹ˆåªæœ‰å½“æ‰€æœ‰keyæ»¡è¶³æ—¶ï¼Œæ‰èƒ½å°†podè°ƒåº¦åˆ°æŸä¸ªåŒºåŸŸã€é’ˆå¯¹Podç¡¬äº²å’Œã€‘ã€‚</p><h1 id="podäº²å’Œæ€§ä¸åäº²å’Œæ€§ç¤ºä¾‹"><a href="#podäº²å’Œæ€§ä¸åäº²å’Œæ€§ç¤ºä¾‹" class="headerlink" title="podäº²å’Œæ€§ä¸åäº²å’Œæ€§ç¤ºä¾‹"></a>podäº²å’Œæ€§ä¸åäº²å’Œæ€§ç¤ºä¾‹</h1><p>ä¸ºäº†æ›´å¥½çš„æ¼”ç¤ºPodäº²å’Œæ€§ä¸åäº²å’Œæ€§ï¼Œæœ¬æ¬¡ç¤ºä¾‹æˆ‘ä»¬ä¼šå°†k8s-masterèŠ‚ç‚¹ä¹ŸåŠ å…¥è¿›æ¥è¿›è¡Œæ¼”ç¤ºã€‚</p><h2 id="å‡†å¤‡äº‹é¡¹-1"><a href="#å‡†å¤‡äº‹é¡¹-1" class="headerlink" title="å‡†å¤‡äº‹é¡¹"></a>å‡†å¤‡äº‹é¡¹</h2><p>ç»™nodeèŠ‚ç‚¹æ‰“labelæ ‡ç­¾</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤å·²å­˜åœ¨æ ‡ç­¾</span></span><br><span class="line">kubectl label nodes k8s-node01 cpu-num-</span><br><span class="line">kubectl label nodes k8s-node01 disk-type-</span><br><span class="line">kubectl label nodes k8s-node02 cpu-num-</span><br><span class="line">kubectl label nodes k8s-node02 disk-type-</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##  --overwriteè¦†ç›–å·²å­˜åœ¨çš„æ ‡ç­¾ä¿¡æ¯</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">k8s-master æ ‡ç­¾æ·»åŠ </span></span><br><span class="line">kubectl label nodes k8s-master busi-use=www --overwrite</span><br><span class="line">kubectl label nodes k8s-master disk-type=ssd --overwrite</span><br><span class="line">kubectl label nodes k8s-master busi-db=redis</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">k8s-node01 æ ‡ç­¾æ·»åŠ </span></span><br><span class="line">kubectl label nodes k8s-node01 busi-use=www</span><br><span class="line">kubectl label nodes k8s-node01 disk-type=sata </span><br><span class="line">kubectl label nodes k8s-node01 busi-db=redis</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">k8s-node02 æ ‡ç­¾æ·»åŠ </span></span><br><span class="line">kubectl label nodes k8s-node02 busi-use=www</span><br><span class="line">kubectl label nodes k8s-node02 disk-type=ssd</span><br><span class="line">kubectl label nodes k8s-node02 busi-db=etcd</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æ‰€æœ‰èŠ‚ç‚¹æ ‡ç­¾ä¿¡æ¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> [root@k8s-master ~]# kubectl get node -o wide --show-labels</span><br><span class="line"><span class="number">2</span> <span class="variable constant_">NAME</span>         <span class="variable constant_">STATUS</span>   <span class="variable constant_">ROLES</span>    <span class="variable constant_">AGE</span>   <span class="variable constant_">VERSION</span>   <span class="variable constant_">INTERNAL</span>-<span class="variable constant_">IP</span>    <span class="variable constant_">EXTERNAL</span>-<span class="variable constant_">IP</span>   <span class="variable constant_">OS</span>-<span class="variable constant_">IMAGE</span>                <span class="variable constant_">KERNEL</span>-<span class="variable constant_">VERSION</span>           <span class="variable constant_">CONTAINER</span>-<span class="variable constant_">RUNTIME</span>   <span class="variable constant_">LABELS</span></span><br><span class="line"><span class="number">3</span> k8s-master   <span class="title class_">Ready</span>    master   28d   v1<span class="number">.17</span><span class="number">.4</span>   <span class="number">172.16</span><span class="number">.1</span><span class="number">.110</span>   &lt;none&gt;        <span class="title class_">CentOS</span> <span class="title class_">Linux</span> <span class="number">7</span> (<span class="title class_">Core</span>)   <span class="number">3.10</span><span class="number">.0</span>-<span class="number">1062.</span>el7.<span class="property">x86_64</span>   <span class="attr">docker</span>:<span class="comment">//19.3.8     beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,busi-db=redis,busi-use=www,disk-type=ssd,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-master,kubernetes.io/os=linux,node-role.kubernetes.io/master=</span></span><br><span class="line"><span class="number">4</span> k8s-node01   <span class="title class_">Ready</span>    &lt;none&gt;   28d   v1<span class="number">.17</span><span class="number">.4</span>   <span class="number">172.16</span><span class="number">.1</span><span class="number">.111</span>   &lt;none&gt;        <span class="title class_">CentOS</span> <span class="title class_">Linux</span> <span class="number">7</span> (<span class="title class_">Core</span>)   <span class="number">3.10</span><span class="number">.0</span>-<span class="number">1062.</span>el7.<span class="property">x86_64</span>   <span class="attr">docker</span>:<span class="comment">//19.3.8     beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,busi-db=redis,busi-use=www,disk-type=sata,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-node01,kubernetes.io/os=linux</span></span><br><span class="line"><span class="number">5</span> k8s-node02   <span class="title class_">Ready</span>    &lt;none&gt;   28d   v1<span class="number">.17</span><span class="number">.4</span>   <span class="number">172.16</span><span class="number">.1</span><span class="number">.112</span>   &lt;none&gt;        <span class="title class_">CentOS</span> <span class="title class_">Linux</span> <span class="number">7</span> (<span class="title class_">Core</span>)   <span class="number">3.10</span><span class="number">.0</span>-<span class="number">1062.</span>el7.<span class="property">x86_64</span>   <span class="attr">docker</span>:<span class="comment">//19.3.8     beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,busi-db=etcd,busi-use=www,disk-type=ssd,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s-node02,kubernetes.io/os=linux</span></span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šæ‰€è¿°ï¼šk8s-masteræ·»åŠ äº†disk-type&#x3D;ssd,busi-db&#x3D;redis,busi-use&#x3D;wwwæ ‡ç­¾</p><p>k8s-node01æ·»åŠ äº†disk-type&#x3D;sata,busi-db&#x3D;redis,busi-use&#x3D;wwwæ ‡ç­¾</p><p>k8s-node02æ·»åŠ äº†disk-type&#x3D;ssd,busi-db&#x3D;etcd,busi-use&#x3D;wwwæ ‡ç­¾</p><p>é€šè¿‡deploymentè¿è¡Œä¸€ä¸ªpodï¼Œæˆ–è€…ç›´æ¥è¿è¡Œä¸€ä¸ªpodä¹Ÿå¯ä»¥ã€‚ä¸ºåç»­çš„Podäº²å’Œæ€§ä¸åäº²å’Œæ€§æµ‹éªŒåšåŸºç¡€ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### yamlæ–‡ä»¶</span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># pwd</span></span><br><span class="line"><span class="string">/root/k8s_practice/scheduler/podAffinity</span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># cat web_deploy.yaml </span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-deploy</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">myweb-deploy</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">myapp-web</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">myapp-web</span></span><br><span class="line">        <span class="attr">version:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># </span></span><br><span class="line"><span class="comment">### è¿è¡Œyamlæ–‡ä»¶</span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># kubectl apply -f web_deploy.yaml </span></span><br><span class="line"><span class="string">deployment.apps/web-deploy</span> <span class="string">created</span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># </span></span><br><span class="line"><span class="comment">### æŸ¥çœ‹podæ ‡ç­¾</span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># kubectl get pod -o wide --show-labels</span></span><br><span class="line"><span class="string">NAME</span>                          <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>   <span class="string">IP</span>           <span class="string">NODE</span>         <span class="string">NOMINATED</span> <span class="string">NODE</span>   <span class="string">READINESS</span> <span class="string">GATES</span>   <span class="string">LABELS</span></span><br><span class="line"><span class="string">web-deploy-5ccc9d7c55-kkwst</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">15m</span>   <span class="number">10.244</span><span class="number">.2</span><span class="number">.4</span>   <span class="string">k8s-node02</span>   <span class="string">&lt;none&gt;</span>           <span class="string">&lt;none&gt;</span>            <span class="string">app=myapp-web,pod-template-hash=5ccc9d7c55,version=v1</span></span><br></pre></td></tr></table></figure><p>å½“å‰podåœ¨k8s-node02èŠ‚ç‚¹ï¼›å…¶ä¸­podçš„æ ‡ç­¾app&#x3D;myapp-web,version&#x3D;v1ä¼šåœ¨åé¢podäº²å’Œæ€§&#x2F;åäº²å’Œæ€§ç¤ºä¾‹ä¸­ä½¿ç”¨ã€‚</p><h2 id="podç¡¬äº²å’Œæ€§ç¤ºä¾‹"><a href="#podç¡¬äº²å’Œæ€§ç¤ºä¾‹" class="headerlink" title="podç¡¬äº²å’Œæ€§ç¤ºä¾‹"></a>podç¡¬äº²å’Œæ€§ç¤ºä¾‹</h2><p>è¦è¿è¡Œçš„yamlæ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># pwd</span></span><br><span class="line"><span class="string">/root/k8s_practice/scheduler/podAffinity</span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># cat pod_required_affinity.yaml </span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-podaffinity-deploy</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">podaffinity-deploy</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">6</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># å…è®¸åœ¨masterèŠ‚ç‚¹è¿è¡Œ</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br><span class="line">        <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">podAffinity:</span></span><br><span class="line">          <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">labelSelector:</span></span><br><span class="line">              <span class="comment"># ç”±äºæ˜¯Podäº²å’Œæ€§/åäº²å’Œæ€§ï¼›å› æ­¤è¿™é‡ŒåŒ¹é…è§„åˆ™å†™çš„æ˜¯Podçš„æ ‡ç­¾ä¿¡æ¯</span></span><br><span class="line">              <span class="attr">matchExpressions:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app</span></span><br><span class="line">                <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                <span class="attr">values:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">myapp-web</span> </span><br><span class="line">            <span class="comment"># æ‹“æ‰‘åŸŸ  è‹¥å¤šä¸ªnodeèŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„æ ‡ç­¾ä¿¡æ¯ã€æ ‡ç­¾é”®å€¼ç›¸åŒã€‘ï¼Œåˆ™è¡¨ç¤ºè¿™äº›nodeèŠ‚ç‚¹å°±åœ¨åŒä¸€æ‹“æ‰‘åŸŸ</span></span><br><span class="line">            <span class="comment"># è¯·å¯¹æ¯”å¦‚ä¸‹ä¸¤ä¸ªä¸åŒçš„æ‹“æ‰‘åŸŸï¼ŒPodçš„è°ƒåº¦ç»“æœ</span></span><br><span class="line">            <span class="comment">#topologyKey: busi-use</span></span><br><span class="line">            <span class="attr">topologyKey:</span> <span class="string">disk-type</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œyamlæ–‡ä»¶å¹¶æŸ¥çœ‹çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master podAffinity]# kubectl apply -f pod_required_affinity.yaml </span><br><span class="line">deployment.apps/pod-podaffinity-deploy created</span><br><span class="line">[root@k8s-master podAffinity]# </span><br><span class="line">[root@k8s-master podAffinity]# kubectl get deploy -o wide</span><br><span class="line">NAME                     READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                                                      SELECTOR</span><br><span class="line">pod-podaffinity-deploy   6/6     6            6           48s   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp</span><br><span class="line">web-deploy               1/1     1            1           22h   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp-web</span><br><span class="line">[root@k8s-master podAffinity]# </span><br><span class="line">[root@k8s-master podAffinity]# kubectl get rs -o wide</span><br><span class="line">NAME                                DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES                                                      SELECTOR</span><br><span class="line">pod-podaffinity-deploy-848559bf5b   6         6         6       52s   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp,pod-template-hash=848559bf5b</span><br><span class="line">web-deploy-5ccc9d7c55               1         1         1       22h   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp-web,pod-template-hash=5ccc9d7c55</span><br><span class="line">[root@k8s-master podAffinity]# </span><br><span class="line">[root@k8s-master podAffinity]# kubectl get pod -o wide</span><br><span class="line">NAME                                      READY   STATUS    RESTARTS   AGE   IP             NODE         NOMINATED NODE   READINESS GATES</span><br><span class="line">pod-podaffinity-deploy-848559bf5b-8kkwm   1/1     Running   0          54s   10.244.0.80    k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podaffinity-deploy-848559bf5b-8s59f   1/1     Running   0          54s   10.244.2.252   k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podaffinity-deploy-848559bf5b-8z4dv   1/1     Running   0          54s   10.244.2.253   k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podaffinity-deploy-848559bf5b-gs7sb   1/1     Running   0          54s   10.244.0.79    k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podaffinity-deploy-848559bf5b-sm6nz   1/1     Running   0          54s   10.244.0.78    k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podaffinity-deploy-848559bf5b-zbr6v   1/1     Running   0          54s   10.244.2.251   k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">web-deploy-5ccc9d7c55-khhrr               1/1     Running   3          22h   10.244.2.245   k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><p>ç”±ä¸Šå¯è§ï¼Œyamlæ–‡ä»¶ä¸­ä¸ºtopologyKey: disk-typeï¼›è™½ç„¶k8s-masterã€k8s-node01ã€k8s-node02éƒ½æœ‰disk-typeæ ‡ç­¾ï¼›ä½†æ˜¯k8s-masterå’Œk8s-node02èŠ‚ç‚¹çš„disk-typeæ ‡ç­¾å€¼ä¸ºssdï¼›è€Œk8s-node01èŠ‚ç‚¹çš„disk-typeæ ‡ç­¾å€¼ä¸ºsataã€‚å› æ­¤k8s-masterå’Œk8s-node02èŠ‚ç‚¹å±äºåŒä¸€æ‹“æ‰‘åŸŸï¼ŒPodåªä¼šè°ƒåº¦åˆ°è¿™ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šã€‚</p><h2 id="podè½¯äº²å’Œæ€§ç¤ºä¾‹"><a href="#podè½¯äº²å’Œæ€§ç¤ºä¾‹" class="headerlink" title="podè½¯äº²å’Œæ€§ç¤ºä¾‹"></a>podè½¯äº²å’Œæ€§ç¤ºä¾‹</h2><p>è¦è¿è¡Œçš„yamlæ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># pwd</span></span><br><span class="line"><span class="string">/root/k8s_practice/scheduler/podAffinity</span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># </span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># cat pod_preferred_affinity.yaml </span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-podaffinity-deploy</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">podaffinity-deploy</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">6</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># å…è®¸åœ¨masterèŠ‚ç‚¹è¿è¡Œ</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br><span class="line">        <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">podAffinity:</span></span><br><span class="line">          <span class="attr">preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">100</span></span><br><span class="line">            <span class="attr">podAffinityTerm:</span></span><br><span class="line">              <span class="attr">labelSelector:</span></span><br><span class="line">                <span class="comment"># ç”±äºæ˜¯Podäº²å’Œæ€§/åäº²å’Œæ€§ï¼›å› æ­¤è¿™é‡ŒåŒ¹é…è§„åˆ™å†™çš„æ˜¯Podçš„æ ‡ç­¾ä¿¡æ¯</span></span><br><span class="line">                <span class="attr">matchExpressions:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">version</span></span><br><span class="line">                  <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                  <span class="attr">values:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">v1</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">v2</span></span><br><span class="line">              <span class="comment"># æ‹“æ‰‘åŸŸ  è‹¥å¤šä¸ªnodeèŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„æ ‡ç­¾ä¿¡æ¯ã€æ ‡ç­¾é”®å€¼ç›¸åŒã€‘ï¼Œåˆ™è¡¨ç¤ºè¿™äº›nodeèŠ‚ç‚¹å°±åœ¨åŒä¸€æ‹“æ‰‘åŸŸ</span></span><br><span class="line">              <span class="attr">topologyKey:</span> <span class="string">disk-type</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œyamlæ–‡ä»¶å¹¶æŸ¥çœ‹çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master podAffinity]# kubectl apply -f pod_preferred_affinity.yaml </span><br><span class="line">deployment.apps/pod-podaffinity-deploy created</span><br><span class="line">[root@k8s-master podAffinity]# </span><br><span class="line">[root@k8s-master podAffinity]# kubectl get deploy -o wide</span><br><span class="line">NAME                     READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                                                      SELECTOR</span><br><span class="line">pod-podaffinity-deploy   6/6     6            6           75s   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp</span><br><span class="line">web-deploy               1/1     1            1           25h   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp-web</span><br><span class="line">[root@k8s-master podAffinity]# </span><br><span class="line">[root@k8s-master podAffinity]# kubectl get rs -o wide</span><br><span class="line">NAME                                DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES                                                      SELECTOR</span><br><span class="line">pod-podaffinity-deploy-8474b4b586   6         6         6       79s   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp,pod-template-hash=8474b4b586</span><br><span class="line">web-deploy-5ccc9d7c55               1         1         1       25h   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp-web,pod-template-hash=5ccc9d7c55</span><br><span class="line">[root@k8s-master podAffinity]# </span><br><span class="line">[root@k8s-master podAffinity]# kubectl get pod -o wide</span><br><span class="line">NAME                                      READY   STATUS    RESTARTS   AGE   IP             NODE         NOMINATED NODE   READINESS GATES</span><br><span class="line">pod-podaffinity-deploy-8474b4b586-57gxh   1/1     Running   0          83s   10.244.2.4     k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podaffinity-deploy-8474b4b586-kd5l4   1/1     Running   0          83s   10.244.2.3     k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podaffinity-deploy-8474b4b586-mlvv7   1/1     Running   0          83s   10.244.0.84    k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podaffinity-deploy-8474b4b586-mtk6r   1/1     Running   0          83s   10.244.0.86    k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podaffinity-deploy-8474b4b586-n5jpj   1/1     Running   0          83s   10.244.0.85    k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podaffinity-deploy-8474b4b586-q2xdl   1/1     Running   0          83s   10.244.3.22    k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">web-deploy-5ccc9d7c55-khhrr               1/1     Running   3          25h   10.244.2.245   k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><p>ç”±ä¸Šå¯è§ï¼Œå†æ ¹æ®k8s-masterã€k8s-node01ã€k8s-node02çš„æ ‡ç­¾ä¿¡æ¯ï¼›å¾ˆå®¹æ˜“æ¨æ–­å‡ºPodä¼šä¼˜å…ˆè°ƒåº¦åˆ°k8s-masterã€k8s-node02èŠ‚ç‚¹ã€‚</p><h2 id="podç¡¬åäº²å’Œæ€§ç¤ºä¾‹"><a href="#podç¡¬åäº²å’Œæ€§ç¤ºä¾‹" class="headerlink" title="podç¡¬åäº²å’Œæ€§ç¤ºä¾‹"></a>podç¡¬åäº²å’Œæ€§ç¤ºä¾‹</h2><p>è¦è¿è¡Œçš„yamlæ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># pwd</span></span><br><span class="line"><span class="string">/root/k8s_practice/scheduler/podAffinity</span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># </span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># cat pod_required_AntiAffinity.yaml </span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-podantiaffinity-deploy</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">podantiaffinity-deploy</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">6</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># å…è®¸åœ¨masterèŠ‚ç‚¹è¿è¡Œ</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br><span class="line">        <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">podAntiAffinity:</span></span><br><span class="line">          <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">labelSelector:</span></span><br><span class="line">              <span class="comment"># ç”±äºæ˜¯Podäº²å’Œæ€§/åäº²å’Œæ€§ï¼›å› æ­¤è¿™é‡ŒåŒ¹é…è§„åˆ™å†™çš„æ˜¯Podçš„æ ‡ç­¾ä¿¡æ¯</span></span><br><span class="line">              <span class="attr">matchExpressions:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app</span></span><br><span class="line">                <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                <span class="attr">values:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">myapp-web</span></span><br><span class="line">            <span class="comment"># æ‹“æ‰‘åŸŸ  è‹¥å¤šä¸ªnodeèŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„æ ‡ç­¾ä¿¡æ¯ã€æ ‡ç­¾é”®å€¼ç›¸åŒã€‘ï¼Œåˆ™è¡¨ç¤ºè¿™äº›nodeèŠ‚ç‚¹å°±åœ¨åŒä¸€æ‹“æ‰‘åŸŸ</span></span><br><span class="line">            <span class="attr">topologyKey:</span> <span class="string">disk-type</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œyamlæ–‡ä»¶å¹¶æŸ¥çœ‹çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master podAffinity]# kubectl apply -f pod_required_AntiAffinity.yaml </span><br><span class="line">deployment.apps/pod-podantiaffinity-deploy created</span><br><span class="line">[root@k8s-master podAffinity]#</span><br><span class="line">[root@k8s-master podAffinity]# kubectl get deploy -o wide</span><br><span class="line">NAME                         READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                                                      SELECTOR</span><br><span class="line">pod-podantiaffinity-deploy   6/6     6            6           68s   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp</span><br><span class="line">web-deploy                   1/1     1            1           25h   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp-web</span><br><span class="line">[root@k8s-master podAffinity]# </span><br><span class="line">[root@k8s-master podAffinity]# kubectl get rs -o wide</span><br><span class="line">NAME                                    DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES                                                      SELECTOR</span><br><span class="line">pod-podantiaffinity-deploy-5fb4764b6b   6         6         6       72s   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp,pod-template-hash=5fb4764b6b</span><br><span class="line">web-deploy-5ccc9d7c55                   1         1         1       25h   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp-web,pod-template-hash=5ccc9d7c55</span><br><span class="line">[root@k8s-master podAffinity]# </span><br><span class="line">[root@k8s-master podAffinity]# kubectl get pod -o wide</span><br><span class="line">NAME                                          READY   STATUS    RESTARTS   AGE   IP             NODE         NOMINATED NODE   READINESS GATES</span><br><span class="line">pod-podantiaffinity-deploy-5fb4764b6b-b5bzd   1/1     Running   0          75s   10.244.3.28    k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podantiaffinity-deploy-5fb4764b6b-b6qjg   1/1     Running   0          75s   10.244.3.23    k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podantiaffinity-deploy-5fb4764b6b-h262g   1/1     Running   0          75s   10.244.3.27    k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podantiaffinity-deploy-5fb4764b6b-q98gt   1/1     Running   0          75s   10.244.3.24    k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podantiaffinity-deploy-5fb4764b6b-v6kpm   1/1     Running   0          75s   10.244.3.25    k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podantiaffinity-deploy-5fb4764b6b-wtmm6   1/1     Running   0          75s   10.244.3.26    k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">web-deploy-5ccc9d7c55-khhrr                   1/1     Running   3          25h   10.244.2.245   k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><p>ç”±ä¸Šå¯è§ï¼Œç”±äºæ˜¯Podåäº²å’Œæµ‹éªŒï¼Œå†æ ¹æ®k8s-masterã€k8s-node01ã€k8s-node02çš„æ ‡ç­¾ä¿¡æ¯ï¼›å¾ˆå®¹æ˜“æ¨æ–­å‡ºPodåªèƒ½è°ƒåº¦åˆ°k8s-node01èŠ‚ç‚¹ã€‚</p><h2 id="podè½¯åäº²å’Œæ€§ç¤ºä¾‹"><a href="#podè½¯åäº²å’Œæ€§ç¤ºä¾‹" class="headerlink" title="podè½¯åäº²å’Œæ€§ç¤ºä¾‹"></a>podè½¯åäº²å’Œæ€§ç¤ºä¾‹</h2><p>è¦è¿è¡Œçš„yamlæ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># pwd</span></span><br><span class="line"><span class="string">/root/k8s_practice/scheduler/podAffinity</span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># </span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># cat pod_preferred_AntiAffinity.yaml </span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-podantiaffinity-deploy</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">podantiaffinity-deploy</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">6</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># å…è®¸åœ¨masterèŠ‚ç‚¹è¿è¡Œ</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br><span class="line">        <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">podAntiAffinity:</span></span><br><span class="line">          <span class="attr">preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">100</span></span><br><span class="line">            <span class="attr">podAffinityTerm:</span></span><br><span class="line">              <span class="attr">labelSelector:</span></span><br><span class="line">                <span class="comment"># ç”±äºæ˜¯Podäº²å’Œæ€§/åäº²å’Œæ€§ï¼›å› æ­¤è¿™é‡ŒåŒ¹é…è§„åˆ™å†™çš„æ˜¯Podçš„æ ‡ç­¾ä¿¡æ¯</span></span><br><span class="line">                <span class="attr">matchExpressions:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">version</span></span><br><span class="line">                  <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                  <span class="attr">values:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">v1</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">v2</span></span><br><span class="line">              <span class="comment"># æ‹“æ‰‘åŸŸ  è‹¥å¤šä¸ªnodeèŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„æ ‡ç­¾ä¿¡æ¯ã€æ ‡ç­¾é”®å€¼ç›¸åŒã€‘ï¼Œåˆ™è¡¨ç¤ºè¿™äº›nodeèŠ‚ç‚¹å°±åœ¨åŒä¸€æ‹“æ‰‘åŸŸ</span></span><br><span class="line">              <span class="attr">topologyKey:</span> <span class="string">disk-type</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œyamlæ–‡ä»¶å¹¶æŸ¥çœ‹çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master podAffinity]# kubectl apply -f pod_preferred_AntiAffinity.yaml </span><br><span class="line">deployment.apps/pod-podantiaffinity-deploy created</span><br><span class="line">[root@k8s-master podAffinity]# </span><br><span class="line">[root@k8s-master podAffinity]# kubectl get deploy -o wide</span><br><span class="line">NAME                         READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                                                      SELECTOR</span><br><span class="line">pod-podantiaffinity-deploy   6/6     6            6           9s    myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp</span><br><span class="line">web-deploy                   1/1     1            1           26h   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp-web</span><br><span class="line">[root@k8s-master podAffinity]# </span><br><span class="line">[root@k8s-master podAffinity]# kubectl get rs -o wide</span><br><span class="line">NAME                                    DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES                                                      SELECTOR</span><br><span class="line">pod-podantiaffinity-deploy-54d758ddb4   6         6         6       13s   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp,pod-template-hash=54d758ddb4</span><br><span class="line">web-deploy-5ccc9d7c55                   1         1         1       26h   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp-web,pod-template-hash=5ccc9d7c55</span><br><span class="line">[root@k8s-master podAffinity]# </span><br><span class="line">[root@k8s-master podAffinity]# kubectl get pod -o wide</span><br><span class="line">NAME                                          READY   STATUS    RESTARTS   AGE   IP             NODE         NOMINATED NODE   READINESS GATES</span><br><span class="line">pod-podantiaffinity-deploy-54d758ddb4-58t9p   1/1     Running   0          17s   10.244.3.31    k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podantiaffinity-deploy-54d758ddb4-9ntd7   1/1     Running   0          17s   10.244.3.32    k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podantiaffinity-deploy-54d758ddb4-9wr6p   1/1     Running   0          17s   10.244.2.5     k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podantiaffinity-deploy-54d758ddb4-gnls4   1/1     Running   0          17s   10.244.3.30    k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podantiaffinity-deploy-54d758ddb4-jlftn   1/1     Running   0          17s   10.244.3.29    k8s-node01   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podantiaffinity-deploy-54d758ddb4-mvplv   1/1     Running   0          17s   10.244.0.87    k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">web-deploy-5ccc9d7c55-khhrr                   1/1     Running   3          26h   10.244.2.245   k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><p>ç”±ä¸Šå¯è§ï¼Œç”±äºæ˜¯Podåäº²å’Œæµ‹éªŒï¼Œå†æ ¹æ®k8s-masterã€k8s-node01ã€k8s-node02çš„æ ‡ç­¾ä¿¡æ¯ï¼›å¾ˆå®¹æ˜“æ¨æ–­å‡ºPodä¼šä¼˜å…ˆè°ƒåº¦åˆ°k8s-node01èŠ‚ç‚¹ã€‚</p><h2 id="podäº²å’Œæ€§ä¸åäº²å’Œæ€§è”åˆç¤ºä¾‹"><a href="#podäº²å’Œæ€§ä¸åäº²å’Œæ€§è”åˆç¤ºä¾‹" class="headerlink" title="podäº²å’Œæ€§ä¸åäº²å’Œæ€§è”åˆç¤ºä¾‹"></a>podäº²å’Œæ€§ä¸åäº²å’Œæ€§è”åˆç¤ºä¾‹</h2><p>è¦è¿è¡Œçš„yamlæ–‡ä»¶</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># pwd</span></span><br><span class="line"><span class="string">/root/k8s_practice/scheduler/podAffinity</span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># </span></span><br><span class="line">[<span class="string">root@k8s-master</span> <span class="string">podAffinity</span>]<span class="comment"># cat pod_podAffinity_all.yaml </span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-podaffinity-all-deploy</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">podaffinity-all-deploy</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">6</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="comment"># å…è®¸åœ¨masterèŠ‚ç‚¹è¿è¡Œ</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">node-role.kubernetes.io/master</span></span><br><span class="line">        <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">myapp-pod</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">podAffinity:</span></span><br><span class="line">          <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">labelSelector:</span></span><br><span class="line">              <span class="comment"># ç”±äºæ˜¯Podäº²å’Œæ€§/åäº²å’Œæ€§ï¼›å› æ­¤è¿™é‡ŒåŒ¹é…è§„åˆ™å†™çš„æ˜¯Podçš„æ ‡ç­¾ä¿¡æ¯</span></span><br><span class="line">              <span class="attr">matchExpressions:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app</span></span><br><span class="line">                <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                <span class="attr">values:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">myapp-web</span></span><br><span class="line">            <span class="comment"># æ‹“æ‰‘åŸŸ  è‹¥å¤šä¸ªnodeèŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„æ ‡ç­¾ä¿¡æ¯ã€æ ‡ç­¾é”®å€¼ç›¸åŒã€‘ï¼Œåˆ™è¡¨ç¤ºè¿™äº›nodeèŠ‚ç‚¹å°±åœ¨åŒä¸€æ‹“æ‰‘åŸŸ</span></span><br><span class="line">            <span class="attr">topologyKey:</span> <span class="string">disk-type</span></span><br><span class="line">        <span class="attr">podAntiAffinity:</span></span><br><span class="line">          <span class="attr">preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">100</span></span><br><span class="line">            <span class="attr">podAffinityTerm:</span></span><br><span class="line">              <span class="attr">labelSelector:</span></span><br><span class="line">                <span class="attr">matchExpressions:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">version</span></span><br><span class="line">                  <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                  <span class="attr">values:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">v1</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">v2</span></span><br><span class="line">              <span class="attr">topologyKey:</span> <span class="string">busi-db</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œyamlæ–‡ä»¶å¹¶æŸ¥çœ‹çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master podAffinity]# kubectl apply -f pod_podAffinity_all.yaml </span><br><span class="line">deployment.apps/pod-podaffinity-all-deploy created</span><br><span class="line">[root@k8s-master podAffinity]# </span><br><span class="line">[root@k8s-master podAffinity]# kubectl get deploy -o wide</span><br><span class="line">NAME                         READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                                                      SELECTOR</span><br><span class="line">pod-podaffinity-all-deploy   6/6     6            1           5s    myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp</span><br><span class="line">web-deploy                   1/1     1            1           28h   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp-web</span><br><span class="line">[root@k8s-master podAffinity]# </span><br><span class="line">[root@k8s-master podAffinity]# kubectl get rs -o wide</span><br><span class="line">NAME                                    DESIRED   CURRENT   READY   AGE   CONTAINERS   IMAGES                                                      SELECTOR</span><br><span class="line">pod-podaffinity-all-deploy-5ddbf9cbf8   6         6         6       10s   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp,pod-template-hash=5ddbf9cbf8</span><br><span class="line">web-deploy-5ccc9d7c55                   1         1         1       28h   myapp-pod    registry.cn-beijing.aliyuncs.com/google_registry/myapp:v1   app=myapp-web,pod-template-hash=5ccc9d7c55</span><br><span class="line">[root@k8s-master podAffinity]# </span><br><span class="line">[root@k8s-master podAffinity]# kubectl get pod -o wide</span><br><span class="line">NAME                                          READY   STATUS    RESTARTS   AGE   IP             NODE         NOMINATED NODE   READINESS GATES</span><br><span class="line">pod-podaffinity-all-deploy-5ddbf9cbf8-5w5b7   1/1     Running   0          15s   10.244.0.91    k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podaffinity-all-deploy-5ddbf9cbf8-j57g9   1/1     Running   0          15s   10.244.0.90    k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podaffinity-all-deploy-5ddbf9cbf8-kwz6w   1/1     Running   0          15s   10.244.0.92    k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podaffinity-all-deploy-5ddbf9cbf8-l8spj   1/1     Running   0          15s   10.244.2.6     k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podaffinity-all-deploy-5ddbf9cbf8-lf22c   1/1     Running   0          15s   10.244.0.89    k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">pod-podaffinity-all-deploy-5ddbf9cbf8-r2fgl   1/1     Running   0          15s   10.244.0.88    k8s-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">web-deploy-5ccc9d7c55-khhrr                   1/1     Running   3          28h   10.244.2.245   k8s-node02   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure><p>ç”±ä¸Šå¯è§ï¼Œæ ¹æ®k8s-masterã€k8s-node01ã€k8s-node02çš„æ ‡ç­¾ä¿¡æ¯ï¼›å¾ˆå®¹æ˜“æ¨æ–­å‡ºPodåªèƒ½è°ƒåº¦åˆ°k8s-masterã€k8s-node02èŠ‚ç‚¹ï¼Œä¸”ä¼šä¼˜å…ˆè°ƒåº¦åˆ°k8s-masterèŠ‚ç‚¹ã€‚</p><h1 id="è¡¥å……ï¼štopologySpreadConstraints-æ‹“æ‰‘åˆ†å¸ƒçº¦æŸ-æœ‰åŒºåˆ«äºaffinityï¼Œä½†ä¹Ÿå¯ä»¥æ§åˆ¶-Pod-åœ¨æŸäº›èŠ‚ç‚¹çš„åˆ†å¸ƒ"><a href="#è¡¥å……ï¼štopologySpreadConstraints-æ‹“æ‰‘åˆ†å¸ƒçº¦æŸ-æœ‰åŒºåˆ«äºaffinityï¼Œä½†ä¹Ÿå¯ä»¥æ§åˆ¶-Pod-åœ¨æŸäº›èŠ‚ç‚¹çš„åˆ†å¸ƒ" class="headerlink" title="è¡¥å……ï¼štopologySpreadConstraints(æ‹“æ‰‘åˆ†å¸ƒçº¦æŸ, æœ‰åŒºåˆ«äºaffinityï¼Œä½†ä¹Ÿå¯ä»¥æ§åˆ¶ Pod åœ¨æŸäº›èŠ‚ç‚¹çš„åˆ†å¸ƒ)"></a>è¡¥å……ï¼štopologySpreadConstraints(æ‹“æ‰‘åˆ†å¸ƒçº¦æŸ, æœ‰åŒºåˆ«äºaffinityï¼Œä½†ä¹Ÿå¯ä»¥æ§åˆ¶ Pod åœ¨æŸäº›èŠ‚ç‚¹çš„åˆ†å¸ƒ)</h1><blockquote><p>é¦–å…ˆå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªèŠ‚ç‚¹, node1, node2</p></blockquote><ol><li>æˆ‘ä»¬éœ€è¦ç»™ä¸¤ä¸ªå‡ ç‚¹æ‰“ä¸Šæ ‡ç­¾</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl label nodes node1 address=ChongQing</span><br><span class="line">kubectl label nodes node2 address=BeiJing</span><br><span class="line">kubectl get nodes --show-labels</span><br></pre></td></tr></table></figure><ol start="2"><li>é…ç½®æœåŠ¡éƒ¨ç½²æ–‡ä»¶</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spring-k8s</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">spring-k8s</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">xxx</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">      <span class="comment"># ç”¨äºæè¿° Pod è¦åœ¨ä»€ä¹ˆæ‹“æ‰‘ç»“æ„ä¸Šè¿›è¡Œå‡è¡¡æ‰“æ•£ï¼Œå¤šä¸ª topologySpreadConstraint ä¹‹é—´æ˜¯ and å…³ç³»ï¼›</span></span><br><span class="line">      <span class="attr">topologySpreadConstraints:</span></span><br><span class="line">        <span class="comment"># è¡¨ç¤ºæŒ‰ç…§ä»€ä¹ˆæ ‡ç­¾è¿›è¡ŒåŒºåˆ†ï¼›</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">topologyKey:</span> <span class="string">address</span></span><br><span class="line">          <span class="comment"># æœ€å¤§å…è®¸çš„ä¸å‡è¡¡æ•°é‡ï¼›å‡è®¾é›†ç¾¤ä¸­æœ‰ä¸‰ä¸ªzoneï¼ŒæŸä¸ªéƒ¨ç½²çš„Podåœ¨zone1å’Œzone2ä¸­éƒ½åˆ†é…äº†ä¸€ä¸ªPodã€‚</span></span><br><span class="line">          <span class="comment"># è®¡ç®—ä¸å‡è¡¡æ•°é‡å…¬å¼ä¸ºï¼šSkew = count[topo] - min(count[topo])ï¼Œç”±æ­¤å¯ä»¥ç®—å‡ºä¸‰ä¸ªzoneçš„Skewåˆ†åˆ«æ˜¯1ã€1ã€0ã€‚</span></span><br><span class="line">          <span class="comment"># å¦‚æœæ–°Podåˆ†é…åˆ°zone1/zone2ï¼Œzone1/zone2çš„skewå°†å˜ä¸º2ï¼Œå¤§äºè®¾ç½®çš„maxSkew=1ï¼›å¦‚æœåˆ†é…åˆ°zone3çš„è¯ï¼Œzone1-zone3çš„Skewå‡ä¸º0ã€‚å› æ­¤æ–°Podåªèƒ½åˆ†é…åˆ°zone3</span></span><br><span class="line">          <span class="comment"># å‡è®¾maxSkewä¸º2ï¼Œå¦‚æœæ–°Podåˆ†é…åˆ°zone1/zone2ï¼Œskew çš„å€¼ä¸º2 &lt;=maxSkewã€‚å› æ­¤zone1-zone3éƒ½æ˜¯å…è®¸çš„ã€‚</span></span><br><span class="line">          <span class="attr">maxSkew:</span> <span class="number">1</span></span><br><span class="line">          <span class="comment"># è¡¨ç¤ºä¸æ»¡è¶³æ—¶é‡‡å–ä»€ä¹ˆç­–ç•¥ï¼ŒDoNotSchedule è¡¨ç¤ºä¸è°ƒåº¦ï¼ŒScheduleAnyway è¡¨ç¤ºä¸ç®¡æ€æ ·éƒ½è°ƒåº¦ï¼›</span></span><br><span class="line">          <span class="attr">whenUnsatisfiable:</span> <span class="string">DoNotSchedule</span></span><br><span class="line">          <span class="attr">labelSelector:</span></span><br><span class="line">            <span class="attr">matchLabels:</span></span><br><span class="line">              <span class="attr">app:</span> <span class="string">myapp</span></span><br></pre></td></tr></table></figure><ol start="3"><li>éªŒè¯</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># kubectl get pod -o wide</span></span><br><span class="line">NAME               READY   STATUS    RESTARTS   AGE   IP             NODE    NOMINATED NODE   READINESS GATES</span><br><span class="line">spring-k8s         1/1     Running   0          55m   10.244.2.172   node2   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">spring-k8s-89p7d   1/1     Running   0          20s   10.244.2.181   node2   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">spring-k8s-v4nqb   1/1     Running   0          20s   10.244.1.219   node1   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…:</span> <span class="post-copyright-info"><a href="https://xiaowu95.wang">å°äº”</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥:</span> <span class="post-copyright-info"><a href="https://xiaowu95.wang/posts/90513b00/">https://xiaowu95.wang/posts/90513b00/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜:</span> <span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://xiaowu95.wang" target="_blank">å°äº”çš„ä¸ªäººæ‚è´§é“º</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/k8s/">k8s</a><a class="post-meta__tags" href="/tags/%E5%AE%B9%E5%99%A8%E5%8C%96/">å®¹å™¨åŒ–</a><a class="post-meta__tags" href="/tags/k3s/">k3s</a><a class="post-meta__tags" href="/tags/rancher/">rancher</a></div><div class="post-share"><div class="social-share" data-image="/img/nba-logo17.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>æ„Ÿè°¢æ”¯æŒ</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wxpay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-lazy-src="/img/wxpay.jpg" alt="å¾®ä¿¡"></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-lazy-src="/img/alipay.jpg" alt="æ”¯ä»˜å®"></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/9c544337/" title="Elasticsearchï¼šSnapshotå¤‡ä»½ä¸æ¢å¤"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo18.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">Elasticsearchï¼šSnapshotå¤‡ä»½ä¸æ¢å¤</div></div><div class="info-2"><div class="info-item-1">SnapshotElasticsearchæ–‡æ¡£é‡Œå¯¹äºsnapshotæœ‰å¦‚ä¸‹æè¿°ï¼š 1The index snapshot process is incremental. In the process of making the index snapshot Elasticsearch analyses the list of the index files that are already stored in the repository and copies only files that were created or changed since the last snapshot. è¿™é‡Œè¯´snapshotæ˜¯å¢é‡å¤‡ä»½çš„ï¼Œæ¯æ¬¡snapshotï¼ŒEsä¼šåˆ†æindexæ–‡ä»¶ï¼Œå¹¶ä¸”åªå¤‡ä»½å¢é‡éƒ¨åˆ†ã€‚ snapshotæ˜¯å¢é‡å¤‡ä»½ï¼Œå¯¹æœªå‘ç”Ÿå˜åŒ–çš„indexé‡å¤å¤‡ä»½å‡ ä¹æ²¡æœ‰èµ„æºæ¶ˆè€—ï¼› åˆ é™¤snapshotä¸ä¼šå¯¹å…¶å®ƒsnapshotäº§ç”Ÿå½±å“ï¼› snapshotæ˜¯å¢é‡å¤‡ä»½ï¼Œå¯¹æœªå‘ç”Ÿå˜åŒ–çš„indexé‡å¤å¤‡ä»½å‡ ä¹æ²¡æœ‰èµ„æºæ¶ˆè€— åˆ é™¤æŸä¸ªsnapshotä¸ä¼šå¯¹å…¶å®ƒsnapshotäº§ç”Ÿå½±å“ã€‚ æ“ä½œå»ºä»“...</div></div></div></a><a class="pagination-related" href="/posts/88a095a/" title="Unicodeä¸­æ–‡ä¹±ç é€ŸæŸ¥è¡¨"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo13.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">Unicodeä¸­æ–‡ä¹±ç é€ŸæŸ¥è¡¨</div></div><div class="info-2"><div class="info-item-1">Unicode ä¸­æ–‡ä¹±ç é€ŸæŸ¥è¡¨ xxxxxx ç¤ºä¾‹ ç‰¹ç‚¹ äº§ç”ŸåŸå›  å¤æ–‡ç  é¢è¾¨æ¹€ç‘•ä½¸ã‚½æ¿‚è—‰æ¶”çŠ²ã‰æ¾¶â•æ‚œæ¶“? å¤§éƒ½ä¸ºä¸è®¤è¯†çš„å¤æ–‡ï¼Œå¹¶åŠ æ‚æ—¥éŸ©æ–‡ ä»¥ GBK æ–¹å¼è¯»å– UTF-8 ç¼–ç çš„ä¸­æ–‡ å£å­—ç  ï¿½ï¿½ï¿½ï¿½Òªï¿½Â¨2ï¿½Ñ§Ï°ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ å¤§éƒ¨åˆ†å­—ç¬¦ä¸ºå°æ–¹å— ä»¥ UTF-8 çš„æ–¹å¼è¯»å– GBK ç¼–ç çš„ä¸­æ–‡ ç¬¦å·ç  Ã§â€Â±Ã¦Å“Ë†Ã¨|ÂÃ¥ï¿¥Â½Ã¥ï¿¥Â½Ã¥-|Ã¤1 Ã¥Â¤Â©Ã¥Â¤Â©Ã¥Ââ€˜Ã¤Â¸Å  å¤§éƒ¨åˆ†å­—ç¬¦ä¸ºå„ç§ç¬¦å· ä»¥ ISO8859-1 æ–¹å¼è¯»å– UTF-8 ç¼–ç çš„ä¸­æ–‡ æ‹¼éŸ³ç  Ã³Ã©Ã”Ã‚Ã²aoÃƒoÃƒÃ‘Â§ÃÂ°Ã¬Ã¬Ã¬Ã¬ÃÃ²Ã©Ã å¤§éƒ¨åˆ†å­—ç¬¦ä¸ºå¤´é¡¶å¸¦æœ‰å„ç§ç±»ä¼¼å£°è°ƒç¬¦å·çš„å­—æ¯ ä»¥ ISO8859-1 æ–¹å¼è¯»å– GBK ç¼–ç çš„ä¸­æ–‡ é—®å¥ç  ç”±æœˆè¦å¥½å¥½å­¦ä¹ å¤©å¤©å‘?? å­—ç¬¦ä¸²é•¿åº¦ä¸ºå¶æ•°æ—¶æ­£ç¡®ï¼Œé•¿åº¦ä¸ºå¥‡æ•°æ—¶æœ€åçš„å­—ç¬¦å˜ä¸ºé—®å· ä»¥ GBK æ–¹å¼è¯»å– UTF-8 ç¼–ç çš„ä¸­æ–‡ï¼Œç„¶ååˆç”¨ UTF-8 çš„æ ¼å¼å†æ¬¡è¯»å– é”Ÿæ‹·ç  é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·è¦é”ŸçŸ«çŒ´æ‹·å­¦ä¹ é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹·é”Ÿæ–¤æ‹· å…¨ä¸­æ–‡å­—ç¬¦ï¼Œä¸”å¤§éƒ¨åˆ†å­—ç¬¦ä¸ºâ€œé”Ÿæ–¤æ‹·â€è¿™å‡ ä¸ªå­—ç¬¦ ä»¥ UTF-8 æ–¹å¼è¯»å– GBK ç¼–ç çš„ä¸­æ–‡ï¼Œç„¶ååˆç”¨ GBK çš„æ ¼å¼å†æ¬¡...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/bbffb116/" title="kubeconfigæ–‡ä»¶è¯¦è§£"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo26.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2023-09-26</div><div class="info-item-2">kubeconfigæ–‡ä»¶è¯¦è§£</div></div><div class="info-2"><div class="info-item-1">åœ¨nodeèŠ‚ç‚¹ä¸Šå¯ä»¥æ‰§è¡Œkubectlå‘½ä»¤å—ï¼Ÿ 12[root@k8s-node1 ~]# kubectl get nodeThe connection to the server localhost:8080 was refused - did you specify the right host or port? localhost:8080 è¿™ä¸ªç«¯å£æ˜¯k8s apiï¼ˆkube-apiserveréå®‰å…¨ç«¯å£ï¼‰çš„ç«¯å£ï¼Œ*åœ¨masterä¸Šé¢å¯ä»¥æ‰§è¡ŒæˆåŠŸå…¶å®èµ°çš„æ˜¯é…ç½®æ–‡ä»¶ã€‚ä½†æ˜¯åœ¨nodeä¸Šè¿æ¥çš„æ˜¯æœ¬åœ°çš„éå®‰å…¨ç«¯å£ã€‚* å…¶å®è¿˜æœ‰ä¸€ä¸ªå¯¹å¤–ç«¯å£æ˜¯6443ï¼Œè¿™ä¸ªæ˜¯kube-apiserverç›‘å¬çš„ï¼Œmasterip:6443å®‰å…¨ç«¯å£ 12[root@k8s-master ~]# netstat -tpln | grep 6443tcp6 0 0 :::6443 :::* LISTEN 92617/kube-apiserve ä»€ä¹ˆå«å®‰å…¨ç«¯å£ï¼Œä»€ä¹ˆå«éå®‰å…¨ç«¯å£ kube-apiserve...</div></div></div></a><a class="pagination-related" href="/posts/67fd0ae0/" title="helmå‘½ä»¤"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-01-10</div><div class="info-item-2">helmå‘½ä»¤</div></div><div class="info-2"><div class="info-item-1">æŸ¥çœ‹æ‰€æœ‰repo1helm repo list åˆ é™¤repo1helm repo remove stable æ·»åŠ repo1helm repo add stable https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts æ›´æ–°1helm repo update ä¸‹è½½æŒ‡å®šç‰ˆæœ¬Rancher ç‰ˆæœ¬ tgz å‹ç¼©åŒ…åˆ°æœ¬åœ°1helm fetch rancher-stable/rancher --version=v2.5.8 éƒ¨ç½²å‡çº§,æŠŠè¯»å–çš„éƒ¨ç½²å‚æ•°ä½¿ç”¨ --set &lt;key&gt;=&lt;value&gt; çš„æ–¹å¼æ·»åŠ åˆ°å‘½ä»¤ä¸­1234helm upgrade rancher rancher-stable/rancher \--namespace cattle-system \--set ingress.tls.source=secret \--set hostname=&lt;domain_name&gt; helmå‘½ä»¤å¤§å…¨ - é“¾æ¥</div></div></div></a><a class="pagination-related" href="/posts/af2a1e86/" title="helmçš„å®‰è£…"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo21.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2023-08-09</div><div class="info-item-2">helmçš„å®‰è£…</div></div><div class="info-2"><div class="info-item-1">ä¸‹è½½helm3.81wget https://get.helm.sh/helm-v3.8.0-linux-amd64.tar.gz è§£å‹1tar -zxvf helm-v3.8.0-linux-amd64.tar.gz èµ‹æƒ1mv linux-amd64/helm /usr/local/bin/helm &amp;&amp; chmod +x /usr/local/bin/helm</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-lazy-src="/img/avatar.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">å°äº”</div><div class="author-info-description">Tomorrow will be better,Everything will be fine</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">554</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">168</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">55</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/wang-xiaowu"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons"><a class="social-icon" href="/random" target="_blank" title="éšä¾¿é€›é€›"><i class="fa-solid fa-shuffle"></i></a><a class="social-icon" href="mailto:wangxiaowu950330@foxmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/30655189?spm_id_from=333.1007.0.0" rel="external nofollow noreferrer" target="_blank" title="BiliBili"><i class="fa-brands fa-bilibili"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa-solid fa-rss"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%E8%A7%84%E5%88%92"><span class="toc-number">1.</span> <span class="toc-text">ä¸»æœºé…ç½®è§„åˆ’</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%B2%E5%92%8C%E6%80%A7%E5%92%8C%E5%8F%8D%E4%BA%B2%E5%92%8C%E6%80%A7"><span class="toc-number">2.</span> <span class="toc-text">äº²å’Œæ€§å’Œåäº²å’Œæ€§</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#node%E8%8A%82%E7%82%B9%E4%BA%B2%E5%92%8C%E6%80%A7"><span class="toc-number">3.</span> <span class="toc-text">nodeèŠ‚ç‚¹äº²å’Œæ€§</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#node%E8%8A%82%E7%82%B9%E4%BA%B2%E5%92%8C%E6%80%A7%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.</span> <span class="toc-text">nodeèŠ‚ç‚¹äº²å’Œæ€§ç¤ºä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E4%BA%8B%E9%A1%B9"><span class="toc-number">4.1.</span> <span class="toc-text">å‡†å¤‡äº‹é¡¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#node%E7%A1%AC%E4%BA%B2%E5%92%8C%E6%80%A7%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.2.</span> <span class="toc-text">nodeç¡¬äº²å’Œæ€§ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#node%E8%BD%AF%E4%BA%B2%E5%92%8C%E6%80%A7%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.3.</span> <span class="toc-text">nodeè½¯äº²å’Œæ€§ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#node%E8%BD%AF%E7%A1%AC%E4%BA%B2%E5%92%8C%E6%80%A7%E8%81%94%E5%90%88%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.4.</span> <span class="toc-text">nodeè½¯ç¡¬äº²å’Œæ€§è”åˆç¤ºä¾‹</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Pod%E4%BA%B2%E5%92%8C%E6%80%A7"><span class="toc-number">5.</span> <span class="toc-text">Podäº²å’Œæ€§</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#pod%E4%BA%B2%E5%92%8C%E6%80%A7%E4%B8%8E%E5%8F%8D%E4%BA%B2%E5%92%8C%E6%80%A7%E7%A4%BA%E4%BE%8B"><span class="toc-number">6.</span> <span class="toc-text">podäº²å’Œæ€§ä¸åäº²å’Œæ€§ç¤ºä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E4%BA%8B%E9%A1%B9-1"><span class="toc-number">6.1.</span> <span class="toc-text">å‡†å¤‡äº‹é¡¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pod%E7%A1%AC%E4%BA%B2%E5%92%8C%E6%80%A7%E7%A4%BA%E4%BE%8B"><span class="toc-number">6.2.</span> <span class="toc-text">podç¡¬äº²å’Œæ€§ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pod%E8%BD%AF%E4%BA%B2%E5%92%8C%E6%80%A7%E7%A4%BA%E4%BE%8B"><span class="toc-number">6.3.</span> <span class="toc-text">podè½¯äº²å’Œæ€§ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pod%E7%A1%AC%E5%8F%8D%E4%BA%B2%E5%92%8C%E6%80%A7%E7%A4%BA%E4%BE%8B"><span class="toc-number">6.4.</span> <span class="toc-text">podç¡¬åäº²å’Œæ€§ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pod%E8%BD%AF%E5%8F%8D%E4%BA%B2%E5%92%8C%E6%80%A7%E7%A4%BA%E4%BE%8B"><span class="toc-number">6.5.</span> <span class="toc-text">podè½¯åäº²å’Œæ€§ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pod%E4%BA%B2%E5%92%8C%E6%80%A7%E4%B8%8E%E5%8F%8D%E4%BA%B2%E5%92%8C%E6%80%A7%E8%81%94%E5%90%88%E7%A4%BA%E4%BE%8B"><span class="toc-number">6.6.</span> <span class="toc-text">podäº²å’Œæ€§ä¸åäº²å’Œæ€§è”åˆç¤ºä¾‹</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%EF%BC%9AtopologySpreadConstraints-%E6%8B%93%E6%89%91%E5%88%86%E5%B8%83%E7%BA%A6%E6%9D%9F-%E6%9C%89%E5%8C%BA%E5%88%AB%E4%BA%8Eaffinity%EF%BC%8C%E4%BD%86%E4%B9%9F%E5%8F%AF%E4%BB%A5%E6%8E%A7%E5%88%B6-Pod-%E5%9C%A8%E6%9F%90%E4%BA%9B%E8%8A%82%E7%82%B9%E7%9A%84%E5%88%86%E5%B8%83"><span class="toc-number">7.</span> <span class="toc-text">è¡¥å……ï¼štopologySpreadConstraints(æ‹“æ‰‘åˆ†å¸ƒçº¦æŸ, æœ‰åŒºåˆ«äºaffinityï¼Œä½†ä¹Ÿå¯ä»¥æ§åˆ¶ Pod åœ¨æŸäº›èŠ‚ç‚¹çš„åˆ†å¸ƒ)</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/d31147a5/" title="Clawdbotå®Œæ•´é…ç½®æŒ‡å—"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo16.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Clawdbotå®Œæ•´é…ç½®æŒ‡å—"></a><div class="content"><a class="title" href="/posts/d31147a5/" title="Clawdbotå®Œæ•´é…ç½®æŒ‡å—">Clawdbotå®Œæ•´é…ç½®æŒ‡å—</a><time datetime="2026-02-11T10:15:08.000Z" title="å‘è¡¨äº 2026-02-11 18:15:08">2026-02-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4d3a9a89/" title="å¤„ç† Rancher è¿æ¥èŠ‚ç‚¹ &quot;Cluster agent is not connected&quot;"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo29.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="å¤„ç† Rancher è¿æ¥èŠ‚ç‚¹ &quot;Cluster agent is not connected&quot;"></a><div class="content"><a class="title" href="/posts/4d3a9a89/" title="å¤„ç† Rancher è¿æ¥èŠ‚ç‚¹ &quot;Cluster agent is not connected&quot;">å¤„ç† Rancher è¿æ¥èŠ‚ç‚¹ &quot;Cluster agent is not connected&quot;</a><time datetime="2026-02-03T06:02:28.000Z" title="å‘è¡¨äº 2026-02-03 14:02:28">2026-02-03</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/nba-logo17.jpg)"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2019 - 2026 By å°äº”</span><span class="framework-info"><span>æ¡†æ¶</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.1</a></span></div><div class="footer_custom_text"><a href="https://www.foreverblog.cn/" rel="external nofollow noreferrer" target="_blank"><img src="/img/loading.gif" data-lazy-src="https://img.foreverblog.cn/logo_en_default.png" alt="åå¹´ä¹‹çº¦" style="width:auto;height:16px"></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.1/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.1/source/js/main.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.1/source/js/tw_cn.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(()=>{const e=()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");if(0===e.length)return;const t=()=>(e=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";e.forEach(((e,n)=>{const d=e.firstElementChild,a=`mermaid-${n}`,r=`%%{init:{ 'theme':'${t}'}}%%\n`+d.textContent,i=mermaid.render(a,r),m=e=>{d.insertAdjacentHTML("afterend",e)};"string"==typeof i?m(i):i.then((({svg:e})=>m(e)))}))})(e);btf.addGlobalFn("themeChange",t,"mermaid"),window.loadMermaid?t():btf.getScript("https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js").then(t)};btf.addGlobalFn("encrypt",e,"mermaid"),window.pjax?e():document.addEventListener("DOMContentLoaded",e)})()</script><script>(()=>{const t=(e,a)=>{"object"==typeof e&&null!==e&&Object.keys(e).forEach((r=>{const n=e[r];"object"==typeof n&&null!==n&&(n[a]?e[r]=n[a]:t(n,a))}))},e=e=>{window.loadChartJS=!0,Array.from(e).forEach(((e,a)=>{const r=e.firstElementChild,n=e.getAttribute("data-chartjs-id")||"chartjs-"+a,d=e.getAttribute("data-width"),o=document.getElementById(n);o&&o.parentNode.remove();const c=r.textContent,l=document.createElement("canvas");l.id=n;const s=document.createElement("div");s.className="chartjs-wrap",d&&(s.style.width=d),s.appendChild(l),r.insertAdjacentElement("afterend",s);const h=document.getElementById(n).getContext("2d"),i=JSON.parse(c),m="dark"===document.documentElement.getAttribute("data-theme")?"dark-mode":"light-mode";(t=>{"dark-mode"===t?(Chart.defaults.color="rgba(255, 255, 255, 0.8)",Chart.defaults.borderColor="rgba(255, 255, 255, 0.2)",Chart.defaults.scale.ticks.backdropColor="transparent"):(Chart.defaults.color="rgba(0, 0, 0, 0.8)",Chart.defaults.borderColor="rgba(0, 0, 0, 0.1)",Chart.defaults.scale.ticks.backdropColor="transparent")})(m),t(i,m),new Chart(h,i)}))},a=()=>{const t=document.querySelectorAll("#article-container .chartjs-container");0!==t.length&&(window.loadChartJS?e(t):btf.getScript("https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js").then((()=>e(t))))};btf.addGlobalFn("themeChange",a,"chartjs"),btf.addGlobalFn("encrypt",a,"chartjs"),window.pjax?a():document.addEventListener("DOMContentLoaded",a)})()</script></div><div class="aplayer no-destroy" data-id="9061017364" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listfolded="false" data-order="random" data-lrctype="1" data-preload="none" data-autoplay="false" muted></div><div class="app-refresh" id="app-refresh"><div class="app-refresh-wrap"><label>ç½‘ç«™å·²æ›´æ–°æœ€æ–°ç‰ˆæœ¬</label> <a href="javascript:void(0)" rel="external nofollow noreferrer" onclick="location.reload()">ç‚¹å‡»åˆ·æ–°</a></div></div><script>function showNotification(){if(GLOBAL_CONFIG.Snackbar){var t="light"===document.documentElement.getAttribute("data-theme")?GLOBAL_CONFIG.Snackbar.bgLight:GLOBAL_CONFIG.Snackbar.bgDark,e=GLOBAL_CONFIG.Snackbar.position;Snackbar.show({text:"å·²æ›´æ–°æœ€æ–°ç‰ˆæœ¬",backgroundColor:t,duration:5e5,pos:e,actionText:"ç‚¹å‡»åˆ·æ–°",actionTextColor:"#fff",onActionClick:function(t){location.reload()}})}else{var o=`top: 0; background: ${"light"===document.documentElement.getAttribute("data-theme")?"#49b1f5":"#1f1f1f"};`;document.getElementById("app-refresh").style.cssText=o}}"serviceWorker"in navigator&&(navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("controllerchange",(function(){showNotification()})),window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js")})))</script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="/js/diytitle.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!0,document.body.addEventListener("input",POWERMODE)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/metingjs/dist/Meting.min.js"></script><script>btf.addGlobalFn("pjaxSend",(()=>{if(window.aplayers)for(let a=0;a<window.aplayers.length;a++)window.aplayers[a].options.fixed||window.aplayers[a].destroy()}),"destroyAplayer"),btf.addGlobalFn("pjaxComplete",loadMeting,"runMetingJS")</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>(()=>{window.pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/talking/"]):not([href="/artitalk/"])',selectors:['meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]','meta[property="og:description"]','link[rel="canonical"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"],cacheBust:!1,analytics:!0,scrollRestoration:!1});const e=e=>{e&&Object.values(e).forEach((e=>{try{e()}catch(e){console.debug("Pjax callback failed:",e)}}))};document.addEventListener("pjax:send",(()=>{btf.removeGlobalFnEvent("pjaxSendOnce"),btf.removeGlobalFnEvent("themeChange");const t=document.body.classList;t.contains("read-mode")&&t.remove("read-mode"),e(window.globalFn.pjaxSend)})),document.addEventListener("pjax:complete",(()=>{btf.removeGlobalFnEvent("pjaxCompleteOnce"),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),a=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(a)),e.parentNode.replaceChild(t,e)})),e(window.globalFn.pjaxComplete)})),document.addEventListener("pjax:error",(e=>{if(404===e.request.status){!0?pjax.loadUrl("/404"):window.location.href="/404"}}))})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div id="algolia-search-input"><div class="ais-SearchBox"><form class="ais-SearchBox-form" action="" role="search" novalidate><input class="ais-SearchBox-input" type="search" placeholder="æœç´¢æ–‡ç« " autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" maxlength="512" aria-label="Search"><button class="ais-SearchBox-submit" type="submit" title="Submit the search query" style="display:none"><svg class="ais-SearchBox-submitIcon" width="10" height="10" viewBox="0 0 40 40" aria-hidden="true"><path d="M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z"></path></svg></button></form></div><hr><div id="algolia-search-results"><div id="algolia-hits"><div id="algolia-hits-empty" style="display:none"></div><div class="ais-Hits" style="display:none"><ol class="ais-Hits-list"></ol></div></div><div class="ais-Pagination" id="algolia-pagination" style="display:none"><ul class="ais-Pagination-list"></ul></div><div id="algolia-info"><span class="ais-Stats-text"></span><a class="algolia-poweredBy" href="https://www.algolia.com/?utm_source=algoliasearch.js&amp;utm_medium=website&amp;utm_content=localhost&amp;utm_campaign=poweredby" target="_blank" aria-label="Search by Algolia" rel="noopener noreferrer"><svg class="ais-PoweredBy-logo" height="1.2em" viewBox="0 0 572 64" style="width:auto"><path fill="#36395A" d="M16 48.3c-3.4 0-6.3-.6-8.7-1.7A12.4 12.4 0 0 1 1.9 42C.6 40 0 38 0 35.4h6.5a6.7 6.7 0 0 0 3.9 6c1.4.7 3.3 1.1 5.6 1.1 2.2 0 4-.3 5.4-1a7 7 0 0 0 3-2.4 6 6 0 0 0 1-3.4c0-1.5-.6-2.8-1.9-3.7-1.3-1-3.3-1.6-5.9-1.8l-4-.4c-3.7-.3-6.6-1.4-8.8-3.4a10 10 0 0 1-3.3-7.9c0-2.4.6-4.6 1.8-6.4a12 12 0 0 1 5-4.3c2.2-1 4.7-1.6 7.5-1.6s5.5.5 7.6 1.6a12 12 0 0 1 5 4.4c1.2 1.8 1.8 4 1.8 6.7h-6.5a6.4 6.4 0 0 0-3.5-5.9c-1-.6-2.6-1-4.4-1s-3.2.3-4.4 1c-1.1.6-2 1.4-2.6 2.4-.5 1-.8 2-.8 3.1a5 5 0 0 0 1.5 3.6c1 1 2.6 1.7 4.7 1.9l4 .3c2.8.2 5.2.8 7.2 1.8 2.1 1 3.7 2.2 4.9 3.8a9.7 9.7 0 0 1 1.7 5.8c0 2.5-.7 4.7-2 6.6a13 13 0 0 1-5.6 4.4c-2.4 1-5.2 1.6-8.4 1.6Zm35.6 0c-2.6 0-4.8-.4-6.7-1.3a13 13 0 0 1-4.7-3.5 17.1 17.1 0 0 1-3.6-10.4v-1c0-2 .3-3.8 1-5.6a13 13 0 0 1 7.3-8.3 15 15 0 0 1 6.3-1.4A13.2 13.2 0 0 1 64 24.3c1 2.2 1.6 4.6 1.6 7.2V34H39.4v-4.3h21.8l-1.8 2.2c0-2-.3-3.7-.9-5.1a7.3 7.3 0 0 0-2.7-3.4c-1.2-.7-2.7-1.1-4.6-1.1s-3.4.4-4.7 1.3a8 8 0 0 0-2.9 3.6c-.6 1.5-.9 3.3-.9 5.4 0 2 .3 3.7 1 5.3a7.9 7.9 0 0 0 2.8 3.7c1.3.8 3 1.3 5 1.3s3.8-.5 5.1-1.3c1.3-1 2.1-2 2.4-3.2h6a11.8 11.8 0 0 1-7 8.7 16 16 0 0 1-6.4 1.2ZM80 48c-2.2 0-4-.3-5.7-1a8.4 8.4 0 0 1-3.7-3.3 9.7 9.7 0 0 1-1.3-5.2c0-2 .5-3.8 1.5-5.2a9 9 0 0 1 4.3-3.1c1.8-.7 4-1 6.7-1H89v4.1h-7.5c-2 0-3.4.5-4.4 1.4-1 1-1.6 2.1-1.6 3.6s.5 2.7 1.6 3.6c1 1 2.5 1.4 4.4 1.4 1.1 0 2.2-.2 3.2-.7 1-.4 1.9-1 2.6-2 .6-1 1-2.4 1-4.2l1.7 2.1c-.2 2-.7 3.8-1.5 5.2a9 9 0 0 1-3.4 3.3 12 12 0 0 1-5.3 1Zm9.5-.7v-8.8h-1v-10c0-1.8-.5-3.2-1.4-4.1-1-1-2.4-1.4-4.2-1.4a142.9 142.9 0 0 0-10.2.4v-5.6a74.8 74.8 0 0 1 8.6-.4c3 0 5.5.4 7.5 1.2s3.4 2 4.4 3.6c1 1.7 1.4 4 1.4 6.7v18.4h-5Zm12.9 0V17.8h5v12.3h-.2c0-4.2 1-7.4 2.8-9.5a11 11 0 0 1 8.3-3.1h1v5.6h-2a9 9 0 0 0-6.3 2.2c-1.5 1.5-2.2 3.6-2.2 6.4v15.6h-6.4Zm34.4 1a15 15 0 0 1-6.6-1.3c-1.9-.9-3.4-2-4.7-3.5a15.5 15.5 0 0 1-2.7-5c-.6-1.7-1-3.6-1-5.4v-1c0-2 .4-3.8 1-5.6a15 15 0 0 1 2.8-4.9c1.3-1.5 2.8-2.6 4.6-3.5a16.4 16.4 0 0 1 13.3.2c2 1 3.5 2.3 4.8 4a12 12 0 0 1 2 6H144c-.2-1.6-1-3-2.2-4.1a7.5 7.5 0 0 0-5.2-1.7 8 8 0 0 0-4.7 1.3 8 8 0 0 0-2.8 3.6 13.8 13.8 0 0 0 0 10.3c.6 1.5 1.5 2.7 2.8 3.6s2.8 1.3 4.8 1.3c1.5 0 2.7-.2 3.8-.8a7 7 0 0 0 2.6-2c.7-1 1-2 1.2-3.2h6.2a11 11 0 0 1-2 6.2 15.1 15.1 0 0 1-11.8 5.5Zm19.7-1v-40h6.4V31h-1.3c0-3 .4-5.5 1.1-7.6a9.7 9.7 0 0 1 3.5-4.8A9.9 9.9 0 0 1 172 17h.3c3.5 0 6 1.1 7.9 3.5 1.7 2.3 2.6 5.7 2.6 10v16.8h-6.4V29.6c0-2.1-.6-3.8-1.8-5a6.4 6.4 0 0 0-4.8-1.8c-2 0-3.7.7-5 2a7.8 7.8 0 0 0-1.9 5.5v17h-6.4Zm63.8 1a12.2 12.2 0 0 1-10.9-6.2 19 19 0 0 1-1.8-7.3h1.4v12.5h-5.1v-40h6.4v19.8l-2 3.5c.2-3.1.8-5.7 1.9-7.7a11 11 0 0 1 4.4-4.5c1.8-1 3.9-1.5 6.1-1.5a13.4 13.4 0 0 1 12.8 9.1c.7 1.9 1 3.8 1 6v1c0 2.2-.3 4.1-1 6a13.6 13.6 0 0 1-13.2 9.4Zm-1.2-5.5a8.4 8.4 0 0 0 7.9-5c.7-1.5 1.1-3.3 1.1-5.3s-.4-3.8-1.1-5.3a8.7 8.7 0 0 0-3.2-3.6 9.6 9.6 0 0 0-9.2-.2 8.5 8.5 0 0 0-3.3 3.2c-.8 1.4-1.3 3-1.3 5v2.3a9 9 0 0 0 1.3 4.8 9 9 0 0 0 3.4 3c1.4.7 2.8 1 4.4 1Zm27.3 3.9-10-28.9h6.5l9.5 28.9h-6Zm-7.5 12.2v-5.7h4.9c1 0 2-.1 2.9-.4a4 4 0 0 0 2-1.4c.4-.7.9-1.6 1.2-2.7l8.6-30.9h6.2l-9.3 32.4a14 14 0 0 1-2.5 5 8.9 8.9 0 0 1-4 2.8c-1.5.6-3.4.9-5.6.9h-4.4Zm9-12.2v-5.2h6.4v5.2H248Z"></path><path fill="#003DFF" d="M534.4 9.1H528a.8.8 0 0 1-.7-.7V1.8c0-.4.2-.7.6-.8l6.5-1c.4 0 .8.2.9.6v7.8c0 .4-.4.7-.8.7zM428 35.2V.8c0-.5-.3-.8-.7-.8h-.2l-6.4 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.5 0 .8-.4.8-.8V43c0-.4-.3-.7-.6-.8-4.5-.5-4.5-6-4.5-7zm106.5-21.8H528c-.4 0-.7.4-.7.8v34c0 .4.3.8.7.8h6.5c.4 0 .8-.4.8-.8v-34c0-.5-.4-.8-.8-.8zm-17.7 21.8V.8c0-.5-.3-.8-.8-.8l-6.5 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.4 0 .8-.4.8-.8V43c0-.4-.3-.7-.7-.8-4.4-.5-4.4-6-4.4-7zm-22.2-20.6a16.5 16.5 0 0 1 8.6 9.3c.8 2.2 1.3 4.8 1.3 7.5a19.4 19.4 0 0 1-4.6 12.6 14.8 14.8 0 0 1-5.2 3.6c-2 .9-5.2 1.4-6.8 1.4a21 21 0 0 1-6.7-1.4 15.4 15.4 0 0 1-8.6-9.3 21.3 21.3 0 0 1 0-14.4 15.2 15.2 0 0 1 8.6-9.3c2-.8 4.3-1.2 6.7-1.2s4.6.4 6.7 1.2zm-6.7 27.6c2.7 0 4.7-1 6.2-3s2.2-4.3 2.2-7.8-.7-6.3-2.2-8.3-3.5-3-6.2-3-4.7 1-6.1 3c-1.5 2-2.2 4.8-2.2 8.3s.7 5.8 2.2 7.8 3.5 3 6.2 3zm-88.8-28.8c-6.2 0-11.7 3.3-14.8 8.2a18.6 18.6 0 0 0 4.8 25.2c1.8 1.2 4 1.8 6.2 1.7s.1 0 .1 0h.9c4.2-.7 8-4 9.1-8.1v7.4c0 .4.3.7.8.7h6.4a.7.7 0 0 0 .7-.7V14.2c0-.5-.3-.8-.7-.8h-13.5zm6.3 26.5a9.8 9.8 0 0 1-5.7 2h-.5a10 10 0 0 1-9.2-14c1.4-3.7 5-6.3 9-6.3h6.4v18.3zm152.3-26.5h13.5c.5 0 .8.3.8.7v33.7c0 .4-.3.7-.8.7h-6.4a.7.7 0 0 1-.8-.7v-7.4c-1.2 4-4.8 7.4-9 8h-.1a4.2 4.2 0 0 1-.5.1h-.9a10.3 10.3 0 0 1-7-2.6c-4-3.3-6.5-8.4-6.5-14.2 0-3.7 1-7.2 3-10 3-5 8.5-8.3 14.7-8.3zm.6 28.4c2.2-.1 4.2-.6 5.7-2V21.7h-6.3a9.8 9.8 0 0 0-9 6.4 10.2 10.2 0 0 0 9.1 13.9h.5zM452.8 13.4c-6.2 0-11.7 3.3-14.8 8.2a18.5 18.5 0 0 0 3.6 24.3 10.4 10.4 0 0 0 13 .6c2.2-1.5 3.8-3.7 4.5-6.1v7.8c0 2.8-.8 5-2.2 6.3-1.5 1.5-4 2.2-7.5 2.2l-6-.3c-.3 0-.7.2-.8.5l-1.6 5.5c-.1.4.1.8.5 1h.1c2.8.4 5.5.6 7 .6 6.3 0 11-1.4 14-4.1 2.7-2.5 4.2-6.3 4.5-11.4V14.2c0-.5-.4-.8-.8-.8h-13.5zm6.3 8.2v18.3a9.6 9.6 0 0 1-5.6 2h-1a10.3 10.3 0 0 1-8.8-14c1.4-3.7 5-6.3 9-6.3h6.4zM291 31.5A32 32 0 0 1 322.8 0h30.8c.6 0 1.2.5 1.2 1.2v61.5c0 1.1-1.3 1.7-2.2 1l-19.2-17a18 18 0 0 1-11 3.4 18.1 18.1 0 1 1 18.2-14.8c-.1.4-.5.7-.9.6-.1 0-.3 0-.4-.2l-3.8-3.4c-.4-.3-.6-.8-.7-1.4a12 12 0 1 0-2.4 8.3c.4-.4 1-.5 1.6-.2l14.7 13.1v-46H323a26 26 0 1 0 10 49.7c.8-.4 1.6-.2 2.3.3l3 2.7c.3.2.3.7 0 1l-.2.2a32 32 0 0 1-47.2-28.6z"></path></svg></a></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@5.39.0/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.1/source/js/search/algolia.min.js"></script></div></div><script data-pjax>if(document.getElementById("recent-posts")&&"/"==location.pathname){var parent=document.getElementById("recent-posts"),child='<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo3.jpg" alt="/img/nba-logo3.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2024-02-02</span><a class="blog-slider__title" href="posts/1bcb0ad4/">å•ç¯å¢ƒ,å¤šåˆ†æ”¯å¹¶è¡Œå¼€å‘æ–¹æ¡ˆ(æµé‡æŸ“è‰²/istio)</a><div class="blog-slider__text">å•ç¯å¢ƒ,å¤šåˆ†æ”¯å¹¶è¡Œå¼€å‘æ–¹æ¡ˆ(æµé‡æŸ“è‰²/istio)</div><a class="blog-slider__button" href="posts/1bcb0ad4/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="/img/nba-logo22.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-06-14</span><a class="blog-slider__title" href="posts/aa43cc95/">è®°å½•k8sç¯å¢ƒä¸‹ç»“åˆalinodeçš„ä½¿ç”¨</a><div class="blog-slider__text">è®°å½•k8sç¯å¢ƒä¸‹ç»“åˆalinodeçš„ä½¿ç”¨</div><a class="blog-slider__button" href="posts/aa43cc95/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo29.jpg" alt="/img/nba-logo29.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-12-13</span><a class="blog-slider__title" href="posts/15957791/">k8sç¯å¢ƒä¸‹,nginxåšwebsocketè´Ÿè½½çš„æ–¹æ¡ˆæ¢³ç†</a><div class="blog-slider__text">k8sç¯å¢ƒä¸‹,nginxåšwebsocketè´Ÿè½½çš„æ–¹æ¡ˆæ¢³ç†</div><a class="blog-slider__button" href="posts/15957791/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="/img/nba-logo22.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-09-26</span><a class="blog-slider__title" href="posts/4ecfb081/">è®°å½•ä¸€æ¬¡k8sç½‘ç»œDNSé—®é¢˜æ’æŸ¥è¿‡ç¨‹</a><div class="blog-slider__text">è®°å½•ä¸€æ¬¡k8sç½‘ç»œDNSé—®é¢˜æ’æŸ¥è¿‡ç¨‹</div><a class="blog-slider__button" href="posts/4ecfb081/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="/img/nba-logo22.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-09-26</span><a class="blog-slider__title" href="posts/37032a87/">k3sé«˜å¯ç”¨å®‰è£…</a><div class="blog-slider__text">k3sé«˜å¯ç”¨å®‰è£…</div><a class="blog-slider__button" href="posts/37032a87/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo5.jpg" alt="/img/nba-logo5.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-11-27</span><a class="blog-slider__title" href="posts/20b19ed4/">åˆ†è¯æœç´¢éœ€æ±‚æ•´ç†</a><div class="blog-slider__text">åˆ†è¯æœç´¢éœ€æ±‚æ•´ç†</div><a class="blog-slider__button" href="posts/20b19ed4/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo26.jpg" alt="/img/nba-logo26.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-12-02</span><a class="blog-slider__title" href="posts/6de14387/">æ•´ç†wsl2é…åˆå¼€å‘çš„ä¸€äº›é…ç½®</a><div class="blog-slider__text">æ•´ç†wsl2é…åˆå¼€å‘çš„ä¸€äº›é…ç½®</div><a class="blog-slider__button" href="posts/6de14387/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="/img/nba-logo22.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-12-11</span><a class="blog-slider__title" href="posts/fb9adcb6/">è®°å½•windows11+wsl2ç¯å¢ƒæ­é…</a><div class="blog-slider__text">windows11+wsl2å¼€å‘ç¯å¢ƒé…ç½®</div><a class="blog-slider__button" href="posts/fb9adcb6/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo26.jpg" alt="/img/nba-logo26.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2026-01-28</span><a class="blog-slider__title" href="posts/2a9d73ff/">æ•™ä½ å¦‚ä½•é›¶æˆæœ¬ä»0åˆ°1ï¼Œå¼€å‘ä¸Šçº¿ä¸€ä¸ªå¯¹æ¥äº†openAIçš„æœºå™¨äºº</a><div class="blog-slider__text">æ•™ä½ å¦‚ä½•é›¶æˆæœ¬ä»0åˆ°1ï¼Œå¼€å‘ä¸Šçº¿ä¸€ä¸ªå¯¹æ¥äº†openAIçš„æœºå™¨äºº</div><a class="blog-slider__button" href="posts/2a9d73ff/">è¯¦æƒ…</a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';console.log("å·²æŒ‚è½½swiper"),parent.insertAdjacentHTML("afterbegin",child)}</script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper@0.18/swiper/swiperindex.js"></script><style></style><script data-pjax>function history_calendar_injector_config(){var i=document.getElementsByClassName("sticky_layout")[0];console.log("å·²æŒ‚è½½history_calendar"),i.insertAdjacentHTML("afterbegin",'<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>é‚£å¹´ä»Šæ—¥</span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>')}document.getElementsByClassName("sticky_layout")[0]&&"/"===location.pathname&&history_calendar_injector_config()</script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"right",width:150,height:300,hOffset:20,vOffset:-20},mobile:{show:!0},log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/"})</script></body></html>