<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>记录kettle安装以及支持clickhouse进行开发(基于kettle9.2) | 小五的个人杂货铺</title><meta name="author" content="小五"><meta name="copyright" content="小五"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="todo 待改造,目前这种可以配置变量的地方却无法配置变量(不识别,只能写死),之后尝试改下    目前kettle最新的版本是9.2,但是es仅支持到6.4.2,而且也无法配置用户名和密码还有schema,所以需要对es-bulk-insert组件改造下下载源码(kettle github源码地址)(有些包可能国内网络下载不下来,而且国内镜像也没有,就需要单独去想办法了,有人需要的话我会把包发"><meta property="og:type" content="article"><meta property="og:title" content="记录kettle安装以及支持clickhouse进行开发(基于kettle9.2)"><meta property="og:url" content="https://xiaowu95.wang/posts/ed754a6/"><meta property="og:site_name" content="小五的个人杂货铺"><meta property="og:description" content="todo 待改造,目前这种可以配置变量的地方却无法配置变量(不识别,只能写死),之后尝试改下    目前kettle最新的版本是9.2,但是es仅支持到6.4.2,而且也无法配置用户名和密码还有schema,所以需要对es-bulk-insert组件改造下下载源码(kettle github源码地址)(有些包可能国内网络下载不下来,而且国内镜像也没有,就需要单独去想办法了,有人需要的话我会把包发"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://xiaowu95.wang/img/nba-logo12.jpg"><meta property="article:published_time" content="2022-01-19T16:00:00.000Z"><meta property="article:modified_time" content="2024-05-10T02:28:28.000Z"><meta property="article:author" content="小五"><meta property="article:tag" content="大数据"><meta property="article:tag" content="kettle"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://xiaowu95.wang/img/nba-logo12.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://xiaowu95.wang/posts/ed754a6/"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="kHfLZxYQ7y3s3AR7gyJDdJkQvGNjQsvopp6N3gEEx0s"><meta name="baidu-site-verification" content="codeva-aVS4F6wAjS"><link rel="manifest" href="/wang-xiaowu/pwa/site.webmanifest"><meta name="msapplication-TileColor" content="#fff"><link rel="apple-touch-icon" sizes="180x180" href="/wang-xiaowu/pwa/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/wang-xiaowu/pwa/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/wang-xiaowu/pwa/favicon-16x16.png"><link rel="mask-icon" href="/wang-xiaowu/pwa/safari-pinned-tab.svg" color="#5bbad5"><link rel="stylesheet" href="/css/index.css?v=5.2.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise(((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach((([e,t])=>n.setAttribute(e,t))),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)})),getCSS:(e,t)=>new Promise(((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)})),addGlobalFn:(e,t,o=!1,a=window)=>{const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),c=window.matchMedia("(prefers-color-scheme: dark)"),r=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(r.matches)a();else if(c.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}c.addEventListener("change",(()=>{void 0===t.get("theme")&&(e.matches?o():a())}))}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?86cb34987e15c900c39e12ebdf08c50d";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),btf.addGlobalFn("pjaxComplete",(()=>{_hmt.push(["_trackPageview",window.location.pathname])}),"baidu_analytics")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-1MFQ47191J"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-1MFQ47191J"),btf.addGlobalFn("pjaxComplete",(()=>{gtag("config","G-1MFQ47191J",{page_path:window.location.pathname})}),"google_analytics")</script><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"M91QAWRVY4",apiKey:"ecc30a5e06136e1cc491685e39801190",indexName:"xiaowu-blog",hitsPerPage:6,languages:{input_placeholder:"搜索文章",hits_empty:"未找到符合您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"簡"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:400,highlightFullpage:!0,highlightMacStyle:!0},copy:{success:"复制成功",error:"复制失败",noSupport:"浏览器不支持"},relativeDate:{homepage:!0,post:!0},runtime:"天",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:150,languages:{author:"作者: 小五",link:"链接: ",source:"来源: 小五的个人杂货铺",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"已切换为繁体中文",cht_to_chs:"已切换为简体中文",day_to_night:"已切换为深色模式",night_to_day:"已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!0,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"记录kettle安装以及支持clickhouse进行开发(基于kettle9.2)",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,isShuoshuo:!1}</script><script src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><link rel="stylesheet" href="/css/font.css"><style>.app-refresh{position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease}.app-refresh-wrap{display:flex;color:#fff;height:100%;align-items:center;justify-content:center}.app-refresh-wrap a{color:#fff;text-decoration:underline;cursor:pointer}</style><link rel="stylesheet" href="/css/titleStyle.css"><link rel="stylesheet" href="/css/mouse.css"><link rel="stylesheet" href="/css/custom.css"><style>.card-announcement .social-button{margin:.6rem 0 0 0;text-align:center}.card-announcement .social-button a{display:block;background-color:var(--btn-bg);color:var(--btn-color);text-align:center;line-height:2.4;margin:4px 0}.card-announcement .social-button a:hover{background-color:var(--btn-hover-color)}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiperstyle.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="alternate" href="/atom.xml" title="小五的个人杂货铺" type="application/atom+xml"></head><body><script>window.paceOptions={restartOnPushState:!1},btf.addGlobalFn("pjaxSend",(()=>{Pace.restart()}),"pace_restart")</script><link rel="stylesheet" href="/css/pace.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-lazy-src="/img/avatar.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">550</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">163</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">58</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/github/"><i class="fa-fw fa-solid fa-address-card"></i> <span>关于我</span></a></div><div class="menus_item"><a class="site-page" href="/ac/"><i class="fa-fw fa-solid fa-wind"></i> <span>便携小空调</span></a></div><div class="menus_item"><a class="site-page" href="/talking/"><i class="fa-fw fa-solid fa-walkie-talkie"></i> <span>博客短记</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i> <span>目录</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-otter"></i> <span>杂记</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/songs/"><i class="fa-fw fas fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>图库</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa-solid fa-film"></i> <span>影视|番剧</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book faa-fload"></i> <span>书单</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad faa-fload"></i> <span>游戏</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-bilibili"></i> <span>BiliBili追番</span></a></li><li><a class="site-page child" href="/cinemas/"><i class="fa-fw fa-solid fa-video"></i> <span>BiliBili追剧</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-user-group"></i> <span>友链</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-mug-saucer"></i> <span>Website Memo</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://console.leancloud.app/apps"><span>🚀 LeanCloud</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.com/dashboard"><span>🚀 Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://tongji.baidu.com/main/overview/10000432799/overview/index"><span>🚀 百度统计</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://ziyuan.baidu.com/dashboard/index"><span>🚀 百度站点管理</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://analytics.google.com/analytics/web/"><span>🚀 谷歌分析</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://search.google.com/search-console?hl=zh-cn"><span>🚀 谷歌站点管理</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.google.com/adsense/new/u/0/pub-1375421173355613/home"><span>🚀 谷歌广告联盟</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.algolia.com/"><span>🚀 Algolia</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://sms-activate.org/cn/"><span>🚀 Sms-activate</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chatgpt.com/"><span>🚀 ChatGPT</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://poe.com/"><span>🚀 Poe聚合</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.idc.net/clientarea"><span>🚀 后浪云</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.west.cn/"><span>🚀 西部数据</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://shandianpro.com/#/dashboard"><span>🚀 闪电</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.huojian.homes/"><span>🚀 小火箭</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/winston779/gougou"><span>🚀 狗狗加速</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/nba-logo12.jpg)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">小五的个人杂货铺</span></a><a class="nav-page-title" href="/"><span class="site-name">记录kettle安装以及支持clickhouse进行开发(基于kettle9.2)</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/github/"><i class="fa-fw fa-solid fa-address-card"></i> <span>关于我</span></a></div><div class="menus_item"><a class="site-page" href="/ac/"><i class="fa-fw fa-solid fa-wind"></i> <span>便携小空调</span></a></div><div class="menus_item"><a class="site-page" href="/talking/"><i class="fa-fw fa-solid fa-walkie-talkie"></i> <span>博客短记</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i> <span>目录</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-otter"></i> <span>杂记</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/songs/"><i class="fa-fw fas fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>图库</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa-solid fa-film"></i> <span>影视|番剧</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book faa-fload"></i> <span>书单</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad faa-fload"></i> <span>游戏</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-bilibili"></i> <span>BiliBili追番</span></a></li><li><a class="site-page child" href="/cinemas/"><i class="fa-fw fa-solid fa-video"></i> <span>BiliBili追剧</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-user-group"></i> <span>友链</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-mug-saucer"></i> <span>Website Memo</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://console.leancloud.app/apps"><span>🚀 LeanCloud</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.com/dashboard"><span>🚀 Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://tongji.baidu.com/main/overview/10000432799/overview/index"><span>🚀 百度统计</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://ziyuan.baidu.com/dashboard/index"><span>🚀 百度站点管理</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://analytics.google.com/analytics/web/"><span>🚀 谷歌分析</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://search.google.com/search-console?hl=zh-cn"><span>🚀 谷歌站点管理</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.google.com/adsense/new/u/0/pub-1375421173355613/home"><span>🚀 谷歌广告联盟</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.algolia.com/"><span>🚀 Algolia</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://sms-activate.org/cn/"><span>🚀 Sms-activate</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chatgpt.com/"><span>🚀 ChatGPT</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://poe.com/"><span>🚀 Poe聚合</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.idc.net/clientarea"><span>🚀 后浪云</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.west.cn/"><span>🚀 西部数据</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://shandianpro.com/#/dashboard"><span>🚀 闪电</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.huojian.homes/"><span>🚀 小火箭</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/winston779/gougou"><span>🚀 狗狗加速</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">记录kettle安装以及支持clickhouse进行开发(基于kettle9.2)<a class="post-edit-link" href="https://github.com/wang-xiaowu/wang-xiaowu.github.io/issues/new?_posts/kettle/记录一次kettle的es-bulk-insert组件二开.md" rel="external nofollow noreferrer" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-19T16:00:00.000Z" title="发表于 2022-01-20 00:00:00">2022-01-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-05-10T02:28:28.000Z" title="更新于 2024-05-10 10:28:28">2024-05-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/kettle/">kettle</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">5.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>35分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;距离上一次更新该文章已经过了&quot;,&quot;messageNext&quot;:&quot;天，文章所描述的內容可能已经发生变化，请留意。&quot;,&quot;postUpdate&quot;:&quot;2024-05-10 10:28:28&quot;}" hidden></div><blockquote><p><strong>todo 待改造,目前这种可以配置变量的地方却无法配置变量(不识别,只能写死),之后尝试改下</strong></p></blockquote><img src="/img/loading.gif" data-lazy-src="/posts/ed754a6/up-f342e75a0afb84ce64130872a8fcaf46c23.png"><h3 id="目前kettle最新的版本是9-2-但是es仅支持到6-4-2-而且也无法配置用户名和密码还有schema-所以需要对es-bulk-insert组件改造下"><a href="#目前kettle最新的版本是9-2-但是es仅支持到6-4-2-而且也无法配置用户名和密码还有schema-所以需要对es-bulk-insert组件改造下" class="headerlink" title="目前kettle最新的版本是9.2,但是es仅支持到6.4.2,而且也无法配置用户名和密码还有schema,所以需要对es-bulk-insert组件改造下"></a><strong>目前kettle最新的版本是9.2,但是es仅支持到6.4.2,而且也无法配置用户名和密码还有schema,所以需要对es-bulk-insert组件改造下</strong></h3><h4 id="下载源码-kettle-github源码地址"><a href="#下载源码-kettle-github源码地址" class="headerlink" title="下载源码(kettle github源码地址)"></a><strong>下载源码(<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/pentaho/pentaho-kettle.git" title="kettle github源码地址">kettle github源码地址</a>)</strong></h4><p><strong>(有些包可能国内网络下载不下来,而且国内镜像也没有,就需要单独去想办法了,有人需要的话我会把包发出来)</strong></p><img src="/img/loading.gif" data-lazy-src="/posts/ed754a6/up-54b3ebed7ea6e708c40b76730fcfadb2f50.png"><h4 id="主要改两个类"><a href="#主要改两个类" class="headerlink" title="主要改两个类"></a><strong>主要改两个类</strong></h4><ul><li>ElasticSearchBulk</li><li>ElasticSearchBulkDialog</li></ul><h4 id="前者是业务数据执行需要的-后者是那个组件框需要的-比如你点test-就会调用这个类的test方法"><a href="#前者是业务数据执行需要的-后者是那个组件框需要的-比如你点test-就会调用这个类的test方法" class="headerlink" title="前者是业务数据执行需要的,后者是那个组件框需要的,比如你点test,就会调用这个类的test方法"></a><strong>前者是业务数据执行需要的,后者是那个组件框需要的,比如你点test,就会调用这个类的test方法</strong></h4><img src="/img/loading.gif" data-lazy-src="/posts/ed754a6/up-52f379eb7fa00b0338ded8dbae8ca966250.png"><h4 id="首先需要改pom文件-改成需要的版本"><a href="#首先需要改pom文件-改成需要的版本" class="headerlink" title="首先需要改pom文件,改成需要的版本"></a><strong>首先需要改pom文件,改成需要的版本</strong></h4><img src="/img/loading.gif" data-lazy-src="/posts/ed754a6/up-bf3427df8d12cbcf83ad63d3a708cfa241d.png"><h4 id="其次是这些在高版本中弃用的类和方法"><a href="#其次是这些在高版本中弃用的类和方法" class="headerlink" title="其次是这些在高版本中弃用的类和方法"></a><strong>其次是这些在高版本中弃用的类和方法</strong></h4><img src="/img/loading.gif" data-lazy-src="/posts/ed754a6/up-77c707c5910131062a687a7fb5d42f5bfaf.png"><h4 id="在elastic官网中也给出了对应的替代方法-https-www-elastic-co-guide-en-elasticsearch-client-java-rest-current-changing-the-application-8217-s-code-html-how-to-migrate-the-way-requests-are-built"><a href="#在elastic官网中也给出了对应的替代方法-https-www-elastic-co-guide-en-elasticsearch-client-java-rest-current-changing-the-application-8217-s-code-html-how-to-migrate-the-way-requests-are-built" class="headerlink" title="在elastic官网中也给出了对应的替代方法(https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/_changing_the_application_8217_s_code.html#_how_to_migrate_the_way_requests_are_built)"></a><strong>在elastic官网中也给出了对应的替代方法(<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/_changing_the_application_8217_s_code.html#_how_to_migrate_the_way_requests_are_built">https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/_changing_the_application_8217_s_code.html#_how_to_migrate_the_way_requests_are_built</a>)</strong></h4><img src="/img/loading.gif" data-lazy-src="/posts/ed754a6/up-07648b4110c746e221a3fec81818942f433.png"><h4 id="ElasticSearchBulk类的修改如下"><a href="#ElasticSearchBulk类的修改如下" class="headerlink" title="ElasticSearchBulk类的修改如下"></a><strong>ElasticSearchBulk类的修改如下</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.pentaho.di.trans.steps.elasticsearchbulk;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.auth.AuthScope;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.auth.UsernamePasswordCredentials;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.CredentialsProvider;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.BasicCredentialsProvider;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.nio.client.HttpAsyncClientBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.DocWriteRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkItemResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.bulk.BulkResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClientBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.transport.NoNodeAvailableException;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.settings.Settings;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentFactory;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentType;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.core.exception.KettleException;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.core.exception.KettleStepException;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.core.row.RowDataUtil;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.core.row.RowMetaInterface;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.core.row.ValueMetaInterface;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.i18n.BaseMessages;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.trans.Trans;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.trans.TransMeta;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.trans.step.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElasticSearchBulk</span> <span class="keyword">extends</span> <span class="title class_">BaseStep</span> <span class="keyword">implements</span> <span class="title class_">StepInterface</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">INSERT_ERROR_CODE</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Class&lt;?&gt; PKG = ElasticSearchBulkMeta.class; <span class="comment">// for i18n</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ElasticSearchBulkMeta meta;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> ElasticSearchBulkData data;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  private Client client;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String index;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  BulkRequestBuilder currentRequest;</span></span><br><span class="line"></span><br><span class="line">  <span class="type">BulkRequest</span> <span class="variable">currentRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BulkRequest</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">batchSize</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">isJsonInsert</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">jsonFieldIdx</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">String</span> <span class="variable">idOutFieldName</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">Integer</span> <span class="variable">idFieldIndex</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">Long</span> <span class="variable">timeout</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">TimeUnit</span> <span class="variable">timeoutUnit</span> <span class="operator">=</span> TimeUnit.MILLISECONDS;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="variable">numberOfErrors</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  private List&lt;IndexRequestBuilder&gt; requestsBuffer;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> List&lt;IndexRequest&gt; requestsBuffer;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">stopOnError</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">useOutput</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Map&lt;String, String&gt; columnsToJson;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> hasFields;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> IndexRequest.<span class="type">OpType</span> <span class="variable">opType</span> <span class="operator">=</span> org.elasticsearch.action.DocWriteRequest.OpType.CREATE;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">ElasticSearchBulk</span><span class="params">(StepMeta stepMeta, StepDataInterface stepDataInterface, <span class="type">int</span> copyNr, TransMeta transMeta,Trans trans )</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">super</span>( stepMeta, stepDataInterface, copyNr, transMeta, trans );</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">processRow</span><span class="params">(StepMetaInterface smi, StepDataInterface sdi )</span> <span class="keyword">throws</span> KettleException &#123;</span><br><span class="line">    Object[] rowData = getRow();</span><br><span class="line">    <span class="keyword">if</span> ( rowData == <span class="literal">null</span> ) &#123;</span><br><span class="line">      <span class="keyword">if</span> ( currentRequest != <span class="literal">null</span> &amp;&amp; currentRequest.numberOfActions() &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">        processBatch( <span class="literal">false</span> );</span><br><span class="line">      &#125;</span><br><span class="line">      setOutputDone();</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( first ) &#123;</span><br><span class="line">      first = <span class="literal">false</span>;</span><br><span class="line">      setupData();</span><br><span class="line"><span class="comment">//      currentRequest = client.prepareBulk();</span></span><br><span class="line"><span class="comment">//      requestsBuffer = new ArrayList&lt;IndexRequestBuilder&gt;( this.batchSize );</span></span><br><span class="line">      <span class="comment">//   try &#123;</span></span><br><span class="line">      <span class="comment">//            client.bulk(currentRequest, RequestOptions.DEFAULT);</span></span><br><span class="line">      <span class="comment">// &#125; catch (IOException e1) &#123;</span></span><br><span class="line">      <span class="comment">//     rejectAllRows( e1.getLocalizedMessage() );</span></span><br><span class="line">      <span class="comment">//       String msg = BaseMessages.getString( PKG, &quot;ElasticSearchBulk.Log.Exception&quot;, e1.getLocalizedMessage() );</span></span><br><span class="line">      <span class="comment">//       logError( msg );</span></span><br><span class="line">      <span class="comment">//       throw new KettleStepException( msg, e1 );</span></span><br><span class="line">      <span class="comment">// &#125;</span></span><br><span class="line">      requestsBuffer = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;IndexRequest&gt;( <span class="built_in">this</span>.batchSize );</span><br><span class="line">      initFieldIndexes();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      data.inputRowBuffer[data.nextBufferRowIdx++] = rowData;</span><br><span class="line">      <span class="keyword">return</span> indexRow( data.inputRowMeta, rowData ) || !stopOnError;</span><br><span class="line">    &#125; <span class="keyword">catch</span> ( KettleStepException e ) &#123;</span><br><span class="line">      <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> ( Exception e ) &#123;</span><br><span class="line">      rejectAllRows( e.getLocalizedMessage() );</span><br><span class="line">      <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulk.Log.Exception&quot;</span>, e.getLocalizedMessage() );</span><br><span class="line">      logError( msg );</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">KettleStepException</span>( msg, e );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Initialize &lt;code&gt;this.data&lt;/code&gt;</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> KettleStepException</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setupData</span><span class="params">()</span> <span class="keyword">throws</span> KettleStepException &#123;</span><br><span class="line"></span><br><span class="line">    data.nextBufferRowIdx = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    data.inputRowMeta = getInputRowMeta().clone(); <span class="comment">// only available after first getRow();</span></span><br><span class="line"></span><br><span class="line">    data.inputRowBuffer = <span class="keyword">new</span> <span class="title class_">Object</span>[batchSize][];</span><br><span class="line"></span><br><span class="line">    data.outputRowMeta = data.inputRowMeta.clone();</span><br><span class="line"></span><br><span class="line">    meta.getFields( data.outputRowMeta, getStepname(), <span class="literal">null</span>, <span class="literal">null</span>, <span class="built_in">this</span>, repository, metaStore );</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initFieldIndexes</span><span class="params">()</span> <span class="keyword">throws</span> KettleStepException &#123;</span><br><span class="line">    <span class="keyword">if</span> ( isJsonInsert ) &#123;</span><br><span class="line">      <span class="type">Integer</span> <span class="variable">idx</span> <span class="operator">=</span> getFieldIdx( data.inputRowMeta, environmentSubstitute( meta.getJsonField() ) );</span><br><span class="line">      <span class="keyword">if</span> ( idx != <span class="literal">null</span> ) &#123;</span><br><span class="line">        jsonFieldIdx = idx.intValue();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">KettleStepException</span>( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulk.Error.NoJsonField&quot;</span> ) );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    idOutFieldName = environmentSubstitute( meta.getIdOutField() );</span><br><span class="line">    <span class="keyword">if</span> ( StringUtils.isNotBlank( meta.getIdInField() ) ) &#123;</span><br><span class="line">      idFieldIndex = getFieldIdx( data.inputRowMeta, environmentSubstitute( meta.getIdInField() ) );</span><br><span class="line">      <span class="keyword">if</span> ( idFieldIndex == <span class="literal">null</span> ) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">KettleStepException</span>( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulk.Error.InvalidIdField&quot;</span> ) );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      idFieldIndex = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Integer <span class="title function_">getFieldIdx</span><span class="params">(RowMetaInterface rowMeta, String fieldName )</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ( fieldName == <span class="literal">null</span> ) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; rowMeta.size(); i++ ) &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> rowMeta.getValueMeta( i ).getName();</span><br><span class="line">      <span class="keyword">if</span> ( fieldName.equals( name ) ) &#123;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> rowMeta The metadata for the row to be indexed</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> row     The data for the row to be indexed</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">indexRow</span><span class="params">( RowMetaInterface rowMeta, Object[] row )</span> <span class="keyword">throws</span> KettleStepException &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//      IndexRequestBuilder requestBuilder = client.prepareIndex( index, type );</span></span><br><span class="line"><span class="comment">//      requestBuilder.setOpType( this.opType );</span></span><br><span class="line">      <span class="type">IndexRequest</span> <span class="variable">indexRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexRequest</span>(index);</span><br><span class="line">      indexRequest.opType(<span class="built_in">this</span>.opType);</span><br><span class="line">      <span class="keyword">if</span> ( idFieldIndex != <span class="literal">null</span> ) &#123;</span><br><span class="line"><span class="comment">//        requestBuilder.setId( &quot;&quot; + row[idFieldIndex] ); // &quot;&quot; just in case field isn&#x27;t string</span></span><br><span class="line">        indexRequest.id(<span class="string">&quot;&quot;</span> + row[idFieldIndex]);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( isJsonInsert ) &#123;</span><br><span class="line"><span class="comment">//        addSourceFromJsonString( row, requestBuilder );</span></span><br><span class="line">        addSourceFromJsonString( row, indexRequest );</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//        addSourceFromRowFields( requestBuilder, rowMeta, row );</span></span><br><span class="line">        addSourceFromRowFields( indexRequest, rowMeta, row );</span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">// currentRequest = new BulkRequest();</span></span><br><span class="line"><span class="comment">//      currentRequest.add( requestBuilder );</span></span><br><span class="line"><span class="comment">//      requestsBuffer.add( requestBuilder );</span></span><br><span class="line">      currentRequest.add( indexRequest );</span><br><span class="line">      requestsBuffer.add( indexRequest );</span><br><span class="line">      <span class="keyword">if</span> ( currentRequest.numberOfActions() &gt;= batchSize ) &#123;</span><br><span class="line">        <span class="keyword">return</span> processBatch( <span class="literal">true</span> );</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> ( KettleStepException e ) &#123;</span><br><span class="line">      <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> ( NoNodeAvailableException e ) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">KettleStepException</span>( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.Error.NoNodesFound&quot;</span> ) );</span><br><span class="line">    &#125; <span class="keyword">catch</span> ( Exception e ) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">KettleStepException</span>( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulk.Log.Exception&quot;</span>, e</span><br><span class="line">              .getLocalizedMessage() ), e );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//  /**</span></span><br><span class="line"><span class="comment">//   * @param row</span></span><br><span class="line"><span class="comment">//   * @param requestBuilder</span></span><br><span class="line"><span class="comment">//   */</span></span><br><span class="line"><span class="comment">//  private void addSourceFromJsonString( Object[] row, IndexRequestBuilder requestBuilder ) throws KettleStepException &#123;</span></span><br><span class="line"><span class="comment">//    Object jsonString = row[jsonFieldIdx];</span></span><br><span class="line"><span class="comment">//    if ( jsonString instanceof byte[] ) &#123;</span></span><br><span class="line"><span class="comment">//      requestBuilder.setSource( (byte[]) jsonString, XContentType.JSON );</span></span><br><span class="line"><span class="comment">//    &#125; else if ( jsonString instanceof String ) &#123;</span></span><br><span class="line"><span class="comment">//      requestBuilder.setSource( (String) jsonString, XContentType.JSON );</span></span><br><span class="line"><span class="comment">//    &#125; else &#123;</span></span><br><span class="line"><span class="comment">//      throw new KettleStepException( BaseMessages.getString( &quot;ElasticSearchBulk.Error.NoJsonFieldFormat&quot; ) );</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> row</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addSourceFromJsonString</span><span class="params">( Object[] row, IndexRequest indexRequest )</span> <span class="keyword">throws</span> KettleStepException &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">jsonString</span> <span class="operator">=</span> row[jsonFieldIdx];</span><br><span class="line">    <span class="keyword">if</span> ( jsonString <span class="keyword">instanceof</span> <span class="type">byte</span>[] ) &#123;</span><br><span class="line">      indexRequest.source( (<span class="type">byte</span>[]) jsonString, XContentType.JSON );</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( jsonString <span class="keyword">instanceof</span> String ) &#123;</span><br><span class="line">      indexRequest.source( (String) jsonString, XContentType.JSON );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">KettleStepException</span>( BaseMessages.getString( <span class="string">&quot;ElasticSearchBulk.Error.NoJsonFieldFormat&quot;</span> ) );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//  /**</span></span><br><span class="line"><span class="comment">//   * @param requestBuilder</span></span><br><span class="line"><span class="comment">//   * @param rowMeta</span></span><br><span class="line"><span class="comment">//   * @param row</span></span><br><span class="line"><span class="comment">//   * @throws IOException</span></span><br><span class="line"><span class="comment">//   */</span></span><br><span class="line"><span class="comment">//  private void addSourceFromRowFields( IndexRequestBuilder requestBuilder, RowMetaInterface rowMeta, Object[] row )</span></span><br><span class="line"><span class="comment">//          throws IOException &#123;</span></span><br><span class="line"><span class="comment">//    XContentBuilder jsonBuilder = XContentFactory.jsonBuilder().startObject();</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    for ( int i = 0; i &lt; rowMeta.size(); i++ ) &#123;</span></span><br><span class="line"><span class="comment">//      if ( idFieldIndex != null &amp;&amp; i == idFieldIndex ) &#123; // skip id</span></span><br><span class="line"><span class="comment">//        continue;</span></span><br><span class="line"><span class="comment">//      &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//      ValueMetaInterface valueMeta = rowMeta.getValueMeta( i );</span></span><br><span class="line"><span class="comment">//      String name = hasFields ? columnsToJson.get( valueMeta.getName() ) : valueMeta.getName();</span></span><br><span class="line"><span class="comment">//      Object value = row[i];</span></span><br><span class="line"><span class="comment">//      if ( value instanceof Date &amp;&amp; value.getClass() != Date.class ) &#123;</span></span><br><span class="line"><span class="comment">//        Date subDate = (Date) value;</span></span><br><span class="line"><span class="comment">//        // create a genuine Date object, or jsonBuilder will not recognize it</span></span><br><span class="line"><span class="comment">//        value = new Date( subDate.getTime() );</span></span><br><span class="line"><span class="comment">//      &#125;</span></span><br><span class="line"><span class="comment">//      if ( StringUtils.isNotBlank( name ) ) &#123;</span></span><br><span class="line"><span class="comment">//        jsonBuilder.field( name, value );</span></span><br><span class="line"><span class="comment">//      &#125;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    jsonBuilder.endObject();</span></span><br><span class="line"><span class="comment">//    requestBuilder.setSource( jsonBuilder );</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> rowMeta</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> row</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addSourceFromRowFields</span><span class="params">( IndexRequest indexRequest, RowMetaInterface rowMeta, Object[] row )</span></span><br><span class="line">          <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">XContentBuilder</span> <span class="variable">jsonBuilder</span> <span class="operator">=</span> XContentFactory.jsonBuilder().startObject();</span><br><span class="line">    <span class="keyword">for</span> ( <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; rowMeta.size(); i++ ) &#123;</span><br><span class="line">      <span class="keyword">if</span> ( idFieldIndex != <span class="literal">null</span> &amp;&amp; i == idFieldIndex ) &#123; <span class="comment">// skip id</span></span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">ValueMetaInterface</span> <span class="variable">valueMeta</span> <span class="operator">=</span> rowMeta.getValueMeta( i );</span><br><span class="line">      <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> hasFields ? columnsToJson.get( valueMeta.getName() ) : valueMeta.getName();</span><br><span class="line">      <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> row[i];</span><br><span class="line">      <span class="keyword">if</span> ( value <span class="keyword">instanceof</span> Date &amp;&amp; value.getClass() != Date.class ) &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">subDate</span> <span class="operator">=</span> (Date) value;</span><br><span class="line">        <span class="comment">// create a genuine Date object, or jsonBuilder will not recognize it</span></span><br><span class="line">        value = <span class="keyword">new</span> <span class="title class_">Date</span>( subDate.getTime() );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( StringUtils.isNotBlank( name ) ) &#123;</span><br><span class="line">        jsonBuilder.field( name, value );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    jsonBuilder.endObject();</span><br><span class="line">    indexRequest.source( jsonBuilder );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">init</span><span class="params">(StepMetaInterface smi, StepDataInterface sdi )</span> &#123;</span><br><span class="line">    meta = (ElasticSearchBulkMeta) smi;</span><br><span class="line">    data = (ElasticSearchBulkData) sdi;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">super</span>.init( smi, sdi ) ) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        numberOfErrors = <span class="number">0</span>;</span><br><span class="line">        initFromMeta();</span><br><span class="line">        initClient();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125; <span class="keyword">catch</span> ( Exception e ) &#123;</span><br><span class="line">        logError( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulk.Log.ErrorOccurredDuringStepInitialize&quot;</span> )</span><br><span class="line">                + e.getMessage() );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initFromMeta</span><span class="params">()</span> &#123;</span><br><span class="line">    index = environmentSubstitute( meta.getIndex() );</span><br><span class="line">    type = environmentSubstitute( meta.getType() );</span><br><span class="line">    batchSize = meta.getBatchSizeInt( <span class="built_in">this</span> );</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      timeout = Long.parseLong( environmentSubstitute( meta.getTimeOut() ) );</span><br><span class="line">    &#125; <span class="keyword">catch</span> ( NumberFormatException e ) &#123;</span><br><span class="line">      timeout = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    timeoutUnit = meta.getTimeoutUnit();</span><br><span class="line">    isJsonInsert = meta.isJsonInsert();</span><br><span class="line">    useOutput = meta.isUseOutput();</span><br><span class="line">    stopOnError = meta.isStopOnError();</span><br><span class="line">    columnsToJson = meta.getFieldsMap();</span><br><span class="line">    <span class="built_in">this</span>.hasFields = columnsToJson.size() &gt; <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">this</span>.opType =</span><br><span class="line">            StringUtils.isNotBlank( meta.getIdInField() ) &amp;&amp; meta.isOverWriteIfSameId() ? DocWriteRequest.OpType.INDEX : DocWriteRequest.OpType.CREATE;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">processBatch</span><span class="params">( <span class="type">boolean</span> makeNew )</span> <span class="keyword">throws</span> KettleStepException &#123;</span><br><span class="line">    <span class="type">BulkResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//    ActionFuture&lt;BulkResponse&gt; actionFuture = currentRequest.execute();</span></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">      response = client.bulk(currentRequest, RequestOptions.DEFAULT);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e1) &#123;</span><br><span class="line">      rejectAllRows( e1.getLocalizedMessage() );</span><br><span class="line">      <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulk.Log.Exception&quot;</span>, e1.getLocalizedMessage() );</span><br><span class="line">      logError( msg );</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">KettleStepException</span>( msg, e1 );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">responseOk</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//    try &#123;</span></span><br><span class="line"><span class="comment">//      if ( timeout != null &amp;&amp; timeoutUnit != null ) &#123;</span></span><br><span class="line"><span class="comment">//        response = actionFuture.actionGet( timeout, timeoutUnit );</span></span><br><span class="line"><span class="comment">//      &#125; else &#123;</span></span><br><span class="line"><span class="comment">//        response = actionFuture.actionGet();</span></span><br><span class="line"><span class="comment">//      &#125;</span></span><br><span class="line"><span class="comment">//    &#125; catch ( ElasticsearchException e ) &#123;</span></span><br><span class="line"><span class="comment">//      String msg = BaseMessages.getString( PKG, &quot;ElasticSearchBulk.Error.BatchExecuteFail&quot;, e.getLocalizedMessage() );</span></span><br><span class="line"><span class="comment">//      if ( e instanceof ElasticsearchTimeoutException ) &#123;</span></span><br><span class="line"><span class="comment">//        msg = BaseMessages.getString( PKG, &quot;ElasticSearchBulk.Error.Timeout&quot; );</span></span><br><span class="line"><span class="comment">//      &#125;</span></span><br><span class="line"><span class="comment">//      logError( msg );</span></span><br><span class="line"><span class="comment">//      rejectAllRows( msg );</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">    <span class="keyword">if</span> ( response != <span class="literal">null</span> ) &#123;</span><br><span class="line">      responseOk = handleResponse( response );</span><br><span class="line">      requestsBuffer.clear();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// have to assume all failed</span></span><br><span class="line">      numberOfErrors += currentRequest.numberOfActions();</span><br><span class="line">      setErrors( numberOfErrors );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( makeNew ) &#123;</span><br><span class="line"><span class="comment">//      currentRequest = client.prepareBulk();</span></span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">        client.bulk(currentRequest, RequestOptions.DEFAULT);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (IOException e1) &#123;</span><br><span class="line">        rejectAllRows( e1.getLocalizedMessage() );</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulk.Log.Exception&quot;</span>, e1.getLocalizedMessage() );</span><br><span class="line">        logError( msg );</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">KettleStepException</span>( msg, e1 );</span><br><span class="line">      &#125;</span><br><span class="line">      data.nextBufferRowIdx = <span class="number">0</span>;</span><br><span class="line">      data.inputRowBuffer = <span class="keyword">new</span> <span class="title class_">Object</span>[batchSize][];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      currentRequest = <span class="literal">null</span>;</span><br><span class="line">      data.inputRowBuffer = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> responseOk;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> &lt;code&gt;true&lt;/code&gt; if no errors</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">handleResponse</span><span class="params">( BulkResponse response )</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">hasErrors</span> <span class="operator">=</span> response.hasFailures();</span><br><span class="line">    <span class="keyword">if</span> ( hasErrors ) &#123;</span><br><span class="line">      logError( response.buildFailureMessage() );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">errorsInBatch</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( hasErrors || useOutput ) &#123;</span><br><span class="line">      <span class="keyword">for</span> ( BulkItemResponse item : response ) &#123;</span><br><span class="line">        <span class="keyword">if</span> ( item.isFailed() ) &#123;</span><br><span class="line">          <span class="comment">// log</span></span><br><span class="line">          logDetailed( item.getFailureMessage() );</span><br><span class="line">          errorsInBatch++;</span><br><span class="line">          <span class="keyword">if</span> ( getStepMeta().isDoingErrorHandling() ) &#123;</span><br><span class="line">            rejectRow( item.getItemId(), item.getFailureMessage() );</span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( useOutput ) &#123;</span><br><span class="line">          <span class="keyword">if</span> ( idOutFieldName != <span class="literal">null</span> ) &#123;</span><br><span class="line">            addIdToRow( item.getId(), item.getItemId() );</span><br><span class="line">          &#125;</span><br><span class="line">          echoRow( item.getItemId() );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    numberOfErrors += errorsInBatch;</span><br><span class="line">    setErrors( numberOfErrors );</span><br><span class="line">    <span class="type">int</span> <span class="variable">linesOK</span> <span class="operator">=</span> currentRequest.numberOfActions() - errorsInBatch;</span><br><span class="line">    <span class="keyword">if</span> ( useOutput ) &#123;</span><br><span class="line">      setLinesOutput( getLinesOutput() + linesOK );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      setLinesWritten( getLinesWritten() + linesOK );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> !hasErrors;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addIdToRow</span><span class="params">( String id, <span class="type">int</span> rowIndex )</span> &#123;</span><br><span class="line">    data.inputRowBuffer[rowIndex] =</span><br><span class="line">            RowDataUtil.resizeArray( data.inputRowBuffer[rowIndex], getInputRowMeta().size() + <span class="number">1</span> );</span><br><span class="line">    data.inputRowBuffer[rowIndex][getInputRowMeta().size()] = id;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Send input row to output</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> rowIndex</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">echoRow</span><span class="params">( <span class="type">int</span> rowIndex )</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      putRow( data.outputRowMeta, data.inputRowBuffer[rowIndex] );</span><br><span class="line">    &#125; <span class="keyword">catch</span> ( KettleStepException e ) &#123;</span><br><span class="line">      logError( e.getLocalizedMessage() );</span><br><span class="line">    &#125; <span class="keyword">catch</span> ( ArrayIndexOutOfBoundsException e ) &#123;</span><br><span class="line">      logError( e.getLocalizedMessage() );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Send input row to error.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> errorMsg</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">rejectRow</span><span class="params">( <span class="type">int</span> index, String errorMsg )</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      putError( getInputRowMeta(), data.inputRowBuffer[index], <span class="number">1</span>, errorMsg, <span class="literal">null</span>, INSERT_ERROR_CODE );</span><br><span class="line">    &#125; <span class="keyword">catch</span> ( KettleStepException e ) &#123;</span><br><span class="line">      logError( e.getLocalizedMessage() );</span><br><span class="line">    &#125; <span class="keyword">catch</span> ( ArrayIndexOutOfBoundsException e ) &#123;</span><br><span class="line">      logError( e.getLocalizedMessage() );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">rejectAllRows</span><span class="params">( String errorMsg )</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> ( <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; data.nextBufferRowIdx; i++ ) &#123;</span><br><span class="line">      rejectRow( i, errorMsg );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initClient</span><span class="params">()</span> <span class="keyword">throws</span> UnknownHostException &#123;</span><br><span class="line">    Settings.<span class="type">Builder</span> <span class="variable">settingsBuilder</span> <span class="operator">=</span> Settings.builder();</span><br><span class="line">    settingsBuilder.put( Settings.Builder.EMPTY_SETTINGS );</span><br><span class="line">    meta.getSettingsMap().entrySet().stream().forEach( ( s ) -&gt; settingsBuilder.put( s.getKey(),</span><br><span class="line">            environmentSubstitute( s.getValue() ) ) );</span><br><span class="line"><span class="comment">//    PreBuiltTransportClient tClient = new PreBuiltTransportClient( settingsBuilder.build() );</span></span><br><span class="line"><span class="comment">//    for ( Server server : meta.getServers() ) &#123;</span></span><br><span class="line"><span class="comment">//      tClient.addTransportAddress( new TransportAddress(</span></span><br><span class="line"><span class="comment">//              InetAddress.getByName( environmentSubstitute( server.getAddress() ) ),</span></span><br><span class="line"><span class="comment">//              server.getPort() ) );</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//    client = tClient;</span></span><br><span class="line">    RestHighLevelClient rclient=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">CredentialsProvider</span> <span class="variable">credentialsProvider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicCredentialsProvider</span>();</span><br><span class="line">    credentialsProvider.setCredentials(AuthScope.ANY,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">UsernamePasswordCredentials</span>(settingsBuilder.get(<span class="string">&quot;es.user&quot;</span>),</span><br><span class="line">                    settingsBuilder.get(<span class="string">&quot;es.password&quot;</span>)));</span><br><span class="line">    <span class="keyword">for</span> ( ElasticSearchBulkMeta.Server server : meta.getServers() ) &#123;</span><br><span class="line">      rclient = <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">              <span class="keyword">new</span> <span class="title class_">HttpHost</span>(server.getAddress(), Integer.valueOf(server</span><br><span class="line">                      .getPort()), settingsBuilder.get(<span class="string">&quot;es.schema&quot;</span>))).setHttpClientConfigCallback(</span><br><span class="line">              <span class="keyword">new</span> <span class="title class_">RestClientBuilder</span>.HttpClientConfigCallback() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> HttpAsyncClientBuilder <span class="title function_">customizeHttpClient</span><span class="params">(</span></span><br><span class="line"><span class="params">                        HttpAsyncClientBuilder httpClientBuilder)</span> &#123;</span><br><span class="line">                  <span class="keyword">return</span> httpClientBuilder</span><br><span class="line">                          .setDefaultCredentialsProvider(credentialsProvider);</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">    client = rclient;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">disposeClient</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">    <span class="keyword">if</span> ( client != <span class="literal">null</span> ) &#123;</span><br><span class="line">      client.close();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dispose</span><span class="params">(StepMetaInterface smi, StepDataInterface sdi )</span> &#123;</span><br><span class="line">    meta = (ElasticSearchBulkMeta) smi;</span><br><span class="line">    data = (ElasticSearchBulkData) sdi;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      disposeClient();</span><br><span class="line">    &#125; <span class="keyword">catch</span> ( Exception e ) &#123;</span><br><span class="line">      logError( e.getLocalizedMessage(), e );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">super</span>.dispose( smi, sdi );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ElasticSearchBulkDialog"><a href="#ElasticSearchBulkDialog" class="headerlink" title="ElasticSearchBulkDialog"></a><strong>ElasticSearchBulkDialog</strong></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.pentaho.di.ui.trans.steps.elasticsearchbulk;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.auth.AuthScope;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.auth.UsernamePasswordCredentials;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.CredentialsProvider;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.BasicCredentialsProvider;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.nio.client.HttpAsyncClientBuilder;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.SWT;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.custom.CTabFolder;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.custom.CTabItem;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.events.FocusListener;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.events.ModifyEvent;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.events.ModifyListener;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.events.SelectionAdapter;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.events.SelectionEvent;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.events.SelectionListener;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.events.ShellAdapter;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.events.ShellEvent;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.layout.FormAttachment;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.layout.FormData;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.layout.FormLayout;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.widgets.Button;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.widgets.Composite;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.widgets.Control;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.widgets.Display;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.widgets.Event;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.widgets.Group;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.widgets.Label;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.widgets.Listener;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.widgets.MessageBox;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.widgets.Shell;</span><br><span class="line"><span class="keyword">import</span> org.eclipse.swt.widgets.Text;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.get.GetIndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RequestOptions;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestClientBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.core.MainResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.transport.NoNodeAvailableException;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.settings.Settings;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.discovery.MasterNotDiscoveredException;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.core.Const;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.core.Props;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.core.exception.KettleException;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.core.row.RowMetaInterface;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.i18n.BaseMessages;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.trans.TransMeta;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.trans.step.BaseStepMeta;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.trans.step.StepDialogInterface;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.trans.steps.elasticsearchbulk.ElasticSearchBulkMeta;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.trans.steps.elasticsearchbulk.ElasticSearchBulkMeta.Server;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.ui.core.dialog.ErrorDialog;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.ui.core.widget.ColumnInfo;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.ui.core.widget.LabelComboVar;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.ui.core.widget.LabelTextVar;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.ui.core.widget.TableView;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.ui.core.widget.TextVar;</span><br><span class="line"><span class="keyword">import</span> org.pentaho.di.ui.trans.step.BaseStepDialog;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElasticSearchBulkDialog</span> <span class="keyword">extends</span> <span class="title class_">BaseStepDialog</span> <span class="keyword">implements</span> <span class="title class_">StepDialogInterface</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> ElasticSearchBulkMeta model;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Class&lt;?&gt; PKG = ElasticSearchBulkMeta.class;</span><br><span class="line">  <span class="keyword">private</span> CTabFolder wTabFolder;</span><br><span class="line">  <span class="keyword">private</span> FormData fdTabFolder;</span><br><span class="line">  <span class="keyword">private</span> CTabItem wGeneralTab;</span><br><span class="line">  <span class="keyword">private</span> Composite wGeneralComp;</span><br><span class="line">  <span class="keyword">private</span> FormData fdGeneralComp;</span><br><span class="line">  <span class="keyword">private</span> Label wlBatchSize;</span><br><span class="line">  <span class="keyword">private</span> TextVar wBatchSize;</span><br><span class="line">  <span class="keyword">private</span> LabelTextVar wIdOutField;</span><br><span class="line">  <span class="keyword">private</span> Group wIndexGroup;</span><br><span class="line">  <span class="keyword">private</span> FormData fdIndexGroup;</span><br><span class="line">  <span class="keyword">private</span> Group wSettingsGroup;</span><br><span class="line">  <span class="keyword">private</span> FormData fdSettingsGroup;</span><br><span class="line">  <span class="keyword">private</span> String[] fieldNames;</span><br><span class="line">  <span class="keyword">private</span> CTabItem wFieldsTab;</span><br><span class="line">  <span class="keyword">private</span> LabelTextVar wIndex;</span><br><span class="line">  <span class="keyword">private</span> LabelTextVar wType;</span><br><span class="line">  <span class="keyword">private</span> ModifyListener lsMod;</span><br><span class="line">  <span class="keyword">private</span> Button wIsJson;</span><br><span class="line">  <span class="keyword">private</span> Label wlIsJson;</span><br><span class="line">  <span class="keyword">private</span> Label wlUseOutput;</span><br><span class="line">  <span class="keyword">private</span> Button wUseOutput;</span><br><span class="line">  <span class="keyword">private</span> LabelComboVar wJsonField;</span><br><span class="line">  <span class="keyword">private</span> TableView wFields;</span><br><span class="line">  <span class="keyword">private</span> CTabItem wServersTab;</span><br><span class="line">  <span class="keyword">private</span> TableView wServers;</span><br><span class="line">  <span class="keyword">private</span> CTabItem wSettingsTab;</span><br><span class="line">  <span class="keyword">private</span> TableView wSettings;</span><br><span class="line">  <span class="keyword">private</span> LabelTimeComposite wTimeOut;</span><br><span class="line">  <span class="keyword">private</span> Label wlStopOnError;</span><br><span class="line">  <span class="keyword">private</span> Button wStopOnError;</span><br><span class="line">  <span class="keyword">private</span> Button wTest;</span><br><span class="line">  <span class="keyword">private</span> Button wTestCl;</span><br><span class="line">  <span class="keyword">private</span> LabelComboVar wIdInField;</span><br><span class="line">  <span class="keyword">private</span> Button wIsOverwrite;</span><br><span class="line">  <span class="keyword">private</span> Label wlIsOverwrite;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">ElasticSearchBulkDialog</span><span class="params">( Shell parent, Object in, TransMeta transMeta, String sname )</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>( parent, (BaseStepMeta) in, transMeta, sname );</span><br><span class="line">    model = (ElasticSearchBulkMeta) in;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">open</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Shell</span> <span class="variable">parent</span> <span class="operator">=</span> getParent();</span><br><span class="line">    <span class="type">Display</span> <span class="variable">display</span> <span class="operator">=</span> parent.getDisplay();</span><br><span class="line">    shell = <span class="keyword">new</span> <span class="title class_">Shell</span>( parent, SWT.DIALOG_TRIM | SWT.RESIZE | SWT.MAX | SWT.MIN );</span><br><span class="line">    props.setLook( shell );</span><br><span class="line">    setShellImage( shell, model );</span><br><span class="line">    lsMod = <span class="keyword">new</span> <span class="title class_">ModifyListener</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">modifyText</span><span class="params">(ModifyEvent e )</span> &#123;</span><br><span class="line">        model.setChanged();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    changed = model.hasChanged();</span><br><span class="line">    <span class="type">FormLayout</span> <span class="variable">formLayout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormLayout</span>();</span><br><span class="line">    formLayout.marginWidth = Const.FORM_MARGIN;</span><br><span class="line">    formLayout.marginHeight = Const.FORM_MARGIN;</span><br><span class="line">    shell.setLayout( formLayout );</span><br><span class="line">    shell.setText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.DialogTitle&quot;</span> ) );</span><br><span class="line">    <span class="type">int</span> <span class="variable">middle</span> <span class="operator">=</span> props.getMiddlePct();</span><br><span class="line">    <span class="type">int</span> <span class="variable">margin</span> <span class="operator">=</span> Const.MARGIN;</span><br><span class="line">    <span class="comment">// Stepname line</span></span><br><span class="line">    wlStepname = <span class="keyword">new</span> <span class="title class_">Label</span>( shell, SWT.RIGHT );</span><br><span class="line">    wlStepname.setText( BaseMessages.getString( PKG, <span class="string">&quot;System.Label.StepName&quot;</span> ) );</span><br><span class="line">    props.setLook( wlStepname );</span><br><span class="line">    fdlStepname = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    fdlStepname.left = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, <span class="number">0</span> );</span><br><span class="line">    fdlStepname.top = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, margin );</span><br><span class="line">    fdlStepname.right = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( middle, -margin );</span><br><span class="line">    wlStepname.setLayoutData( fdlStepname );</span><br><span class="line">    wStepname = <span class="keyword">new</span> <span class="title class_">Text</span>( shell, SWT.SINGLE | SWT.LEFT | SWT.BORDER );</span><br><span class="line">    wStepname.setText( stepname );</span><br><span class="line">    props.setLook( wStepname );</span><br><span class="line">    wStepname.addModifyListener( lsMod );</span><br><span class="line">    fdStepname = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    fdStepname.left = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( middle, <span class="number">0</span> );</span><br><span class="line">    fdStepname.top = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, margin );</span><br><span class="line">    fdStepname.right = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">100</span>, <span class="number">0</span> );</span><br><span class="line">    wStepname.setLayoutData( fdStepname );</span><br><span class="line">    wTabFolder = <span class="keyword">new</span> <span class="title class_">CTabFolder</span>( shell, SWT.BORDER );</span><br><span class="line">    props.setLook( wTabFolder, Props.WIDGET_STYLE_TAB );</span><br><span class="line">    <span class="comment">// GENERAL TAB</span></span><br><span class="line">    addGeneralTab();</span><br><span class="line">    <span class="comment">// Servers TAB</span></span><br><span class="line">    addServersTab();</span><br><span class="line">    <span class="comment">// Fields TAB</span></span><br><span class="line">    addFieldsTab();</span><br><span class="line">    <span class="comment">// Settings TAB</span></span><br><span class="line">    addSettingsTab();</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// BUTTONS //</span></span><br><span class="line">    <span class="comment">// //</span></span><br><span class="line">    wOK = <span class="keyword">new</span> <span class="title class_">Button</span>( shell, SWT.PUSH );</span><br><span class="line">    wOK.setText( BaseMessages.getString( PKG, <span class="string">&quot;System.Button.OK&quot;</span> ) );</span><br><span class="line">    wCancel = <span class="keyword">new</span> <span class="title class_">Button</span>( shell, SWT.PUSH );</span><br><span class="line">    wCancel.setText( BaseMessages.getString( PKG, <span class="string">&quot;System.Button.Cancel&quot;</span> ) );</span><br><span class="line">    setButtonPositions( <span class="keyword">new</span> <span class="title class_">Button</span>[]&#123;wOK, wCancel&#125;, margin, <span class="literal">null</span> );</span><br><span class="line">    fdTabFolder = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    fdTabFolder.left = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, <span class="number">0</span> );</span><br><span class="line">    fdTabFolder.top = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( wStepname, margin );</span><br><span class="line">    fdTabFolder.right = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">100</span>, <span class="number">0</span> );</span><br><span class="line">    fdTabFolder.bottom = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( wOK, -margin );</span><br><span class="line">    wTabFolder.setLayoutData( fdTabFolder );</span><br><span class="line">    <span class="comment">// //</span></span><br><span class="line">    <span class="comment">// Std Listeners //</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    addStandardListeners();</span><br><span class="line">    wTabFolder.setSelection( <span class="number">0</span> );</span><br><span class="line">    <span class="comment">// Set the shell size, based upon previous time...</span></span><br><span class="line">    setSize();</span><br><span class="line">    getData( model );</span><br><span class="line">    model.setChanged( changed );</span><br><span class="line">    shell.open();</span><br><span class="line">    <span class="keyword">while</span> ( !shell.isDisposed() ) &#123;</span><br><span class="line">      <span class="keyword">if</span> ( !display.readAndDispatch() ) &#123;</span><br><span class="line">        display.sleep();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> stepname;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addStandardListeners</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Add listeners</span></span><br><span class="line">    lsOK = <span class="keyword">new</span> <span class="title class_">Listener</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleEvent</span><span class="params">(Event e )</span> &#123;</span><br><span class="line">        ok();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    lsCancel = <span class="keyword">new</span> <span class="title class_">Listener</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleEvent</span><span class="params">(Event e )</span> &#123;</span><br><span class="line">        cancel();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    lsMod = <span class="keyword">new</span> <span class="title class_">ModifyListener</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">modifyText</span><span class="params">(ModifyEvent event )</span> &#123;</span><br><span class="line">        model.setChanged();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    wOK.addListener( SWT.Selection, lsOK );</span><br><span class="line">    wCancel.addListener( SWT.Selection, lsCancel );</span><br><span class="line">    lsDef = <span class="keyword">new</span> <span class="title class_">SelectionAdapter</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">widgetDefaultSelected</span><span class="params">(SelectionEvent e )</span> &#123;</span><br><span class="line">        ok();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    wStepname.addSelectionListener( lsDef );</span><br><span class="line">    <span class="comment">// window close</span></span><br><span class="line">    shell.addShellListener( <span class="keyword">new</span> <span class="title class_">ShellAdapter</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shellClosed</span><span class="params">(ShellEvent e )</span> &#123;</span><br><span class="line">        cancel();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addGeneralTab</span><span class="params">()</span> &#123;</span><br><span class="line">    wGeneralTab = <span class="keyword">new</span> <span class="title class_">CTabItem</span>( wTabFolder, SWT.NONE );</span><br><span class="line">    wGeneralTab.setText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.General.Tab&quot;</span> ) );</span><br><span class="line">    wGeneralComp = <span class="keyword">new</span> <span class="title class_">Composite</span>( wTabFolder, SWT.NONE );</span><br><span class="line">    props.setLook( wGeneralComp );</span><br><span class="line">    <span class="type">FormLayout</span> <span class="variable">generalLayout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormLayout</span>();</span><br><span class="line">    generalLayout.marginWidth = <span class="number">3</span>;</span><br><span class="line">    generalLayout.marginHeight = <span class="number">3</span>;</span><br><span class="line">    wGeneralComp.setLayout( generalLayout );</span><br><span class="line">    <span class="comment">// Index GROUP</span></span><br><span class="line">    fillIndexGroup( wGeneralComp );</span><br><span class="line">    <span class="comment">// Options GROUP</span></span><br><span class="line">    fillOptionsGroup( wGeneralComp );</span><br><span class="line">    fdGeneralComp = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    fdGeneralComp.left = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, <span class="number">0</span> );</span><br><span class="line">    fdGeneralComp.top = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( wStepname, Const.MARGIN );</span><br><span class="line">    fdGeneralComp.right = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">100</span>, <span class="number">0</span> );</span><br><span class="line">    fdGeneralComp.bottom = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">100</span>, <span class="number">0</span> );</span><br><span class="line">    wGeneralComp.setLayoutData( fdGeneralComp );</span><br><span class="line">    wGeneralComp.layout();</span><br><span class="line">    wGeneralTab.setControl( wGeneralComp );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">fillIndexGroup</span><span class="params">( Composite parentTab )</span> &#123;</span><br><span class="line">    wIndexGroup = <span class="keyword">new</span> <span class="title class_">Group</span>( parentTab, SWT.SHADOW_NONE );</span><br><span class="line">    props.setLook( wIndexGroup );</span><br><span class="line">    wIndexGroup.setText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.IndexGroup.Label&quot;</span> ) );</span><br><span class="line">    <span class="type">FormLayout</span> <span class="variable">indexGroupLayout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormLayout</span>();</span><br><span class="line">    indexGroupLayout.marginWidth = <span class="number">10</span>;</span><br><span class="line">    indexGroupLayout.marginHeight = <span class="number">10</span>;</span><br><span class="line">    wIndexGroup.setLayout( indexGroupLayout );</span><br><span class="line">    <span class="comment">// Index</span></span><br><span class="line">    wIndex = <span class="keyword">new</span> <span class="title class_">LabelTextVar</span>( transMeta, wIndexGroup, BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.Index&quot;</span></span><br><span class="line">            + <span class="string">&quot;.Label&quot;</span> ), BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.Index.Tooltip&quot;</span> ) );</span><br><span class="line">    wIndex.addModifyListener( lsMod );</span><br><span class="line">    <span class="comment">// Type</span></span><br><span class="line">    wType =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">LabelTextVar</span>( transMeta, wIndexGroup, BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.Type&quot;</span></span><br><span class="line">                    + <span class="string">&quot;.Label&quot;</span> ),</span><br><span class="line">                    BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.Type.Tooltip&quot;</span> ) );</span><br><span class="line">    wType.addModifyListener( lsMod );</span><br><span class="line">    <span class="comment">// Test button</span></span><br><span class="line">    wTest = <span class="keyword">new</span> <span class="title class_">Button</span>( wIndexGroup, SWT.PUSH );</span><br><span class="line">    wTest.setText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.TestIndex.Label&quot;</span> ) );</span><br><span class="line">    wTest.setToolTipText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.TestIndex.Tooltip&quot;</span> ) );</span><br><span class="line">    wTest.addListener( SWT.Selection, <span class="keyword">new</span> <span class="title class_">Listener</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleEvent</span><span class="params">(Event arg0 )</span> &#123;</span><br><span class="line">        test( TestType.INDEX );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; );</span><br><span class="line">    Control[] connectionControls = <span class="keyword">new</span> <span class="title class_">Control</span>[]&#123;wIndex, wType&#125;;</span><br><span class="line">    placeControls( wIndexGroup, connectionControls );</span><br><span class="line">    BaseStepDialog.positionBottomButtons( wIndexGroup, <span class="keyword">new</span> <span class="title class_">Button</span>[]&#123;wTest&#125;, Const.MARGIN, wType );</span><br><span class="line">    fdIndexGroup = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    fdIndexGroup.left = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, Const.MARGIN );</span><br><span class="line">    fdIndexGroup.top = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( wStepname, Const.MARGIN );</span><br><span class="line">    fdIndexGroup.right = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">100</span>, -Const.MARGIN );</span><br><span class="line">    wIndexGroup.setLayoutData( fdIndexGroup );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addServersTab</span><span class="params">()</span> &#123;</span><br><span class="line">    wServersTab = <span class="keyword">new</span> <span class="title class_">CTabItem</span>( wTabFolder, SWT.NONE );</span><br><span class="line">    wServersTab.setText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.ServersTab.TabTitle&quot;</span> ) );</span><br><span class="line">    <span class="type">FormLayout</span> <span class="variable">serversLayout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormLayout</span>();</span><br><span class="line">    serversLayout.marginWidth = Const.FORM_MARGIN;</span><br><span class="line">    serversLayout.marginHeight = Const.FORM_MARGIN;</span><br><span class="line">    <span class="type">Composite</span> <span class="variable">wServersComp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Composite</span>( wTabFolder, SWT.NONE );</span><br><span class="line">    wServersComp.setLayout( serversLayout );</span><br><span class="line">    props.setLook( wServersComp );</span><br><span class="line">    <span class="comment">// Test button</span></span><br><span class="line">    wTestCl = <span class="keyword">new</span> <span class="title class_">Button</span>( wServersComp, SWT.PUSH );</span><br><span class="line">    wTestCl.setText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.TestCluster.Label&quot;</span> ) );</span><br><span class="line">    wTestCl.setToolTipText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.TestCluster.Tooltip&quot;</span> ) );</span><br><span class="line">    wTestCl.addListener( SWT.Selection, <span class="keyword">new</span> <span class="title class_">Listener</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleEvent</span><span class="params">(Event arg0 )</span> &#123;</span><br><span class="line">        test( TestType.CLUSTER );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; );</span><br><span class="line">    setButtonPositions( <span class="keyword">new</span> <span class="title class_">Button</span>[]&#123;wTestCl&#125;, Const.MARGIN, <span class="literal">null</span> );</span><br><span class="line">    ColumnInfo[] columnsMeta = <span class="keyword">new</span> <span class="title class_">ColumnInfo</span>[<span class="number">2</span>];</span><br><span class="line">    columnsMeta[<span class="number">0</span>] =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ColumnInfo</span>( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.ServersTab.Address.Column&quot;</span> ),</span><br><span class="line">                    ColumnInfo.COLUMN_TYPE_TEXT, <span class="literal">false</span> );</span><br><span class="line">    columnsMeta[<span class="number">0</span>].setUsingVariables( <span class="literal">true</span> );</span><br><span class="line">    columnsMeta[<span class="number">1</span>] =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ColumnInfo</span>( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.ServersTab.Port.Column&quot;</span> ),</span><br><span class="line">                    ColumnInfo.COLUMN_TYPE_TEXT, <span class="literal">true</span> );</span><br><span class="line">    wServers =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">TableView</span>( transMeta, wServersComp, SWT.BORDER | SWT.FULL_SELECTION | SWT.MULTI, columnsMeta, <span class="number">1</span>, lsMod,</span><br><span class="line">                    props );</span><br><span class="line">    <span class="type">FormData</span> <span class="variable">fdServers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    fdServers.left = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, Const.MARGIN );</span><br><span class="line">    fdServers.top = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, Const.MARGIN );</span><br><span class="line">    fdServers.right = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">100</span>, -Const.MARGIN );</span><br><span class="line">    fdServers.bottom = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( wTestCl, -Const.MARGIN );</span><br><span class="line">    wServers.setLayoutData( fdServers );</span><br><span class="line">    <span class="type">FormData</span> <span class="variable">fdServersComp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    fdServersComp.left = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, <span class="number">0</span> );</span><br><span class="line">    fdServersComp.top = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, <span class="number">0</span> );</span><br><span class="line">    fdServersComp.right = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">100</span>, <span class="number">0</span> );</span><br><span class="line">    fdServersComp.bottom = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">100</span>, <span class="number">0</span> );</span><br><span class="line">    wServersComp.setLayoutData( fdServersComp );</span><br><span class="line">    wServersComp.layout();</span><br><span class="line">    wServersTab.setControl( wServersComp );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addSettingsTab</span><span class="params">()</span> &#123;</span><br><span class="line">    wSettingsTab = <span class="keyword">new</span> <span class="title class_">CTabItem</span>( wTabFolder, SWT.NONE );</span><br><span class="line">    wSettingsTab.setText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.SettingsTab.TabTitle&quot;</span> ) );</span><br><span class="line">    <span class="type">FormLayout</span> <span class="variable">serversLayout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormLayout</span>();</span><br><span class="line">    serversLayout.marginWidth = Const.FORM_MARGIN;</span><br><span class="line">    serversLayout.marginHeight = Const.FORM_MARGIN;</span><br><span class="line">    <span class="type">Composite</span> <span class="variable">wSettingsComp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Composite</span>( wTabFolder, SWT.NONE );</span><br><span class="line">    wSettingsComp.setLayout( serversLayout );</span><br><span class="line">    props.setLook( wSettingsComp );</span><br><span class="line">    ColumnInfo[] columnsMeta = <span class="keyword">new</span> <span class="title class_">ColumnInfo</span>[<span class="number">2</span>];</span><br><span class="line">    columnsMeta[<span class="number">0</span>] =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ColumnInfo</span>( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.SettingsTab.Property.Column&quot;</span> ),</span><br><span class="line">                    ColumnInfo.COLUMN_TYPE_TEXT, <span class="literal">false</span> );</span><br><span class="line">    columnsMeta[<span class="number">1</span>] =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ColumnInfo</span>( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.SettingsTab.Value.Column&quot;</span> ),</span><br><span class="line">                    ColumnInfo.COLUMN_TYPE_TEXT, <span class="literal">false</span> );</span><br><span class="line">    columnsMeta[<span class="number">1</span>].setUsingVariables( <span class="literal">true</span> );</span><br><span class="line">    wSettings =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">TableView</span>( transMeta, wSettingsComp, SWT.BORDER | SWT.FULL_SELECTION | SWT.MULTI, columnsMeta, <span class="number">1</span>, lsMod,</span><br><span class="line">                    props );</span><br><span class="line">    <span class="type">FormData</span> <span class="variable">fdServers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    fdServers.left = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, Const.MARGIN );</span><br><span class="line">    fdServers.top = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, Const.MARGIN );</span><br><span class="line">    fdServers.right = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">100</span>, -Const.MARGIN );</span><br><span class="line">    fdServers.bottom = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">100</span>, -Const.MARGIN );</span><br><span class="line">    wSettings.setLayoutData( fdServers );</span><br><span class="line">    <span class="type">FormData</span> <span class="variable">fdServersComp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    fdServersComp.left = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, <span class="number">0</span> );</span><br><span class="line">    fdServersComp.top = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, <span class="number">0</span> );</span><br><span class="line">    fdServersComp.right = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">100</span>, <span class="number">0</span> );</span><br><span class="line">    fdServersComp.bottom = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">100</span>, <span class="number">0</span> );</span><br><span class="line">    wSettingsComp.setLayoutData( fdServersComp );</span><br><span class="line">    wSettingsComp.layout();</span><br><span class="line">    wSettingsTab.setControl( wSettingsComp );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addFieldsTab</span><span class="params">()</span> &#123;</span><br><span class="line">    wFieldsTab = <span class="keyword">new</span> <span class="title class_">CTabItem</span>( wTabFolder, SWT.NONE );</span><br><span class="line">    wFieldsTab.setText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.FieldsTab.TabTitle&quot;</span> ) );</span><br><span class="line">    <span class="type">FormLayout</span> <span class="variable">fieldsLayout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormLayout</span>();</span><br><span class="line">    fieldsLayout.marginWidth = Const.FORM_MARGIN;</span><br><span class="line">    fieldsLayout.marginHeight = Const.FORM_MARGIN;</span><br><span class="line">    <span class="type">Composite</span> <span class="variable">wFieldsComp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Composite</span>( wTabFolder, SWT.NONE );</span><br><span class="line">    wFieldsComp.setLayout( fieldsLayout );</span><br><span class="line">    props.setLook( wFieldsComp );</span><br><span class="line">    wGet = <span class="keyword">new</span> <span class="title class_">Button</span>( wFieldsComp, SWT.PUSH );</span><br><span class="line">    wGet.setText( BaseMessages.getString( PKG, <span class="string">&quot;System.Button.GetFields&quot;</span> ) );</span><br><span class="line">    wGet.setToolTipText( BaseMessages.getString( PKG, <span class="string">&quot;System.Tooltip.GetFields&quot;</span> ) );</span><br><span class="line">    lsGet = <span class="keyword">new</span> <span class="title class_">Listener</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleEvent</span><span class="params">(Event e )</span> &#123;</span><br><span class="line">        getPreviousFields( wFields );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    wGet.addListener( SWT.Selection, lsGet );</span><br><span class="line">    setButtonPositions( <span class="keyword">new</span> <span class="title class_">Button</span>[]&#123;wGet&#125;, Const.MARGIN, <span class="literal">null</span> );</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">fieldsRowCount</span> <span class="operator">=</span> model.getFields().size();</span><br><span class="line">    String[] names = <span class="built_in">this</span>.fieldNames != <span class="literal">null</span> ? <span class="built_in">this</span>.fieldNames : <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;&quot;</span>&#125;;</span><br><span class="line">    ColumnInfo[] columnsMeta = <span class="keyword">new</span> <span class="title class_">ColumnInfo</span>[<span class="number">2</span>];</span><br><span class="line">    columnsMeta[<span class="number">0</span>] =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ColumnInfo</span>( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.NameColumn.Column&quot;</span> ),</span><br><span class="line">                    ColumnInfo.COLUMN_TYPE_CCOMBO, names, <span class="literal">false</span> );</span><br><span class="line">    columnsMeta[<span class="number">1</span>] =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ColumnInfo</span>( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.TargetNameColumn.Column&quot;</span> ),</span><br><span class="line">                    ColumnInfo.COLUMN_TYPE_TEXT, <span class="literal">false</span> );</span><br><span class="line">    wFields =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">TableView</span>( transMeta, wFieldsComp, SWT.BORDER | SWT.FULL_SELECTION | SWT.MULTI, columnsMeta,</span><br><span class="line">                    fieldsRowCount,</span><br><span class="line">                    lsMod, props );</span><br><span class="line">    <span class="type">FormData</span> <span class="variable">fdFields</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    fdFields.left = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, Const.MARGIN );</span><br><span class="line">    fdFields.top = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, Const.MARGIN );</span><br><span class="line">    fdFields.right = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">100</span>, -Const.MARGIN );</span><br><span class="line">    fdFields.bottom = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( wGet, -Const.MARGIN );</span><br><span class="line">    wFields.setLayoutData( fdFields );</span><br><span class="line">    <span class="type">FormData</span> <span class="variable">fdFieldsComp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    fdFieldsComp.left = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, <span class="number">0</span> );</span><br><span class="line">    fdFieldsComp.top = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, <span class="number">0</span> );</span><br><span class="line">    fdFieldsComp.right = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">100</span>, <span class="number">0</span> );</span><br><span class="line">    fdFieldsComp.bottom = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">100</span>, <span class="number">0</span> );</span><br><span class="line">    wFieldsComp.setLayoutData( fdFieldsComp );</span><br><span class="line">    wFieldsComp.layout();</span><br><span class="line">    wFieldsTab.setControl( wFieldsComp );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">fillOptionsGroup</span><span class="params">( Composite parentTab )</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">margin</span> <span class="operator">=</span> Const.MARGIN;</span><br><span class="line">    wSettingsGroup = <span class="keyword">new</span> <span class="title class_">Group</span>( parentTab, SWT.SHADOW_NONE );</span><br><span class="line">    props.setLook( wSettingsGroup );</span><br><span class="line">    wSettingsGroup.setText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.SettingsGroup.Label&quot;</span> ) );</span><br><span class="line">    <span class="type">FormLayout</span> <span class="variable">settingGroupLayout</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormLayout</span>();</span><br><span class="line">    settingGroupLayout.marginWidth = <span class="number">10</span>;</span><br><span class="line">    settingGroupLayout.marginHeight = <span class="number">10</span>;</span><br><span class="line">    wSettingsGroup.setLayout( settingGroupLayout );</span><br><span class="line">    <span class="comment">// Timeout</span></span><br><span class="line">    wTimeOut =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">LabelTimeComposite</span>( wSettingsGroup, BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.TimeOut&quot;</span></span><br><span class="line">                    + <span class="string">&quot;.Label&quot;</span> ),</span><br><span class="line">                    BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.TimeOut.Tooltip&quot;</span> ) );</span><br><span class="line">    props.setLook( wTimeOut );</span><br><span class="line">    wTimeOut.addModifyListener( lsMod );</span><br><span class="line">    <span class="comment">// BatchSize</span></span><br><span class="line">    wlBatchSize = <span class="keyword">new</span> <span class="title class_">Label</span>( wSettingsGroup, SWT.RIGHT );</span><br><span class="line">    wlBatchSize.setText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.BatchSize.Label&quot;</span> ) );</span><br><span class="line">    props.setLook( wlBatchSize );</span><br><span class="line">    wBatchSize = <span class="keyword">new</span> <span class="title class_">TextVar</span>( transMeta, wSettingsGroup, SWT.SINGLE | SWT.LEFT | SWT.BORDER );</span><br><span class="line">    props.setLook( wBatchSize );</span><br><span class="line">    wBatchSize.addModifyListener( lsMod );</span><br><span class="line">    <span class="comment">// Stop on error</span></span><br><span class="line">    wlStopOnError = <span class="keyword">new</span> <span class="title class_">Label</span>( wSettingsGroup, SWT.RIGHT );</span><br><span class="line">    wlStopOnError.setText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.StopOnError.Label&quot;</span> ) );</span><br><span class="line">    wStopOnError = <span class="keyword">new</span> <span class="title class_">Button</span>( wSettingsGroup, SWT.CHECK | SWT.RIGHT );</span><br><span class="line">    wStopOnError.setToolTipText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.StopOnError.Tooltip&quot;</span> ) );</span><br><span class="line">    wStopOnError.addSelectionListener( <span class="keyword">new</span> <span class="title class_">SelectionListener</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">widgetDefaultSelected</span><span class="params">(SelectionEvent arg0 )</span> &#123;</span><br><span class="line">        widgetSelected( arg0 );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">widgetSelected</span><span class="params">(SelectionEvent arg0 )</span> &#123;</span><br><span class="line">        model.setChanged();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; );</span><br><span class="line">    <span class="comment">// ID input</span></span><br><span class="line">    wIdInField =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">LabelComboVar</span>( transMeta, wSettingsGroup, BaseMessages.getString( PKG,</span><br><span class="line">                    <span class="string">&quot;ElasticSearchBulkDialog.IdField.Label&quot;</span> ), BaseMessages.getString( PKG,</span><br><span class="line">                    <span class="string">&quot;ElasticSearchBulkDialog.IdField.Tooltip&quot;</span> ) );</span><br><span class="line">    props.setLook( wIdInField );</span><br><span class="line">    wIdInField.getComboWidget().setEditable( <span class="literal">true</span> );</span><br><span class="line">    wIdInField.addModifyListener( lsMod );</span><br><span class="line">    wIdInField.addFocusListener( <span class="keyword">new</span> <span class="title class_">FocusListener</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">focusLost</span><span class="params">(org.eclipse.swt.events.FocusEvent e )</span> &#123;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">focusGained</span><span class="params">(org.eclipse.swt.events.FocusEvent e )</span> &#123;</span><br><span class="line">        getPreviousFields( wIdInField );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; );</span><br><span class="line">    getPreviousFields( wIdInField );</span><br><span class="line">    wlIsOverwrite = <span class="keyword">new</span> <span class="title class_">Label</span>( wSettingsGroup, SWT.RIGHT );</span><br><span class="line">    wlIsOverwrite.setText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.Overwrite.Label&quot;</span> ) );</span><br><span class="line">    wIsOverwrite = <span class="keyword">new</span> <span class="title class_">Button</span>( wSettingsGroup, SWT.CHECK | SWT.RIGHT );</span><br><span class="line">    wIsOverwrite.setToolTipText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.Overwrite.Tooltip&quot;</span> ) );</span><br><span class="line">    wIsOverwrite.addSelectionListener( <span class="keyword">new</span> <span class="title class_">SelectionListener</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">widgetDefaultSelected</span><span class="params">(SelectionEvent arg0 )</span> &#123;</span><br><span class="line">        widgetSelected( arg0 );</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">widgetSelected</span><span class="params">(SelectionEvent arg0 )</span> &#123;</span><br><span class="line">        model.setChanged();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; );</span><br><span class="line">    <span class="comment">// Output rows</span></span><br><span class="line">    wlUseOutput = <span class="keyword">new</span> <span class="title class_">Label</span>( wSettingsGroup, SWT.RIGHT );</span><br><span class="line">    wlUseOutput.setText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.UseOutput.Label&quot;</span> ) );</span><br><span class="line">    wUseOutput = <span class="keyword">new</span> <span class="title class_">Button</span>( wSettingsGroup, SWT.CHECK | SWT.RIGHT );</span><br><span class="line">    wUseOutput.setToolTipText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.UseOutput.Tooltip&quot;</span> ) );</span><br><span class="line">    wUseOutput.addSelectionListener( <span class="keyword">new</span> <span class="title class_">SelectionListener</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">widgetDefaultSelected</span><span class="params">(SelectionEvent arg0 )</span> &#123;</span><br><span class="line">        widgetSelected( arg0 );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">widgetSelected</span><span class="params">(SelectionEvent arg0 )</span> &#123;</span><br><span class="line">        wIdOutField.setEnabled( wUseOutput.getSelection() );</span><br><span class="line">        model.setChanged();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; );</span><br><span class="line">    <span class="comment">// ID out field</span></span><br><span class="line">    wIdOutField =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">LabelTextVar</span>( transMeta, wSettingsGroup, BaseMessages.getString( PKG,</span><br><span class="line">                    <span class="string">&quot;ElasticSearchBulkDialog.IdOutField.Label&quot;</span> ), BaseMessages.getString( PKG,</span><br><span class="line">                    <span class="string">&quot;ElasticSearchBulkDialog.IdOutField.Tooltip&quot;</span> ) );</span><br><span class="line">    props.setLook( wIdOutField );</span><br><span class="line">    wIdOutField.setEnabled( wUseOutput.getSelection() );</span><br><span class="line">    wIdOutField.addModifyListener( lsMod );</span><br><span class="line">    <span class="comment">// use json</span></span><br><span class="line">    wlIsJson = <span class="keyword">new</span> <span class="title class_">Label</span>( wSettingsGroup, SWT.RIGHT );</span><br><span class="line">    wlIsJson.setText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.IsJson.Label&quot;</span> ) );</span><br><span class="line">    wIsJson = <span class="keyword">new</span> <span class="title class_">Button</span>( wSettingsGroup, SWT.CHECK | SWT.RIGHT );</span><br><span class="line">    wIsJson.setToolTipText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.IsJson.Tooltip&quot;</span> ) );</span><br><span class="line">    wIsJson.addSelectionListener( <span class="keyword">new</span> <span class="title class_">SelectionListener</span>() &#123;</span><br><span class="line"></span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">widgetDefaultSelected</span><span class="params">(SelectionEvent arg0 )</span> &#123;</span><br><span class="line">        widgetSelected( arg0 );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">widgetSelected</span><span class="params">(SelectionEvent arg0 )</span> &#123;</span><br><span class="line">        wJsonField.setEnabled( wIsJson.getSelection() );</span><br><span class="line">        wFields.setEnabled( !wIsJson.getSelection() );</span><br><span class="line">        wFields.setVisible( !wIsJson.getSelection() );</span><br><span class="line">        wGet.setEnabled( !wIsJson.getSelection() );</span><br><span class="line">        model.setChanged();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; );</span><br><span class="line">    <span class="comment">// Json field</span></span><br><span class="line">    wJsonField =</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">LabelComboVar</span>( transMeta, wSettingsGroup, BaseMessages.getString( PKG,</span><br><span class="line">                    <span class="string">&quot;ElasticSearchBulkDialog.JsonField.Label&quot;</span> ), BaseMessages.getString( PKG,</span><br><span class="line">                    <span class="string">&quot;ElasticSearchBulkDialog.JsonField.Tooltip&quot;</span> ) );</span><br><span class="line">    wJsonField.getComboWidget().setEditable( <span class="literal">true</span> );</span><br><span class="line">    props.setLook( wJsonField );</span><br><span class="line">    wJsonField.addModifyListener( lsMod );</span><br><span class="line">    wJsonField.addFocusListener( <span class="keyword">new</span> <span class="title class_">FocusListener</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">focusLost</span><span class="params">(org.eclipse.swt.events.FocusEvent e )</span> &#123;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">focusGained</span><span class="params">(org.eclipse.swt.events.FocusEvent e )</span> &#123;</span><br><span class="line">        getPreviousFields( wJsonField );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; );</span><br><span class="line">    getPreviousFields( wJsonField );</span><br><span class="line">    wJsonField.setEnabled( wIsJson.getSelection() );</span><br><span class="line">    Control[] settingsControls = <span class="keyword">new</span> <span class="title class_">Control</span>[]&#123;wlBatchSize, wBatchSize, wlStopOnError, wStopOnError, wTimeOut,</span><br><span class="line">            wIdInField, wlIsOverwrite, wIsOverwrite, wlUseOutput, wUseOutput, wIdOutField, wlIsJson, wIsJson,</span><br><span class="line">            wJsonField&#125;;</span><br><span class="line">    placeControls( wSettingsGroup, settingsControls );</span><br><span class="line">    fdSettingsGroup = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    fdSettingsGroup.left = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">0</span>, margin );</span><br><span class="line">    fdSettingsGroup.top = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( wIndexGroup, margin );</span><br><span class="line">    fdSettingsGroup.right = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">100</span>, -margin );</span><br><span class="line">    wSettingsGroup.setLayoutData( fdSettingsGroup );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getPreviousFields</span><span class="params">( LabelComboVar combo )</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> combo.getText();</span><br><span class="line">    combo.removeAll();</span><br><span class="line">    combo.setItems( getInputFieldNames() );</span><br><span class="line">    <span class="keyword">if</span> ( value != <span class="literal">null</span> ) &#123;</span><br><span class="line">      combo.setText( value );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> String[] getInputFieldNames() &#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">this</span>.fieldNames == <span class="literal">null</span> ) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">RowMetaInterface</span> <span class="variable">r</span> <span class="operator">=</span> transMeta.getPrevStepFields( stepname );</span><br><span class="line">        <span class="keyword">if</span> ( r != <span class="literal">null</span> ) &#123;</span><br><span class="line">          fieldNames = r.getFieldNames();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">catch</span> ( KettleException ke ) &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ErrorDialog</span>( shell, BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.FailedToGetFields.DialogTitle&quot;</span> ),</span><br><span class="line">                BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.FailedToGetFields.DialogMessage&quot;</span> ), ke );</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fieldNames;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getPreviousFields</span><span class="params">( TableView table )</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="type">RowMetaInterface</span> <span class="variable">r</span> <span class="operator">=</span> transMeta.getPrevStepFields( stepname );</span><br><span class="line">      <span class="keyword">if</span> ( r != <span class="literal">null</span> ) &#123;</span><br><span class="line">        BaseStepDialog.getFieldsFromPrevious( r, table, <span class="number">1</span>, <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>&#125;, <span class="literal">null</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="literal">null</span> );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> ( KettleException ke ) &#123;</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">ErrorDialog</span>( shell, BaseMessages.getString( PKG, <span class="string">&quot;System.Dialog.GetFieldsFailed.Title&quot;</span> ), BaseMessages</span><br><span class="line">              .getString( PKG, <span class="string">&quot;System.Dialog.GetFieldsFailed.Message&quot;</span> ), ke );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">placeControls</span><span class="params">( Group group, Control[] controls )</span> &#123;</span><br><span class="line">    <span class="type">Control</span> <span class="variable">previousAbove</span> <span class="operator">=</span> group;</span><br><span class="line">    <span class="type">Control</span> <span class="variable">previousLeft</span> <span class="operator">=</span> group;</span><br><span class="line">    <span class="keyword">for</span> ( Control control : controls ) &#123;</span><br><span class="line">      <span class="keyword">if</span> ( control <span class="keyword">instanceof</span> Label ) &#123;</span><br><span class="line">        addLabelAfter( control, previousAbove );</span><br><span class="line">        previousLeft = control;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        addWidgetAfter( control, previousAbove, previousLeft );</span><br><span class="line">        previousAbove = control;</span><br><span class="line">        previousLeft = group;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addWidgetAfter</span><span class="params">( Control widget, Control widgetAbove, Control widgetLeft )</span> &#123;</span><br><span class="line">    props.setLook( widget );</span><br><span class="line">    <span class="type">FormData</span> <span class="variable">fData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    fData.left = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( widgetLeft, Const.MARGIN );</span><br><span class="line">    fData.top = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( widgetAbove, Const.MARGIN );</span><br><span class="line">    fData.right = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( <span class="number">100</span>, -Const.MARGIN );</span><br><span class="line">    widget.setLayoutData( fData );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addLabelAfter</span><span class="params">( Control widget, Control widgetAbove )</span> &#123;</span><br><span class="line">    props.setLook( widget );</span><br><span class="line">    <span class="type">FormData</span> <span class="variable">fData</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    fData.top = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( widgetAbove, Const.MARGIN );</span><br><span class="line">    fData.right = <span class="keyword">new</span> <span class="title class_">FormAttachment</span>( Const.MIDDLE_PCT, -Const.MARGIN );</span><br><span class="line">    widget.setLayoutData( fData );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Read the data from the ElasticSearchBulkMeta object and show it in this dialog.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> in The ElasticSearchBulkMeta object to obtain the data from.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getData</span><span class="params">( ElasticSearchBulkMeta in )</span> &#123;</span><br><span class="line">    wIndex.setText( Const.NVL( in.getIndex(), <span class="string">&quot;&quot;</span> ) );</span><br><span class="line">    wType.setText( Const.NVL( in.getType(), <span class="string">&quot;&quot;</span> ) );</span><br><span class="line">    wBatchSize.setText( Const.NVL( in.getBatchSize(), <span class="string">&quot;&quot;</span> + ElasticSearchBulkMeta.DEFAULT_BATCH_SIZE ) );</span><br><span class="line">    wStopOnError.setSelection( in.isStopOnError() );</span><br><span class="line">    wTimeOut.setText( Const.NVL( in.getTimeOut(), <span class="string">&quot;&quot;</span> ) );</span><br><span class="line">    wTimeOut.setTimeUnit( in.getTimeoutUnit() );</span><br><span class="line">    wIdInField.setText( Const.NVL( in.getIdInField(), <span class="string">&quot;&quot;</span> ) );</span><br><span class="line">    wIsOverwrite.setSelection( in.isOverWriteIfSameId() );</span><br><span class="line">    wIsJson.setSelection( in.isJsonInsert() );</span><br><span class="line">    wJsonField.setText( Const.NVL( in.getJsonField(), <span class="string">&quot;&quot;</span> ) );</span><br><span class="line">    wJsonField.setEnabled( wIsJson.getSelection() ); <span class="comment">// listener not working here</span></span><br><span class="line">    wUseOutput.setSelection( in.isUseOutput() );</span><br><span class="line">    wIdOutField.setText( Const.NVL( in.getIdOutField(), <span class="string">&quot;&quot;</span> ) );</span><br><span class="line">    wIdOutField.setEnabled( wUseOutput.getSelection() ); <span class="comment">// listener not working here</span></span><br><span class="line">    <span class="comment">// Fields</span></span><br><span class="line">    mapToTableView( model.getFieldsMap(), wFields );</span><br><span class="line">    <span class="comment">// Servers</span></span><br><span class="line">    <span class="keyword">for</span> ( ElasticSearchBulkMeta.Server server : model.getServers() ) &#123;</span><br><span class="line">      wServers.add( server.address, <span class="string">&quot;&quot;</span> + server.port );</span><br><span class="line">    &#125;</span><br><span class="line">    wServers.removeEmptyRows();</span><br><span class="line">    wServers.setRowNums();</span><br><span class="line">    <span class="comment">// Settings</span></span><br><span class="line">    mapToTableView( model.getSettingsMap(), wSettings );</span><br><span class="line">    wStepname.selectAll();</span><br><span class="line">    wStepname.setFocus();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">mapToTableView</span><span class="params">( Map&lt;String, String&gt; map, TableView table )</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> ( String key : map.keySet() ) &#123;</span><br><span class="line">      table.add( key, map.get( key ) );</span><br><span class="line">    &#125;</span><br><span class="line">    table.removeEmptyRows();</span><br><span class="line">    table.setRowNums();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">cancel</span><span class="params">()</span> &#123;</span><br><span class="line">    stepname = <span class="literal">null</span>;</span><br><span class="line">    model.setChanged( changed );</span><br><span class="line">    dispose();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">ok</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      toModel( model );</span><br><span class="line">    &#125; <span class="keyword">catch</span> ( KettleException e ) &#123;</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">ErrorDialog</span>( shell, BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.ErrorValidateData.DialogTitle&quot;</span> ),</span><br><span class="line">              BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.ErrorValidateData.DialogMessage&quot;</span> ), e );</span><br><span class="line">    &#125;</span><br><span class="line">    dispose();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">toModel</span><span class="params">( ElasticSearchBulkMeta in )</span> <span class="keyword">throws</span> KettleException &#123; <span class="comment">// copy info to ElasticSearchBulkMeta</span></span><br><span class="line">    stepname = wStepname.getText();</span><br><span class="line">    in.setType( wType.getText() );</span><br><span class="line">    in.setIndex( wIndex.getText() );</span><br><span class="line">    in.setBatchSize( wBatchSize.getText() );</span><br><span class="line">    in.setTimeOut( Const.NVL( wTimeOut.getText(), <span class="literal">null</span> ) );</span><br><span class="line">    in.setTimeoutUnit( wTimeOut.getTimeUnit() );</span><br><span class="line">    in.setIdInField( wIdInField.getText() );</span><br><span class="line">    in.setOverWriteIfSameId( StringUtils.isNotBlank( wIdInField.getText() ) &amp;&amp; wIsOverwrite.getSelection() );</span><br><span class="line">    in.setStopOnError( wStopOnError.getSelection() );</span><br><span class="line">    in.setJsonInsert( wIsJson.getSelection() );</span><br><span class="line">    in.setJsonField( wIsJson.getSelection() ? wJsonField.getText() : <span class="literal">null</span> );</span><br><span class="line">    in.setIdOutField( wIdOutField.getText() );</span><br><span class="line">    in.setUseOutput( wUseOutput.getSelection() );</span><br><span class="line">    in.clearFields();</span><br><span class="line">    <span class="keyword">if</span> ( !wIsJson.getSelection() ) &#123;</span><br><span class="line">      <span class="keyword">for</span> ( <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; wFields.getItemCount(); i++ ) &#123;</span><br><span class="line">        String[] row = wFields.getItem( i );</span><br><span class="line">        <span class="keyword">if</span> ( StringUtils.isNotBlank( row[<span class="number">0</span>] ) ) &#123;</span><br><span class="line">          in.addField( row[<span class="number">0</span>], row[<span class="number">1</span>] );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    in.clearServers();</span><br><span class="line">    <span class="keyword">for</span> ( <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; wServers.getItemCount(); i++ ) &#123;</span><br><span class="line">      String[] row = wServers.getItem( i );</span><br><span class="line">      <span class="keyword">if</span> ( StringUtils.isNotBlank( row[<span class="number">0</span>] ) ) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          in.addServer( row[<span class="number">0</span>], Integer.parseInt( row[<span class="number">1</span>] ) );</span><br><span class="line">        &#125; <span class="keyword">catch</span> ( NumberFormatException nfe ) &#123;</span><br><span class="line">          in.addServer( row[<span class="number">0</span>], ElasticSearchBulkMeta.DEFAULT_PORT );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    in.clearSettings();</span><br><span class="line">    <span class="keyword">for</span> ( <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; wSettings.getItemCount(); i++ ) &#123;</span><br><span class="line">      String[] row = wSettings.getItem( i );</span><br><span class="line">      in.addSetting( row[<span class="number">0</span>], row[<span class="number">1</span>] );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">enum</span> <span class="title class_">TestType</span> &#123;</span><br><span class="line">    INDEX, CLUSTER,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">( TestType testType )</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="type">ElasticSearchBulkMeta</span> <span class="variable">tempMeta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ElasticSearchBulkMeta</span>();</span><br><span class="line">      toModel( tempMeta );</span><br><span class="line">      <span class="keyword">if</span> ( !tempMeta.getServers().isEmpty() ) &#123;</span><br><span class="line">        Settings.<span class="type">Builder</span> <span class="variable">settingsBuilder</span> <span class="operator">=</span> Settings.builder();</span><br><span class="line">        settingsBuilder.put( Settings.Builder.EMPTY_SETTINGS );</span><br><span class="line">        tempMeta.getSettingsMap().entrySet().stream().forEach( ( s ) -&gt; settingsBuilder.put( s.getKey(), transMeta</span><br><span class="line">                .environmentSubstitute( s.getValue() ) ) );</span><br><span class="line">        RestHighLevelClient rclient=<span class="literal">null</span>;</span><br><span class="line"><span class="comment">//        try ( PreBuiltTransportClient client = new PreBuiltTransportClient( settingsBuilder.build() ) ) &#123; </span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        for ( Server server : tempMeta.getServers() ) &#123; </span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//          client.addTransportAddress( new TransportAddress(</span></span><br><span class="line"><span class="comment">//                  InetAddress.getByName( transMeta.environmentSubstitute( server.getAddress() ) ),</span></span><br><span class="line"><span class="comment">//                  server.getPort() ) );</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">CredentialsProvider</span> <span class="variable">credentialsProvider</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BasicCredentialsProvider</span>();</span><br><span class="line">        credentialsProvider.setCredentials(AuthScope.ANY,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">UsernamePasswordCredentials</span>(settingsBuilder.get(<span class="string">&quot;es.user&quot;</span>),</span><br><span class="line">                        settingsBuilder.get(<span class="string">&quot;es.password&quot;</span>)));</span><br><span class="line">        <span class="keyword">for</span> ( Server server : tempMeta.getServers() ) &#123;</span><br><span class="line">          rclient = <span class="keyword">new</span> <span class="title class_">RestHighLevelClient</span>(RestClient.builder(</span><br><span class="line">                  <span class="keyword">new</span> <span class="title class_">HttpHost</span>(server.getAddress(), Integer.valueOf(server</span><br><span class="line">                          .getPort()), settingsBuilder.get(<span class="string">&quot;es.schema&quot;</span>))).setHttpClientConfigCallback(</span><br><span class="line">                  <span class="keyword">new</span> <span class="title class_">RestClientBuilder</span>.HttpClientConfigCallback() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> HttpAsyncClientBuilder <span class="title function_">customizeHttpClient</span><span class="params">(</span></span><br><span class="line"><span class="params">                            HttpAsyncClientBuilder httpClientBuilder)</span> &#123;</span><br><span class="line">                      <span class="keyword">return</span> httpClientBuilder</span><br><span class="line">                              .setDefaultCredentialsProvider(credentialsProvider);</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;));</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        AdminClient admin = rclient.admin();</span></span><br><span class="line">        String[] index = tempMeta.getIndex().split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="type">GetIndexRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetIndexRequest</span>();</span><br><span class="line">        request.indices(index);</span><br><span class="line">        request.local(<span class="literal">false</span>);</span><br><span class="line">        request.humanReadable(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">exists</span>  <span class="operator">=</span> rclient.indices().exists(request, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="keyword">switch</span> ( testType ) &#123;</span><br><span class="line">          <span class="keyword">case</span> INDEX:</span><br><span class="line">            <span class="keyword">if</span> ( StringUtils.isBlank( tempMeta.getIndex() ) ) &#123;</span><br><span class="line">              showError( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulk.Error.NoIndex&quot;</span> ) );</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// First check to see if the index exists</span></span><br><span class="line"><span class="comment">//            IndicesExistsRequestBuilder indicesExistBld = admin.indices().prepareExists( tempMeta.getIndex() );</span></span><br><span class="line"><span class="comment">//            IndicesExistsResponse indicesExistResponse = indicesExistBld.execute().get();</span></span><br><span class="line">            <span class="keyword">if</span> ( !exists ) &#123;</span><br><span class="line">              showError( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.Error.NoIndex&quot;</span> ) );</span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            RecoveryRequestBuilder indicesBld = rclient.indices().prepareRecoveries( tempMeta.getIndex() );</span></span><br><span class="line"><span class="comment">//            ActionFuture&lt;RecoveryResponse&gt; lafInd = indicesBld.execute();</span></span><br><span class="line"><span class="comment">//            String shards = &quot;&quot; + lafInd.get().getSuccessfulShards() + &quot;/&quot; + lafInd.get().getTotalShards();</span></span><br><span class="line">            showMessage( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.TestIndex.TestOK&quot;</span>, <span class="string">&quot;true&quot;</span> ) );</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> CLUSTER:</span><br><span class="line"><span class="comment">//            ClusterStateRequestBuilder clusterBld = admin.cluster().prepareState();</span></span><br><span class="line"><span class="comment">//            ActionFuture&lt;ClusterStateResponse&gt; lafClu = clusterBld.execute();</span></span><br><span class="line"><span class="comment">//            ClusterStateResponse cluResp = lafClu.actionGet();</span></span><br><span class="line"><span class="comment">//            String name = cluResp.getClusterName().value();</span></span><br><span class="line"><span class="comment">//            ClusterState cluState = cluResp.getState();</span></span><br><span class="line"><span class="comment">//            int numNodes = cluState.getNodes().getSize();</span></span><br><span class="line"><span class="comment">//            showMessage( BaseMessages.getString( PKG, &quot;ElasticSearchBulkDialog.TestCluster.TestOK&quot;, name, numNodes ) );</span></span><br><span class="line">            <span class="type">MainResponse</span> <span class="variable">response</span> <span class="operator">=</span> rclient.info(RequestOptions.DEFAULT);</span><br><span class="line">            showMessage( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.TestCluster.TestOK&quot;</span>, response.getClusterName(), response.getVersion() ) );</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        showError( <span class="string">&quot;Servers is null&quot;</span> );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> ( NoNodeAvailableException | MasterNotDiscoveredException e ) &#123;</span><br><span class="line">      showError( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.Error.NoNodesFound&quot;</span> ) );</span><br><span class="line">    &#125; <span class="keyword">catch</span> ( Exception e ) &#123;</span><br><span class="line">      showError( e.getLocalizedMessage() );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">showError</span><span class="params">( String message )</span> &#123;</span><br><span class="line">    <span class="type">MessageBox</span> <span class="variable">mb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MessageBox</span>( shell, SWT.OK | SWT.ICON_ERROR );</span><br><span class="line">    mb.setMessage( message );</span><br><span class="line">    mb.setText( BaseMessages.getString( PKG, <span class="string">&quot;System.Dialog.Error.Title&quot;</span> ) );</span><br><span class="line">    mb.open();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">showMessage</span><span class="params">( String message )</span> &#123;</span><br><span class="line">    <span class="type">MessageBox</span> <span class="variable">mb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MessageBox</span>( shell, SWT.OK | SWT.ICON_INFORMATION );</span><br><span class="line">    mb.setMessage( message );</span><br><span class="line">    mb.setText( BaseMessages.getString( PKG, <span class="string">&quot;ElasticSearchBulkDialog.Test.TestOKTitle&quot;</span> ) );</span><br><span class="line">    mb.open();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.getClass().getName();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="改完后重新打包"><a href="#改完后重新打包" class="headerlink" title="改完后重新打包"></a><strong>改完后重新打包</strong></h4><blockquote><p>执行<code>mvn clean package -Dmaven.test.skip=true</code></p></blockquote><h4 id="进入-plugins-elasticsearch-bulk-insert-assemblies-plugin-target文件夹下-解压jar包并更名替换掉原有包的elasticsearch-bulk-insert-plugin文件夹"><a href="#进入-plugins-elasticsearch-bulk-insert-assemblies-plugin-target文件夹下-解压jar包并更名替换掉原有包的elasticsearch-bulk-insert-plugin文件夹" class="headerlink" title="进入~\plugins\elasticsearch-bulk-insert\assemblies\plugin\target文件夹下,解压jar包并更名替换掉原有包的elasticsearch-bulk-insert-plugin文件夹"></a><strong>进入~\plugins\elasticsearch-bulk-insert\assemblies\plugin\target文件夹下,解压jar包并更名替换掉原有包的elasticsearch-bulk-insert-plugin文件夹</strong></h4><h4 id="重新进入kettle会发现组件进入了不推荐区域"><a href="#重新进入kettle会发现组件进入了不推荐区域" class="headerlink" title="重新进入kettle会发现组件进入了不推荐区域"></a><strong>重新进入kettle会发现组件进入了不推荐区域</strong></h4><img src="/img/loading.gif" data-lazy-src="/posts/ed754a6/up-a3107bd1657b0c6ee828eb62c77bee3a766.png"><h4 id="配置-并查看是否成功"><a href="#配置-并查看是否成功" class="headerlink" title="配置,并查看是否成功"></a><strong>配置,并查看是否成功</strong></h4><img src="/img/loading.gif" data-lazy-src="/posts/ed754a6/up-f361b85fc843d11702b20b56d2a590ec9a0.png"> <img src="/img/loading.gif" data-lazy-src="/posts/ed754a6/up-36c40ad0fd8b110d6e61ad2cf55a2b5e256.png"></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者:</span> <span class="post-copyright-info"><a href="https://xiaowu95.wang">小五</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接:</span> <span class="post-copyright-info"><a href="https://xiaowu95.wang/posts/ed754a6/">https://xiaowu95.wang/posts/ed754a6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://xiaowu95.wang" target="_blank">小五的个人杂货铺</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a><a class="post-meta__tags" href="/tags/kettle/">kettle</a></div><div class="post-share"><div class="social-share" data-image="/img/nba-logo12.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>感谢支持</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wxpay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-lazy-src="/img/wxpay.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-lazy-src="/img/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/4a7e37d2/" title="记录kettle安装以及支持clickhouse进行开发"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo24.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">记录kettle安装以及支持clickhouse进行开发</div></div><div class="info-2"><div class="info-item-1">kettle下载地址 选择需要的版本,进入这个路径,下载这个ce 解压 kettle 安装包下载clickhouse所需驱动包 将 clickhouse-plugins文件夹复制到 kettle 的 data-integration\plugins文件夹里 复制驱动包里的其余jar包，粘贴到 kettle 的 data-integration\libswt\xxx 目录下（根据自己的系统而定,linux环境使用uname -r 先看下系统） 启动kettle编辑工具，双击 data-integration 目录下 Spoon.bat 启动</div></div></div></a><a class="pagination-related" href="/posts/d1062c8f/" title="关于记录集合里面的记录数"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo5.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">关于记录集合里面的记录数</div></div><div class="info-2"><div class="info-item-1">记录集合里面的记录数 该数量是指组件与组件之间通信的【缓存队列】的size大小，Kettle内部用List实现该缓存队列，每一条语句都会被封装成一个 RowSet对象，每个组件之间都会有个List&lt;RowSet&gt;队列，源step每次会往该队列写一条数据，目标step每次会从队列读取一条数据。 kettle里面转换是并行的，数据是一条一条流经每个组件，队列大小采用默认的10000条即可。 但是当使用到【阻塞数据直至步骤完成】、【阻塞数据】相关组件时，则需要根据业务数据量扩大该size的大小。 否则，数据会一直在某两个组件之间的缓存队列中存放，当数量达到一定大小时，就会卡主不动。 缓存队列的大小对作业没有影响，查看源码发现，缓存队列由inputRowSet 和 outputRowset组成，底部实现是ArrayList，初始化创建的时候，默认容量为10，并不会直接创建设定长度的 数组。并且使用ArrayList的特性：当要添加的数据量超过数组的容量时候，ArrayList会动态扩容，size扩大1.5倍</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/265f9108/" title="job和trans的参数详解"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo3.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2024-05-10</div><div class="info-item-2">job和trans的参数详解</div></div><div class="info-2"><div class="info-item-1">pan调用示例 sh pan.sh -rep=initech_pdi_repo -user=pgibbons -pass=lumburghsux -trans=TPS_reports_2011 -param:db_ip=$db_ip -param:db_name=$db_name 参数 参数说明 rep 企业或数据库存储库名称 user 仓库用户名 pass 仓库密码 trans 要启动的转换的名称（在存储库中显示） dir 包含转换的存储库目录，包括前导斜杠 file 如果调用的是本地 KTR 文件，则为文件名，如果不在本地目录中，则包括路径 level 日志级别（基本、详细、调试、行级别、错误、无） logfile 将日志输出写入的本地文件名 listdir 列出指定存储库中的目录 listtrans 列出指定存储库目录中的转换 listrep 列出可用的存储库 exprep 将所有存储库对象导出到一个 XML 文件 norep 防止 Pan 登录到存储库。如果您已经设置了...</div></div></div></a><a class="pagination-related" href="/posts/801d1ce5/" title="Kettle是什么"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo20.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2024-05-10</div><div class="info-item-2">Kettle是什么</div></div><div class="info-2"><div class="info-item-1">kettle中文网 免费开源的基于java的企业级ETL工具ETL（Extract-Transform-Load的缩写，即数据抽取、转换、装载的过程），对于企业或行业应用来说，我们经常会遇到各种数据的处理，转换，迁移，所以了解并掌握一种etl工具的使用，必不可少，这里我介绍一个我在工作中使用了3年左右的ETL工具Kettle,本着好东西不独享的想法，跟大家分享碰撞交流一下！在使用中我感觉这个工具真的很强大，支持图形化的GUI设计界面，然后可以以工作流的形式流转，在做一些简单或复杂的数据抽取、质量检测、数据清洗、数据转换、数据过滤等方面有着比较稳定的表现，其中最主要的我们通过熟练的应用它，减少了非常多的研发工作量，提高了我们的工作效率</div></div></div></a><a class="pagination-related" href="/posts/3068c067/" title="一些开发中需要注意的问题点"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo28.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2024-05-10</div><div class="info-item-2">一些开发中需要注意的问题点</div></div><div class="info-2"><div class="info-item-1">注意点1234567891011121314151617181920212223242526272829303132333435361. 过滤记录或者字段选择等组件, 无法出现上面步骤中的字段的时候,尝试在上面步骤中再次点击确定2. 两个数据流join前必须先进行排序操作。3. 数据流从计算器或join操作流出，并将流入另一join操作之前，需要插入一个字段选择插件。4. 表输入插件中，填写查询语句时，语句末尾不能加分号。~~ kettle8.2以上无此问题5. sql脚本插件中，填写sql语句时，语句末尾必须加分号，否则不会执行。~~ kettle8.2以上无此问题6. 引用变量时，采用$&#123;变量名&#125;的方式引用，以免出现问题。此种引用方式还可以在变量内容后接其他字符串，例如：$&#123;key&#125;_20151217会被解析为：value_2015217。7. job中执行多个trans时，如何确定trans执行的先后顺序？根据连接线的先后顺序执行，如果需要优先执行则先连接从开始到该trans的连线即可。8....</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-lazy-src="/img/avatar.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">小五</div><div class="author-info-description">Tomorrow will be better,Everything will be fine</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">550</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">163</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">58</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/wang-xiaowu"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons"><a class="social-icon" href="/random" target="_blank" title="随便逛逛"><i class="fa-solid fa-shuffle"></i></a><a class="social-icon" href="mailto:wangxiaowu950330@foxmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/30655189?spm_id_from=333.1007.0.0" rel="external nofollow noreferrer" target="_blank" title="BiliBili"><i class="fa-brands fa-bilibili"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa-solid fa-rss"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E5%89%8Dkettle%E6%9C%80%E6%96%B0%E7%9A%84%E7%89%88%E6%9C%AC%E6%98%AF9-2-%E4%BD%86%E6%98%AFes%E4%BB%85%E6%94%AF%E6%8C%81%E5%88%B06-4-2-%E8%80%8C%E4%B8%94%E4%B9%9F%E6%97%A0%E6%B3%95%E9%85%8D%E7%BD%AE%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81%E8%BF%98%E6%9C%89schema-%E6%89%80%E4%BB%A5%E9%9C%80%E8%A6%81%E5%AF%B9es-bulk-insert%E7%BB%84%E4%BB%B6%E6%94%B9%E9%80%A0%E4%B8%8B"><span class="toc-number">1.</span> <span class="toc-text">目前kettle最新的版本是9.2,但是es仅支持到6.4.2,而且也无法配置用户名和密码还有schema,所以需要对es-bulk-insert组件改造下</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E6%BA%90%E7%A0%81-kettle-github%E6%BA%90%E7%A0%81%E5%9C%B0%E5%9D%80"><span class="toc-number">1.1.</span> <span class="toc-text">下载源码(kettle github源码地址)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E6%94%B9%E4%B8%A4%E4%B8%AA%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">主要改两个类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E8%80%85%E6%98%AF%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE%E6%89%A7%E8%A1%8C%E9%9C%80%E8%A6%81%E7%9A%84-%E5%90%8E%E8%80%85%E6%98%AF%E9%82%A3%E4%B8%AA%E7%BB%84%E4%BB%B6%E6%A1%86%E9%9C%80%E8%A6%81%E7%9A%84-%E6%AF%94%E5%A6%82%E4%BD%A0%E7%82%B9test-%E5%B0%B1%E4%BC%9A%E8%B0%83%E7%94%A8%E8%BF%99%E4%B8%AA%E7%B1%BB%E7%9A%84test%E6%96%B9%E6%B3%95"><span class="toc-number">1.3.</span> <span class="toc-text">前者是业务数据执行需要的,后者是那个组件框需要的,比如你点test,就会调用这个类的test方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E9%9C%80%E8%A6%81%E6%94%B9pom%E6%96%87%E4%BB%B6-%E6%94%B9%E6%88%90%E9%9C%80%E8%A6%81%E7%9A%84%E7%89%88%E6%9C%AC"><span class="toc-number">1.4.</span> <span class="toc-text">首先需要改pom文件,改成需要的版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E6%AC%A1%E6%98%AF%E8%BF%99%E4%BA%9B%E5%9C%A8%E9%AB%98%E7%89%88%E6%9C%AC%E4%B8%AD%E5%BC%83%E7%94%A8%E7%9A%84%E7%B1%BB%E5%92%8C%E6%96%B9%E6%B3%95"><span class="toc-number">1.5.</span> <span class="toc-text">其次是这些在高版本中弃用的类和方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8elastic%E5%AE%98%E7%BD%91%E4%B8%AD%E4%B9%9F%E7%BB%99%E5%87%BA%E4%BA%86%E5%AF%B9%E5%BA%94%E7%9A%84%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%B3%95-https-www-elastic-co-guide-en-elasticsearch-client-java-rest-current-changing-the-application-8217-s-code-html-how-to-migrate-the-way-requests-are-built"><span class="toc-number">1.6.</span> <span class="toc-text">在elastic官网中也给出了对应的替代方法(https:&#x2F;&#x2F;www.elastic.co&#x2F;guide&#x2F;en&#x2F;elasticsearch&#x2F;client&#x2F;java-rest&#x2F;current&#x2F;_changing_the_application_8217_s_code.html#_how_to_migrate_the_way_requests_are_built)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ElasticSearchBulk%E7%B1%BB%E7%9A%84%E4%BF%AE%E6%94%B9%E5%A6%82%E4%B8%8B"><span class="toc-number">1.7.</span> <span class="toc-text">ElasticSearchBulk类的修改如下</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ElasticSearchBulkDialog"><span class="toc-number">1.8.</span> <span class="toc-text">ElasticSearchBulkDialog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%B9%E5%AE%8C%E5%90%8E%E9%87%8D%E6%96%B0%E6%89%93%E5%8C%85"><span class="toc-number">1.9.</span> <span class="toc-text">改完后重新打包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5-plugins-elasticsearch-bulk-insert-assemblies-plugin-target%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%8B-%E8%A7%A3%E5%8E%8Bjar%E5%8C%85%E5%B9%B6%E6%9B%B4%E5%90%8D%E6%9B%BF%E6%8D%A2%E6%8E%89%E5%8E%9F%E6%9C%89%E5%8C%85%E7%9A%84elasticsearch-bulk-insert-plugin%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-number">1.10.</span> <span class="toc-text">进入~\plugins\elasticsearch-bulk-insert\assemblies\plugin\target文件夹下,解压jar包并更名替换掉原有包的elasticsearch-bulk-insert-plugin文件夹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%96%B0%E8%BF%9B%E5%85%A5kettle%E4%BC%9A%E5%8F%91%E7%8E%B0%E7%BB%84%E4%BB%B6%E8%BF%9B%E5%85%A5%E4%BA%86%E4%B8%8D%E6%8E%A8%E8%8D%90%E5%8C%BA%E5%9F%9F"><span class="toc-number">1.11.</span> <span class="toc-text">重新进入kettle会发现组件进入了不推荐区域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-%E5%B9%B6%E6%9F%A5%E7%9C%8B%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F"><span class="toc-number">1.12.</span> <span class="toc-text">配置,并查看是否成功</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/c75c82a0/" title="使用 TypeScript 创建 Koa 服务器"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo16.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="使用 TypeScript 创建 Koa 服务器"></a><div class="content"><a class="title" href="/posts/c75c82a0/" title="使用 TypeScript 创建 Koa 服务器">使用 TypeScript 创建 Koa 服务器</a><time datetime="2025-10-11T06:00:11.000Z" title="发表于 2025-10-11 14:00:11">2025-10-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/c9d8bfa7/" title="Nodejs应用提取heap并加以分析的一些常用方法"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo24.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Nodejs应用提取heap并加以分析的一些常用方法"></a><div class="content"><a class="title" href="/posts/c9d8bfa7/" title="Nodejs应用提取heap并加以分析的一些常用方法">Nodejs应用提取heap并加以分析的一些常用方法</a><time datetime="2025-09-28T07:54:43.000Z" title="发表于 2025-09-28 15:54:43">2025-09-28</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/nba-logo12.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By 小五</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a href="https://www.foreverblog.cn/" rel="external nofollow noreferrer" target="_blank"><img src="/img/loading.gif" data-lazy-src="https://img.foreverblog.cn/logo_en_default.png" alt="十年之约" style="width:auto;height:16px"></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.2.2/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.2.2/source/js/main.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.2.2/source/js/tw_cn.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(()=>{const e=()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");if(0===e.length)return;const t=()=>(e=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";e.forEach(((e,n)=>{const d=e.firstElementChild,a=`mermaid-${n}`,r=`%%{init:{ 'theme':'${t}'}}%%\n`+d.textContent,i=mermaid.render(a,r),m=e=>{d.insertAdjacentHTML("afterend",e)};"string"==typeof i?m(i):i.then((({svg:e})=>m(e)))}))})(e);btf.addGlobalFn("themeChange",t,"mermaid"),window.loadMermaid?t():btf.getScript("https://cdn.jsdelivr.net/npm/mermaid@11.4.0/dist/mermaid.min.js").then(t)};btf.addGlobalFn("encrypt",e,"mermaid"),window.pjax?e():document.addEventListener("DOMContentLoaded",e)})()</script><script>(()=>{const t=document.querySelectorAll("#article-container .chartjs-container");if(0===t.length)return;const e=(t,a)=>{"object"==typeof t&&null!==t&&Object.keys(t).forEach((r=>{const n=t[r];"object"==typeof n&&null!==n&&(n[a]?t[r]=n[a]:e(n,a))}))},a=()=>{window.loadChartJS=!0,Array.from(t).forEach(((t,a)=>{const r=t.firstElementChild,n=t.getAttribute("data-chartjs-id")||"chartjs-"+a,d=t.getAttribute("data-width"),o=document.getElementById(n);o&&o.parentNode.remove();const c=r.textContent,l=document.createElement("canvas");l.id=n;const s=document.createElement("div");s.className="chartjs-wrap",d&&(s.style.width=d),s.appendChild(l),r.insertAdjacentElement("afterend",s);const h=document.getElementById(n).getContext("2d"),i=JSON.parse(c),m="dark"===document.documentElement.getAttribute("data-theme")?"dark-mode":"light-mode";(t=>{"dark-mode"===t?(Chart.defaults.color="rgba(255, 255, 255, 0.8)",Chart.defaults.borderColor="rgba(255, 255, 255, 0.2)",Chart.defaults.scale.ticks.backdropColor="transparent"):(Chart.defaults.color="rgba(0, 0, 0, 0.8)",Chart.defaults.borderColor="rgba(0, 0, 0, 0.1)",Chart.defaults.scale.ticks.backdropColor="transparent")})(m),e(i,m),new Chart(h,i)}))},r=()=>{window.loadChartJS?a():btf.getScript("https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js").then(a)};btf.addGlobalFn("themeChange",a,"chartjs"),btf.addGlobalFn("encrypt",a,"chartjs"),window.pjax?r():document.addEventListener("DOMContentLoaded",r)})()</script></div><div class="aplayer no-destroy" data-id="9061017364" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listfolded="false" data-order="random" data-lrctype="1" data-preload="none" data-autoplay="false" muted></div><div class="app-refresh" id="app-refresh"><div class="app-refresh-wrap"><label>网站已更新最新版本</label> <a href="javascript:void(0)" rel="external nofollow noreferrer" onclick="location.reload()">点击刷新</a></div></div><script>function showNotification(){if(GLOBAL_CONFIG.Snackbar){var t="light"===document.documentElement.getAttribute("data-theme")?GLOBAL_CONFIG.Snackbar.bgLight:GLOBAL_CONFIG.Snackbar.bgDark,e=GLOBAL_CONFIG.Snackbar.position;Snackbar.show({text:"已更新最新版本",backgroundColor:t,duration:5e5,pos:e,actionText:"点击刷新",actionTextColor:"#fff",onActionClick:function(t){location.reload()}})}else{var o=`top: 0; background: ${"light"===document.documentElement.getAttribute("data-theme")?"#49b1f5":"#1f1f1f"};`;document.getElementById("app-refresh").style.cssText=o}}"serviceWorker"in navigator&&(navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("controllerchange",(function(){showNotification()})),window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js")})))</script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="/js/diytitle.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!0,document.body.addEventListener("input",POWERMODE)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/metingjs/dist/Meting.min.js"></script><script>btf.addGlobalFn("pjaxSend",(()=>{if(window.aplayers)for(let a=0;a<window.aplayers.length;a++)window.aplayers[a].options.fixed||window.aplayers[a].destroy()}),"destroyAplayer"),btf.addGlobalFn("pjaxComplete",loadMeting,"runMetingJS")</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>(()=>{window.pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/talking/"]):not([href="/artitalk/"])',selectors:['link[rel="canonical"]','meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"],cacheBust:!1,analytics:!0,scrollRestoration:!1});const e=e=>{e&&Object.values(e).forEach((e=>e()))};document.addEventListener("pjax:send",(()=>{btf.removeGlobalFnEvent("pjaxSendOnce"),btf.removeGlobalFnEvent("themeChange");const t=document.body.classList;t.contains("read-mode")&&t.remove("read-mode"),e(window.globalFn.pjaxSend)})),document.addEventListener("pjax:complete",(()=>{btf.removeGlobalFnEvent("pjaxCompleteOnce"),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),a=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(a)),e.parentNode.replaceChild(t,e)})),e(window.globalFn.pjaxComplete)})),document.addEventListener("pjax:error",(e=>{404===e.request.status&&pjax.loadUrl("/404")}))})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@5.12.0/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.75.3/dist/instantsearch.production.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.2.2/source/js/search/algolia.min.js"></script></div></div><script data-pjax>if(document.getElementById("recent-posts")&&"/"==location.pathname){var parent=document.getElementById("recent-posts"),child='<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo25.jpg" alt="/img/nba-logo25.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2024-02-02</span><a class="blog-slider__title" href="posts/1bcb0ad4/">单环境,多分支并行开发方案(流量染色/istio)</a><div class="blog-slider__text">单环境,多分支并行开发方案(流量染色/istio)</div><a class="blog-slider__button" href="posts/1bcb0ad4/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo15.jpg" alt="/img/nba-logo15.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-04-06</span><a class="blog-slider__title" href="posts/2a9d73ff/">教你如何零成本从0到1，开发上线一个对接了openAI的机器人</a><div class="blog-slider__text">教你如何零成本从0到1，开发上线一个对接了openAI的机器人</div><a class="blog-slider__button" href="posts/2a9d73ff/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo3.jpg" alt="/img/nba-logo3.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-06-14</span><a class="blog-slider__title" href="posts/aa43cc95/">记录k8s环境下结合alinode的使用</a><div class="blog-slider__text">记录k8s环境下结合alinode的使用</div><a class="blog-slider__button" href="posts/aa43cc95/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo29.jpg" alt="/img/nba-logo29.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-12-13</span><a class="blog-slider__title" href="posts/15957791/">k8s环境下,nginx做websocket负载的方案梳理</a><div class="blog-slider__text">k8s环境下,nginx做websocket负载的方案梳理</div><a class="blog-slider__button" href="posts/15957791/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo12.jpg" alt="/img/nba-logo12.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-09-26</span><a class="blog-slider__title" href="posts/4ecfb081/">记录一次k8s网络DNS问题排查过程</a><div class="blog-slider__text">记录一次k8s网络DNS问题排查过程</div><a class="blog-slider__button" href="posts/4ecfb081/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo12.jpg" alt="/img/nba-logo12.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-09-26</span><a class="blog-slider__title" href="posts/37032a87/">k3s高可用安装</a><div class="blog-slider__text">k3s高可用安装</div><a class="blog-slider__button" href="posts/37032a87/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo17.jpg" alt="/img/nba-logo17.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-11-27</span><a class="blog-slider__title" href="posts/20b19ed4/">分词搜索需求整理</a><div class="blog-slider__text">分词搜索需求整理</div><a class="blog-slider__button" href="posts/20b19ed4/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo9.jpg" alt="/img/nba-logo9.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-12-02</span><a class="blog-slider__title" href="posts/6de14387/">整理wsl2配合开发的一些配置</a><div class="blog-slider__text">整理wsl2配合开发的一些配置</div><a class="blog-slider__button" href="posts/6de14387/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo30.jpg" alt="/img/nba-logo30.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-12-11</span><a class="blog-slider__title" href="posts/fb9adcb6/">记录windows11+wsl2环境搭配</a><div class="blog-slider__text">windows11+wsl2开发环境配置</div><a class="blog-slider__button" href="posts/fb9adcb6/">详情</a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';console.log("已挂载swiper"),parent.insertAdjacentHTML("afterbegin",child)}</script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper@0.18/swiper/swiperindex.js"></script><style></style><script data-pjax>function history_calendar_injector_config(){var i=document.getElementsByClassName("sticky_layout")[0];console.log("已挂载history_calendar"),i.insertAdjacentHTML("afterbegin",'<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>那年今日</span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>')}document.getElementsByClassName("sticky_layout")[0]&&"/"===location.pathname&&history_calendar_injector_config()</script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"right",width:150,height:300,hOffset:20,vOffset:-20},mobile:{show:!0},log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/"})</script></body></html>