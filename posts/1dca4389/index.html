<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>k8så¤§ç‰ˆæœ¬æ–°ç‰¹æ€§ä¸€è§ˆ(é•¿æœŸè®°å½•) | å°äº”çš„ä¸ªäººæ‚è´§é“º</title><meta name="author" content="å°äº”"><meta name="copyright" content="å°äº”"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Kubernetes v1.22Kubernetes v1.22 å·²ç»åœ¨ä»Šå¤©æ­£å¼å‘å¸ƒäº†ï¼Œè¿™æ˜¯ 2021 å¹´çš„ç¬¬äºŒä¸ªæ­£å¼å‘å¸ƒçš„ç‰ˆæœ¬ã€‚æ­¤ç‰ˆæœ¬ä¸­å…±åŒ…å« 53 é¡¹å¢å¼ºæ›´æ–°ï¼Œå…¶ä¸­ 13 é¡¹è¾¾åˆ° stableï¼Œ24 é¡¹è¾¾åˆ° beta è¿˜æœ‰ 16 é¡¹ä¸º alphaã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰ 3 é¡¹ç‰¹æ€§è¢«æ ‡è®°ä¸ºåºŸå¼ƒã€‚ ä»ä»Šå¹´çš„ 4 æœˆä»½ï¼ŒKubernetes çš„å‘å¸ƒèŠ‚å¥ç”±åŸæ¥çš„æ¯ 3 ä¸ªæœˆä¸€ä¸ªç‰ˆæœ¬ä¿®æ”¹æˆäº†æ¯ 4 ä¸ªæœˆä¸€ä¸ªç‰ˆæœ¬ï¼Œ"><meta property="og:type" content="article"><meta property="og:title" content="k8så¤§ç‰ˆæœ¬æ–°ç‰¹æ€§ä¸€è§ˆ(é•¿æœŸè®°å½•)"><meta property="og:url" content="https://xiaowu95.wang/posts/1dca4389/"><meta property="og:site_name" content="å°äº”çš„ä¸ªäººæ‚è´§é“º"><meta property="og:description" content="Kubernetes v1.22Kubernetes v1.22 å·²ç»åœ¨ä»Šå¤©æ­£å¼å‘å¸ƒäº†ï¼Œè¿™æ˜¯ 2021 å¹´çš„ç¬¬äºŒä¸ªæ­£å¼å‘å¸ƒçš„ç‰ˆæœ¬ã€‚æ­¤ç‰ˆæœ¬ä¸­å…±åŒ…å« 53 é¡¹å¢å¼ºæ›´æ–°ï¼Œå…¶ä¸­ 13 é¡¹è¾¾åˆ° stableï¼Œ24 é¡¹è¾¾åˆ° beta è¿˜æœ‰ 16 é¡¹ä¸º alphaã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰ 3 é¡¹ç‰¹æ€§è¢«æ ‡è®°ä¸ºåºŸå¼ƒã€‚ ä»ä»Šå¹´çš„ 4 æœˆä»½ï¼ŒKubernetes çš„å‘å¸ƒèŠ‚å¥ç”±åŸæ¥çš„æ¯ 3 ä¸ªæœˆä¸€ä¸ªç‰ˆæœ¬ä¿®æ”¹æˆäº†æ¯ 4 ä¸ªæœˆä¸€ä¸ªç‰ˆæœ¬ï¼Œ"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://xiaowu95.wang/img/nba-logo8.jpg"><meta property="article:published_time" content="2023-09-26T06:01:39.000Z"><meta property="article:modified_time" content="2023-12-11T09:21:34.000Z"><meta property="article:author" content="å°äº”"><meta property="article:tag" content="k8s"><meta property="article:tag" content="å®¹å™¨åŒ–"><meta property="article:tag" content="k3s"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://xiaowu95.wang/img/nba-logo8.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "k8så¤§ç‰ˆæœ¬æ–°ç‰¹æ€§ä¸€è§ˆ(é•¿æœŸè®°å½•)",
  "url": "https://xiaowu95.wang/posts/1dca4389/",
  "image": "https://xiaowu95.wang/img/nba-logo8.jpg",
  "datePublished": "2023-09-26T06:01:39.000Z",
  "dateModified": "2023-12-11T09:21:34.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "å°äº”",
      "url": "https://xiaowu95.wang"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://xiaowu95.wang/posts/1dca4389/"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="kHfLZxYQ7y3s3AR7gyJDdJkQvGNjQsvopp6N3gEEx0s"><meta name="baidu-site-verification" content="codeva-aVS4F6wAjS"><link rel="manifest" href="/wang-xiaowu/pwa/site.webmanifest"><meta name="msapplication-TileColor" content="#fff"><link rel="apple-touch-icon" sizes="180x180" href="/wang-xiaowu/pwa/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/wang-xiaowu/pwa/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/wang-xiaowu/pwa/favicon-16x16.png"><link rel="mask-icon" href="/wang-xiaowu/pwa/safari-pinned-tab.svg" color="#5bbad5"><link rel="stylesheet" href="/css/index.css?v=5.5.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.33/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise(((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach((([e,t])=>n.setAttribute(e,t))),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)})),getCSS:(e,t)=>new Promise(((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)})),addGlobalFn:(e,t,o=!1,a=window)=>{const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),c=window.matchMedia("(prefers-color-scheme: dark)"),r=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(r.matches)a();else if(c.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}c.addEventListener("change",(()=>{void 0===t.get("theme")&&(e.matches?o():a())}))}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?86cb34987e15c900c39e12ebdf08c50d";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),btf.addGlobalFn("pjaxComplete",(()=>{_hmt.push(["_trackPageview",window.location.pathname])}),"baidu_analytics")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-1MFQ47191J"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-1MFQ47191J"),btf.addGlobalFn("pjaxComplete",(()=>{gtag("config","G-1MFQ47191J",{page_path:window.location.pathname})}),"google_analytics")</script><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"M91QAWRVY4",apiKey:"ecc30a5e06136e1cc491685e39801190",indexName:"xiaowu-blog",hitsPerPage:6,languages:{hits_empty:"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}",hits_stats:"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œè€—æ—¶ ${time} æ¯«ç§’"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"ç¹",msgToSimplifiedChinese:"ç°¡"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:400,highlightFullpage:!0,highlightMacStyle:!0},copy:{success:"å¤åˆ¶æˆåŠŸ",error:"å¤åˆ¶å¤±è´¥",noSupport:"æµè§ˆå™¨ä¸æ”¯æŒ"},relativeDate:{homepage:!0,post:!0},runtime:"å¤©",dateSuffix:{just:"åˆšåˆš",min:"åˆ†é’Ÿå‰",hour:"å°æ—¶å‰",day:"å¤©å‰",month:"ä¸ªæœˆå‰"},copyright:{limitCount:150,languages:{author:"ä½œè€…: å°äº”",link:"é“¾æ¥: ",source:"æ¥æº: å°äº”çš„ä¸ªäººæ‚è´§é“º",info:"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"å·²åˆ‡æ¢ä¸ºç¹ä½“ä¸­æ–‡",cht_to_chs:"å·²åˆ‡æ¢ä¸ºç®€ä½“ä¸­æ–‡",day_to_night:"å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼",night_to_day:"å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"åŠ è½½æ›´å¤š"},isPhotoFigcaption:!1,islazyloadPlugin:!0,isAnchor:!0,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"k8så¤§ç‰ˆæœ¬æ–°ç‰¹æ€§ä¸€è§ˆ(é•¿æœŸè®°å½•)",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><script src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><link rel="stylesheet" href="/css/font.css"><style>.app-refresh{position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease}.app-refresh-wrap{display:flex;color:#fff;height:100%;align-items:center;justify-content:center}.app-refresh-wrap a{color:#fff;text-decoration:underline;cursor:pointer}</style><link rel="stylesheet" href="/css/titleStyle.css"><link rel="stylesheet" href="/css/mouse.css"><link rel="stylesheet" href="/css/custom.css"><style>.card-announcement .social-button{margin:.6rem 0 0 0;text-align:center}.card-announcement .social-button a{display:block;background-color:var(--btn-bg);color:var(--btn-color);text-align:center;line-height:2.4;margin:4px 0}.card-announcement .social-button a:hover{background-color:var(--btn-hover-color)}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiperstyle.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="alternate" href="/atom.xml" title="å°äº”çš„ä¸ªäººæ‚è´§é“º" type="application/atom+xml"></head><body><script>window.paceOptions={restartOnPushState:!1},btf.addGlobalFn("pjaxSend",(()=>{Pace.restart()}),"pace_restart")</script><link rel="stylesheet" href="/css/pace.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-lazy-src="/img/avatar.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">554</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">168</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">55</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/github/"><i class="fa-fw fa-solid fa-address-card"></i> <span>å…³äºæˆ‘</span></a></div><div class="menus_item"><a class="site-page" href="/ac/"><i class="fa-fw fa-solid fa-wind"></i> <span>ä¾¿æºå°ç©ºè°ƒ</span></a></div><div class="menus_item"><a class="site-page" href="/talking/"><i class="fa-fw fa-solid fa-walkie-talkie"></i> <span>åšå®¢çŸ­è®°</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i> <span>ç›®å½•</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-otter"></i> <span>æ‚è®°</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/songs/"><i class="fa-fw fas fa-music"></i> <span>éŸ³ä¹</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>å›¾åº“</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa-solid fa-film"></i> <span>å½±è§†|ç•ªå‰§</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book faa-fload"></i> <span>ä¹¦å•</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad faa-fload"></i> <span>æ¸¸æˆ</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-bilibili"></i> <span>BiliBiliè¿½ç•ª</span></a></li><li><a class="site-page child" href="/cinemas/"><i class="fa-fw fa-solid fa-video"></i> <span>BiliBiliè¿½å‰§</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i> <span>ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-user-group"></i> <span>å‹é“¾</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-mug-saucer"></i> <span>Website Memo</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://console.leancloud.app/apps"><span>ğŸš€ LeanCloud</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.com/dashboard"><span>ğŸš€ Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://tongji.baidu.com/main/overview/10000432799/overview/index"><span>ğŸš€ ç™¾åº¦ç»Ÿè®¡</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://ziyuan.baidu.com/dashboard/index"><span>ğŸš€ ç™¾åº¦ç«™ç‚¹ç®¡ç†</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://analytics.google.com/analytics/web/"><span>ğŸš€ è°·æ­Œåˆ†æ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://search.google.com/search-console?hl=zh-cn"><span>ğŸš€ è°·æ­Œç«™ç‚¹ç®¡ç†</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.google.com/adsense/new/u/0/pub-1375421173355613/home"><span>ğŸš€ è°·æ­Œå¹¿å‘Šè”ç›Ÿ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.algolia.com/"><span>ğŸš€ Algolia</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://sms-activate.org/cn/"><span>ğŸš€ Sms-activate</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chatgpt.com/"><span>ğŸš€ ChatGPT</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://gemini.google.com/"><span>ğŸš€ Gemini</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://poe.com/"><span>ğŸš€ Poeèšåˆ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.idc.net/clientarea"><span>ğŸš€ åæµªäº‘</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.west.cn/"><span>ğŸš€ è¥¿éƒ¨æ•°æ®</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://shandianpro.com/#/dashboard"><span>ğŸš€ é—ªç”µ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.huojian.homes/"><span>ğŸš€ å°ç«ç®­</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/winston779/gougou"><span>ğŸš€ ç‹—ç‹—åŠ é€Ÿ</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/nba-logo8.jpg)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">å°äº”çš„ä¸ªäººæ‚è´§é“º</span></a><a class="nav-page-title" href="/"><span class="site-name">k8så¤§ç‰ˆæœ¬æ–°ç‰¹æ€§ä¸€è§ˆ(é•¿æœŸè®°å½•)</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i> <span>è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/github/"><i class="fa-fw fa-solid fa-address-card"></i> <span>å…³äºæˆ‘</span></a></div><div class="menus_item"><a class="site-page" href="/ac/"><i class="fa-fw fa-solid fa-wind"></i> <span>ä¾¿æºå°ç©ºè°ƒ</span></a></div><div class="menus_item"><a class="site-page" href="/talking/"><i class="fa-fw fa-solid fa-walkie-talkie"></i> <span>åšå®¢çŸ­è®°</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i> <span>ç›®å½•</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-otter"></i> <span>æ‚è®°</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/songs/"><i class="fa-fw fas fa-music"></i> <span>éŸ³ä¹</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>å›¾åº“</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa-solid fa-film"></i> <span>å½±è§†|ç•ªå‰§</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book faa-fload"></i> <span>ä¹¦å•</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad faa-fload"></i> <span>æ¸¸æˆ</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-bilibili"></i> <span>BiliBiliè¿½ç•ª</span></a></li><li><a class="site-page child" href="/cinemas/"><i class="fa-fw fa-solid fa-video"></i> <span>BiliBiliè¿½å‰§</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i> <span>ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-user-group"></i> <span>å‹é“¾</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-mug-saucer"></i> <span>Website Memo</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://console.leancloud.app/apps"><span>ğŸš€ LeanCloud</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.com/dashboard"><span>ğŸš€ Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://tongji.baidu.com/main/overview/10000432799/overview/index"><span>ğŸš€ ç™¾åº¦ç»Ÿè®¡</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://ziyuan.baidu.com/dashboard/index"><span>ğŸš€ ç™¾åº¦ç«™ç‚¹ç®¡ç†</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://analytics.google.com/analytics/web/"><span>ğŸš€ è°·æ­Œåˆ†æ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://search.google.com/search-console?hl=zh-cn"><span>ğŸš€ è°·æ­Œç«™ç‚¹ç®¡ç†</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.google.com/adsense/new/u/0/pub-1375421173355613/home"><span>ğŸš€ è°·æ­Œå¹¿å‘Šè”ç›Ÿ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.algolia.com/"><span>ğŸš€ Algolia</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://sms-activate.org/cn/"><span>ğŸš€ Sms-activate</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chatgpt.com/"><span>ğŸš€ ChatGPT</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://gemini.google.com/"><span>ğŸš€ Gemini</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://poe.com/"><span>ğŸš€ Poeèšåˆ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.idc.net/clientarea"><span>ğŸš€ åæµªäº‘</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.west.cn/"><span>ğŸš€ è¥¿éƒ¨æ•°æ®</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://shandianpro.com/#/dashboard"><span>ğŸš€ é—ªç”µ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.huojian.homes/"><span>ğŸš€ å°ç«ç®­</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/winston779/gougou"><span>ğŸš€ ç‹—ç‹—åŠ é€Ÿ</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">k8så¤§ç‰ˆæœ¬æ–°ç‰¹æ€§ä¸€è§ˆ(é•¿æœŸè®°å½•)<a class="post-edit-link" href="https://github.com/wang-xiaowu/wang-xiaowu.github.io/issues/new?_posts/kubernetes/k8så¤§ç‰ˆæœ¬æ–°ç‰¹æ€§ä¸€è§ˆ(é•¿æœŸè®°å½•).md" rel="external nofollow noreferrer" title="ç¼–è¾‘" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2023-09-26T06:01:39.000Z" title="å‘è¡¨äº 2023-09-26 14:01:39">2023-09-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-12-11T09:21:34.000Z" title="æ›´æ–°äº 2023-12-11 17:21:34">2023-12-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/k8s/">k8s</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">19.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>72åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;è·ç¦»ä¸Šä¸€æ¬¡æ›´æ–°è¯¥æ–‡ç« å·²ç»è¿‡äº†&quot;,&quot;messageNext&quot;:&quot;å¤©ï¼Œæ–‡ç« æ‰€æè¿°çš„å…§å®¹å¯èƒ½å·²ç»å‘ç”Ÿå˜åŒ–ï¼Œè¯·ç•™æ„ã€‚&quot;,&quot;postUpdate&quot;:&quot;2023-12-11 17:21:34&quot;}" hidden></div><h1 id="Kubernetes-v1-22"><a href="#Kubernetes-v1-22" class="headerlink" title="Kubernetes v1.22"></a>Kubernetes v1.22</h1><p>Kubernetes v1.22 å·²ç»åœ¨ä»Šå¤©æ­£å¼å‘å¸ƒäº†ï¼Œè¿™æ˜¯ 2021 å¹´çš„ç¬¬äºŒä¸ªæ­£å¼å‘å¸ƒçš„ç‰ˆæœ¬ã€‚æ­¤ç‰ˆæœ¬ä¸­å…±åŒ…å« 53 é¡¹å¢å¼ºæ›´æ–°ï¼Œå…¶ä¸­ 13 é¡¹è¾¾åˆ° stableï¼Œ24 é¡¹è¾¾åˆ° beta è¿˜æœ‰ 16 é¡¹ä¸º alphaã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰ 3 é¡¹ç‰¹æ€§è¢«æ ‡è®°ä¸ºåºŸå¼ƒã€‚</p><p>ä»ä»Šå¹´çš„ 4 æœˆä»½ï¼ŒKubernetes çš„å‘å¸ƒèŠ‚å¥ç”±åŸæ¥çš„æ¯ 3 ä¸ªæœˆä¸€ä¸ªç‰ˆæœ¬ä¿®æ”¹æˆäº†æ¯ 4 ä¸ªæœˆä¸€ä¸ªç‰ˆæœ¬ï¼Œè¿™ä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªåº”ç”¨äº†æ­¤èŠ‚å¥çš„é•¿å‘¨æœŸç‰ˆæœ¬ã€‚</p><h2 id="Server-side-Apply-ç‰¹æ€§è¾¾åˆ°-GA"><a href="#Server-side-Apply-ç‰¹æ€§è¾¾åˆ°-GA" class="headerlink" title="Server-side Apply ç‰¹æ€§è¾¾åˆ° GA"></a>Server-side Apply ç‰¹æ€§è¾¾åˆ° GA</h2><p>Server-side Apply è¿™ä¸ªç‰¹æ€§ä¸»è¦ç›®æ ‡æ˜¯æŠŠé€»è¾‘ä» <code>kubectl apply</code> ç§»åŠ¨åˆ° kube-apiserver ä¸­ï¼Œè¿™å¯ä»¥ä¿®å¤å½“å‰é‡åˆ°çš„å¾ˆå¤šæœ‰å…³æ‰€æœ‰æƒå†²çªçš„é—®é¢˜ã€‚</p><p>Server-side Apply å½“å‰æ˜¯é€šè¿‡ <code>Kubernetes</code> æ–°å¢çš„ <code>.meta.managedFields</code> å±æ€§æ¥è·Ÿè¸ªå¯¹è±¡å­—æ®µçš„æ›´æ”¹çš„ã€‚</p><p>åŒæ—¶æ­¤ç‰¹æ€§çš„å¥½å¤„åœ¨äºä½ å¯ä»¥ç›´æ¥é€šè¿‡ API å®Œæˆå£°æ˜å¼é…ç½®çš„æ“ä½œï¼Œè€Œæ— éœ€ä¾èµ–äºç‰¹å®šçš„ <code>kubectl apply</code> å‘½ä»¤ï¼Œæ¯”å¦‚ç›´æ¥é€šè¿‡ <code>curl</code> å³å¯å®Œæˆã€‚</p><p>æ­¤åŠŸèƒ½çš„ç”¨æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply --server-side [--dry-run=server]</span><br></pre></td></tr></table></figure><h2 id="Pod-Security-Policy-çš„æ›¿ä»£å“"><a href="#Pod-Security-Policy-çš„æ›¿ä»£å“" class="headerlink" title="Pod Security Policy çš„æ›¿ä»£å“"></a>Pod Security Policy çš„æ›¿ä»£å“</h2><p>PodSecurity admission controller æ˜¯åœ¨ Kubernets v1.21 ä¸­è¢«åºŸå¼ƒçš„ Pod Security Policies çš„æ›¿ä»£å“ã€‚</p><p>è¿™ä¸ª admission controller å¯ä»¥æŒ‰ namespace çº§åˆ«å¯ç”¨ Pod Security Standards ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹ä¸‰ç§æ¨¡å¼ï¼š</p><ul><li><strong>enforce</strong>: è¿åç­–ç•¥çš„ Pod å°†è¢«æ‹’ç»ï¼›</li><li><strong>audit</strong>ï¼šè¿åç­–ç•¥çš„ Pod å°†ä¼šæ·»åŠ å®¡è®¡æ³¨é‡Šï¼Œä½†å…¶ä»–æƒ…å†µä¸‹éƒ½å…è®¸ï¼›</li><li><strong>warn</strong>ï¼šè¿åç­–ç•¥çš„ Pod å°†ä¼šè§¦å‘é¢å‘ç”¨æˆ·çš„è­¦å‘Šï¼›</li></ul><p>å¯é€šè¿‡å¦‚ä¸‹é…ç½®æ–‡ä»¶è¿›è¡Œæ§åˆ¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiserver.config.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">AdmissionConfiguration</span></span><br><span class="line"><span class="attr">plugins:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">PodSecurity</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">defaults:</span>  <span class="comment"># Defaults applied when a mode label is not set.</span></span><br><span class="line">      <span class="attr">enforce:</span>         <span class="string">&lt;default</span> <span class="string">enforce</span> <span class="string">policy</span> <span class="string">level&gt;</span></span><br><span class="line">      <span class="attr">enforce-version:</span> <span class="string">&lt;default</span> <span class="string">enforce</span> <span class="string">policy</span> <span class="string">version&gt;</span></span><br><span class="line">      <span class="attr">audit:</span>         <span class="string">&lt;default</span> <span class="string">audit</span> <span class="string">policy</span> <span class="string">level&gt;</span></span><br><span class="line">      <span class="attr">audit-version:</span> <span class="string">&lt;default</span> <span class="string">audit</span> <span class="string">policy</span> <span class="string">version&gt;</span></span><br><span class="line">      <span class="attr">warn:</span>          <span class="string">&lt;default</span> <span class="string">warn</span> <span class="string">policy</span> <span class="string">level&gt;</span></span><br><span class="line">      <span class="attr">warn-version:</span>  <span class="string">&lt;default</span> <span class="string">warn</span> <span class="string">policy</span> <span class="string">version&gt;</span></span><br><span class="line">    <span class="attr">exemptions:</span></span><br><span class="line">      <span class="attr">usernames:</span>         [ <span class="string">&lt;array</span> <span class="string">of</span> <span class="string">authenticated</span> <span class="string">usernames</span> <span class="string">to</span> <span class="string">exempt&gt;</span> ]</span><br><span class="line">      <span class="attr">runtimeClassNames:</span> [ <span class="string">&lt;array</span> <span class="string">of</span> <span class="string">runtime</span> <span class="string">class</span> <span class="string">names</span> <span class="string">to</span> <span class="string">exempt&gt;</span> ]</span><br><span class="line">      <span class="attr">namespaces:</span>        [ <span class="string">&lt;array</span> <span class="string">of</span> <span class="string">namespaces</span> <span class="string">to</span> <span class="string">exempt&gt;</span> ]</span><br></pre></td></tr></table></figure><h2 id="Node-swap-æ”¯æŒ"><a href="#Node-swap-æ”¯æŒ" class="headerlink" title="Node swap æ”¯æŒ"></a>Node swap æ”¯æŒ</h2><p>æ­¤ç‰¹æ€§ç°åœ¨æ˜¯ Alpha é˜¶æ®µã€‚</p><p>è™½ç„¶ swap å¹¶ä¸å¤Ÿå¿«ï¼Œä½†æ˜¯ç°åœ¨æœ‰å¾ˆå¤šåœºæ™¯éƒ½æ˜¯éœ€è¦ç”¨åˆ°å®ƒçš„ï¼Œå°¤å…¶æ˜¯ä¸€äº› Java å’Œ Node åº”ç”¨ã€‚</p><p>åœ¨ Kubernetes çš„ issue åˆ—è¡¨ä¸­æœ‰ä¸€ä¸ªå­˜åœ¨äº† 5 å¹´å·¦å³çš„è®¨è®ºï¼Œå°±æ˜¯é’ˆå¯¹äºèƒ½å¦å¼€å¯ swap æ”¯æŒçš„ã€‚å½“å‰è¿™ä¸ªç‰¹æ€§ä¸€æ—¦å¼€å¯å°±æ˜¯é’ˆå¯¹äºæ•´ä¸ª Node çš„ï¼Œå¹¶ä¸èƒ½ç²¾ç¡®åˆ°æŸä¸ª Pod ä¸­ã€‚</p><p>ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ­¥éª¤å¯ç”¨æ­¤ç‰¹æ€§ï¼š</p><ul><li>åœ¨ Node ä¸­å¯ç”¨ swapï¼›</li><li>å¼€å¯ kubelet çš„ <code>NodeMemorySwap</code> ç‰¹æ€§ï¼›</li><li>è®¾ç½® <code>--fail-on-swap=false</code></li><li>å¯é€‰åœ¨ Kubelet çš„é…ç½®ä¸­å¢åŠ  <code>MemorySwap.SwapBehavior=UnlimitedSwap</code></li></ul><p>æ›´å¤šå†…å®¹å¯å‚è€ƒï¼š<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/kubernetes/enhancements/tree/master/keps/sig-node/2400-node-swap">https://github.com/kubernetes/enhancements/tree/master/keps/sig-node/2400-node-swap</a></p><h2 id="å¤–éƒ¨å®¢æˆ·ç«¯å‡­è¯æä¾›å·¥å…·"><a href="#å¤–éƒ¨å®¢æˆ·ç«¯å‡­è¯æä¾›å·¥å…·" class="headerlink" title="å¤–éƒ¨å®¢æˆ·ç«¯å‡­è¯æä¾›å·¥å…·"></a>å¤–éƒ¨å®¢æˆ·ç«¯å‡­è¯æä¾›å·¥å…·</h2><p>è¿™ä¸ªåŠŸèƒ½å…è®¸ client-go ä½¿ç”¨å¤–éƒ¨å·¥å…·è¿›è¡Œèº«ä»½éªŒè¯ï¼Œæ¯”å¦‚ LDAPã€Kerberosã€OAuth2ã€SAML ç­‰ã€‚è¿™ä¸ªç‰¹æ€§æ˜¯ä» v1.10 å¼€å§‹å¼•å…¥çš„ã€‚</p><p>ä½¿ç”¨æ­¤ç‰¹æ€§çš„è¯ï¼Œéœ€è¦ä½ åœ¨ kubeconfig é…ç½®æ–‡ä»¶ä¸­ä½œä¸º user å­—æ®µä¸‹çš„å­—æ®µè¿›è¡Œé…ç½®ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Config</span></span><br><span class="line"><span class="attr">users:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">my-user</span></span><br><span class="line">  <span class="attr">user:</span></span><br><span class="line">    <span class="attr">exec:</span></span><br><span class="line">      <span class="attr">command:</span> <span class="string">&quot;example-client-go-exec-plugin&quot;</span></span><br><span class="line">      <span class="attr">apiVersion:</span> <span class="string">&quot;client.authentication.k8s.io/v1beta1&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">env:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;FOO&quot;</span></span><br><span class="line">        <span class="attr">value:</span> <span class="string">&quot;bar&quot;</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">args:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;arg1&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;arg2&quot;</span></span><br><span class="line">      </span><br><span class="line">      <span class="attr">provideClusterInfo:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">clusters:</span></span><br><span class="line"><span class="string">...</span></span><br></pre></td></tr></table></figure><p>åœ¨ <code>user.exec</code>å­—æ®µä¸‹é…ç½®å¯ç”¨çš„ client-go-exec plugin å³å¯ã€‚ç°åœ¨ä¹Ÿæœ‰ä¸€ä¸ªç¤ºä¾‹é¡¹ç›®å¯ä¾›å‚è€ƒ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/ankeesler/sample-exec-plugin">https://github.com/ankeesler/sample-exec-plugin</a></p><h2 id="å¯ç´¢å¼•çš„-Job-API"><a href="#å¯ç´¢å¼•çš„-Job-API" class="headerlink" title="å¯ç´¢å¼•çš„ Job API"></a>å¯ç´¢å¼•çš„ Job API</h2><p>åœ¨ Kubernetes v1.21 ä¸­æ–°å¢çš„å¯ç´¢å¼• Job API å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„è°ƒåº¦å¹¶è¡ŒåŒ–çš„ Jobã€‚ç°åœ¨å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„æ–¹å¼é€šè¿‡ç¯å¢ƒå˜é‡è®© Job ä¸­çš„ Pod çŸ¥é“è‡ªå·±çš„ç´¢å¼•ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">...</span>]</span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">subdomain:</span> <span class="string">my-job-svc</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">task</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">registry.example.com/processing-image</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;./process&quot;</span>,  <span class="string">&quot;--index&quot;</span>, <span class="string">&quot;$JOB_COMPLETION_INDEX&quot;</span>, <span class="string">&quot;--hosts-pattern&quot;</span>, <span class="string">&quot;my-job-<span class="template-variable">&#123;&#123;.id&#125;&#125;</span>.my-job-svc&quot;</span>]</span><br></pre></td></tr></table></figure><h2 id="ä¸º-Job-API-å¢åŠ -suspend-å­—æ®µ"><a href="#ä¸º-Job-API-å¢åŠ -suspend-å­—æ®µ" class="headerlink" title="ä¸º Job API å¢åŠ  suspend å­—æ®µ"></a>ä¸º Job API å¢åŠ  suspend å­—æ®µ</h2><p>è‡ª v1.21 èµ·ï¼ŒJob å¯ä»¥é€šè¿‡è®¾ç½® <code>.spec.suspend=true</code> å­—æ®µæ¥ä¸´æ—¶çš„æŒ‚èµ·ã€‚å¯ä»¥æ¯”è¾ƒæ–¹ä¾¿çš„å»è¿›è¡Œæ§åˆ¶ï¼Œç±»ä¼¼ Argo workflow ä¸­ï¼Œä¹Ÿå¯ä»¥å¯¹æŸä¸ª workflow è¿›è¡ŒæŒ‚èµ·æ“ä½œã€‚</p><h2 id="CSR-çš„æœ‰æ•ˆæœŸ"><a href="#CSR-çš„æœ‰æ•ˆæœŸ" class="headerlink" title="CSR çš„æœ‰æ•ˆæœŸ"></a>CSR çš„æœ‰æ•ˆæœŸ</h2><p>é€šè¿‡åœ¨ <code>CertificateSigningRequestSpec</code> ä¸­å¢åŠ çš„ <code>ExpirationSeconds</code> å¯ä»¥æ¥å—çš„æœ€å°å€¼æ˜¯ 600ï¼ˆ10åˆ†é’Ÿï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆå¥½çš„æ§åˆ¶å…¶æœ‰æ•ˆæœŸäº†ã€‚ç°åœ¨é»˜è®¤çš„æ˜¯ 1 å¹´ã€‚</p><h2 id="å†…å­˜èµ„æºçš„-QoS"><a href="#å†…å­˜èµ„æºçš„-QoS" class="headerlink" title="å†…å­˜èµ„æºçš„ QoS"></a>å†…å­˜èµ„æºçš„ QoS</h2><p>ä¹‹å‰ Kubernetes åœ¨ä½¿ç”¨ cgroups v1 ï¼Œå¯¹äº Pod çš„ QoS å…¶å®åªé€‚ç”¨äº CPU èµ„æºã€‚Kubernetes v1.22 ä¸­é€šè¿‡å¼•å…¥ cgroups v2 æ¥æä¾›äº†ä¸€ä¸ª alpha ç‰¹æ€§ï¼Œå…è®¸å¯¹å†…å­˜èµ„æºä¹Ÿæä¾› QoSã€‚ï¼ˆå¦‚æœæ²¡è®°é”™ï¼Œè²Œä¼¼æ˜¯è…¾è®¯äº‘å›¢é˜Ÿæäº¤çš„ KEP å§ï¼‰</p><p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡KIND ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥å¿«é€Ÿçš„ä½“éªŒ Kubernetes v1.22 ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kind create cluster --image=kindest/node:v1.22.0@sha256:b8bda84bb3a190e6e028b1760d277454a72267a5454b57db34437c34a588d047</span><br></pre></td></tr></table></figure><h1 id="Kubernetes-v1-23"><a href="#Kubernetes-v1-23" class="headerlink" title="Kubernetes v1.23"></a>Kubernetes v1.23</h1><p>Kubernetes v1.23 ä»Šå¤©æ­£å¼å‘å¸ƒï¼Œè¿™æ˜¯ 2021 å¹´å‘å¸ƒçš„ç¬¬ä¸‰ä¸ªç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯ 2021 å¹´æœ€åä¸€ä¸ªæ­£å¼å‘å¸ƒçš„ç‰ˆæœ¬ã€‚</p><p>æ­¤ç‰ˆæœ¬ä¸­ä¸»è¦åŒ…æ‹¬ 47 é¡¹å¢å¼ºæ›´æ–°ï¼Œå…¶ä¸­ 11 é¡¹è¾¾åˆ° stable, 17 é¡¹è¾¾åˆ° beta è¿˜æœ‰ 19 é¡¹è¾¾åˆ° alpha ã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰ 1 é¡¹è¢«æ ‡è®°ä¸ºåºŸå¼ƒã€‚ç›¸æ¯”äº v1.22 ä»æ•°é‡ä¸Šæ¥è¯´æ˜¯å°‘äº†ä¸€ç‚¹ï¼ˆv1.22 æœ‰ 53 é¡¹å¢å¼ºæ›´æ–°ï¼‰ï¼Œä½†è¿™å¹¶ä¸å½±å“è¿™æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„ç‰ˆæœ¬ï¼</p><p>åœ¨ Kubernetes çš„å‘å¸ƒå‘¨æœŸå˜æ›´ä¸º <strong>æ¯4ä¸ªæœˆä¸€ä¸ªç‰ˆæœ¬</strong> åï¼Œå¾ˆæ˜æ˜¾çš„æ„Ÿè§‰å°±æ˜¯ä¸ç”¨åœ¨å‡çº§ä¸Šé¢èŠ±è´¹å¤ªå¤šæ—¶é—´äº†ï¼Œæ¯•ç«Ÿ Kubernetes çš„å‡çº§æ“ä½œæ˜¯ä¸ªä½“åŠ›æ´»ã€‚</p><h2 id="æ–°å¢-kubectl-alpha-events-å‘½ä»¤"><a href="#æ–°å¢-kubectl-alpha-events-å‘½ä»¤" class="headerlink" title="æ–°å¢ kubectl alpha events å‘½ä»¤"></a>æ–°å¢ kubectl alpha events å‘½ä»¤</h2><p>åœ¨<a target="_blank" rel="noopener external nofollow noreferrer" href="http://mp.weixin.qq.com/s?__biz=MzI2ODAwMzUwNA==&mid=2649296608&idx=1&sn=f56f3a3ee090a37b98c0767de3bd14bf&chksm=f2eb9f3fc59c16292d26ace955fa910270afa8c45a67313f54f77ae285a03e049e70aa23d1c2&scene=21#wechat_redirect">ã€ŠK8S ç”Ÿæ€å‘¨æŠ¥| Helm æ–°ç‰ˆæœ¬å‘å¸ƒå¢å¼ºå¯¹ OCI çš„æ”¯æŒã€‹</a> æ–‡ç« çš„ä¸Šæ¸¸è¿›å±•ä¸­æ›¾ä»‹ç»äº†è¯¥åŠŸèƒ½ã€‚å®ƒæ˜¯æŒ‰ç…§ KEP #1440 å®æ–½çš„ã€‚</p><blockquote><p>â€œ</p><p>å¢åŠ æ­¤å‘½ä»¤ä¸»è¦æ˜¯ç”±äºåœ¨ä¸ä¿®æ”¹ <code>kubectl get</code> çš„å‰æä¸‹ï¼ŒæŸ¥çœ‹ <code>event</code> æœ‰ä¸€äº›é™åˆ¶ï¼Œæ‰€ä»¥ç›´æ¥å¢åŠ  <code>kubectl events</code> å‘½ä»¤å¯ä»¥æ›´æ–¹ä¾¿çš„å»è·å–åˆ°éœ€è¦çš„ä¿¡æ¯ï¼Œå°¤å…¶æ˜¯ event æ˜¯åœ¨ Kubernetes ä¸­ç»å¸¸éœ€è¦æŸ¥çœ‹çš„ä¸€ä¸ªä¿¡æ¯ã€‚<code>kubectl get events</code> æ¯”è¾ƒå…¸å‹çš„ä¸€äº›é—®é¢˜, æ¯”å¦‚æ’åºï¼ˆè™½ç„¶å¯ä»¥é€šè¿‡åŠ å‚æ•°è§£å†³ï¼‰ï¼Œ watchï¼Œä»¥åŠæ— æ³•æŒ‰ç…§æ—¶é—´çº¿æ–¹å¼å»æŸ¥çœ‹ events ç­‰ã€‚</p><p>â€</p></blockquote><p>æ¥çœ‹çœ‹è¿™ä¸ªå‘½ä»¤å…·ä½“å¦‚ä½•ä½¿ç”¨ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥åˆ›å»ºä¸¤ä¸ª Podï¼Œåˆ†åˆ«å« <code>redis</code> å’Œ <code>redis2</code> ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(MoeLove) âœ kubectl run redis --image=<span class="string">&quot;ghcr.io/tao12345666333/redis:alpine&quot;</span> </span><br><span class="line">pod/redis created</span><br><span class="line">(MoeLove) âœ kubectl run redis2 --image=<span class="string">&quot;ghcr.io/tao12345666333/redis:alpine&quot;</span></span><br><span class="line">pod/redis2 created</span><br><span class="line">(MoeLove) âœ kubectl  get pods</span><br><span class="line">NAME     READY   STATUS    RESTARTS   AGE</span><br><span class="line">redis    1/1     Running   0          12m</span><br><span class="line">redis2   1/1     Running   0          2m23s</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ <code>kubectl alpha events</code> å¯ä»¥çœ‹åˆ°å½“å‰ namespace ä¸‹çš„æ‰€æœ‰ events ã€‚å¦‚æœå¢åŠ  <code>--for</code> æ¡ä»¶å¯ä»¥ç”¨æ¥ç­›é€‰åªå±•ç¤ºç‰¹å®šèµ„æºç›¸å…³çš„ events ã€‚åŒæ—¶ <strong>é»˜è®¤æƒ…å†µä¸‹å°±æ˜¯æŒ‰æ—¶é—´æ’åºçš„</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(MoeLove) âœ kubectl  alpha events</span><br><span class="line">LAST SEEN   TYPE     REASON      OBJECT       MESSAGE</span><br><span class="line">12m         Normal   Scheduled   Pod/redis    Successfully assigned default/redis to kind-control-plane</span><br><span class="line">12m         Normal   Pulling     Pod/redis    Pulling image <span class="string">&quot;ghcr.io/tao12345666333/redis:alpine&quot;</span></span><br><span class="line">12m         Normal   Pulled      Pod/redis    Successfully pulled image <span class="string">&quot;ghcr.io/tao12345666333/redis:alpine&quot;</span> <span class="keyword">in</span> 4.028873745s</span><br><span class="line">12m         Normal   Created     Pod/redis    Created container redis</span><br><span class="line">12m         Normal   Started     Pod/redis    Started container redis</span><br><span class="line">3m5s        Normal   Scheduled   Pod/redis2   Successfully assigned default/redis2 to kind-control-plane</span><br><span class="line">3m5s        Normal   Pulled      Pod/redis2   Container image <span class="string">&quot;ghcr.io/tao12345666333/redis:alpine&quot;</span> already present on machine</span><br><span class="line">3m4s        Normal   Created     Pod/redis2   Created container redis2</span><br><span class="line">3m4s        Normal   Started     Pod/redis2   Started container redis2</span><br><span class="line">(MoeLove) âœ kubectl  alpha events --<span class="keyword">for</span> pod/redis2</span><br><span class="line">LAST SEEN   TYPE     REASON      OBJECT       MESSAGE</span><br><span class="line">3m23s       Normal   Scheduled   Pod/redis2   Successfully assigned default/redis2 to kind-control-plane</span><br><span class="line">3m23s       Normal   Pulled      Pod/redis2   Container image <span class="string">&quot;ghcr.io/tao12345666333/redis:alpine&quot;</span> already present on machine</span><br><span class="line">3m22s       Normal   Created     Pod/redis2   Created container redis2</span><br><span class="line">3m22s       Normal   Started     Pod/redis2   Started container redis2</span><br></pre></td></tr></table></figure><h2 id="IPv4-IPv6-åŒæ ˆæ”¯æŒè¾¾åˆ°-GA"><a href="#IPv4-IPv6-åŒæ ˆæ”¯æŒè¾¾åˆ°-GA" class="headerlink" title="IPv4&#x2F;IPv6 åŒæ ˆæ”¯æŒè¾¾åˆ° GA"></a>IPv4&#x2F;IPv6 åŒæ ˆæ”¯æŒè¾¾åˆ° GA</h2><p>åœ¨é…ç½®åŒæ ˆç½‘ç»œçš„ Kubernetes æ—¶ï¼Œéœ€è¦åŒæ—¶æŒ‡å®š <code>--node-cidr-mask-size-ipv4</code> å’Œ <code>--node-cidr-mask-size-ipv6</code> ä»¥ä¾¿äºè®¾ç½®æ¯ä¸ª Node ä¸Šçš„å­ç½‘å¤§å°ã€‚åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬éƒ½æ˜¯ç›´æ¥ä½¿ç”¨ <code>--node-cidr-mask-size</code> è¿›è¡Œè®¾ç½®å³å¯ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä»ç„¶ä½¿ç”¨å•æ ˆ Kubernetes é›†ç¾¤çš„è¯ï¼Œæ­£å¸¸æ¥è¯´ä¸éœ€è¦åšä»€ä¹ˆè°ƒæ•´ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šé¢æåˆ°çš„é€‰é¡¹ï¼Œæ¥å•ç‹¬è®¾ç½®é›†ç¾¤çš„ IPv4&#x2F;IPv6 å­ç½‘ã€‚</p><h2 id="PodSecurity-Admission-è¾¾åˆ°-Beta"><a href="#PodSecurity-Admission-è¾¾åˆ°-Beta" class="headerlink" title="PodSecurity Admission è¾¾åˆ° Beta"></a>PodSecurity Admission è¾¾åˆ° Beta</h2><p>PodSecurity Admission æ˜¯ä¹‹å‰çš„ PSP çš„ä»£æ›¿ï¼Œå…³äº Kubernetes Admission å¯ä»¥å‚è€ƒæ–‡ç«  <a target="_blank" rel="noopener external nofollow noreferrer" href="http://mp.weixin.qq.com/s?__biz=MzI2ODAwMzUwNA==&mid=2649296994&idx=2&sn=60686fcebaacff30b9762a6229e85d12&chksm=f2eb81bdc59c08ab0f10013ed2bda48a7f3f5f3e0d335b7f1cdbbbce6e5b81656b487e9955d8&scene=21#wechat_redirect">ã€Šç†æ¸… Kubernetes ä¸­ Admission æœºåˆ¶ã€‹</a>ã€‚</p><h2 id="IngressClass-æ”¯æŒ-namespace-çº§åˆ«çš„å‚æ•°"><a href="#IngressClass-æ”¯æŒ-namespace-çº§åˆ«çš„å‚æ•°" class="headerlink" title="IngressClass æ”¯æŒ namespace çº§åˆ«çš„å‚æ•°"></a>IngressClass æ”¯æŒ namespace çº§åˆ«çš„å‚æ•°</h2><p><code>IngressClass.Spec.Parameters.Namespace</code> å­—æ®µå½“å‰è¾¾åˆ° GA ï¼Œè¿™æ ·å°±å¯ä»¥ä¸º IngressClass è®¾ç½®å‚æ•°ä¸º namespace çº§åˆ«äº†ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"> <span class="attr">kind:</span> <span class="string">IngressClass</span></span><br><span class="line"> <span class="attr">metadata:</span></span><br><span class="line">   <span class="attr">name:</span> <span class="string">external-lb</span></span><br><span class="line"> <span class="attr">spec:</span></span><br><span class="line">   <span class="attr">controller:</span> <span class="string">example.com/ingress-controller</span></span><br><span class="line">   <span class="attr">parameters:</span></span><br><span class="line">     <span class="attr">apiGroup:</span> <span class="string">k8s.example.com</span></span><br><span class="line">     <span class="attr">kind:</span> <span class="string">IngressParameters</span></span><br><span class="line">     <span class="attr">name:</span> <span class="string">external-lb</span></span><br><span class="line">     <span class="attr">namespace:</span> <span class="string">external-configuration</span></span><br><span class="line">     <span class="attr">scope:</span> <span class="string">Namespace</span></span><br></pre></td></tr></table></figure><h2 id="Probe-ä¸­å¢åŠ -gRPC-åè®®çš„æ”¯æŒ"><a href="#Probe-ä¸­å¢åŠ -gRPC-åè®®çš„æ”¯æŒ" class="headerlink" title="Probe ä¸­å¢åŠ  gRPC åè®®çš„æ”¯æŒ"></a>Probe ä¸­å¢åŠ  gRPC åè®®çš„æ”¯æŒ</h2><p>é€šè¿‡ KEP #2727 ï¼Œåœ¨æ­¤ç‰ˆæœ¬ä¸­ä¸º Pod.Spec.Container.{Liveness,Readiness,Startup} çš„ Probe æ·»åŠ äº† gRPC åè®®çš„æ”¯æŒã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">readinessProbe:</span></span><br><span class="line">  <span class="attr">grpc:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">9090</span></span><br><span class="line">    <span class="attr">service:</span> <span class="string">moelove-service</span></span><br><span class="line">  <span class="attr">initialDelaySeconds:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><p>å¯é€šè¿‡ <code>GRPCContainerProbe</code> feature gate å¼€å¯æ­¤ç‰¹æ€§ã€‚å…·ä½“ç»†èŠ‚å¯å‚è€ƒ <code>#106463</code></p><h2 id="æ–°å¢-OpenAPI-V3"><a href="#æ–°å¢-OpenAPI-V3" class="headerlink" title="æ–°å¢ OpenAPI V3"></a>æ–°å¢ OpenAPI V3</h2><p>è¿™ä¸ªç‰¹æ€§æ˜¯ Alpha çº§åˆ«ï¼Œå¯é€šè¿‡ <code>OpenApiv3</code> feature gate è¿›è¡Œå¼€å¯ã€‚</p><p>å¢åŠ æ­¤ç‰¹æ€§ä¸»è¦æ˜¯ç”±äº CRD ç›®å‰å¯é€šè¿‡ OpenApi V3 è¿›è¡Œå®šä¹‰ï¼Œä½†æ˜¯ api-server ç›®å‰è¿˜ä¸æ”¯æŒã€‚å½“ä» OpenApi V3 è½¬æ¢ä¸º V2 æ—¶ï¼Œéƒ¨åˆ†ä¿¡æ¯å°†ä¼šä¸¢å¤±ã€‚</p><p>æ›´å¤šè¯¦ç»†ä¿¡æ¯å¯å‚è€ƒ KEP <code>#2896</code></p><h2 id="CRD-Validation-è¡¨è¾¾å¼è¯­è¨€"><a href="#CRD-Validation-è¡¨è¾¾å¼è¯­è¨€" class="headerlink" title="CRD Validation è¡¨è¾¾å¼è¯­è¨€"></a>CRD Validation è¡¨è¾¾å¼è¯­è¨€</h2><p>è¿™æ˜¯ä¸€é¡¹ Alpha çº§åˆ«çš„ç‰¹æ€§ï¼Œé»˜è®¤æ˜¯ä¸å¼€å¯çš„ã€‚å¯é€šè¿‡å¢åŠ  <code>CustomResourceValidationExpressions</code> feature gate æ¥è¿›è¡Œå¼€å¯ã€‚å•ç‹¬ä»‹ç»æ­¤ Alpha çº§åˆ«çš„ç‰¹æ€§æ˜¯å› ä¸ºç›®å‰åŸºäº Custom Resource Definitions (CRDs) çš„æ–¹å¼å¯¹ Kubernetes è¿›è¡Œæ‰©å±•å·²ç»æˆä¸ºä¸»æµï¼Œä½†æ˜¯åœ¨ CRD ä¸­ç›®å‰èƒ½æ·»åŠ çš„æ ¡éªŒè§„åˆ™æœ‰é™ï¼Œæ›´å¤šçš„åœºæ™¯éƒ½éœ€è¦é€šè¿‡é¢å¤–çš„ Admission æ¥å®Œæˆã€‚</p><p>æ­¤åŠŸèƒ½ä½¿ç”¨ä¸€ç§å«åš Common Expression Language (CEL) çš„è¯­è¨€è¿›è¡Œè§„åˆ™å®šä¹‰ï¼Œé€šè¿‡ <code>x-kubernetes-validation-rules</code> å­—æ®µè¿›è¡Œè§„åˆ™çš„æ·»åŠ ã€‚</p><p>ä¾‹å¦‚ï¼ŒæŸä¸ª CRDs çš„å†…å®¹å¦‚ä¸‹ï¼Œå…¶ä¸­å®šä¹‰äº† <code>minReplicas</code> å°äº <code>replicas</code> å¹¶ä¸” <code>replicas</code> å°äº <code>maxReplicas</code> ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"><span class="attr">openAPIV3Schema:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">  <span class="attr">properties:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">      <span class="attr">x-kubernetes-validation-rules:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">rule:</span> <span class="string">&quot;self.minReplicas &lt;= self.replicas&quot;</span></span><br><span class="line">          <span class="attr">message:</span> <span class="string">&quot;replicas should be greater than or equal to minReplicas.&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">rule:</span> <span class="string">&quot;self.replicas &lt;= self.maxReplicas&quot;</span></span><br><span class="line">          <span class="attr">message:</span> <span class="string">&quot;replicas should be smaller than or equal to maxReplicas.&quot;</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="string">...</span></span><br><span class="line">        <span class="attr">minReplicas:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">        <span class="attr">replicas:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">        <span class="attr">maxReplicas:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">      <span class="attr">required:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">minReplicas</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">replicas</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">maxReplicas</span> </span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œå½“æœ‰å¦‚ä¸‹çš„è‡ªå®šä¹‰èµ„æºåˆ›å»ºæ—¶ï¼ŒKubernetes å°†ä¼šæ‹’ç»å…¶è¯·æ±‚ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">&quot;stable.example.com/v1&quot;</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomDeployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-new-deploy-object</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">minReplicas:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">20</span></span><br><span class="line">  <span class="attr">maxReplicas:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><p>å¹¶ä¸”è¿”å›å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">The CustomDeployment &quot;my-new-deploy-object&quot; is invalid:</span><br><span class="line">* spec: Invalid value: map[string]interface &#123;&#125;&#123;&quot;maxReplicas&quot;:10, &quot;minReplicas&quot;:0, &quot;replicas&quot;:20&#125;: replicas should be smaller than or equal to maxReplicas.</span><br></pre></td></tr></table></figure><p>è¿™æ ·ç›¸æ¯”åŸæ¥æˆ‘ä»¬é€šè¿‡ Admission çš„æ–¹å¼æ¥è¿›è¡Œæ ¡éªŒå°±ä¼šæ–¹ä¾¿çš„å¤šã€‚å…³äº Kubernetes Admission å¯ä»¥å‚è€ƒæ–‡ç«  <a target="_blank" rel="noopener external nofollow noreferrer" href="http://mp.weixin.qq.com/s?__biz=MzI2ODAwMzUwNA==&mid=2649296994&idx=2&sn=60686fcebaacff30b9762a6229e85d12&chksm=f2eb81bdc59c08ab0f10013ed2bda48a7f3f5f3e0d335b7f1cdbbbce6e5b81656b487e9955d8&scene=21#wechat_redirect">ã€Šç†æ¸… Kubernetes ä¸­ Admission æœºåˆ¶ã€‹</a>ã€‚</p><h2 id="HPA-v2-API-è¾¾åˆ°-GA"><a href="#HPA-v2-API-è¾¾åˆ°-GA" class="headerlink" title="HPA v2 API è¾¾åˆ° GA"></a>HPA v2 API è¾¾åˆ° GA</h2><p>HPA v2 å¤§çº¦æ˜¯åœ¨ 5 å¹´å‰é¦–æ¬¡æå‡ºï¼Œç»è¿‡è¿™ 5 å¹´çš„å‘å±•ï¼Œç»ˆäºåœ¨ç°åœ¨å®ƒè¾¾åˆ°äº† GA çº§åˆ«ã€‚</p><h1 id="Kubernetes-v1-24"><a href="#Kubernetes-v1-24" class="headerlink" title="Kubernetes v1.24"></a>Kubernetes v1.24</h1><h2 id="å„beta-APIé»˜è®¤å…³é—­"><a href="#å„beta-APIé»˜è®¤å…³é—­" class="headerlink" title="å„beta APIé»˜è®¤å…³é—­"></a>å„beta APIé»˜è®¤å…³é—­</h2><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°çš„å„beta APIä¸ä¼šåœ¨é›†ç¾¤å†…å¾—åˆ°å¯ç”¨ã€‚ä½†å…¨éƒ¨åŸæœ‰beta APIåŠå…¶æ–°ç‰ˆæœ¬å°†åœ¨1.24ä¸­ç»§ç»­é»˜è®¤å¯ç”¨</p><h2 id="OpenAPI-v3"><a href="#OpenAPI-v3" class="headerlink" title="OpenAPI v3"></a>OpenAPI v3</h2><p>Kubernetes 1.24å¼€å§‹ä¸ºAPIçš„OpenAPI v3å‘å¸ƒæ ¼å¼æä¾›betaæ”¯æŒã€‚</p><h2 id="å­˜å‚¨å®¹é‡ä¸å­˜å‚¨å·æ‰©å±•åŒåŒè¿æ¥é€šç”¨ç‰ˆæœ¬"><a href="#å­˜å‚¨å®¹é‡ä¸å­˜å‚¨å·æ‰©å±•åŒåŒè¿æ¥é€šç”¨ç‰ˆæœ¬" class="headerlink" title="å­˜å‚¨å®¹é‡ä¸å­˜å‚¨å·æ‰©å±•åŒåŒè¿æ¥é€šç”¨ç‰ˆæœ¬"></a>å­˜å‚¨å®¹é‡ä¸å­˜å‚¨å·æ‰©å±•åŒåŒè¿æ¥é€šç”¨ç‰ˆæœ¬</h2><p>å­˜å‚¨å®¹é‡è·Ÿè¸ªé€šè¿‡CSIStorageCapacityå¯¹è±¡å…¬å¼€å½“å‰å¯ç”¨çš„å­˜å‚¨å®¹é‡ï¼Œå¹¶å¯¹ä½¿ç”¨åç»­ç»‘å®šçš„CSIå­˜å‚¨å·çš„podè¿›è¡Œè°ƒåº¦å¢å¼ºã€‚<br>å­˜å‚¨å·æ‰©å±•åˆ™æ–°å¢å¯¹ç°æœ‰æŒä¹…å·çš„é‡æ–°è°ƒæ•´åŠŸèƒ½ã€‚</p><h2 id="NonPreemptingPriorityè¿æ¥ç¨³å®šç‰ˆ"><a href="#NonPreemptingPriorityè¿æ¥ç¨³å®šç‰ˆ" class="headerlink" title="NonPreemptingPriorityè¿æ¥ç¨³å®šç‰ˆ"></a>NonPreemptingPriorityè¿æ¥ç¨³å®šç‰ˆ</h2><p>æ­¤åŠŸèƒ½ä¸ºPriorityClassesæ·»åŠ äº†æ–°çš„é€‰é¡¹ï¼Œå¯å¼€å¯æˆ–å…³é—­PodæŠ¢å æœºåˆ¶</p><h2 id="å­˜å‚¨æ’ä»¶è¿ç§»"><a href="#å­˜å‚¨æ’ä»¶è¿ç§»" class="headerlink" title="å­˜å‚¨æ’ä»¶è¿ç§»"></a>å­˜å‚¨æ’ä»¶è¿ç§»</h2><p>ç›®å‰Kuberneteså¼€å‘å›¢é˜Ÿæ­£åœ¨è¿ç§»æ ‘å†…å­˜å‚¨æ’ä»¶ï¼Œå¸Œæœ›åœ¨å®ç°CSIæ’ä»¶çš„åŒæ—¶ã€ä¿æŒåŸæœ‰APIçš„æ­£å¸¸èµ·æ•ˆã€‚Azure Diskä¸OpenStack Cinderç­‰æ’ä»¶å·²ç»å®Œæˆäº†è¿ç§»ã€‚</p><h2 id="gRPCæ¢é’ˆå‡çº§è‡³betaç‰ˆ"><a href="#gRPCæ¢é’ˆå‡çº§è‡³betaç‰ˆ" class="headerlink" title="gRPCæ¢é’ˆå‡çº§è‡³betaç‰ˆ"></a>gRPCæ¢é’ˆå‡çº§è‡³betaç‰ˆ</h2><p>åœ¨1.24ç‰ˆæœ¬ä¸­ï¼ŒgRPCæ¢é’ˆåŠŸèƒ½å·²ç»è¿›å…¥betaé˜¶æ®µä¸”é»˜è®¤å¯ç”¨ã€‚ç°åœ¨ï¼Œå¤§å®¶å¯ä»¥åœ¨Kubernetesä¸­ä¸ºè‡ªå·±çš„gRPCåº”ç”¨ç¨‹åºåŸç”Ÿé…ç½®å¯åŠ¨ã€æ´»åŠ¨ä¸å°±ç»ªæ¢æµ‹ï¼Œè€Œä¸”æ— éœ€å…¬å¼€HTTPå•†æˆ˜æˆ–è€…ä½¿ç”¨é¢å¤–çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><h2 id="Kubeletè¯ä¹¦æä¾›ç¨‹åºå‡çº§è‡³betaç‰ˆ"><a href="#Kubeletè¯ä¹¦æä¾›ç¨‹åºå‡çº§è‡³betaç‰ˆ" class="headerlink" title="Kubeletè¯ä¹¦æä¾›ç¨‹åºå‡çº§è‡³betaç‰ˆ"></a>Kubeletè¯ä¹¦æä¾›ç¨‹åºå‡çº§è‡³betaç‰ˆ</h2><p>æœ€åˆåœ¨Kubernetes 1.20ç‰ˆæœ¬ä¸­ä»¥alphaç‰ˆäº®ç›¸çš„kubeleté•œåƒè¯ä¹¦æä¾›ç¨‹åºç°å·²å‡çº§è‡³betaç‰ˆã€‚ç°åœ¨ï¼Œkubeletå°†ä½¿ç”¨execæ’ä»¶åŠ¨æ€æ£€ç´¢å®¹å™¨é•œåƒæ³¨å†Œè¡¨çš„å‡­è¯ï¼Œè€Œä¸å†å°†å‡­è¯å­˜å‚¨åœ¨èŠ‚ç‚¹æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šã€‚</p><h2 id="é¿å…ä¸ºæœåŠ¡åˆ†é…IPæ—¶å‘ç”Ÿå†²çª"><a href="#é¿å…ä¸ºæœåŠ¡åˆ†é…IPæ—¶å‘ç”Ÿå†²çª" class="headerlink" title="é¿å…ä¸ºæœåŠ¡åˆ†é…IPæ—¶å‘ç”Ÿå†²çª"></a>é¿å…ä¸ºæœåŠ¡åˆ†é…IPæ—¶å‘ç”Ÿå†²çª</h2><p>Kubernetes 1.24å¼•å…¥äº†ä¸€é¡¹æ–°çš„é€‰æ‹©æ€§åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·ä¸ºæœåŠ¡çš„é™æ€IPåˆ†é…åœ°å€ä¿ç•™ä¸€ä¸ªè½¯èŒƒå›´ã€‚é€šè¿‡æ‰‹åŠ¨å¯ç”¨æ­¤é¡¹åŠŸèƒ½ï¼Œé›†ç¾¤å°†ä»æ‚¨æŒ‡å®šçš„æœåŠ¡IPæ± ä¸­è‡ªåŠ¨è·å–åœ°å€ï¼Œä»è€Œé™ä½å†²çªé£é™©ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒæœåŠ¡çš„ClusterIPèƒ½å¤Ÿä»¥ä¸‹åˆ—æ–¹å¼åˆ†é…ï¼š<br>åŠ¨æ€åˆ†é…ï¼Œå³é›†ç¾¤å°†åœ¨é…ç½®çš„æœåŠ¡IPèŒƒå›´å†…è‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªç©ºé—²IPã€‚<br>é™æ€åˆ†é…ï¼Œæ„å‘³ç€ç”¨æˆ·éœ€è¦åœ¨å·²é…ç½®çš„æœåŠ¡IPèŒƒå›´å†…æŒ‡å®šä¸€ä¸ªIPã€‚</p><blockquote><p>æœåŠ¡ClusterIPæ˜¯å”¯ä¸€çš„ï¼›å› æ­¤è‹¥å°è¯•ä½¿ç”¨å·²è¢«åˆ†é…çš„ClusterIPè¿›è¡ŒæœåŠ¡åˆ›å»ºï¼Œåˆ™ä¼šè¿”å›é”™è¯¯ç»“æœã€‚</p></blockquote><h1 id="Kubernetes-v1-25"><a href="#Kubernetes-v1-25" class="headerlink" title="Kubernetes v1.25"></a>Kubernetes v1.25</h1><p>Kubernetes æ­£å¼å‘å¸ƒäº†ï¼ŒåŒ…å«äº† 40 é¡¹ç›®å¢å¼ºæ›´æ–°ã€‚</p><p>æœ¬æ¬¡ LOGO çš„ä¸»è¦è¡¨è¾¾çš„æ„æ€æ˜¯ <strong>å°Šé‡åä½œå’Œå¼€æ”¾çš„ç²¾ç¥</strong> ï¼Œè¿™ç§ç²¾ç¥å°†æˆ‘ä»¬å‡èšåˆ°ä¸€èµ·è½¬å˜ä¸ºèƒ½æ”¹å˜ä¸–ç•Œçš„åŠ›é‡ã€‚</p><p>å…¶å®æˆ‘æ¯æœŸçš„ ã€Œk8sç”Ÿæ€å‘¨æŠ¥ã€éƒ½æœ‰ä¸€ä¸ªå«ä¸Šæ¸¸è¿›å±•çš„éƒ¨åˆ†ï¼Œæ‰€ä»¥å¾ˆå¤šå€¼å¾—å…³æ³¨çš„å†…å®¹åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­å·²ç»å‘è¿‡äº†ã€‚</p><p>è¿™ç¯‡ä¸­æˆ‘ä¼šå†é¢å¤–ä»‹ç»ä¸€äº›ä¹‹å‰æœªæ¶µç›–çš„ï¼Œå’Œä¹‹å‰ä»‹ç»è¿‡çš„å€¼å¾—å…³æ³¨çš„å†…å®¹ã€‚</p><h2 id="core-CSI-Migration-è¾¾åˆ°-Stable"><a href="#core-CSI-Migration-è¾¾åˆ°-Stable" class="headerlink" title="core CSI Migration è¾¾åˆ° Stable"></a><strong>core CSI Migration è¾¾åˆ° Stable</strong></h2><p>Kubernetes å¯¹ CSI çš„æ”¯æŒæ˜¯è‡ª v1.9 å¼€å§‹å¼•å…¥çš„ï¼Œåˆ° 2019 å¹´çš„ v1.13 æ—¶å·²ç»æ­£å¼ GA ã€‚æœ€è¿‘å‡ ä¸ªç‰ˆæœ¬ä¸­ï¼Œç¤¾åŒºæ­£åœ¨å°†åŸæœ¬çš„ in-tree æ’ä»¶é€æ­¥åºŸå¼ƒæˆ–åˆ é™¤ï¼Œå¹¶è¿ç§»è‡³ä½¿ç”¨ CSI é©±åŠ¨çš„æ–¹å¼ã€‚</p><p>è¿ç§»è‡³ä½¿ç”¨ CSI çš„å¥½å¤„åœ¨äºï¼Œèƒ½æé«˜å¯ç»´æŠ¤æ€§ï¼Œå¹¶å‡å°‘å›  in-tree ä»£ç å¯¼è‡´çš„æ¼æ´æˆ–è€…é”™è¯¯çš„å‘ç”Ÿã€‚</p><p>ä½†æ˜¯è¿ç§»ä¹Ÿå¹¶ä¸æ˜¯ç›´æ¥æ›¿æ¢ï¼Œç¤¾åŒºè€ƒè™‘åˆ°ç”¨æˆ·çš„è¿ç§»æˆæœ¬ï¼Œäºæ˜¯æå‡ºäº†ä¸€ç§è§£å†³æ–¹æ¡ˆï¼šCSI Migration ï¼Œè¿™ä¸ªæ–¹æ¡ˆæ˜¯å°† in-tree API è½¬æ¢ä¸ºç­‰æ•ˆ CSI APIï¼Œå¹¶å°†æ“ä½œå§”æ‰˜ç»™ CSI é©±åŠ¨ç¨‹åºçš„åŠŸèƒ½ã€‚ç›®å‰è¯¥åŠŸèƒ½è¾¾åˆ° GAï¼Œin-tree çš„è¿ç§»ä¹Ÿæœ‰å¾ˆå¤šè¿›å±•ã€‚</p><ul><li>deprecate GlusterFS plugin from available in-tree drivers. by humblec Â· Pull Request <code>#111485</code> Â· kubernetes&#x2F;kubernetes</li></ul><p>åœ¨è¿™ä¸ª PR ä¸­åºŸå¼ƒäº† in-tree çš„ GlusterFS çš„ pluginï¼Œè¿™å…¶å®æ˜¯æœ€æ—©çš„ dynamic provisioner ï¼Œè‡ª Kubernetes v1.4 ç‰ˆæœ¬å¼€å§‹å¼•å…¥ã€‚</p><p>åœ¨åæ¥ CSI é©±åŠ¨å‡ºç°çš„æ—¶å€™ï¼Œç¤¾åŒºä¸­ä¹Ÿç«‹åˆ»å‡ºç°äº†å¯¹åº”çš„é©±åŠ¨å®ç° <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/gluster/gluster-csi-driver/">https://github.com/gluster/gluster-csi-driver/</a> ï¼Œåªä¸è¿‡è¯¥é¡¹ç›®å¹¶æ²¡æœ‰ç§¯æçš„è¿›è¡Œç»´æŠ¤ã€‚ç°åœ¨è¿˜æœ‰å¦ä¸€ä¸ªæ¯”è¾ƒæ¨èçš„æ›¿ä»£æ–¹æ¡ˆï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/kadalu/kadalu/">https://github.com/kadalu/kadalu/</a> æ­¤é¡¹ç›®æœ€æ–°çš„ç‰ˆæœ¬ä¸º v0.8.15 ã€‚</p><p>ç»è¿‡ç¤¾åŒºä¹‹å‰çš„è®¨è®ºï¼Œè¿˜æ˜¯å†³å®šåœ¨ v1.25 ç‰ˆæœ¬å¼€å§‹å°† in-tree çš„ GlusterFS plugin æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå¹¶åœ¨åç»­çš„ç‰ˆæœ¬ä¸­è¿›è¡Œç§»é™¤ã€‚</p><p>å¦‚æœæœ‰æ­£åœ¨ä½¿ç”¨æ­¤æ’ä»¶çš„å°ä¼™ä¼´ï¼Œæˆ‘å»ºè®®å¯ä»¥å°½æ—©çš„è¯„ä¼° kadalu çš„å¯è¡Œæ€§ &amp; è¿ç§»æˆæœ¬ã€‚</p><ul><li>cleanup: Remove storageos volume plugins from k8s codebase by Jiawei0227 Â· Pull Request <code>#111620</code> Â· kubernetes&#x2F;kubernetes</li><li>cleanup: Remove flocker volume plugins from k8s codebase by Jiawei0227 Â· Pull Request <code>#111618</code> Â· kubernetes&#x2F;kubernetes</li><li>cleanup: Remove quobyte volume plugins from k8s codebase by Jiawei0227 Â· Pull Request <code>#111619</code> Â· kubernetes&#x2F;kubernetes</li></ul><p>ä¸Šè¿°çš„è¿™å‡ ä¸ª PR æ‰€åšçš„äº‹æƒ…åŸºæœ¬ç±»ä¼¼ï¼Œæ˜¯ä¸€äº›æ¸…ç†æ“ä½œã€‚å°† Kubernetes é¡¹ç›®ä¸­ <code>StorageOS</code>ï¼Œ<code>Flocker</code> å’Œ <code>Quobyte</code> ç­‰ in-tree çš„å·æ’ä»¶éƒ½åˆ é™¤æ‰äº†ã€‚</p><p>å…¶ä¸­ <code>StorageOS</code> å’Œ <code>Quobyte</code> å¦‚æœæœ‰åœ¨ä½¿ç”¨ï¼Œå»ºè®®å¾€ CSI plugin è¿›è¡Œè¿ç§»ï¼Œè€Œ <code>Flocker</code> åˆ™æ˜¯ç”±äºä¸å†ç»´æŠ¤äº†ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ä»»ä½•è¿ç§»è®¡åˆ’ã€‚</p><h2 id="cgroup-v2-æ”¯æŒè¾¾åˆ°-GA"><a href="#cgroup-v2-æ”¯æŒè¾¾åˆ°-GA" class="headerlink" title="cgroup v2 æ”¯æŒè¾¾åˆ° GA"></a><strong>cgroup v2 æ”¯æŒè¾¾åˆ° GA</strong></h2><p>åœ¨ 2019 å¹´ GitChat å¯¹æˆ‘çš„è®¿è°ˆä¸­è®©æˆ‘èŠ 2020 å¹´çš„æŠ€æœ¯è¶‹åŠ¿ï¼Œæˆ‘å½“æ—¶çš„ä¸»è¦è§‚ç‚¹æ‘˜å½•å¦‚ä¸‹ï¼š</p><blockquote><p>â€œ</p><p>ä½œä¸ºäº‘åŸç”ŸæŠ€æœ¯çš„åŸºçŸ³ï¼ŒKubernetes åœ¨ 2020 å¹´çš„çƒ­åº¦å°†ä¼šæŒç»­ä¸Šå‡ã€‚è€Œå„ä¸ªå…¬å¸çš„é›†ç¾¤è§„æ¨¡ï¼Œä»¥åŠå¯¹å®¹å™¨æŠ€æœ¯çš„æ¨è¿›éƒ½å°†ä¼šæŒç»­åŠ å¤§ã€‚åœ¨ç»å†äº†åˆæ­¥å®¹å™¨åŒ–åï¼Œæ›´å¤šçš„å…¬å¸å°†é¢ä¸´çš„é—®é¢˜æ˜¯ç¨³å®šæ€§å’Œæ€§èƒ½ä¼˜åŒ–é—®é¢˜ã€‚ä¸æ­¤åŒæ—¶ï¼Œservice meshï¼Œserverless ç­‰æŠ€æœ¯ä¹Ÿéƒ½ä¼šé€æ­¥å¾—åˆ°æ™®éåº”ç”¨ã€‚ä»åº•å±‚æ¬¡æŠ€æœ¯çš„è§’åº¦æ¥çœ‹ï¼Œcgroups v2 å°†é€æ­¥æ™®åŠï¼Œè¿›è€Œå–ä»£ cgroups v1ï¼Œä½†è¿™ä¸ªè¿‡ç¨‹å¯èƒ½éœ€è¦ä¸¤ä¸‰å¹´å·¦å³ã€‚æ•´ä½“è€Œè¨€ï¼Œç¨³å®šæ€§å’Œæ€§èƒ½ä¼˜åŒ–å°†ä¼šæ˜¯æœªæ¥çš„ä¸»æ—‹å¾‹ã€‚</p><p>â€</p></blockquote><p>å¦‚ä»Šï¼Œ3 å¹´æ—¶é—´å·²ç»è¿‡å»ï¼ŒKubernetes v1.25 ä¸­å¯¹ cgroup v2 çš„æ”¯æŒå·²ç»è¾¾åˆ° GA ã€‚</p><h2 id="PodSecurity-ç‰¹æ€§è¾¾åˆ°-GA"><a href="#PodSecurity-ç‰¹æ€§è¾¾åˆ°-GA" class="headerlink" title="PodSecurity ç‰¹æ€§è¾¾åˆ° GA"></a><strong>PodSecurity ç‰¹æ€§è¾¾åˆ° GA</strong></h2><p>åœ¨ <code>#110459 Â· kubernetes/kubernetes</code> ä¸­æ­£å¼å°† PodSecurity ç‰¹æ€§å‡çº§åˆ° GA ã€‚å¦‚æœæˆ‘æ²¡æœ‰è®°é”™ï¼Œè¿™ä¸ª ç‰¹æ€§åº”è¯¥æ˜¯ä»å¼•å…¥åˆ° GA æœ€å¿«çš„ç‰¹æ€§ä¹‹ä¸€äº†ã€‚</p><p>PodSecurity æ˜¯è‡ª Kubernetes v1.22 å¼•å…¥çš„ alpha ç‰¹æ€§ï¼Œä½œä¸º PodSecurityPolicy çš„ä¸€ä¸ªæ›¿ä»£ã€‚åœ¨ v1.23 è¾¾åˆ° beta çº§åˆ«ï¼Œé€šè¿‡ä¸Šè¿° PRï¼Œåœ¨ v1.25 æ­£å¼ GA ï¼Œå¹¶ä¸”é»˜è®¤å¯ç”¨ï¼Œå¯ä»¥çœ‹åˆ° æ•´ä¸ªå‘å±•è¿‡ç¨‹è¿˜æ˜¯å¾ˆå¿«çš„ã€‚</p><p>PodSecurity å®šä¹‰äº† 3 ç§çº§åˆ«ï¼š</p><ul><li>Enforceï¼šå¦‚æœ Pod è¿åç­–ç•¥ï¼Œåˆ™ä¸ä¼šè¢«åˆ›å»ºï¼›</li><li>Auditï¼šå¦‚æœ Pod è¿åç­–ç•¥ï¼Œåˆ™åœ¨å®¡è®¡æ—¥å¿—ä¸­ä¼šè¢«è®°å½•ï¼Œä½†æ˜¯ Pod ä»å°†æ­£å¸¸åˆ›å»ºï¼›</li><li>Warnï¼šå¦‚æœ Pod è¿åç­–ç•¥ï¼Œåˆ™ä¼šåœ¨ console ä¸­æ‰“å° warning ä¿¡æ¯ï¼ŒPod ä»å°†æ­£å¸¸åˆ›å»ºï¼›</li></ul><p>ä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦ç»™ namespace æ·»åŠ  <code>pod-security.kubernetes.io/&lt;mode&gt;=&lt;standard&gt;</code> æ ‡ç­¾å³å¯ã€‚</p><p>åªè¦ä½ çš„ Kubernetes é›†ç¾¤ç‰ˆæœ¬å…ˆå‡çº§åˆ° v1.22 ä»¥ä¸Šï¼Œå¹¶ä¸”å¼€å¯ PodSecurity ç‰¹æ€§ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŒ‰ç…§ Migrate from PodSecurityPolicy to the Built-In PodSecurity Admission Controller | Kubernetes è¿›è¡Œè¿ç§»äº†ã€‚</p><h2 id="åˆæ­¥æ”¯æŒ-user-namespaces"><a href="#åˆæ­¥æ”¯æŒ-user-namespaces" class="headerlink" title="åˆæ­¥æ”¯æŒ user namespaces"></a><strong>åˆæ­¥æ”¯æŒ user namespaces</strong></h2><ul><li>Add support for user namespaces phase 1 (KEP 127) by rata Â· Pull Request <code>#111090</code> Â· kubernetes&#x2F;kubernetes</li></ul><p>è¿™ä¸ª PR å®ç°äº† KEP127 çš„ç¬¬ä¸€é˜¶æ®µï¼ŒKEP127 æ—¨åœ¨ä¸º Pod æ·»åŠ  user namespaces çš„æ”¯æŒã€‚å¯¹ user namespaces ä¸å¤ªç†Ÿæ‚‰çš„å°ä¼™ä¼´ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘ä¹‹å‰çš„ç³»åˆ—æ–‡ç« ï¼šã€Šææ‡‚å®¹å™¨æŠ€æœ¯çš„åŸºçŸ³ï¼šnamespace ï¼ˆä¸Šï¼‰ã€‹ å’Œ ã€Šææ‡‚å®¹å™¨æŠ€æœ¯çš„åŸºçŸ³ï¼šnamespace ï¼ˆä¸‹ï¼‰ã€‹ ã€‚</p><p>åœ¨ Kubernetes ä¸­æ”¯æŒä½¿ç”¨ user namespaces çš„å¥½å¤„åœ¨äºï¼Œå¯ä»¥åœ¨ä¸ä¸»æœºæœ‰ä¸åŒ UID&#x2F;GID çš„ Pod ä¸­è¿è¡Œè¿›ç¨‹ï¼Œè¿™æ ·åœ¨ Pod å†…çš„ç‰¹æƒè¿›ç¨‹ å®é™…æ˜¯ä½œä¸ºä¸»æœºä¸­çš„æ™®é€šè¿›ç¨‹è¿è¡Œçš„ã€‚è¿™æ ·ï¼Œå‡è®¾ Pod å†…çš„ç‰¹æƒè¿›ç¨‹ç”±äºå®‰å…¨æ¼æ´è¢«æ”»ç ´ï¼Œå¯¹ä¸»æœºçš„å½±å“ä¹Ÿå¯ä»¥é™åˆ°æ¯”è¾ƒä½ã€‚</p><p>ç›´æ¥ç›¸å…³çš„æ¼æ´ï¼Œæ¯”å¦‚ CVE-2019-5736 ï¼Œæˆ‘ä¹Ÿæ›¾åœ¨ 2019 å¹´çš„æ–‡ç«  ã€Šrunc 1.0-rc7 å‘å¸ƒä¹‹é™…ã€‹ ä¸“é—¨ä»‹ç»è¿‡ï¼Œ æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥åˆ°è¯¥æ–‡ç« ä¸­äº†è§£è¯¦æƒ…ã€‚</p><p>è¯¥å®ç°æ˜¯åœ¨ Pod çš„ Spec ä¸­æ·»åŠ äº†å¸ƒå°”ç±»å‹çš„ <code>HostUsers</code> å­—æ®µï¼Œä»¥å†³å®šæ˜¯å¦å¯ç”¨ä¸»æœºçš„ user namespacesï¼Œé»˜è®¤æ˜¯ true ã€‚</p><p>æ­¤å¤–ï¼Œç›®å‰å¯é¢„è§çš„æƒ…å†µæ˜¯ï¼Œå¦‚æœ Kubernetes é›†ç¾¤ä½¿ç”¨çš„ Linux å†…æ ¸ç‰ˆæœ¬åœ¨ v5.19 ä»¥ä¸‹çš„è¯ï¼Œé‚£ä¹ˆä½¿ç”¨è¯¥ç‰¹æ€§å¯èƒ½ä¼šå¯¼è‡´ Pod çš„å¯åŠ¨æ—¶é—´å¢åŠ ã€‚</p><h2 id="CronJobTimeZone-è¾¾åˆ°-Beta-çº§åˆ«"><a href="#CronJobTimeZone-è¾¾åˆ°-Beta-çº§åˆ«" class="headerlink" title="CronJobTimeZone è¾¾åˆ° Beta çº§åˆ«"></a><strong>CronJobTimeZone è¾¾åˆ° Beta çº§åˆ«</strong></h2><ul><li>Promote CronJobTimeZone to beta by soltysh Â· Pull Request <code>#111435</code> Â· kubernetes&#x2F;kubernetes</li></ul><p>CronJob TimeZone çš„ç‰¹æ€§è¾¾åˆ°äº† Beta é˜¶æ®µã€‚ä¸è¿‡æ ¹æ® Kubernetes æœ€æ–°çš„ç‰¹æ€§ç­–ç•¥ï¼Œè¯¥ç‰¹æ€§ä»ç„¶éœ€è¦æ‰‹åŠ¨å¼€å¯ <code>CronJobTimeZone</code> feature gate ã€‚</p><p>æ³¨æ„ï¼ŒCronJob å¦‚æœä¸è®¾ç½® TimeZone çš„è¯ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯ kube-controller-manager è¿›ç¨‹çš„ TimeZone ã€‚ä¹‹å‰æœ‰é‡åˆ°å°ä¼™ä¼´åœ¨è¿™ä¸ªé—®é¢˜ä¸Šæµªè´¹äº†ä¸€äº›æ—¶é—´ã€‚</p><h2 id="å¼•å…¥-alpha-ç‰¹æ€§-ContainerCheckpoint"><a href="#å¼•å…¥-alpha-ç‰¹æ€§-ContainerCheckpoint" class="headerlink" title="å¼•å…¥ alpha ç‰¹æ€§ ContainerCheckpoint"></a><strong>å¼•å…¥ alpha ç‰¹æ€§ ContainerCheckpoint</strong></h2><p>#104907 Â· kubernetes&#x2F;kubernetes è¿™æ˜¯ä¸€ä¸ªæŒç»­äº†å°†è¿‘ä¸€å¹´çš„ PRï¼Œåœ¨è¿™ä¸ª PR ä¸­å¼•å…¥äº†ä¸€é¡¹æ–°çš„ç‰¹æ€§ï¼š<code>ContainerCheckpoint</code>ã€‚</p><p>å¯¹ Docker æ¯”è¾ƒç†Ÿæ‚‰çš„å°ä¼™ä¼´ï¼Œå¯èƒ½çŸ¥é“åœ¨ Docker ä¸­å­˜åœ¨ä¸€ä¸ª <code>docker checkpoint</code> çš„å­å‘½ä»¤ã€‚è¿™ä¸ªå­å‘½ä»¤å®é™…ä¸Šæ˜¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬ä¸ºæŸä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨åˆ›å»ºä¸€ä¸ªçŠ¶æ€ç‚¹çš„å¿«ç…§ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°ç£ç›˜ä¸­ã€‚</p><p>åç»­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤ checkpoint å¯åŠ¨å®¹å™¨ï¼Œæ¢å¤å…¶åŸå…ˆçš„çŠ¶æ€ï¼Œæˆ–è€…å°†å®¹å™¨è¿ç§»åˆ°å…¶ä»–çš„æœºå™¨ä¸Šã€‚</p><p>åŒæ ·çš„ï¼Œåœ¨ Kubernetes ä¸­æä¾›çš„è¿™ä¸ª <code>ContainerCheckpoint</code> çš„æ–°ç‰¹æ€§æ˜¯è‡ª v1.25 å¼€å§‹ä½œä¸º alpha ç‰¹æ€§åŠ å…¥çš„ï¼Œé»˜è®¤æ˜¯å…³é—­çš„ã€‚åˆ©ç”¨æ­¤ç‰¹æ€§å¯ä»¥é€šè¿‡ kubelet æä¾›çš„ APIï¼Œä¸º container åˆ›å»ºä¸€ä¸ªæœ‰çŠ¶æ€çš„å¿«ç…§ï¼Œç„¶åå°†å…¶ç§»åŠ¨åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œè°ƒè¯•ï¼Œæˆ–è€…å…¶ä»–ç±»ä¼¼çš„éœ€æ±‚ã€‚</p><p>æ­¤å¤„éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ›å»º checkpoint å¯èƒ½ä¼šäº§ç”Ÿä¸€äº›å®‰å…¨éšæ‚£ï¼Œæ¯”å¦‚ checkpoint å®é™…ä¸Šæ˜¯å¯¹å½“å‰è¿è¡Œä¸­ container çš„å†…å­˜å¿«ç…§ï¼Œæ‰€ä»¥å¦‚æœåœ¨ container çš„å†…å­˜ä¸­åŒ…å«äº†æŸäº›éšç§æ•°æ®ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½åœ¨è¿ç§»åˆ°å…¶ä»–æœºå™¨ä¸Šä¹Ÿå¯ä»¥è®¿é—®åˆ°ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œåˆ›å»º checkpoint ä¼šäº§ç”Ÿä¸€äº›æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶æ˜¯éœ€è¦å ç”¨ç£ç›˜çš„ã€‚å¦‚æœé¢‘ç¹çš„åˆ›å»º checkpoint åˆ™å¯èƒ½å¯¼è‡´ç£ç›˜å‹åŠ›è¿‡å¤§ã€‚checkpoint çš„å­˜æ¡£ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šæ”¾åœ¨ <code>/var/lib/kubelet/checkpoints</code> ç›®å½•ä¸‹ï¼Œå¹¶ä¸”ä»¥ <code>checkpoint-&lt;podFullName&gt;-&lt;containerName&gt;-&lt;timestamp&gt;.tar</code> è¿›è¡Œå‘½åã€‚</p><p>è¿™ä¸ªç‰¹æ€§ä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œç›´æ¥ç»™ Kubelet å‘é€ä¸€ä¸ªè¯·æ±‚å³å¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST /checkpoint/&#123;namespace&#125;/&#123;pod&#125;/&#123;container&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°†è·å–åˆ°çš„å½’æ¡£æ–‡ä»¶ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ¢å¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crictl restore --import=&lt;archive&gt;</span><br></pre></td></tr></table></figure><h2 id="ä¸º-kubectl-å¼•å…¥-kuberc-é…ç½®æ–‡ä»¶"><a href="#ä¸º-kubectl-å¼•å…¥-kuberc-é…ç½®æ–‡ä»¶" class="headerlink" title="ä¸º kubectl å¼•å…¥ kuberc é…ç½®æ–‡ä»¶"></a><strong>ä¸º kubectl å¼•å…¥ kuberc é…ç½®æ–‡ä»¶</strong></h2><p>KEP-3104 è¿™ä¸ª KEP æ—¨åœ¨ä¸º kubectl å¼•å…¥ä¸€ä¸ªæ–°çš„é…ç½®æ–‡ä»¶ <code>kuberc</code>ï¼Œç”¨æ¥é…ç½®ä¸€äº›ç”¨æˆ·çš„è‡ªå®šä¹‰é…ç½®ã€‚è¿™åœ¨å¾ˆå¤šçš„é¡¹ç›®ï¼Œæˆ–è€…å·¥å…·ä¸­éƒ½æœ‰ç±»ä¼¼çš„ç”¨æ³•ã€‚æ¯”å¦‚ Vim ä¸­å¯ä»¥é€šè¿‡ <code>-u</code> æŒ‡å®šç”¨æˆ·è‡ªå·±çš„é…ç½®æ–‡ä»¶ï¼Œæˆ–è€…ä½¿ç”¨é»˜è®¤çš„ <code>~/.vimrc</code> æ¥å®Œæˆè‡ªå®šä¹‰é…ç½®ã€‚</p><p>è¿™æ ·åšçš„å¥½å¤„å°±åœ¨äºå¯ä»¥è®© <code>kubeconfig</code> æ›´åŠ çš„ä¸“æ³¨ï¼Œä»…ä»…éœ€è¦ä¿ç•™å’Œé›†ç¾¤ã€ç”¨æˆ·å‡­è¯ç›¸å…³çš„ä¿¡æ¯å³å¯ï¼Œå¯¹äºç”¨æˆ·çš„è‡ªå®šä¹‰é…ç½®åˆ™åˆ†ç¦»å¼€æ¥ã€‚å…·ä½“è€Œè¨€ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶çœ‹èµ·æ¥å°±ä¼šæ˜¯è¿™æ ·ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Preferences</span></span><br><span class="line"></span><br><span class="line"><span class="attr">command:</span></span><br><span class="line">  <span class="attr">aliases:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">alias:</span> <span class="string">getdbprod</span></span><br><span class="line">      <span class="attr">command:</span> <span class="string">get</span> <span class="string">pods</span> <span class="string">-l</span> <span class="string">what=database</span> <span class="string">--namespace</span> <span class="string">us-2-production</span></span><br><span class="line">      </span><br><span class="line">  <span class="attr">overrides:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">command:</span> <span class="string">apply</span></span><br><span class="line">      <span class="attr">flags:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">server-side</span></span><br><span class="line">          <span class="attr">default:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">command:</span> <span class="string">delete</span></span><br><span class="line">      <span class="attr">flags:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">confirm</span></span><br><span class="line">          <span class="attr">default:</span> <span class="string">&quot;true&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">command:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line">      <span class="attr">flags:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">exec-auth-allowlist</span></span><br><span class="line">          <span class="attr">default:</span> <span class="string">/var/kubectl/exec/...</span></span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥ä¹Ÿæ¯”è¾ƒç›´è§‚ï¼Œå¯ä»¥ç”¨æ¥å¢åŠ ä¸€äº› <code>alias</code> å’Œè¦†ç›–ä¸€äº›é»˜è®¤çš„é…ç½®ï¼Œè¿™æ ·å¤§å®¶ä¸å†éœ€è¦å®šä¹‰å¾ˆå¤šçš„ aliasï¼Œä»¥åä½¿ç”¨ kubectl çš„æ—¶å€™æ•²çš„å‘½ä»¤ä¹Ÿèƒ½å°‘å¾ˆå¤šã€‚æ­¤ç‰¹æ€§æœªå®ç°ä¹‹å‰ï¼Œ åœ¨è¿™é‡Œé¡ºä¾¿æ¨èå¦ä¸€ä¸ªé¡¹ç›® kubectl-aliasesï¼Œæ­¤é¡¹ç›®ä¸­åŒ…å«äº†å¾ˆå¤š aliasï¼Œå¯ä»¥è®©ä½¿ç”¨ kubectl çš„è¿‡ç¨‹æ›´åŠ ç®€å•ã€‚</p><p>ä½†ä¹Ÿæœ‰ä¸€äº›å¼Šç«¯ï¼Œå°±åƒæ˜¯æ¯ä¸ª Vim ç”¨æˆ·éƒ½è¦æœ‰è‡ªå·±çš„ vimrc é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œè¿™ä¼šå…»æˆä¸€å®šçš„ä¹ æƒ¯ã€‚åœ¨ä¸€äº›æ²¡æœ‰è‡ªå·±è‡ªå®šä¹‰é…ç½®çš„æœºå™¨ä¸Šä½¿ç”¨æ—¶ï¼Œä¼šæœ‰äº›ä¸ä¹ æƒ¯ã€‚åŒæ—¶ï¼Œè¿™åœ¨æ’æŸ¥é—®é¢˜æ—¶ï¼Œä¹Ÿå¯èƒ½å¢åŠ æ’æŸ¥çš„é“¾è·¯ï¼ˆæ¯”å¦‚ kuberc ä¸­å¢åŠ äº†ä¸€ä¸ªé”™è¯¯çš„é…ç½®ä¹‹ç±»çš„ï¼‰ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘åœ¨æ’æŸ¥ Vim çš„é—®é¢˜æ—¶å€™ï¼Œé€šå¸¸ä¼šç›´æ¥ <code>vim -u /dev/null</code> è¿™æ ·ï¼Œä»¥é˜²ä½¿ç”¨äº†ä»»ä½•è‡ªå®šä¹‰é…ç½®é€ æˆå½±å“ã€‚é‚£ä¹ˆåç»­å¦‚æœè¿™ä¸ªåŠŸèƒ½å®Œå…¨å®ç°äº†ï¼Œé‚£ä¹ˆå¤§å®¶åœ¨ æ’æŸ¥é—®é¢˜çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä½¿ç”¨ <code>kubectl --kuberc /dev/null</code> ç±»ä¼¼è¿™æ ·çš„æ–¹å¼æ¥é¿å…æœ¬åœ°è‡ªå®šä¹‰é…ç½®é€ æˆå½±å“ã€‚</p><h2 id="ä¸º-kubectl-æ·»åŠ -subresource-çš„è¡¥å…¨"><a href="#ä¸º-kubectl-æ·»åŠ -subresource-çš„è¡¥å…¨" class="headerlink" title="ä¸º kubectl æ·»åŠ  --subresource çš„è¡¥å…¨"></a><strong>ä¸º kubectl æ·»åŠ  --subresource çš„è¡¥å…¨</strong></h2><ul><li>Add shell completion for new --subresource flag by marckhouzam Â· Pull Request <code>#109070</code> Â· kubernetes&#x2F;kubernetes</li></ul><p>åœ¨ Kubernetes v1.24 ä¸­ï¼Œç»™ kubectl å¢åŠ äº† subresource çš„æ”¯æŒï¼ˆæŒ‡ <code>status</code> å’Œ <code>scale</code>ï¼‰ï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç›´æ¥å¯¹ subresource è¿›è¡Œæ“ä½œäº†ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡éƒ½ <code>-o yaml</code> ä¹‹ç±»çš„ç›´æ¥è¿›è¡ŒæŸ¥çœ‹ï¼Œæˆ–è€…é€šè¿‡ curl ä¹‹ç±»çš„è°ƒç”¨ API æ¥å®Œæˆå…¶ä»–æ“ä½œã€‚ä½¿ç”¨äº†æ­¤ç‰¹æ€§åï¼Œå¯ä»¥æœ‰å¦‚ä¸‹æ•ˆæœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># v1.24+</span></span><br><span class="line">tao@moelove:~$ kubectl get  -n apisix  --subresource status deploy apisix-ingress-controller </span><br><span class="line">NAME                        AGE</span><br><span class="line">apisix-ingress-controller   2d23h</span><br><span class="line"></span><br><span class="line">tao@moelove:~$ kubectl get  -n apisix  --subresource scale deploy apisix-ingress-controller  -ojson</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;apiVersion&quot;</span>: <span class="string">&quot;autoscaling/v1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;Scale&quot;</span>,</span><br><span class="line">    <span class="string">&quot;metadata&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;creationTimestamp&quot;</span>: <span class="string">&quot;2022-08-04T18:57:45Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;apisix-ingress-controller&quot;</span>,</span><br><span class="line">        <span class="string">&quot;namespace&quot;</span>: <span class="string">&quot;apisix&quot;</span>,</span><br><span class="line">        <span class="string">&quot;resourceVersion&quot;</span>: <span class="string">&quot;1656&quot;</span>,</span><br><span class="line">        <span class="string">&quot;uid&quot;</span>: <span class="string">&quot;7c191a14-ee55-4254-80ba-7c91b4c833bd&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;spec&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;replicas&quot;</span>: 1</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;status&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;replicas&quot;</span>: 1,</span><br><span class="line">        <span class="string">&quot;selector&quot;</span>: <span class="string">&quot;app.kubernetes.io/instance=apisix,app.kubernetes.io/name=ingress-controller&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨æ­¤ä¹‹å‰ç‰ˆæœ¬ä½¿ç”¨è¯¥å‚æ•°çš„è¯ï¼Œä¼šç›´æ¥æç¤ºé”™è¯¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># v1.23</span></span><br><span class="line">tao@moelove:~$ kubectl-v1.23 get  -n apisix  --subresource status deploy apisix-ingress-controller </span><br><span class="line">Error: unknown flag: --subresource</span><br><span class="line">See <span class="string">&#x27;kubectl get --help&#x27;</span> <span class="keyword">for</span> usage.</span><br></pre></td></tr></table></figure><p>æ­¤å¤„æˆ‘æåˆ°çš„è¿™ä¸ªåœ¨ v1.25 ä¸­çš„ PR å®é™…ä¸Šæ˜¯ä¸ºäº†ç»™ <code>--subresource</code> æä¾›ä¸€ä¸ªå‘½ä»¤è¡¥å…¨çš„èƒ½åŠ›ï¼ˆè™½ç„¶å¦‚ä¸Šæ–‡æåˆ°çš„ï¼Œç›®å‰å°±ä¸¤ç§èµ„æºï¼‰ï¼Œè¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ã€‚</p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a><strong>å…¶ä»–</strong></h2><ul><li><code>#109074 Â· kubernetes/kubernetes</code></li></ul><p>kubeadm ä¸­ä¸º etcd çš„ static Pod å¢åŠ äº†ä¸€ä¸ª <code>--experimental-initial-corrupt-check</code> é€‰é¡¹ï¼Œå¯ä»¥ç”¨æ¥ç¡®è®¤ etcd member ä¸­æ•°æ®çš„ä¸€è‡´æ€§ã€‚è¿™ä¸ªç‰¹æ€§é¢„æœŸåœ¨ etcd çš„ v3.6 ç‰ˆæœ¬ä¸­ä¼šæ­£å¼å¯ç”¨ã€‚æ­¤å¤–ï¼Œetcd çš„ Release é¡µé¢ä¹Ÿå†™äº†ï¼Œå½“å‰ä¸å»ºè®®å°† etcd 3.5.x ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œå¦‚æœå°šæœªè¿›è¡Œå‡çº§ï¼Œå¯ä»¥å…ˆç»§ç»­ä½¿ç”¨ 3.4.xã€‚å¦‚æœå·²ç»å‡çº§äº†ï¼Œé‚£ä¹ˆå¯ä»¥è‡ªè¡Œå¢åŠ æ­¤å‚æ•°ï¼›</p><ul><li>Migrate Ginkgo from v1 to v2 Â· kubernetes&#x2F;kubernetes</li></ul><p>è¿™ä¸ª PR æŒç»­äº†å°†è¿‘ä¸‰ä¸ªæœˆï¼Œä¸»è¦æ˜¯å°† Kubernetes é¡¹ç›®ä¸­ä½¿ç”¨çš„ Ginkgo ä»å·²ç»åºŸå¼ƒçš„ v1 ç‰ˆæœ¬å‡çº§åˆ° v2 ç‰ˆæœ¬ã€‚</p><p>å…¶å®ç›®å‰å¾ˆå¤šé¡¹ç›®éƒ½åœ¨ç§¯æçš„æ¨è¿›æ­¤äº‹ï¼Œä½†ä¸åŒçš„é¡¹ç›®å¯¹ Ginkgo çš„ä¾èµ–å’Œä½¿ç”¨ç¨‹åº¦ä¸åŒï¼Œåœ¨è¿™ä¸ª PR ä¸­ä¿®æ”¹äº†è¶…è¿‡ 600 ä¸ªæ–‡ä»¶ï¼Œéå¸¸çš„åºå¤§ã€‚è€Œä¹‹å‰åœ¨ Apache APISIX Ingress controller é¡¹ç›®ä¸­ï¼Œä» Ginkgo v1 å‡çº§åˆ° v2 æ—¶ï¼Œä»…ä»…ç”¨äº†ä¸€å‘¨æ—¶é—´ï¼Œä¿®æ”¹æ–‡ä»¶ä¸ç®—å¤ªå¤šã€‚æ­¤å¤–ç›®å‰ Kubernetes Ingress-NGINX é¡¹ç›®ä¹ŸåŒæ ·åœ¨è¿›è¡Œæ­¤å‡çº§ï¼Œå¯èƒ½å·¥ä½œé‡ä¹Ÿä¸å°ã€‚</p><ul><li>Introduce KUBECACHEDIR environment variable to override default discovery cache dir by ardaguclu Â· kubernetes&#x2F;kubernetes</li></ul><p>è¿™ä¸ª PR è¯´èµ·æ¥æ˜¯æ¯”è¾ƒå°çš„ä¸€ä¸ªæ”¹åŠ¨ï¼Œä½†æ˜¯å®ƒçš„å½±å“å´å¾ˆå¤§ã€‚</p><p>åœ¨è¿™ä¸ª PR ä¸­å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ <code>KUBECACHEDIR</code> ç¯å¢ƒå˜é‡ï¼Œæ¥æ›¿ä»£é»˜è®¤çš„ <code>~/.kube/cache</code> ç¼“å­˜ç›®å½•ã€‚é€šè¿‡è¿™ä¸ª PR å°±æœ‰å¯èƒ½ä¼šå¯¼è‡´ç”¨æˆ·åœ¨ä½¿ç”¨ kubectl çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªç¯å¢ƒå˜é‡æ¥è·³è¿‡ ç¼“å­˜ã€‚è¿›è€Œå¯èƒ½ä¼šå¼•èµ·ä¸€äº›æ€§èƒ½é—®é¢˜ã€‚</p><ul><li>kube-apiserver: default --enable-logs-handler flag to false Â· kubernetes&#x2F;kubernetes</li></ul><p>kube-apiserver ä¸­çš„ <code>/logs</code> ç”±äºå®‰å…¨é—®é¢˜ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šè¿›è¡Œå…³é—­ï¼Œç„¶åé€šè¿‡ <code>--enable-logs-handler</code> æ ‡ç­¾è¿›è¡Œå¯ç”¨ã€‚å¦‚æœè¦è¿›è¡Œæ—¥å¿—é‡‡é›†çš„è¯ï¼Œéœ€è¦é¢å¤–æ³¨æ„ä¸‹ã€‚</p><ul><li><code>#111060 Â· kubernetes/kubernetes</code></li></ul><p>kube-proxy çš„ container image å°†è¦å˜æ›´ä¸º distroless çš„äº†ã€‚è¿™å¯ä»¥è§„é¿å¾ˆå¤šå®‰å…¨éšæ‚£ï¼Œæå‡é›†ç¾¤çš„å®‰å…¨æ€§ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯ Kubernetes v1.25 ä¸­æ¯”è¾ƒå€¼å¾—å…³æ³¨çš„å†…å®¹ã€‚åœ¨è¿›è¡Œé›†ç¾¤å‡çº§å‰ä¸€å®šè¦æ³¨æ„æ£€æŸ¥ã€‚å¥½äº†ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ï¼</p><h1 id="Kubernetes-v1-26"><a href="#Kubernetes-v1-26" class="headerlink" title="Kubernetes v1.26"></a>Kubernetes v1.26</h1><p>Kubernetes v1.26 æ˜¯ 2022 å¹´çš„æœ€åä¸€ä¸ªå¤§ç‰ˆæœ¬æ›´æ–°ï¼ŒåŒ…å«äº† 37 é¡¹ä¸»è¦çš„æ›´æ–°ã€‚</p><p>8 æœˆåº•æ­£å¼å‘å¸ƒçš„ v1.25 ä¸­åŒ…å« 40 é¡¹ã€‚</p><p>åœ¨ v1.26 ä¸­åŒ…å«äº†å¾ˆå¤šç›´æ¥å½±å“ç”¨æˆ·ä¸ Kubernetes äº¤äº’ç›¸å…³çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ä»¥ä¸‹å†…å®¹ä¸­ä¼šä»‹ç»çš„å…è®¸è·¨ namespace æŒä¹…åŒ–å·å¿«ç…§å¼•ç”¨ï¼›å…è®¸ç”¨æˆ·æ— éœ€é¢å¤–çš„ exporter å³å¯è‡ªå®šä¹‰ Service Level Indicator(SLI); kubectl events è¾¾åˆ° Betaï¼›æ”¯æŒ Pod æ‰€éœ€èµ„æºå°±ç»ªåå†è¿›è¡Œè°ƒåº¦ï¼›æ”¯æŒä½¿ç”¨ OpenAPI v3 ç­‰ã€‚</p><p>ä»¥åŠé’ˆå¯¹é«˜æ€§èƒ½è´Ÿè½½è¿è¡Œåœ¨å“ªä¸ªç‰©ç† CPU çš„åœºæ™¯æ”¯æŒã€‚</p><h2 id="3294-å…è®¸è·¨-namespace-æŒä¹…åŒ–å·å¿«ç…§å¼•ç”¨"><a href="#3294-å…è®¸è·¨-namespace-æŒä¹…åŒ–å·å¿«ç…§å¼•ç”¨" class="headerlink" title="#3294 å…è®¸è·¨ namespace æŒä¹…åŒ–å·å¿«ç…§å¼•ç”¨"></a><code>#3294</code> å…è®¸è·¨ namespace æŒä¹…åŒ–å·å¿«ç…§å¼•ç”¨</h2><p>åœ¨ Kubernetes ä¸­ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>VolumeSnapshot</code> ç‰¹æ€§ï¼Œä»å·å¿«ç…§åˆ›å»ºæ–°çš„æŒä¹…åŒ–å·ã€‚è¿™æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œæ¯”å¦‚è¯´ DBA å¯ä»¥åœ¨è¿›è¡Œæ•°æ®åº“å¤§çš„å˜æ›´&#x2F;è¿ç§»æ“ä½œå‰ï¼Œå¯¹æŒä¹…åŒ–å·åšä¸€æ¬¡å¿«ç…§ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™å¯ä»¥ç›´æ¥ä»è¯¥å¿«ç…§æ¢å¤æ•°æ®åº“ä¹‹å‰çš„çŠ¶æ€ã€‚</p><p>ä¾‹å¦‚é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯ä»¥åŠ¨æ€çš„åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">snapshot.storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VolumeSnapshotClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-snapclass</span></span><br><span class="line"><span class="attr">driver:</span> <span class="string">testdriver.csi.k8s.io</span></span><br><span class="line"><span class="attr">deletionPolicy:</span> <span class="string">Delete</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="attr">csi.storage.k8s.io/snapshotter-secret-name:</span> <span class="string">mysecret</span></span><br><span class="line">  <span class="attr">csi.storage.k8s.io/snapshotter-secret-namespace:</span> <span class="string">mysecretnamespace</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">snapshot.storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">VolumeSnapshot</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-snapshot</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ns1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">volumeSnapshotClassName:</span> <span class="string">test-snapclass</span></span><br><span class="line">  <span class="attr">source:</span></span><br><span class="line">    <span class="attr">persistentVolumeClaimName:</span> <span class="string">test-pvc</span></span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œè¿™é‡Œä¹Ÿæœ‰äº›éœ€è¦æ³¨æ„çš„ç‚¹ï¼Œè¯¥åŠŸèƒ½åªèƒ½ç”¨äº CSI å­˜å‚¨é©±åŠ¨ï¼Œå¹¶ä¸”è¯¥åŠŸèƒ½æ˜¯è‡ª Kubernetes v1.17 è¾¾åˆ° betaï¼Œv1.20 æ­£å¼ GA çš„ã€‚</p><p>åœ¨ v1.26 ä¸­å¢åŠ çš„ç‰¹æ€§æ˜¯ <code>CrossNamespaceVolumeDataSource</code> å½“å‰æ˜¯ Alpha é˜¶æ®µï¼Œå…è®¸åˆ›å»ºæŒä¹…åŒ–å·çš„æ—¶å€™ï¼Œè·¨ namespace å¼•ç”¨å·å¿«ç…§ã€‚å®ƒçš„ä¸»è¦ä»·å€¼åœ¨äºï¼Œæ¯”å¦‚æƒ³è¦åšåº”ç”¨è·¨ namespace è¿ç§»çš„æ—¶å€™ï¼Œç›´æ¥ä»å¦ä¸€ä¸ª namespace å¯¹æŒä¹…åŒ–å·åšå¿«ç…§ï¼Œç„¶åä½¿ç”¨å¿«ç…§åˆ›å»º PVC å³å¯å¾ˆè½»æ¾çš„å®Œæˆè¿ç§»ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">testvolumeclaim</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">nstest1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">mystorageclass</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">2Gi</span></span><br><span class="line">  <span class="attr">dataSourceRef:</span></span><br><span class="line">    <span class="attr">apiGroup:</span> <span class="string">snapshot.storage.k8s.io</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">VolumeSnapshot</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">testsnapshot</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">moelove</span></span><br><span class="line">  <span class="attr">volumeMode:</span> <span class="string">Filesystem</span></span><br></pre></td></tr></table></figure><p>å½“ç„¶å¦‚æœè€ƒè™‘æˆæƒç›¸å…³é—®é¢˜çš„è¯ï¼Œè¿™é‡Œä½¿ç”¨ Gateway API çš„ ReferenceGrant æ¥æ§åˆ¶æˆæƒã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">gateway.networking.k8s.io/v1alpha2</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReferenceGrant</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">moelove</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">from:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">group:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">nstest1</span></span><br><span class="line">  <span class="attr">to:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">group:</span> <span class="string">snapshot.storage.k8s.io</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">VolumeSnapshot</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">testsnapshot</span></span><br></pre></td></tr></table></figure><p>æˆ‘è®¤ä¸ºè¿™æ˜¯ä¸ªå¾ˆå®ç”¨çš„åŠŸèƒ½ã€‚</p><h2 id="3488-å…è®¸ä½¿ç”¨-CEL-è¿›è¡Œ-Admission-Control"><a href="#3488-å…è®¸ä½¿ç”¨-CEL-è¿›è¡Œ-Admission-Control" class="headerlink" title="#3488 å…è®¸ä½¿ç”¨ CEL è¿›è¡Œ Admission Control"></a><code>#3488</code> å…è®¸ä½¿ç”¨ CEL è¿›è¡Œ Admission Control</h2><p>è¿™ç¯‡ <a target="_blank" rel="noopener external nofollow noreferrer" href="http://mp.weixin.qq.com/s?__biz=MzI2ODAwMzUwNA==&mid=2649297076&idx=1&sn=4d6a86220535a0aaa9fdbcbaf66625f4&chksm=f2eb816bc59c087db1ff984e94e449cb9bd6ee6efd18cf25cf946f3019532e56463629e2f1e0&scene=21#wechat_redirect">K8S ç”Ÿæ€å‘¨æŠ¥| Kubernetes v1.23.0 æ­£å¼å‘å¸ƒï¼Œæ–°ç‰¹æ€§ä¸€è§ˆ | MoeLove</a> æ–‡ç« ä¸­ï¼Œæ›¾ä»‹ç»è¿‡ Kubernetes ä¸­å¼•å…¥äº† Common Expression Language (CEL) è¿›è¡Œ CRD Validationã€‚è¯¥ç‰¹æ€§åœ¨ v1.25 è¾¾åˆ° Betaã€‚</p><p>ä¾‹å¦‚ï¼ŒæŸä¸ª CRDs çš„å†…å®¹å¦‚ä¸‹ï¼Œå…¶ä¸­å®šä¹‰äº† <code>minReplicas</code> å°äº <code>replicas</code> å¹¶ä¸” <code>replicas</code> å°äº <code>maxReplicas</code> ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"><span class="attr">openAPIV3Schema:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">  <span class="attr">properties:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">      <span class="attr">x-kubernetes-validation-rules:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">rule:</span> <span class="string">&quot;self.minReplicas &lt;= self.replicas&quot;</span></span><br><span class="line">          <span class="attr">message:</span> <span class="string">&quot;replicas should be greater than or equal to minReplicas.&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">rule:</span> <span class="string">&quot;self.replicas &lt;= self.maxReplicas&quot;</span></span><br><span class="line">          <span class="attr">message:</span> <span class="string">&quot;replicas should be smaller than or equal to maxReplicas.&quot;</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="string">...</span></span><br><span class="line">        <span class="attr">minReplicas:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">        <span class="attr">replicas:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">        <span class="attr">maxReplicas:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">      <span class="attr">required:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">minReplicas</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">replicas</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">maxReplicas</span> </span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œå½“æœ‰å¦‚ä¸‹çš„è‡ªå®šä¹‰èµ„æºåˆ›å»ºæ—¶ï¼ŒKubernetes å°†ä¼šæ‹’ç»å…¶è¯·æ±‚ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">&quot;stable.example.com/v1&quot;</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomDeployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-new-deploy-object</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">minReplicas:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">20</span></span><br><span class="line">  <span class="attr">maxReplicas:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><p>å¹¶ä¸”è¿”å›å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">The</span> <span class="string">CustomDeployment</span> <span class="string">&quot;my-new-deploy-object&quot;</span> <span class="attr">is invalid:</span></span><br><span class="line"><span class="string">*</span> <span class="attr">spec: Invalid value:</span> <span class="string">map[string]interface</span> &#123;&#125;&#123;<span class="string">&quot;maxReplicas&quot;</span><span class="string">:10</span>, <span class="string">&quot;minReplicas&quot;</span><span class="string">:0</span>, <span class="string">&quot;replicas&quot;</span><span class="string">:20</span>&#125;<span class="string">:</span> <span class="string">replicas</span> <span class="string">should</span> <span class="string">be</span> <span class="string">smaller</span> <span class="string">than</span> <span class="string">or</span> <span class="string">equal</span> <span class="string">to</span> <span class="string">maxReplicas.</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¿‡ç¨‹çœ‹èµ·æ¥å’Œ Admission controller åšçš„äº‹æƒ…å¾ˆåƒã€‚å½“ç„¶ï¼Œæˆ‘ä¹‹å‰ä¹Ÿå†™äº†ä¸€ç¯‡æ–‡ç«  ã€Š<a target="_blank" rel="noopener external nofollow noreferrer" href="http://mp.weixin.qq.com/s?__biz=MzI2ODAwMzUwNA==&mid=2649296994&idx=2&sn=60686fcebaacff30b9762a6229e85d12&chksm=f2eb81bdc59c08ab0f10013ed2bda48a7f3f5f3e0d335b7f1cdbbbce6e5b81656b487e9955d8&scene=21#wechat_redirect">ç†æ¸… Kubernetes ä¸­çš„å‡†å…¥æ§åˆ¶ï¼ˆAdmission Controller) | MoeLove</a>ã€‹ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å†ç¿»çœ‹ä¸‹ã€‚</p><p>å›åˆ°æˆ‘ä»¬èŠåˆ°è¿™ä¸ªç‰¹æ€§ä¸­ï¼Œå¯ä»¥è®¤ä¸ºè¿™æ˜¯ä¸€ç§å¯¹ Admission webhook çš„æ›¿ä»£ï¼Œç”¨ä¸€ç§æ›´åŠ åŸç”Ÿï¼Œç›´è§‚ï¼Œå¹¶ä¸”å£°æ˜å¼çš„æ–¹å¼æ¥è¿›è¡Œç®¡ç†ã€‚</p><p>è¿™é‡Œå¼•å…¥äº†ä¸€ä¸ªæ–°çš„èµ„æº <code>ValidatingAdmissionPolicy</code> ï¼Œä½¿ç”¨èµ·æ¥å¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">admissionregistration.k8s.io/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ValidatingAdmissionPolicy</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">&quot;demo-policy.moelove.info&quot;</span></span><br><span class="line"><span class="attr">Spec:</span></span><br><span class="line">  <span class="attr">failurePolicy:</span> <span class="string">Fail</span></span><br><span class="line">  <span class="attr">matchConstraints:</span></span><br><span class="line">    <span class="attr">resourceRules:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">apiGroups:</span>   [<span class="string">&quot;apps&quot;</span>]</span><br><span class="line">      <span class="attr">apiVersions:</span> [<span class="string">&quot;v1&quot;</span>]</span><br><span class="line">      <span class="attr">operations:</span>  [<span class="string">&quot;CREATE&quot;</span>, <span class="string">&quot;UPDATE&quot;</span>]</span><br><span class="line">      <span class="attr">resources:</span>   [<span class="string">&quot;deployments&quot;</span>]</span><br><span class="line">  <span class="attr">validations:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">expression:</span> <span class="string">&quot;object.spec.replicas &lt;= 2&quot;</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°é…ç½®å°†ä¼šæ‹’ç» replicas ä¸å¤§äº 2 çš„ Deploymentã€‚</p><p>è¿™ä¸ªç‰¹æ€§çš„ä¼˜åŠ¿å°±åœ¨äºæ— éœ€é¢å¤–çš„å…¶ä»–ç»„ä»¶ï¼Œé™¤äº†éœ€è¦å­¦ä¹  CEL å¤–ï¼Œè¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ã€‚è¯¥ç‰¹æ€§ç›®å‰æ˜¯ alpha çº§åˆ«ã€‚</p><h2 id="3545-æ”¹å–„-NUMA-ä¸­çš„æ‹“æ‰‘ç®¡ç†"><a href="#3545-æ”¹å–„-NUMA-ä¸­çš„æ‹“æ‰‘ç®¡ç†" class="headerlink" title="#3545 æ”¹å–„ NUMA ä¸­çš„æ‹“æ‰‘ç®¡ç†"></a><code>#3545</code> æ”¹å–„ NUMA ä¸­çš„æ‹“æ‰‘ç®¡ç†</h2><p>åœ¨æ–‡ç«  <a target="_blank" rel="noopener external nofollow noreferrer" href="http://mp.weixin.qq.com/s?__biz=MzI2ODAwMzUwNA==&mid=2649295985&idx=1&sn=3167c6b2bc11f2e2a0e684f654ed8d75&chksm=f2eb9daec59c14b87fa906e866e7fe62b0c6ec2eedb94859c2036fd53aac5b1c8e31355e6c20&scene=21#wechat_redirect">K8S ç”Ÿæ€å‘¨æŠ¥| Kubernetes v1.21 å‘å¸ƒ, å¸¦æ¥æ–°çš„å†…å­˜ç®¡ç†å™¨ | MoeLove</a> ä¸­ä»‹ç»ï¼ŒKubernetes v1.21 ä¸­åœ¨ kubelet ä¸­æ–°å¢äº†ä¸€ä¸ªå†…å­˜ç®¡ç†å™¨ã€‚</p><p>ä¸»è¦æ˜¯ä¸ºäº†åº”å¯¹å¤š NUMA ç»“æ„ä¸‹çš„æ•ˆç‡ã€‚å¤š NUMA ç»“æ„ä¸‹ï¼Œä¸ºäº†ä¿è¯æ•ˆç‡ï¼Œæ‰€ä»¥ä¼šæŒ‰å†…å­˜å’Œ CPU çš„ç›¸å¯¹è·ç¦»æ¥æŒ‰ node å®šä¹‰æ˜¯å¦ä¸º local memory æˆ–è€…è¯´æœ¬åœ°å†…å­˜ï¼ŒåŒæ—¶ç”±äºå®é™…ä½ç½®ä¸åŒï¼Œæ‰€ä»¥å°±å¯èƒ½ä¼šäº§ç”Ÿå†…å­˜åˆ†é…ä¸å‡åŒ€çš„æƒ…å†µäº†ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ numactl ç®¡ç†å·¥å…·æŸ¥çœ‹ä¸‹å½“å‰æœºå™¨ä¸Šçš„æƒ…å†µï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[tao@moelove ~]<span class="comment"># numactl -H</span></span><br><span class="line">available: 2 nodes (0-1)</span><br><span class="line">node 0 cpus: 0 1 2 3 4 5 6 7 8 9 20 21 22 23 24 25 26 27 28 29</span><br><span class="line">node 0 size: 65186 MB</span><br><span class="line">node 0 free: 9769 MB</span><br><span class="line">node 1 cpus: 10 11 12 13 14 15 16 17 18 19 30 31 32 33 34 35 36 37 38 39</span><br><span class="line">node 1 size: 65536 MB</span><br><span class="line">node 1 free: 15206 MB</span><br><span class="line">node distances:</span><br><span class="line">node   0   1 </span><br><span class="line">  0:  10  21 </span><br><span class="line">  1:  21  10 </span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨æˆ‘å½“å‰çš„è¿™å°æœºå™¨ä¸Šå°±å­˜åœ¨ç€æ¯”è¾ƒæ˜æ˜¾çš„å†…å­˜åˆ†é…ä¸å‡çš„æƒ…å†µã€‚æ‰€ä»¥å½“æŸä¸ªè¿›ç¨‹è¾¾åˆ°äº†å…¶ local memory çš„ä¸Šé™ï¼Œé‚£è‡ªç„¶å°±ä¼šå½±å“åˆ°å®ƒçš„æ€§èƒ½ã€‚æˆ‘æœ€æ—©æŠ˜è…¾ NUMA ç›¸å…³é—®é¢˜æ˜¯åœ¨å‰äº›å¹´å¤§é‡ä½¿ç”¨ MongoDB çš„æ—¶å€™ï¼Œåœ¨è¿™ä¸Šé¢ä¹ŸèŠ±äº†äº›æ—¶é—´ï¼Œä¸è¿‡è¿™ä¹Ÿä¸å½±å“æˆ‘å¯¹ MongoDB çš„å–œçˆ±~</p><p>è¿™æ¬¡åœ¨ kubelet ä¸­å¢åŠ çš„å†…å­˜ç®¡ç†å™¨ä¾¿å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥åœ¨å¯åŠ¨ kubelet çš„æ—¶å€™é€šè¿‡ <code>--reserved-memory</code> ä»¥åŠé…åˆ <code>--memory-manager-policy</code> ç­‰å‚æ•°æ¥ä¸€èµ·è®¾ç½®ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--memory-manager-policy static --reserved-memory 0:memory=1Gi,hugepages-1M=2Gi --reserved-memory 1:memory=2Gi</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š<code>memory-manager-policy</code> å¿…é¡»è®¾ç½®ä¸º staticï¼Œå¦‚æœä¸è®¾ç½®åˆ™é»˜è®¤ä¸º noneï¼Œå³ä¸é‡‡å–ä»»ä½•è¡Œä¸ºã€‚</p><p>ä¸è¿‡è¿™ä¸ªç‰¹æ€§è¿˜åœ¨è¾ƒæ—©æœŸçš„é˜¶æ®µï¼Œç›®å‰åªä¸º <code>Guaranteed</code> QoS ç±»çš„ Pod æä¾›æ”¯æŒã€‚å¦å¤–ï¼Œå¦‚æœæ­£ç¡®å¯ç”¨äº†æ­¤ç‰¹æ€§ï¼Œåˆ™åœ¨æœºå™¨çš„ <code>/var/lib/kubelet/memory_manager_state</code> å¯ä»¥çœ‹åˆ°å…¶è¯¦ç»†ä¿¡æ¯ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/1dca4389/640.png" title="å›¾ç‰‡"><p>æœ€ç»ˆå°†ä¼šå½±å“åˆ°æ‹“æ‰‘ç®¡ç†å™¨ã€‚</p><p>ç„¶ååœ¨ Kubernetes v1.22 åˆ™ç»§ç»­åœ¨ kubelet ä¸­å¢åŠ äº†å¦ä¸€ä¸ª <code>--cpu-manager-policy-options</code> é€‰é¡¹ï¼Œå¯¹åº”ä¸º CPU ç®¡ç†å™¨ã€‚</p><p>åœ¨ v1.26 ä¸­å¢åŠ çš„åˆ™æ˜¯ <code>--topology-manager-policy-options</code> æ¥æ§åˆ¶æ•´ä½“çš„æ‹“æ‰‘ç®¡ç†ã€‚ç°åœ¨ä»…æ”¯æŒä¸€ä¸ª <code>prefer-closest-numa-nodes=true</code> é…ç½®ï¼Œå½“å¼€å¯æ­¤é…ç½®çš„æ—¶å€™ï¼Œæ‹“æ‰‘ç®¡ç†å™¨å°†å°½é‡åœ¨å•ä¸ª NUMA æˆ–è€…å°½å¯èƒ½å°‘çš„ NUMA èŠ‚ç‚¹ä¸­å¯¹é½èµ„æºã€‚</p><p>è¿™å¯¹äºé«˜æ€§èƒ½è´Ÿè½½æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªä¼˜åŒ–ã€‚å»ºè®®å…³æ³¨ã€‚</p><h2 id="113274-ä¸º-Pod-è°ƒåº¦å¢åŠ è°ƒåº¦å°±ç»ªçš„æœºåˆ¶"><a href="#113274-ä¸º-Pod-è°ƒåº¦å¢åŠ è°ƒåº¦å°±ç»ªçš„æœºåˆ¶" class="headerlink" title="#113274 ä¸º Pod è°ƒåº¦å¢åŠ è°ƒåº¦å°±ç»ªçš„æœºåˆ¶"></a><code>#113274</code> ä¸º Pod è°ƒåº¦å¢åŠ è°ƒåº¦å°±ç»ªçš„æœºåˆ¶</h2><p>è¿™æ˜¯ KEP 3521 çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚</p><p>é¦–å…ˆç®€å•çš„å›é¡¾ä¸€ä¸‹ Pod çš„åˆ›å»ºè¿‡ç¨‹ã€‚</p><p>å½“ client é€šè¿‡ kube-apiserver åˆ›å»ºæˆåŠŸ Pod èµ„æºåï¼Œkube-scheduler ä¼šå»æ£€æŸ¥å°šæœªè¢«è°ƒåº¦çš„ Podï¼Œç„¶åä¸ºå…¶è¿›è¡Œè°ƒåº¦ï¼Œåˆ†é… Nodeã€‚ä¹‹å Node è·å–åˆ°è°ƒåº¦åˆ°è¯¥ Node ä¸Šçš„ Pod ç„¶åè¿›è¡Œåˆ›å»ºã€‚è¿™é‡Œçœç•¥äº†å¾ˆå¤šç»†èŠ‚ï¼Œä½†å…¶ä»–çš„éƒ¨åˆ†ä¸æˆ‘ä»¬æ­¤å¤„è¦ä»‹ç»çš„å†…å®¹å…³ç³»ä¸å¤ªå¤§ï¼Œå°±ä¸å±•å¼€äº†ã€‚</p><p>æ ¹æ®ä¸Šè¿°çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨ Pod åˆ›å»ºæˆåŠŸåï¼Œå…¶å®å°±é»˜è®¤è¯¥ Pod æ˜¯å¯ä»¥è¢«è°ƒåº¦äº†ï¼Œkube-scheduler å°±åº”è¯¥å¼€å§‹å·¥ä½œäº†ã€‚</p><p>ä½†åœ¨å®é™…çš„åœºæ™¯ä¸­ï¼ŒPod é€šå¸¸è¿˜ä¼šéœ€è¦ä¸€äº›å…¶ä»–çš„èµ„æºï¼Œæœ€å…¸å‹çš„æ¯”å¦‚å­˜å‚¨ã€‚åœ¨ä¸€äº›ç¯å¢ƒä¸­ï¼Œè¿™äº›èµ„æºæ˜¯éœ€è¦é¢„å…ˆè¿›è¡Œåˆ›å»ºçš„ï¼Œ<strong>å°¤å…¶æ˜¯åœ¨ä¸€äº›äº‘å‚å•†çš„åœºæ™¯ä¸­ï¼Œè¿˜éœ€è¦æ£€æŸ¥ç”¨æˆ·è´¦æˆ·ä¸­æ˜¯å¦è¿˜æœ‰ä½™é¢å¯ä»¥ç”¨äºåˆ›å»ºäº‘ç›˜ç­‰</strong>ã€‚</p><p>ä¸€ä½†å‰ç½®çš„ä¾èµ–æ— æ³•æ»¡è¶³ï¼Œå‡å¦‚ kube-scheduler å·²ç»å®Œæˆäº† Pod çš„è°ƒåº¦ï¼Œé‚£ä¹ˆ kubelet ä¾§å°±ä¼šå¤„äºå°è¯•åˆ›å»º Pod ï¼Œä½†å¤±è´¥çš„æƒ…å†µã€‚</p><p>è¿™ä¸ª KEP çš„å‡ºç°å°±å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¢åŠ äº†ä¸€ä¸ª Pod æ˜¯å¦å‡†å¤‡å¥½è¢«è°ƒåº¦çš„æœºåˆ¶ã€‚å¦‚æœå‰ç½®ä¾èµ–ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆ Pod å°±æ— éœ€è¢«è°ƒåº¦ï¼Œè¿™ä¹Ÿä¸ä¼šæ¶ˆè€—èµ„æºã€‚kube-scheduler å’Œ kubelet éƒ½æ— éœ€è¿›è¡Œå¤„ç†ã€‚å¾…æ¡ä»¶æ»¡è¶³ï¼ŒPod å†è¢«è°ƒåº¦å’Œåˆ›å»ºå³å¯ã€‚</p><p>è¿™ä¸ªæœºåˆ¶æˆ‘ä¸ªäººæ„Ÿè§‰è¿˜æ˜¯æŒºå¥½çš„ï¼Œç”šè‡³æˆ‘å¯ä»¥æœ‰æ›´çµæ´»çš„ç­–ç•¥æ¥æ§åˆ¶åº”ç”¨çš„å‰¯æœ¬ã€‚æ¯”å¦‚åœ¨å¤§æµé‡ï¼Œéœ€è¦åŠ¨æ€æ‰©å®¹çš„åœºæ™¯ä¸‹ï¼Œæˆ‘å¯ä»¥åˆ©ç”¨æ­¤æœºåˆ¶é¢„å…ˆåˆ›å»ºä¸€äº› Pod èµ„æºä»¥åŠå‡†å¤‡å¥½å®ƒçš„ä¾èµ–ï¼Œ ç”šè‡³å¯ä»¥åœ¨ Node ä¸Šå‡†å¤‡å¥½é•œåƒç­‰ã€‚å½“éœ€è¦å¢åŠ å‰¯æœ¬æ—¶ï¼Œç›´æ¥æ ‡è®° Pod å¯è¢«è°ƒåº¦ï¼Œ è¿™æ ·å°±å¯ä»¥æ›´å¿«çš„åœ¨ Node ä¸Šæ‹‰èµ· Pod äº†ã€‚</p><h2 id="ç§»é™¤-CRI-v1alpha2"><a href="#ç§»é™¤-CRI-v1alpha2" class="headerlink" title="ç§»é™¤ CRI v1alpha2"></a>ç§»é™¤ CRI v1alpha2</h2><p>åœ¨ç§»é™¤äº† dockershim çš„æ”¯æŒåï¼Œ ç°åœ¨ç»ˆäºåˆ æ‰äº† CRI v1alpha2 çš„ä»£ç ï¼Œè¿™æ„å‘³ç€ä¹‹åæ‰€æœ‰å®ç°äº† CRI çš„è¿è¡Œæ—¶ï¼Œéƒ½å¿…é¡»å®ç° CRI v1 çš„æ¥å£ã€‚</p><p>ç›®å‰ containerd çš„ CRI v1 æ¥å£å·²ç»å®ç°äº†ï¼Œæ‰€ä»¥åœ¨ Kubernetes v1.26 å‘å¸ƒåï¼Œä¹Ÿå¯ä»¥æ”¾å¿ƒçš„ä½¿ç”¨ containerd ä½œä¸ºå…¶è¿è¡Œæ—¶ã€‚</p><p>ä¸è¿‡ï¼Œä½ æ˜¯å¦è¿˜è®°å¾— cri-dockerd å‘¢ï¼Ÿç”¨äºå°† Docker ä½œä¸º Kubernetes è¿è¡Œæ—¶çš„ç»„ä»¶ï¼Œç°åœ¨ç”± Mirantis è¿›è¡Œç»´æŠ¤ï¼Œ æ­¤é¡¹ç›®ç›®å‰çš„ç»´æŠ¤è€…æ¯”è¾ƒå°‘ï¼Œç›®å‰è¿˜åªæ”¯æŒ CRI v1alpha2 ï¼Œæ‰€ä»¥ï¼Œå¦‚æœä½ åœ¨ä½¿ç”¨æ­¤é¡¹ç›®è®© Docker ä½œä¸ºè¿è¡Œæ—¶ï¼Œå¹¶ä¸”æƒ³è¦å‡çº§åˆ° Kubernetes v1.26 çš„è¯ï¼Œè¿™æ˜¯ä¸è¡Œçš„ã€‚</p><h2 id="111333-Auth-API-å…è®¸è·å–-User-å±æ€§"><a href="#111333-Auth-API-å…è®¸è·å–-User-å±æ€§" class="headerlink" title="#111333 Auth API å…è®¸è·å– User å±æ€§"></a><code>#111333</code> Auth API å…è®¸è·å– User å±æ€§</h2><p>è¿™æ˜¯ KEP-3325: Self subject attributes review API å®ç°çš„ä¸€éƒ¨åˆ†ã€‚</p><p>å¤§å®¶æƒ³å¿…éƒ½çŸ¥é“ï¼ŒKubernetes ä¸­å¹¶æ²¡æœ‰ Userï¼ˆç”¨æˆ·ï¼‰çš„èµ„æºï¼Œä½†æ˜¯ Kubernetes ä¸­æœ‰æƒé™æ ¡éªŒçš„æ–¹å¼ï¼Œæ¯”å¦‚æˆ‘ä»¬å¸¸ç”¨åˆ°çš„åˆ©ç”¨ x509 è¯ä¹¦è¿›è¡Œç”¨æˆ·æƒé™ç›¸å…³çš„æ ¡éªŒï¼Œæˆ–è€… é€šè¿‡å¤–éƒ¨çš„ OIDC å’Œ webhook ç­‰è¿›è¡Œæ ¡éªŒã€‚</p><p>æ­¤åŠŸèƒ½å®é™…ä¸Šæ˜¯ä¸ºäº†æ·»åŠ ä¸€ä¸ªæ–°çš„æ¥å£ï¼Œä»¥ä¾¿äºç”¨æˆ·èº«ä»½é€šè¿‡æ ¡éªŒåï¼Œè·å–å…¶æ‰€å…·æœ‰çš„å±æ€§ã€‚è¿™æ ·å°±å¯ä»¥ç®€å•çš„é€šè¿‡å¢åŠ ä¸€ä¸ª <code>kubectl auth whoami</code> çš„å‘½ä»¤ï¼Œæ¥äº†è§£å½“å‰ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯äº†ã€‚è¿™åŠŸèƒ½æ¯”è¾ƒç±»ä¼¼äºæˆ‘ä»¬åš OAuth çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šåšä¸ª UserInfo ä¹‹ç±»çš„æ¥å£ï¼Œç”¨æ¥æŸ¥çœ‹ç”¨æˆ·ç›¸å…³çš„å±æ€§ã€‚</p><p>è¯¥åŠŸèƒ½æ˜¯é€šè¿‡åœ¨ <code>authentication.k8s.io</code> Group ä¸‹æ·»åŠ äº† <code>SelfSubjectReview</code> èµ„æºæ¥å®ç°çš„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SelfSubjectReview contains the user information that the kube-apiserver has about the user making this request.</span></span><br><span class="line"><span class="comment">// When using impersonation, users will receive the user info of the user being impersonated.</span></span><br><span class="line"><span class="keyword">type</span> SelfSubjectReview <span class="keyword">struct</span> &#123;</span><br><span class="line"> metav1.TypeMeta <span class="string">`json:&quot;,inline&quot;`</span></span><br><span class="line"> <span class="comment">// Standard object&#x27;s metadata.</span></span><br><span class="line"> <span class="comment">// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata</span></span><br><span class="line"> <span class="comment">// +optional</span></span><br><span class="line"> metav1.ObjectMeta <span class="string">`json:&quot;metadata,omitempty&quot; protobuf:&quot;bytes,1,opt,name=metadata&quot;`</span></span><br><span class="line"> <span class="comment">// Status is filled in by the server with the user attributes.</span></span><br><span class="line"> Status SelfSubjectReviewStatus <span class="string">`json:&quot;status,omitempty&quot; protobuf:&quot;bytes,2,opt,name=status&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SelfSubjectReviewStatus is filled by the kube-apiserver and sent back to a user.</span></span><br><span class="line"><span class="keyword">type</span> SelfSubjectReviewStatus <span class="keyword">struct</span> &#123;</span><br><span class="line"> <span class="comment">// User attributes of the user making this request.</span></span><br><span class="line"> <span class="comment">// +optional</span></span><br><span class="line"> UserInfo v1.UserInfo <span class="string">`json:&quot;userInfo,omitempty&quot; protobuf:&quot;bytes,1,opt,name=userInfo&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤åŠŸèƒ½åœ¨ v1.26 ç‰ˆæœ¬å¼€å§‹å¼•å…¥ï¼Œå¹¶ä½œä¸º Alpha ç‰¹æ€§æä¾›ï¼Œå¯é€šè¿‡ <code>APISelfSubjectReview</code> feature gate æ§åˆ¶æ˜¯å¦å¯ç”¨ã€‚</p><p>åŒæ—¶ï¼Œæœ¬æ¬¡ä¹Ÿåœ¨ kubectl ä¸­æ·»åŠ äº† <code>kubectl alpha auth whoami</code> å­å‘½ä»¤ï¼Œå¯ç›´æ¥æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„ç›¸å…³å±æ€§ä¿¡æ¯ã€‚å½“æ‰§è¡Œæ­¤å‘½ä»¤åï¼Œä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">authentication.k8s.io/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">SelfSubjectReview</span></span><br><span class="line"><span class="attr">status:</span></span><br><span class="line">  <span class="attr">userInfo:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">tao.moelove.info</span></span><br><span class="line">    <span class="attr">uid:</span> <span class="string">a79aaf30-0c6a-66ed-881d-0888ac1266683</span></span><br><span class="line">    <span class="attr">groups:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">admins</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">speakers</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">system:authenticated</span></span><br><span class="line">    <span class="attr">extra:</span></span><br><span class="line">      <span class="attr">skills:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">reading</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">learning</span></span><br><span class="line">      <span class="attr">subjects:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">kubernetes</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">containers</span></span><br></pre></td></tr></table></figure><h2 id="3386-å‡å°‘-Kubelet-åœ¨-PLEG-ä¸­çš„-CPU-æ¶ˆè€—"><a href="#3386-å‡å°‘-Kubelet-åœ¨-PLEG-ä¸­çš„-CPU-æ¶ˆè€—" class="headerlink" title="#3386 å‡å°‘ Kubelet åœ¨ PLEG ä¸­çš„ CPU æ¶ˆè€—"></a><code>#3386</code> å‡å°‘ Kubelet åœ¨ PLEG ä¸­çš„ CPU æ¶ˆè€—</h2><p>è¿™ä¸ªä¸»è¦æ˜¯ä¸ºäº†å‡å°‘ Kubelet åœ¨è·Ÿè¸ª Pod çŠ¶æ€ PLEG æ—¶çš„ CPU æ¶ˆè€—ã€‚</p><p>å®ƒå°†å‡å°‘ Kubelet çš„ä¸€äº›å®šæœŸè½®è¯¢ï¼Œè€Œæ˜¯å°½å¯èƒ½çš„ä¾èµ–äº CRI çš„é€šçŸ¥ã€‚</p><p>ç»è¿‡è¿™ä¸ªè°ƒæ•´ï¼Œä¹Ÿè®¸åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é‡åˆ°çš„ PLEG é—®é¢˜ä¹Ÿèƒ½å°‘ä¸€ç‚¹å§ã€‚</p><h2 id="å…¶ä»–-1"><a href="#å…¶ä»–-1" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><ul><li>kubeadm: Add the option to cleanup the <code>tmp</code> directory by chendave Â· Pull Request <code>#112172</code> Â· kubernetes&#x2F;kubernetes</li></ul><p>kubeadm æ–°å¢ <code>cleanup-tmp-dir</code> é…ç½®é¡¹ï¼Œåœ¨ <code>kubeadm reset</code> æ—¶ï¼Œå¯ä»¥é€šè¿‡ä¼ é€’æ­¤å‚æ•°å°† kubeadm äº§ç”Ÿçš„ä¸´æ—¶æ–‡ä»¶ç»™æ¸…ç†å¹²å‡€ã€‚</p><ul><li>Avoid propagating &quot;search .&quot; into containers &#x2F;etc&#x2F;resolv.conf by dghubble Â· Pull Request <code>#112157</code> Â· kubernetes&#x2F;kubernetes</li></ul><p>ä» Kubernetes v1.25 å¼€å§‹ï¼Œ<code>/etc/resolv.conf</code> ä¸­çš„ <code>search .</code> ä¼šè¢«ä¼ é€’åˆ°å®¹å™¨å†…ã€‚</p><p>è¿™ä¼šå¯¼è‡´ä»»æ„åŸºäº musl libc ç³»ç»Ÿçš„ DNS æŸ¥è¯¢å¤±è´¥ï¼Œæ¯”å¦‚ä»»ä½•åŸºäº Alpinelinux çš„é•œåƒéƒ½ä¼šå¤±è´¥ã€‚</p><p>è¦éªŒè¯è‡ªå·±çš„é›†ç¾¤æ˜¯å¦ä¼šå—è¯¥é—®é¢˜å½±å“ï¼Œåªéœ€è¦æŸ¥çœ‹ç³»ç»Ÿçš„ <code>/etc/resolv.conf</code> æ–‡ä»¶çš„å†…å®¹å³å¯ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">nameserver</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.53</span></span><br><span class="line"><span class="string">options</span> <span class="string">edns0</span> <span class="string">trust-ad</span></span><br><span class="line"><span class="string">search</span> <span class="string">.</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ä¸Šè¿°çš„æƒ…å†µï¼Œä¸€èˆ¬è¯´æ˜æ˜¯è¢« systemd resove æ¥ç®¡äº†ï¼Œå¹¶ä¸”ä¼šå—åˆ°æ­¤å¤„æè¿°çš„é—®é¢˜æ‰€å½±å“ã€‚</p><ul><li>Fix rollout history bug by brianpursley Â· Pull Request <code>#111093</code> Â· kubernetes&#x2F;kubernetes</li></ul><p>åœ¨æ‰§è¡Œ <code>kubectl rollout history</code> çš„æ—¶å€™å¯ä»¥ä¼ é€’ <code>--revision=3</code> æ‹¿åˆ°æŒ‡å®šç‰ˆæœ¬çš„ä¿¡æ¯ã€‚ä½†æ˜¯å¦‚æœæŒ‡å®šäº† output format ï¼Œåˆ™ <code>--revision</code> å¯èƒ½ä¼šå¤±æ•ˆã€‚é€šè¿‡æ­¤ PR ä¾¿å¯è§£å†³æ­¤é—®é¢˜ï¼Œä½†è¦åˆ° v1.26 æ‰ä¼šæºå¸¦ã€‚</p><ul><li>Expose a pending pods summary in scheudler&#39;s dummper output by Huang-Wei Â· Pull Request <code>#111726</code> Â· kubernetes&#x2F;kubernetes</li></ul><p>è°ƒåº¦ç¨‹åºå¯ä»¥ dump å‡ºæ›´å¤šä¿¡æ¯ã€‚</p><ul><li>Revert &quot;promote LocalStorageCapacityIsolationFSQuotaMonitoring to beta&quot; by rphillips Â· Pull Request <code>#112076</code> Â· kubernetes&#x2F;kubernetes</li></ul><p>ç”±äº OpenShift å›¢é˜Ÿå‘ç°åœ¨ä½¿ç”¨å®ƒçš„æ—¶å€™å­˜åœ¨ä¸€äº›é—®é¢˜, å°† <code>LocalStorageCapacityIsolationFSQuotaMonitoring</code> é‡æ–°å›é€€åˆ° Alpha é˜¶æ®µã€‚</p><ul><li>Removal of GlusterFS code from the repo by humblec Â· Pull Request <code>#112015</code> Â· kubernetes&#x2F;kubernetes</li></ul><p>åœ¨ä¹‹å‰çš„ ã€ŒK8S ç”Ÿæ€å‘¨æŠ¥ã€ä¸­æˆ‘æ›¾ä»‹ç»è¿‡ï¼Œåœ¨ v1.25 ä¸­å°†æ ‘å†…çš„ GlusterFS plugin æ ‡è®°ä¸ºåºŸå¼ƒï¼Œå¹¶å»ºè®®è¿ç§»è‡³ä½¿ç”¨ CSI ï¼Œ å¦‚ä»Šè¿™äº›æ’ä»¶å·²ç»è¢«å½»åº•åˆ é™¤äº†ã€‚</p><ul><li>kubelet: append options to pod if there are multi options in &#x2F;etc&#x2F;resolv.conf by pacoxu Â· Pull Request <code>#112414</code> Â· kubernetes&#x2F;kubernetes</li></ul><p>å½“å‰ kubelet åˆ›å»º Pod çš„æ—¶å€™ï¼Œå¦‚æœ <code>/etc/resolv.conf</code> ä¸­å­˜åœ¨å¤šè¡Œ options é…ç½®ï¼Œåˆ™åªå–æœ€åä¸€è¡Œã€‚</p><p>ä¾‹å¦‚ &#x2F;etc&#x2F;resolv.conf åŒ…å«çš„é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">options timeout:1 </span><br><span class="line">options attempts:3</span><br></pre></td></tr></table></figure><p>åˆ™ Pod ä¸­çš„ &#x2F;etc&#x2F;resolv.conf åªåŒ…å«å¦‚ä¸‹å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options attempts:3</span><br></pre></td></tr></table></figure><p>ä½†äº‹å®ä¸Šå³ä½¿åœ¨ &#x2F;etc&#x2F;resolv.conf ä¸­é…ç½®å¤šè¡Œ options ï¼ŒDNS ä¹Ÿæ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ã€‚æ‰€ä»¥å½“å‰çš„ kubelet è¡Œä¸ºå°±ä¸ä¸€è‡´äº†ã€‚</p><p>é€šè¿‡è¿™ä¸ª PRï¼Œ ä¼šå°†ä¸»æœºçš„ &#x2F;etc&#x2F;resolv.conf ä¸­çš„å¤šè¡Œé…ç½®åˆå¹¶ä¸ºä¸€è¡Œã€‚å¦‚æœè¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œåˆ™ Pod å†…çœ‹åˆ°çš„å°±æ˜¯å¦‚ä¸‹å†…å®¹äº†.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options timeout:1 attempts:3</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹å°±æ˜¯ï¼ŒKubernetes ä¸­çš„é»˜è®¤ DNS ç­–ç•¥å¹¶é <code>default</code>ï¼Œè¿™ä¸ªä¿®æ”¹åªæ˜¯é’ˆå¯¹ <code>default</code> ç­–ç•¥çš„ã€‚</p><ul><li>kubeadm: Inherit <code>dry-run</code> flags for each sub-phases by chendave Â· Pull Request <code>#112945</code> Â· kubernetes&#x2F;kubernetes kubeadm æ‰€æœ‰çš„é˜¶æ®µéƒ½æ”¯æŒäº† dry-run æ¨¡å¼ï¼›</li><li>Add categories to kubectl api-resources wide output and add --categories flag by brianpursley Â· Pull Request <code>#111096</code> Â· kubernetes&#x2F;kubernetes ä¸º <code>kubectl api-resources -o wide</code> çš„è¾“å‡ºä¸­å¢åŠ äº†ä¸€åˆ— &quot;Categories&quot;ï¼›</li><li>add <code>--concurrent-horizontal-pod-autoscaler-syncs</code> flag to kube-controller-manager by zroubalik Â· Pull Request #108501 Â· kubernetes&#x2F;kubernetes ä¸º kube-controller-manager å¢åŠ äº† <code>--concurrent-horizontal-pod-autoscaler-syncs</code> çš„å‚æ•°ï¼ŒåŸå…ˆ HPA ä¸­é»˜è®¤åªæœ‰ä¸€ä¸ª workerï¼Œåœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸­å¤„ç†æ•ˆç‡å¾ˆä½ã€‚æœ¬æ¬¡çš„ PR å¯ä»¥é€šè¿‡æ­¤å‚æ•°æ¥è‡ªè¡Œé…ç½® worker æ•°é‡ï¼Œä»¥ä¾¿äºæå‡æ•ˆç‡ï¼›</li><li>Normalize HTTP lifecycle handlers with HTTP probers by jasimmons Â· Pull Request <code>#86139</code> Â· kubernetes&#x2F;kubernetes</li></ul><p>æˆ‘ä»¬å¯ä»¥ä¸º Pod å¢åŠ  <code>postStart</code> å’Œ <code>preStop</code> çš„ Hookï¼Œå¹¶ä¸”å…¶åˆ†åˆ«å¯ä»¥è®¾ç½®ä¸º <code>Exec</code> æˆ– <code>HTTP</code> æ¨¡å¼ã€‚è¿™ä¸ª PR ä¸»è¦æ˜¯åœ¨ä¿®æ”¹ HTTP æ¨¡å¼ä¸‹çš„è¡Œä¸ºã€‚</p><p>å…·ä½“æ¥è¯´ï¼ŒHTTP æ¨¡å¼ä¸‹çš„ä»£ç ä¸ readiness&#x2F;liveness ä¸‹ä½¿ç”¨çš„å¹¶ä¸ä¸€æ ·ï¼Œè€Œä¸”ä¹Ÿä¸æ”¯æŒä¸€äº›å¸¸è§çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š</p><ul><li>è®¾ç½®è‡ªå®šä¹‰ HTTP header</li><li>ä½¿ç”¨ HTTPS è¿æ¥</li></ul><p>ä½†ç»è¿‡æ­¤ PR ,ç»ˆäºå°†å®ƒä»¬çš„è¡Œä¸ºè¿›è¡Œäº†ç»Ÿä¸€ï¼Œä½†è¿™æ¯•ç«Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„è°ƒæ•´ï¼Œå¦‚æœä½ ä¸å¸Œæœ›åº”ç”¨æ­¤å˜æ›´ï¼Œ å¯ä»¥é€šè¿‡ <code>-feature-gates=ConsistentHTTPGetHandlers=false</code> è¿›è¡Œå…¨å±€ç¦ç”¨ï¼Œé¿å…è¿™ä¸ªåŠŸèƒ½å½±å“åˆ°ä½ çš„ç¯å¢ƒã€‚</p><ul><li>Escape terminal special characters in kubectl by dgl Â· Pull Request <code>#112553</code> Â· kubernetes&#x2F;kubernetes</li></ul><p>è¿™ä¸ª PR ä¸­å¯¹ä¸€äº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è½¬ä¹‰ã€‚è¿™å…¶å®æ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„å†…å®¹ï¼Œæˆ‘æ¥ç¨å¾®ä»‹ç»ä¸€ä¸‹ã€‚</p><p>ä½ å¯ä»¥åœ¨è‡ªå·±çš„ç»ˆç«¯ä¸­å°è¯•æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f - &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;apiVersion&quot;: &quot;v1&quot;,</span></span><br><span class="line"><span class="string">    &quot;involvedObject&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;kind&quot;: &quot;Node&quot;,</span></span><br><span class="line"><span class="string">        &quot;name&quot;: &quot;node01&quot;,</span></span><br><span class="line"><span class="string">        &quot;uid&quot;: &quot;node01&quot;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;kind&quot;: &quot;Event&quot;,</span></span><br><span class="line"><span class="string">    &quot;message&quot;: &quot;\u001b[2J\u001b[3J\u001b[1;1H\u001b[m spoofed \u001b[60C\u001b[1;0m. Done&quot;,</span></span><br><span class="line"><span class="string">    &quot;metadata&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;name&quot;: &quot;spoofEvent&quot;,</span></span><br><span class="line"><span class="string">        &quot;namespace&quot;: &quot;default&quot;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;source&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;component&quot;: &quot;kubelet&quot;,</span></span><br><span class="line"><span class="string">        &quot;host&quot;: &quot;node01&quot;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;type&quot;: &quot;Normal&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><p>è¿™å°†ä¼šåˆ›å»ºä¸€æ¡ event è®°å½•ï¼Œä½†æ˜¯ä¸€ä½†ä½ æ‰§è¡Œ <code>kubectl get events</code> ä½ å°±ä¼šå‘ç°ä¸€äº›æœ‰è¶£çš„äº‹æƒ…ï¼Œå±å¹•ä¸Šçš„è®°å½•è¢«æ¸…ç©ºäº†ã€‚</p><p>è¿™æ˜¯ç”±äº kubectl åœ¨è¾“å‡ºå†…å®¹çš„æ—¶å€™å¹¶ä¸ä¼šè¿›è¡Œä»»ä½•è½¬ä¹‰ï¼Œæ¯”å¦‚ä¸Šè¿°ç¤ºä¾‹ä¸­åŒ…å«äº†ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼š</p><ul><li><code>\u001b[2J</code>ï¼šæ¸…å±</li><li><code>\u001b[60C</code>: å°†å…‰æ ‡å‘å‰ç§»åŠ¨ 60</li></ul><p>å½“ç„¶è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ï¼Œæˆ‘å°è±¡ä¸­æˆ‘æ—©å¹´åˆšå¼€å§‹æ¥è§¦ Linux ä¸ä¹…åè¿˜èŠ±è´¹äº†ä¸€äº›æ—¶é—´æ¥å­¦ä¹ è¿™äº›ä¸œè¥¿ï¼Œå› ä¸ºè¿™äº›ä¸œè¥¿å¯ä»¥é…ç½®åˆ°ç»ˆç«¯é‡Œé¢ï¼Œå®ç°ä¸€äº›æ¯”å¦‚å˜æ¢é¢œè‰²ä¹‹ç±»çš„äº‹æƒ…ã€‚</p><p>æˆ‘ç¿»äº†ä¸‹æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼Œæ›¾ç»è¿˜æœ‰å°† bash åšè¿‡å¦‚ä¸‹è®¾ç½®ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function git-branch-name &#123;</span><br><span class="line">  git symbolic-ref HEAD <span class="number">2</span>&gt;/dev/null | cut -d<span class="string">&quot;/&quot;</span> -f <span class="number">3</span></span><br><span class="line">  #git rev-parse --abbrev-ref HEAD</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function git-branch-prompt &#123;</span><br><span class="line">  local branch=<span class="string">`git-branch-name`</span></span><br><span class="line">  <span class="keyword">if</span> [ $branch ]; then printf <span class="string">&quot; [%s]&quot;</span> $branch; fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PS1=<span class="string">&quot;\u@\h \[\033[0;36m\]\W\[\033[0m\]\[\033[0;32m\]\$(git-branch-prompt)\[\033[0m\] \$ &quot;</span></span><br></pre></td></tr></table></figure><p>å¯¹æ­¤å†…å®¹æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è¯•è¯•çœ‹æŠŠä¸Šè¿°å†…å®¹è´´åˆ°è‡ªå·±çš„ <code>.bashrc</code> æ–‡ä»¶ä¸­ï¼Œç„¶å <code>source</code> ä¸€ä¸‹çœ‹çœ‹ã€‚</p><p>å›åˆ°è¿™ä¸ª PR ä¸­ï¼Œä¹‹å‰è¿™ä¸ªé—®é¢˜è¿˜ç»™åˆ†é…æˆäº† CVE-2021-25743ï¼Œ ä¿®å¤çš„åŠæ³•ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æ¯”è¾ƒè€—æ—¶è€—åŠ›ï¼Œå°±æ˜¯å¯¹ä¸€äº›è¾“å‡ºçš„ä½ç½®åšäº†è½¬ä¹‰æ“ä½œã€‚</p><p>ä¸è¿‡å¯èƒ½è¿˜æœ‰ä¸€äº›é—æ¼çš„ï¼Œæ¯”å¦‚ <code>kubectl logs</code> ä¹‹ç±»çš„ï¼Œå¯èƒ½ä¹Ÿä¼šå—åˆ°å½±å“ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å»éªŒè¯ä¸€ä¸‹ã€‚</p><ul><li>(kubectl certificates): Remove certificates&#x2F;v1beta1 client usage by ardaguclu Â· Pull Request <code>#111990</code> Â· kubernetes&#x2F;kubernetes</li></ul><p><code>certificates.k8s.io/v1beta1</code> è‡ª Kubernetes v1.19 å·²è¢«åºŸå¼ƒï¼Œé€šè¿‡æ­¤ PR ç§»é™¤ï¼Œå°†åœ¨ v1.26 ç‰ˆæœ¬ä¸­ç”Ÿæ•ˆã€‚</p><p>ä»¥åä½¿ç”¨ <code>certificates.k8s.io/v1</code> å³å¯ã€‚è¿™ä¸ªä¸»è¦æ˜¯å½±å“ <code>kubectl certificate</code> å‘½ä»¤ã€‚</p><h1 id="Kubernetes-v1-27"><a href="#Kubernetes-v1-27" class="headerlink" title="Kubernetes v1.27"></a>Kubernetes v1.27</h1><p><strong>Kubernetes v1.27 æ˜¯ 2023 å¹´çš„ç¬¬ä¸€ä¸ªå¤§ç‰ˆæœ¬æ›´æ–°ï¼ŒåŒ…å«äº†è¿‘ 60 é¡¹ä¸»è¦çš„æ›´æ–°ã€‚</strong> è€Œ 1.26 åªæœ‰ 37 é¡¹ï¼Œæ‰€ä»¥è¿™ä¸ªç‰ˆæœ¬å¯ä»¥è¯´æ˜¯ä¸€ä¸ªå˜åŒ–éå¸¸æ˜¾è‘—çš„ç‰ˆæœ¬äº†ã€‚</p><p><strong>å…¶ä¸­ 18 ä¸ªå¢å¼ºåŠŸèƒ½æ­£åœ¨è¿›å…¥ Alpha é˜¶æ®µï¼Œ29 ä¸ªå°†å‡çº§åˆ° Beta é˜¶æ®µï¼Œè€Œå¦å¤– 13 ä¸ªåˆ™å°†å‡çº§åˆ°ç¨³å®šç‰ˆã€‚</strong></p><p>å°½ç®¡è¿™ä¸ªç‰ˆæœ¬ä¸­åŒ…å«äº†è¿™ä¹ˆå¤šçš„ç‰¹æ€§å˜æ›´ï¼Œä½†å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™ä¸ªç‰ˆæœ¬åº”è¯¥ç®—æ˜¯ç¬¬ä¸€ä¸ªå®Œå…¨æŒ‰ç…§å³å®šæµç¨‹ï¼Œæªå®ˆæ¯ä¸ª deadline çš„ç‰ˆæœ¬ã€‚ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œæ¯æ¬¡éƒ½æˆ–å¤šæˆ–å°‘ä¼šæœ‰ä¸€äº›å˜æ•°ï¼Œä¸è¿‡è¿™ä¹Ÿä»ä¾§é¢å¯ä»¥çœ‹åˆ° release team åšäº†å¾ˆå¤šå¹•åçš„å·¥ä½œã€‚</p><h2 id="SeccompDefault-è¾¾åˆ°-Stable"><a href="#SeccompDefault-è¾¾åˆ°-Stable" class="headerlink" title="SeccompDefault è¾¾åˆ° Stable"></a>SeccompDefault è¾¾åˆ° Stable</h2><p>å¦‚æœæƒ³è¦é»˜è®¤ä½¿ç”¨ seccomp profileï¼Œåˆ™å¿…é¡»åœ¨æ¯ä¸ªæƒ³è¦ä½¿ç”¨å®ƒçš„èŠ‚ç‚¹ä¸Šä¸º kubelet å¯ç”¨ <code>--seccomp-default</code> é€‰é¡¹ã€‚å¦‚æœå¯ç”¨äº†è¯¥é€‰é¡¹ï¼Œåˆ™ kubelet å°†é»˜è®¤ä½¿ç”¨ç”±å®¹å™¨è¿è¡Œæ—¶å®šä¹‰çš„ <code>RuntimeDefault</code> seccomp profileï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <code>Unconfined</code>ï¼ˆç¦ç”¨seccompï¼‰æ¨¡å¼ã€‚â€œ</p><p>é»˜è®¤é…ç½®æ–‡ä»¶æ—¨åœ¨æä¾›å¼ºå¤§çš„å®‰å…¨æ€§è®¾ç½®ï¼Œå¹¶ä¿ç•™å·¥ä½œè´Ÿè½½åŠŸèƒ½ã€‚å®¹å™¨è¿è¡Œæ—¶çš„ä¸åŒå‘å¸ƒç‰ˆæœ¬ä¹‹é—´å¯èƒ½å­˜åœ¨ä¸åŒçš„é»˜è®¤é…ç½®æ–‡ä»¶ã€‚</p><p>å°è±¡é‡Œå¾ˆæ—©ä¹‹å‰ Docker çš„é…ç½®æ–‡ä»¶å°±å› ä¸ºä¿®è¡¥å®‰å…¨æ¼æ´è€Œè°ƒæ•´è¿‡ã€‚</p><h2 id="Pod-è°ƒåº¦å°±ç»ªæœºåˆ¶è¾¾åˆ°-Beta"><a href="#Pod-è°ƒåº¦å°±ç»ªæœºåˆ¶è¾¾åˆ°-Beta" class="headerlink" title="Pod è°ƒåº¦å°±ç»ªæœºåˆ¶è¾¾åˆ° Beta"></a>Pod è°ƒåº¦å°±ç»ªæœºåˆ¶è¾¾åˆ° Beta</h2><p>è¿™ä¸ªåŠŸèƒ½å®é™…ä¸Šæ˜¯ä» Kubernetes v1.26 å¼€å§‹å¢åŠ çš„ã€‚æ˜¯ KEP 3521 çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬æ¥ç®€å•çš„å›é¡¾ä¸€ä¸‹ Pod çš„åˆ›å»ºè¿‡ç¨‹ã€‚</p><p>å½“ client é€šè¿‡ kube-apiserver åˆ›å»ºæˆåŠŸ Pod èµ„æºåï¼Œkube-scheduler ä¼šå»æ£€æŸ¥å°šæœªè¢«è°ƒåº¦çš„ Podï¼Œç„¶åä¸ºå…¶è¿›è¡Œè°ƒåº¦ï¼Œåˆ†é… Nodeã€‚ä¹‹å Node è·å–åˆ°è°ƒåº¦åˆ°è¯¥ Node ä¸Šçš„ Pod ç„¶åè¿›è¡Œåˆ›å»ºã€‚è¿™é‡Œçœç•¥äº†å¾ˆå¤šç»†èŠ‚ï¼Œä½†å…¶ä»–çš„éƒ¨åˆ†ä¸æˆ‘ä»¬æ­¤å¤„è¦ä»‹ç»çš„å†…å®¹å…³ç³»ä¸å¤ªå¤§ï¼Œå°±ä¸å±•å¼€äº†ã€‚</p><p>æ ¹æ®ä¸Šè¿°çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨ Pod åˆ›å»ºæˆåŠŸåï¼Œå…¶å®å°±é»˜è®¤è¯¥ Pod æ˜¯å¯ä»¥è¢«è°ƒåº¦äº†ï¼Œkube-scheduler å°±åº”è¯¥å¼€å§‹å·¥ä½œäº†ã€‚</p><p>ä½†åœ¨å®é™…çš„åœºæ™¯ä¸­ï¼ŒPod é€šå¸¸è¿˜ä¼šéœ€è¦ä¸€äº›å…¶ä»–çš„èµ„æºï¼Œæœ€å…¸å‹çš„æ¯”å¦‚å­˜å‚¨ã€‚åœ¨ä¸€äº›ç¯å¢ƒä¸­ï¼Œè¿™äº›èµ„æºæ˜¯éœ€è¦é¢„å…ˆè¿›è¡Œåˆ›å»ºçš„ï¼Œ<strong>å°¤å…¶æ˜¯åœ¨ä¸€äº›äº‘å‚å•†çš„åœºæ™¯ä¸­ï¼Œè¿˜éœ€è¦æ£€æŸ¥ç”¨æˆ·è´¦æˆ·ä¸­æ˜¯å¦è¿˜æœ‰ä½™é¢å¯ä»¥ç”¨äºåˆ›å»ºäº‘ç›˜ç­‰</strong>ã€‚</p><p>ä¸€ä½†å‰ç½®çš„ä¾èµ–æ— æ³•æ»¡è¶³ï¼Œå‡å¦‚ kube-scheduler å·²ç»å®Œæˆäº† Pod çš„è°ƒåº¦ï¼Œé‚£ä¹ˆ kubelet ä¾§å°±ä¼šå¤„äºå°è¯•åˆ›å»º Pod ï¼Œä½†å¤±è´¥çš„æƒ…å†µã€‚</p><p>è¿™ä¸ª KEP çš„å‡ºç°å°±å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¢åŠ äº†ä¸€ä¸ª Pod æ˜¯å¦å‡†å¤‡å¥½è¢«è°ƒåº¦çš„æœºåˆ¶ã€‚å¦‚æœå‰ç½®ä¾èµ–ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆ Pod å°±æ— éœ€è¢«è°ƒåº¦ï¼Œè¿™ä¹Ÿä¸ä¼šæ¶ˆè€—èµ„æºã€‚kube-scheduler å’Œ kubelet éƒ½æ— éœ€è¿›è¡Œå¤„ç†ã€‚å¾…æ¡ä»¶æ»¡è¶³ï¼ŒPod å†è¢«è°ƒåº¦å’Œåˆ›å»ºå³å¯ã€‚</p><p>è¿™ä¸ªæœºåˆ¶æˆ‘ä¸ªäººæ„Ÿè§‰è¿˜æ˜¯æŒºå¥½çš„ï¼Œç”šè‡³æˆ‘å¯ä»¥æœ‰æ›´çµæ´»çš„ç­–ç•¥æ¥æ§åˆ¶åº”ç”¨çš„å‰¯æœ¬ã€‚æ¯”å¦‚åœ¨å¤§æµé‡ï¼Œéœ€è¦åŠ¨æ€æ‰©å®¹çš„åœºæ™¯ä¸‹ï¼Œæˆ‘å¯ä»¥åˆ©ç”¨æ­¤æœºåˆ¶é¢„å…ˆåˆ›å»ºä¸€äº› Pod èµ„æºä»¥åŠå‡†å¤‡å¥½å®ƒçš„ä¾èµ–ï¼Œ ç”šè‡³å¯ä»¥åœ¨ Node ä¸Šå‡†å¤‡å¥½é•œåƒç­‰ã€‚å½“éœ€è¦å¢åŠ å‰¯æœ¬æ—¶ï¼Œç›´æ¥æ ‡è®° Pod å¯è¢«è°ƒåº¦ï¼Œ</p><p>ä½¿ç”¨æ—¶ï¼Œé€šè¿‡é…ç½® Pod çš„ <code>.spec.schedulingGates</code> å³å¯ã€‚</p><h2 id="æ–°å¢-NodeLogQuery-ç‰¹æ€§-KEP-2258"><a href="#æ–°å¢-NodeLogQuery-ç‰¹æ€§-KEP-2258" class="headerlink" title="æ–°å¢ NodeLogQuery ç‰¹æ€§ - KEP-2258"></a>æ–°å¢ NodeLogQuery ç‰¹æ€§ - KEP-2258</h2><p>æˆ‘ä»¬é€šå¸¸æœ€ä¹ æƒ¯ä½¿ç”¨ <code>kubectl logs</code> å‘½ä»¤æ¥è·å– Kubernetes é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨çš„æ—¥å¿—ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç»™å®ƒä¼ é€’ä¸€äº›å‚æ•°æ¥è°ƒæ•´å®ƒçš„è¿‡æ»¤èŒƒå›´ã€‚</p><p>æ¯”å¦‚ï¼š<code>kubectl logs job/hello</code> æ¥æŒ‡å®šè·å– hello è¿™ä¸ª job çš„æ—¥å¿—ï¼›ä¹Ÿå¯ä»¥å¢åŠ  <code>-l</code> &#x2F; <code>--selector=&#39;&#39;</code> æ¥åŸºäº label è¿›è¡Œè¿‡æ»¤ã€‚</p><p>ä½†è¿™å¹¶æ²¡æœ‰æ‰©å±•åˆ° Node çº§åˆ«çš„æ—¥å¿—ï¼Œæ— æ³•ç›´æ¥è·å–åˆ°æŸä¸ª Node ä¸Šçš„å…¨éƒ¨æ—¥å¿—ï¼Œè¦æƒ³å¾—åˆ°è¿™ä¸ªç»“æœéœ€è¦å†™ä¸€æ®µå¾ˆå¤æ‚çš„ Shell æ¥å®Œæˆã€‚</p><p>å½“å‰ Kubernetes ç¤¾åŒºå·²ç»é€æ¸æä¾›äº†æ›´å¤š Node è°ƒè¯•å·¥å…·ï¼Œæ—¨åœ¨ä¸ºè°ƒè¯• Node æ•…éšœæä¾›ç»Ÿä¸€ä½“éªŒï¼Œå¹¶æ›´å¥½åœ°æ”¯æŒæç®€æ“ä½œç³»ç»Ÿã€‚é€šè¿‡ KEP 2258: add node log query by LorbusChris Â· Pull Request <code>#96120</code> Â· kubernetes&#x2F;kubernetes ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥è¿œç¨‹è·å–åº•å±‚ Node æ—¥å¿—ã€‚ä¸å®¹å™¨æ—¥å¿—è®°å½•ä¸€æ ·ï¼Œè¿™æ˜¯Kubelet APIçš„ä¸€éƒ¨åˆ†ã€‚</p><p>å¯¹äºLinuxç³»ç»Ÿï¼Œå®ƒæŸ¥è¯¢journaldï¼›å¯¹äºWindowsç³»ç»Ÿï¼Œåˆ™æŸ¥è¯¢äº‹ä»¶æ—¥å¿—(Event Log)ã€‚ç›®å‰è¿˜æ²¡æœ‰ä¸“é—¨é’ˆå¯¹æ­¤åŠŸèƒ½çš„ kubectl å‘½ä»¤ï¼Œä½†å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œå°è¯•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(MoeLove) âœ kubectl get --raw <span class="string">&quot;/api/v2/nodes/<span class="variable">$NODE_NAME</span>/proxy/logs/?query=kubelet</span></span><br></pre></td></tr></table></figure><h2 id="åŸºäº-CEL-çš„-Admission-Control"><a href="#åŸºäº-CEL-çš„-Admission-Control" class="headerlink" title="åŸºäº CEL çš„ Admission Control"></a>åŸºäº CEL çš„ Admission Control</h2><p>å¯¹ Kubernetes ä¸­çš„ Adminssion Control æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼š<a target="_blank" rel="noopener external nofollow noreferrer" href="http://mp.weixin.qq.com/s?__biz=MzI2ODAwMzUwNA==&mid=2649296994&idx=2&sn=60686fcebaacff30b9762a6229e85d12&chksm=f2eb81bdc59c08ab0f10013ed2bda48a7f3f5f3e0d335b7f1cdbbbce6e5b81656b487e9955d8&scene=21#wechat_redirect">ç†æ¸… Kubernetes ä¸­çš„å‡†å…¥æ§åˆ¶ï¼ˆAdmission Controller) | MoeLove</a></p><ul><li>KEP-3488: Implement secondary authz for ValidatingAdmissionPolicy by jpbetz Â· Pull Request <code>#116054</code> Â· kubernetes&#x2F;kubernetes</li><li>KEP-3488: Implement Enforcement Actions and Audit Annotations by jpbetz Â· Pull Request <code>#115973</code> Â· kubernetes&#x2F;kubernetes</li></ul><p>Kubernetes åœ¨ v1.26 å¢åŠ äº†ä¸€é¡¹å¾ˆé‡è¦çš„ç‰¹æ€§ï¼Œé‚£å°±æ˜¯å…è®¸ä½¿ç”¨ CEL è¿›è¡Œ Admission Controlï¼Œå…·ä½“å†…å®¹å¯ä»¥å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="noopener external nofollow noreferrer" href="http://mp.weixin.qq.com/s?__biz=MzI2ODAwMzUwNA==&mid=2649298102&idx=1&sn=2bef678dc8ece2b17c492a9a31450d6e&chksm=f2eb8569c59c0c7f3dad16f45941218c59310779759e275120311fe30ded91b88fa1d576028e&scene=21#wechat_redirect">Kubernetes v1.26 æ–°ç‰¹æ€§ä¸€è§ˆ | MoeLove</a></p><p>å…¶ä¸­å¼•å…¥äº†ä¸€ä¸ªæ–°çš„èµ„æº ValidatingAdmissionPolicy ï¼Œä½¿ç”¨èµ·æ¥å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">admissionregistration.k8s.io/v1alpha1</span></span><br><span class="line"> <span class="attr">kind:</span> <span class="string">ValidatingAdmissionPolicy</span></span><br><span class="line"> <span class="attr">metadata:</span></span><br><span class="line">   <span class="attr">name:</span> <span class="string">&quot;demo-policy.moelove.info&quot;</span></span><br><span class="line"> <span class="attr">Spec:</span></span><br><span class="line">   <span class="attr">failurePolicy:</span> <span class="string">Fail</span></span><br><span class="line">   <span class="attr">matchConstraints:</span></span><br><span class="line">     <span class="attr">resourceRules:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">apiGroups:</span>   [<span class="string">&quot;apps&quot;</span>]</span><br><span class="line">       <span class="attr">apiVersions:</span> [<span class="string">&quot;v1&quot;</span>]</span><br><span class="line">       <span class="attr">operations:</span>  [<span class="string">&quot;CREATE&quot;</span>, <span class="string">&quot;UPDATE&quot;</span>]</span><br><span class="line">       <span class="attr">resources:</span>   [<span class="string">&quot;deployments&quot;</span>]</span><br><span class="line">   <span class="attr">validations:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">expression:</span> <span class="string">&quot;object.spec.replicas &lt;= 2&quot;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨å½“æ—¶ä¹Ÿåªæ˜¯å®ç°äº† KEP-3488 çš„ä¸€éƒ¨åˆ†ã€‚</p><p>åœ¨è¿™ä¸ª PR ä¸­æ˜¯åœ¨å®ç° Authz çš„éƒ¨åˆ†ï¼Œè¿™å…è®¸ç”¨ CEL è¡¨è¾¾å¼ç¼–å†™å¤æ‚çš„ admission control è§„åˆ™ï¼Œ æ”¾ç½®åœ¨å£°æ˜å¼èµ„æºä¸­ï¼Œè€Œä¸æ˜¯æ„å»ºå’Œéƒ¨ç½² webhookã€‚</p><p>è™½ç„¶ admission webhook ä¸€ç›´æ˜¯æˆ‘ä»¬çµæ´»çš„ä¸ç¬¬ä¸‰æ–¹å·¥å…·é›†æˆçš„åŸºçŸ³ï¼Œä½†æ˜¯å¯¹äºæ–°ç”¨æˆ·æ¥è¯´ï¼Œå®ƒä»¬æœ‰å¾ˆå¤šå¤æ‚æ€§ï¼Œæ–°çš„ CEL ç³»ç»Ÿæœ‰æœ›æ¥ç®¡ä»…éœ€è¦å¯¹é»˜è®¤è§„åˆ™è¿›è¡Œå°ä¿®æ”¹çš„ç®€å•ç‹¬ç«‹æ¡ˆä¾‹ã€‚</p><p>ä»¥å‰ï¼Œè¡¨è¾¾å¼ä¸Šä¸‹æ–‡ä¼šå…¬å¼€æœ‰å…³å½“å‰è¯·æ±‚å’Œç›®æ ‡èµ„æºçš„ä¿¡æ¯ï¼Œç°åœ¨é€šè¿‡è¿™ä¸ª PR å¯ä»¥åœ¨æˆæƒå±‚ä¸­åŠ¨æ€æ£€æŸ¥ RBAC æƒé™ã€‚ä¸€äº›æœ‰ç”¨çš„åœ°æ–¹å¯èƒ½æ˜¯ä½¿ç”¨ RBAC è¿›è¡Œæ¯ä¸ªå­—æ®µçš„æ›´æ–°æƒé™ï¼Œå…è®¸ RBAC æ£€æŸ¥ç‰¹å®šå¯¹è±¡è€Œä¸ä½¿ç”¨ resourceNames ç³»ç»Ÿï¼Œ æˆ–åŸºäºè¯·æ±‚è€…èº«ä»½é™åˆ¶å¯¹ç¨‹åºæ•æ„Ÿå­—æ®µï¼ˆä¾‹å¦‚ finalizers ï¼‰çš„è®¿é—®è€Œæ— éœ€ç”Ÿæˆå¤æ‚çš„ RBAC ç­–ç•¥ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">authorizer.group(<span class="string">&#x27;&#x27;</span>).resource(<span class="string">&#x27;pods&#x27;</span>).namespace(<span class="string">&#x27;default&#x27;</span>).check(<span class="string">&#x27;create&#x27;</span>).allowed()</span><br><span class="line">authorizer.path(<span class="string">&#x27;/healthz&#x27;</span>).check(<span class="string">&#x27;GET&#x27;</span>).allowed()</span><br><span class="line">authorizer.requestResource.check(<span class="string">&#x27;my-custom-verb&#x27;</span>).allowed()</span><br></pre></td></tr></table></figure><p>æœ¬æ¬¡è¿˜åŠ å…¥äº†<code>#115973</code>ï¼Œè¯¥åŠŸèƒ½å…è®¸åœ¨å¤±è´¥æ—¶ä½œä¸ºä¸»è¦æ“ä½œå‘å‡ºå®¡è®¡æ—¥å¿—äº‹ä»¶ï¼Œæˆ–è€…å¦‚æœéœ€è¦æ›´å¤šæ•°æ®ï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ªæˆ–å¤šä¸ªCELè¡¨è¾¾å¼ï¼Œä»¥æä¾›è¯¦ç»†çš„å€¼ï¼Œ è¿™äº›å€¼å°†å‘é€åˆ°å®¡è®¡å­ç³»ç»Ÿã€‚</p><p>è¿™æ—¢å¯ä»¥åœ¨å¼€å‘æ–°ç­–ç•¥æ—¶æä¾›å¼ºå¤§çš„è°ƒè¯•é€‰é¡¹ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œè¿è¡Œæ—¶åˆ†æã€‚å…¶ä»– CEL admission ç‰¹æ€§åŒ…æ‹¬æˆæœ¬æ£€æŸ¥ï¼Œä»¥é˜²æ­¢æ‚¨ä½¿ç”¨æ‰€æœ‰è¿™äº›æ–°åŠŸèƒ½æ„å¤–æ‹’ç»æœåŠ¡è‡ªå·±çš„ kube-apiserverï¼Œä»¥åŠæ”¹è¿›çš„ç±»å‹æ£€æŸ¥ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒåŸºäº CEL çš„ admission å¤„ç†æœ‰äº†å¾ˆå¤šæ–°çš„åŠŸèƒ½ï¼Œå¸Œæœ›è¿›ä¸€æ­¥å°† webhook æ¨å…¥åˆ°ä¸€ä¸ªæœ‰é™çš„ç”¨ä¾‹ç©ºé—´ä¸­ï¼ˆé˜²æ­¢æ»¥ç”¨ï¼‰ã€‚</p><h2 id="Pod-In-place-åŸåœ°ä¼¸ç¼©èƒ½åŠ›"><a href="#Pod-In-place-åŸåœ°ä¼¸ç¼©èƒ½åŠ›" class="headerlink" title="Pod In-place åŸåœ°ä¼¸ç¼©èƒ½åŠ›"></a>Pod In-place åŸåœ°ä¼¸ç¼©èƒ½åŠ›</h2><p>è¿™ä¸ªåŠŸèƒ½å…è®¸åœ¨ä¸é‡å¯ Pod çš„æƒ…å†µä¸‹ï¼Œæ›´æ–° Pod çš„ resources é…ç½®ã€‚</p><ul><li>In-place Pod Vertical Scaling feature by vinaykul Â· Pull Request #102884 Â· kubernetes&#x2F;kubernetes</li></ul><p>ç»è¿‡ 4 å¹´çš„è§„åˆ’å’Œè‡³å°‘ 2 å¹´çš„å¼€å‘ï¼Œåœ¨ Kubernetes v1.27 ä¸­ç»ˆäºæ¨å‡ºäº† Pod çš„å°±åœ°èµ„æºç¼©æ”¾çš„ç¬¬ä¸€ç‰ˆã€‚è¿™ä¸ªPRå®ç°äº†æ ¸å¿ƒç¼©æ”¾åŠŸèƒ½å’Œä¸€äº›ç›¸å…³çš„APIå¤„ç†ã€‚ä¸»è¦åŠŸèƒ½éå¸¸ç®€å•ï¼Œç°åœ¨å¯ä»¥åœ¨ç°æœ‰å®¹å™¨ä¸Šç¼–è¾‘ <code>resources</code> é…ç½®ï¼Œè€Œä¸ä¼šå¯¼è‡´ API é”™è¯¯ã€‚</p><p>åœ¨çœ‹åˆ°ç¼©æ”¾è¯·æ±‚åï¼ŒKubelet ä¼šç«‹å³é‡‡å–è¡ŒåŠ¨å¹¶æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦æœ‰è¶³å¤Ÿçš„èµ„æºæ¥æ»¡è¶³æ–°çš„è¯·æ±‚ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œå®ƒå°† <code>Status.Resize</code> å­—æ®µè®¾ç½®ä¸º InProgressï¼Œå¹¶ç»§ç»­è¿›è¡Œ CRI è°ƒç”¨å’Œå…¶ä»–å†…éƒ¨æ›´æ–°ã€‚</p><p>å¦‚æœæ–°çš„å¤§å°ä¸åˆé€‚ï¼Œå°†å¯åŠ¨å…¶ä»–çŠ¶æ€æµï¼Œä½†æ€»ä½“ç›®æ ‡ç›¸åŒï¼Œå³å°è¯•åœ¨å¯èƒ½çš„æƒ…å†µä¸‹æä¾›è¯·æ±‚çš„æ›´æ”¹ã€‚è¿˜æœ‰ä¸€ä¸ªæ–°çš„ per-resource ç¼©æ”¾ç­–ç•¥å­—æ®µï¼Œå¯ä»¥è®¾ç½®ä¸º <code>RestartNotRequired</code>ï¼ˆé»˜è®¤å€¼ï¼‰è¡¨ç¤ºä¸éœ€è¦é‡æ–°å¯åŠ¨ï¼ˆä½†æŸäº›è¿è¡Œæ—¶ä»ç„¶å¯èƒ½éœ€è¦è¿™æ ·åšï¼‰ï¼Œ æˆ–è®¾ç½®ä¸º <code>Restart</code> ä»¥å¼ºåˆ¶å…³é—­å’Œé‡æ–°å¯åŠ¨å®¹å™¨ï¼ˆä¾‹å¦‚å…·æœ‰éœ€è¦é‡æ–°è®¡ç®—-Xmx å †å¤§å°æ ‡å¿—çš„ Java åº”ç”¨ï¼‰ã€‚</p><p>ç°åœ¨ç¼ºå°‘ä¸€ä¸ªæ˜¾è‘—çš„ç‰¹æ€§æ˜¯åŸºäºç¼©æ”¾çš„é©±é€ã€‚ç›®å‰ï¼ŒKubelet ä¸ä¼šè‡ªåŠ¨å¤„ç†å®ƒï¼Œä½†å¦‚æœå¤–éƒ¨ç³»ç»Ÿæ‰§è¡Œ Pod åˆ é™¤ï¼Œå®ƒå°†é€‚å½“åœ°ä½œå‡ºååº”ã€‚</p><p>å°½ç®¡ç°åœ¨è¿˜å¤„äºæ¯”è¾ƒæ—©æœŸçš„é˜¶æ®µï¼Œä½†è‡³å°‘æˆ‘ä»¬çœ‹åˆ°äº†å®ƒçš„å˜åŒ–ï¼ŒæœŸå¾…åç»­çš„æ¼”è¿›ã€‚</p><h2 id="ä¸€äº›åºŸå¼ƒæé†’"><a href="#ä¸€äº›åºŸå¼ƒæé†’" class="headerlink" title="ä¸€äº›åºŸå¼ƒæé†’"></a>ä¸€äº›åºŸå¼ƒæé†’</h2><h3 id="ä¸å†æä¾›çš„APIç‰ˆæœ¬ï¼š"><a href="#ä¸å†æä¾›çš„APIç‰ˆæœ¬ï¼š" class="headerlink" title="ä¸å†æä¾›çš„APIç‰ˆæœ¬ï¼š"></a>ä¸å†æä¾›çš„APIç‰ˆæœ¬ï¼š</h3><ul><li>Kubeadm <code>v1beta2</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>kubeadm config migrate</code> è¿ç§»åˆ° <code>v1beta3</code>ã€‚</li><li><code>resource.k8s.io/v1alpha1.PodScheduling</code> ï¼šè¯·ä½¿ç”¨ <code>resource.k8s.io/v1alpha2.PodSchedulingContext</code>ã€‚</li><li>DynamicResourceManagement <code>v1alpha1</code>ï¼šè¯·ä½¿ç”¨ <code>v1alpha2</code>ã€‚</li><li>CSIStorageCapacityï¼š<code>storage.k8s.io/v1beta1</code>ï¼šè¯·ä½¿ç”¨ v1ã€‚</li></ul><h3 id="å·²å¼ƒç”¨ï¼Œåœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒä¹‹å‰å®ç°æ›¿ä»£æ–¹æ¡ˆï¼š"><a href="#å·²å¼ƒç”¨ï¼Œåœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒä¹‹å‰å®ç°æ›¿ä»£æ–¹æ¡ˆï¼š" class="headerlink" title="å·²å¼ƒç”¨ï¼Œåœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒä¹‹å‰å®ç°æ›¿ä»£æ–¹æ¡ˆï¼š"></a>å·²å¼ƒç”¨ï¼Œåœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒä¹‹å‰å®ç°æ›¿ä»£æ–¹æ¡ˆï¼š</h3><ul><li><code>seccomp.security.alpha.kubernetes.io/pod</code> å’Œ <code>container.seccomp.security.alpha.kubernetes.io</code> annotations ï¼šè¯·æ”¹ç”¨ <code>securityContext.seccompProfile</code> å­—æ®µã€‚</li><li><code>SecurityContextDeny</code> å‡†å…¥æ’ä»¶ã€‚</li><li><code>service.kubernetes.io/topology-aware-hints</code> annotationsï¼šè¯·æ”¹ç”¨ <code>service.kubernetes.io/topology-mode</code>ã€‚</li></ul><h3 id="å·²åˆ é™¤"><a href="#å·²åˆ é™¤" class="headerlink" title="å·²åˆ é™¤"></a>å·²åˆ é™¤</h3><ul><li><p>Feature gates:</p></li><li><ul><li><code>IPv6DualStack</code></li><li><code>ExpandCSIVolumes</code></li><li><code>ExpandInUsePersistentVolumes</code></li><li><code>ExpandPersistentVolumes</code></li><li><code>ControllerManagerLeaderMigration</code></li><li><code>CSI Migration</code></li><li><code>CSIInlineVolume</code></li><li><code>EphemeralContainers</code></li><li><code>LocalStorageCapacityIsolation</code></li><li><code>NetworkPolicyEndPort</code></li><li><code>StatefulSetMinReadySeconds</code></li><li><code>IdentifyPodOS</code></li><li><code>DaemonSetUpdateSurge</code></li></ul></li><li><p>appProtocol: <code>kubernetes.io/grpc</code>.</p></li><li><p>kube-apiserver å‚æ•°: <code>--master-service-namespace</code>.</p></li><li><p>CLI å‚æ•°: <code>--enable-taint-manager</code> å’Œ <code>--pod-eviction-timeout</code>.</p></li><li><p>kubelet å‚æ•°: <code>--container-runtime</code>, <code>--master-service-namespace</code>.</p></li><li><p>Azure disk in-tree storage plugin.</p></li><li><p>AWS kubelet credential provider: ä½¿ç”¨ <code>ecr-credential-provider</code>.</p></li><li><p>Metrics:</p></li><li><ul><li><code>node_collector_evictions_number</code> è¢« <code>node_collector_evictions_total</code> æ›¿æ¢</li><li><code>scheduler_e2e_scheduling_duration_seconds</code> è¢« <code>scheduler_scheduling_attempt_duration_seconds</code> æ›¿æ¢</li></ul></li></ul><h1 id="Kubernetes-v1-28"><a href="#Kubernetes-v1-28" class="headerlink" title="Kubernetes v1.28"></a>Kubernetes v1.28</h1><p><strong>Kubernetes v1.28 æ˜¯ 2023 å¹´çš„ç¬¬äºŒä¸ªå¤§ç‰ˆæœ¬æ›´æ–°ï¼ŒåŒ…å«äº† 46 é¡¹ä¸»è¦çš„æ›´æ–°ã€‚</strong> è€Œä»Šå¹´å‘å¸ƒçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ v1.27 æœ‰è¿‘ 60 é¡¹ï¼Œæ‰€ä»¥å¯ä»¥çœ‹å‡ºæ¥ï¼Œåœ¨å‘å¸ƒèŠ‚å¥è°ƒæ•´åï¼Œæ¯ä¸ª Kubernetes ç‰ˆæœ¬ä¸­éƒ½ä¼šåŒ…å«å¾ˆå¤šæ–°çš„å˜åŒ–ã€‚</p><p>å…¶ä¸­ 20 ä¸ªå¢å¼ºåŠŸèƒ½æ­£åœ¨è¿›å…¥ Alpha é˜¶æ®µï¼Œ14 ä¸ªå°†å‡çº§åˆ° Beta é˜¶æ®µï¼Œè€Œå¦å¤– 12 ä¸ªåˆ™å°†å‡çº§åˆ°ç¨³å®šç‰ˆã€‚</p><p>å¯ä»¥çœ‹å‡ºæ¥å¾ˆå¤šéƒ½æ˜¯æ–°ç‰¹æ€§ã€‚</p><h2 id="Kubernetes-é›†ç¾¤å¯ä»¥çœŸæ­£å¹´åº¦å‡çº§äº†"><a href="#Kubernetes-é›†ç¾¤å¯ä»¥çœŸæ­£å¹´åº¦å‡çº§äº†" class="headerlink" title="Kubernetes é›†ç¾¤å¯ä»¥çœŸæ­£å¹´åº¦å‡çº§äº†"></a>Kubernetes é›†ç¾¤å¯ä»¥çœŸæ­£å¹´åº¦å‡çº§äº†</h2><p>æˆ‘ä»¬çŸ¥é“ Kubernetes é›†ç¾¤çš„æ¶æ„ä¸­ control plane å’Œ Node åˆ†ç¦»çš„ï¼Œè™½ç„¶ç”¨æˆ·åœ¨éƒ¨ç½²é›†ç¾¤çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šé€‰æ‹©å°† control plane å’Œ Node éƒ¨ç½²ä¸ºç›¸åŒç‰ˆæœ¬ã€‚ ä½†æ˜¯å¦‚æœè¦è¿›è¡Œé›†ç¾¤ç‰ˆæœ¬å‡çº§çš„æ—¶å€™ï¼Œå°±ä¼šå‘ç° control plane å’Œ Node åœ¨å‡çº§è¿‡ç¨‹ä¸­æ˜¯æ— æ³•ä¿æŒç‰ˆæœ¬ä¸€è‡´çš„ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼š</p><ul><li>æˆ‘éƒ¨ç½²äº†ä¸€å¥— v1.23 ç‰ˆæœ¬çš„ Kubernetes é›†ç¾¤ï¼Œcontrol plane å’Œ Node ç›®å‰éƒ½æ˜¯ v1.23;</li><li>å‡çº§ control plane åˆ° v1.24;</li><li>è¿™ä¸ªæ—¶å€™ Node è¿˜æ˜¯ v1.23;</li><li>æœ€åå°† Node ä¹Ÿå‡çº§åˆ° v1.24;</li></ul><p>åœ¨è¿™ä¸ªå‡çº§è¿‡ç¨‹ä¸­ï¼Œcontrol plane å’Œ Node æœ‰ä¸€æ®µæ—¶é—´ç‰ˆæœ¬æ˜¯ä¸ä¸€è‡´çš„ï¼Œè¿™ä¼šäº§ç”Ÿé—®é¢˜å—ï¼Ÿ</p><p>é€šå¸¸æ¥è¯´ï¼Œå¯¹äºå¤§å¤šæ•°è½¯ä»¶ï¼Œå¦‚æœæ˜¯è¿™ç§åˆ†ç¦»å¼æ¶æ„ï¼Œç‰ˆæœ¬ä¸ä¸€è‡´æ˜¯æœ‰å¯èƒ½å­˜åœ¨é—®é¢˜çš„ï¼ˆè¿™é‡Œæˆ‘å°±ä¸è¯´æŸäº›ç³»ç»Ÿ&#x2F;è½¯ä»¶äº†ï¼‰ã€‚ ä½†ä¸Šè¿°è¿‡ç¨‹å¾ˆæ˜æ˜¾æ˜¯ä¸€å®šå­˜åœ¨çš„ï¼Œæ‰€ä»¥ <strong>Kubernetes åœ¨è¿™æ–¹é¢ä¸“é—¨åšäº†å¤„ç†å’Œå…¼å®¹</strong> ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªç­–ç•¥å«ä½œ Kubernetes çš„ç‰ˆæœ¬åå·®ç­–ç•¥ã€‚</p><p>Kubernetes ä¸­å…è®¸ control plane å’Œ Node ä¹‹é—´çš„ç‰ˆæœ¬å­˜åœ¨ n-2 çš„åå·®ã€‚æ¯”å¦‚ï¼š</p><ul><li>control plane ç‰ˆæœ¬ä¸º v1.27</li><li>Node ç‰ˆæœ¬å¯ä»¥ä¸º v1.27, v1.26 å’Œ v1.25</li></ul><p>ä¸è¿‡ä» v1.28 å¼€å§‹ï¼Œè¿™ä¸ªç‰ˆæœ¬åå·®ç­–ç•¥æ‰©å±•æˆäº† n-3ï¼Œæ¯”å¦‚ï¼š</p><ul><li>control plane ç‰ˆæœ¬ä¸º v1.28</li><li>Node ç‰ˆæœ¬å¯ä»¥ä¸º v1.28, v1.27, v1.26 å’Œ v1.25</li></ul><p>è§£é‡Šå®Œè¿™ä¸ªç‰ˆæœ¬åå·®ç­–ç•¥åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªäº‹æƒ…åˆ°åº•æœ‰å¤šä¹ˆé‡è¦ã€‚</p><p><strong>Kubernetes å½“å‰çš„å‘å¸ƒå’Œæ”¯æŒç­–ç•¥ï¼Œæ˜¯ç”¨æˆ·å¯ä»¥åœ¨ä¸€å¹´å†…æŒç»­å‡çº§åˆ°æœ€æ–°çš„è¡¥ä¸ç‰ˆæœ¬ä»¥è·å–å®‰å…¨ä¿®å¤ï¼Œå¹¶ä¸”åªè¦è¿›è¡Œ 3 ä¸ªè¿ç»­çš„ç‰ˆæœ¬å‡çº§ï¼Œå°±å¯ä»¥è¿½ä¸Šæœ€æ–°æ”¯æŒçš„ç‰ˆæœ¬äº†ã€‚</strong></p><p>ç„¶è€Œï¼Œç”±äº control plane å’Œ Node ä¹‹é—´æµ‹è¯•&#x2F;æ”¯æŒåå·®ç›®å‰ä»…é™äº n-2 ä¸ªç‰ˆæœ¬ï¼Œå› æ­¤æ¯å¹´çš„ 3 ä¸ªç‰ˆæœ¬å‡çº§å°†ä¸å¾—ä¸è¿›è¡Œä¸¤æ¬¡ Node çš„å‡çº§ï¼Œæ‰èƒ½ä¿æŒåœ¨å—æ”¯æŒèŒƒå›´å†…ã€‚ä¾‹å¦‚ï¼Œä» v1.24 å‡çº§åˆ° v1.27 ï¼Œè¿™ä¸ªåœºæ™¯æ­£å¥½æ˜¯ä» 2022 å¹´çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬å‡çº§åˆ° 2023 å¹´çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ã€‚</p><ul><li>control plane å’Œ Node éƒ½æ˜¯ v1.24;</li><li>control plane å‡çº§ v1.24 - v1.25 - v1.26;</li><li>Node å‡çº§ v1.24 - v1.26;</li><li>control plane å‡çº§ v1.26 - v1.27</li><li>Node å‡çº§ v1.26 - v1.27</li></ul><p>ä»è¿™é‡Œå¯ä»¥çœ‹åˆ° Node è¦å‡çº§ä¸¤æ¬¡ï¼Œäº‹å®ä¸Šåœ¨ Kubernetes é›†ç¾¤çš„ç»´æŠ¤è¿‡ç¨‹ä¸­ï¼ŒNode ç‰ˆæœ¬çš„å‡çº§å¸¦æ¥çš„å½±å“æ˜¯å¾ˆå¤§çš„ï¼Œ æ¯”å¦‚åŸå…ˆè¿è¡Œåœ¨è¿™äº› Node ä¸Šçš„ Pod éœ€è¦é‡æ–°è°ƒåº¦&#x2F;é‡å»ºç­‰ï¼Œè™½ç„¶ç†æƒ³çŠ¶å†µä¸‹å¯¹äºä¸šåŠ¡åº”è¯¥æ²¡ä»€ä¹ˆå½±å“ï¼ˆä½†å®é™…æƒ…å†µä¸‹...) æ­¤å¤–ï¼Œéšç€é›†ç¾¤è§„æ¨¡çš„å¢åŠ ï¼Œè¿™ä¸ª Node å‡çº§çš„å·¥ä½œé‡ä¹Ÿæ˜¯å¾ˆå¤§çš„ã€‚</p><p>å¦‚æœä½¿ç”¨ç°åœ¨æ–°çš„ n-3 åå·®ç­–ç•¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ•ˆæœï¼Œè¿˜æ˜¯ä» v1.24 åˆ° v1.27 ï¼ˆæ­¤å¤„åªæ˜¯ç”¨åšä¸¾ä¾‹ï¼Œä» v1.28 æ‰ç”Ÿæ•ˆï¼‰ï¼š</p><ul><li>control plane å’Œ Node éƒ½æ˜¯ v1.24;</li><li>control plane å‡çº§ v1.24 - v1.25 - v1.26 - v1.27;</li><li>Node å‡çº§ v1.24 - v1.27;</li></ul><p>è¿™æ ·çš„è¯ï¼ŒNode åªéœ€è¦å‡çº§ä¸€æ¬¡ï¼Œå¾ˆæ˜æ˜¾ <strong>èŠ‚çœäº†å¾ˆå¤šå·¥ä½œé‡ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥å‡å°‘å¯¹ä¸šåŠ¡çš„å½±å“</strong> ï¼Œè¿™æ ·ä¹ŸçœŸæ­£å®ç°äº† Kubernetes çš„å¹´åº¦æ”¯æŒç­–ç•¥ã€‚</p><p>æ³¨æ„ï¼šé¦–ä¸ªå¯ç”¨ n-3 åå·®ç­–ç•¥çš„æ˜¯ v1.28 ï¼Œå®ƒå…è®¸ control plane æ˜¯ v1.28 è€Œ Node æœ€æ—§ä¸º v1.25ã€‚</p><p>å…³äº Kubernetes çš„ç‰ˆæœ¬åå·®ç­–ç•¥çš„è¯¦ç»†è¯´æ˜å¯ä»¥å‚è€ƒ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://kubernetes.io/releases/version-skew-policy/">https://kubernetes.io/releases/version-skew-policy/</a></p><h2 id="åŸºäº-CEL-çš„-Admission-Control-è¾¾åˆ°-Beta"><a href="#åŸºäº-CEL-çš„-Admission-Control-è¾¾åˆ°-Beta" class="headerlink" title="åŸºäº CEL çš„ Admission Control è¾¾åˆ° Beta"></a>åŸºäº CEL çš„ Admission Control è¾¾åˆ° Beta</h2><p>å¯¹ Kubernetes ä¸­çš„ Adminssion Control æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹æ–‡ç« ï¼š<a target="_blank" rel="noopener external nofollow noreferrer" href="http://mp.weixin.qq.com/s?__biz=MzI2ODAwMzUwNA==&mid=2649296994&idx=2&sn=60686fcebaacff30b9762a6229e85d12&chksm=f2eb81bdc59c08ab0f10013ed2bda48a7f3f5f3e0d335b7f1cdbbbce6e5b81656b487e9955d8&scene=21#wechat_redirect">ç†æ¸… Kubernetes ä¸­çš„å‡†å…¥æ§åˆ¶ï¼ˆAdmission Controller) | MoeLove</a></p><ul><li>KEP-3488: Implement secondary authz for ValidatingAdmissionPolicy by jpbetz Â· Pull Request <code>#116054</code> Â· kubernetes&#x2F;kubernetes</li><li>KEP-3488: Implement Enforcement Actions and Audit Annotations by jpbetz Â· Pull Request <code>#115973</code> Â· kubernetes&#x2F;kubernetes</li></ul><p>Kubernetes åœ¨ v1.26 å¢åŠ äº†ä¸€é¡¹å¾ˆé‡è¦çš„ç‰¹æ€§ï¼Œé‚£å°±æ˜¯å…è®¸ä½¿ç”¨ CEL è¿›è¡Œ Admission Controlï¼Œå…·ä½“å†…å®¹å¯ä»¥å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="noopener external nofollow noreferrer" href="http://mp.weixin.qq.com/s?__biz=MzI2ODAwMzUwNA==&mid=2649298102&idx=1&sn=2bef678dc8ece2b17c492a9a31450d6e&chksm=f2eb8569c59c0c7f3dad16f45941218c59310779759e275120311fe30ded91b88fa1d576028e&scene=21#wechat_redirect">Kubernetes v1.26 æ–°ç‰¹æ€§ä¸€è§ˆ | MoeLove</a></p><p>å…¶ä¸­å¼•å…¥äº†ä¸€ä¸ªæ–°çš„èµ„æº ValidatingAdmissionPolicy ï¼Œä½¿ç”¨èµ·æ¥å¦‚ä¸‹:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">admissionregistration.k8s.io/v1alpha1</span></span><br><span class="line"> <span class="attr">kind:</span> <span class="string">ValidatingAdmissionPolicy</span></span><br><span class="line"> <span class="attr">metadata:</span></span><br><span class="line">   <span class="attr">name:</span> <span class="string">&quot;demo-policy.moelove.info&quot;</span></span><br><span class="line"> <span class="attr">Spec:</span></span><br><span class="line">   <span class="attr">failurePolicy:</span> <span class="string">Fail</span></span><br><span class="line">   <span class="attr">matchConstraints:</span></span><br><span class="line">     <span class="attr">resourceRules:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">apiGroups:</span>   [<span class="string">&quot;apps&quot;</span>]</span><br><span class="line">       <span class="attr">apiVersions:</span> [<span class="string">&quot;v1&quot;</span>]</span><br><span class="line">       <span class="attr">operations:</span>  [<span class="string">&quot;CREATE&quot;</span>, <span class="string">&quot;UPDATE&quot;</span>]</span><br><span class="line">       <span class="attr">resources:</span>   [<span class="string">&quot;deployments&quot;</span>]</span><br><span class="line">   <span class="attr">validations:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">expression:</span> <span class="string">&quot;object.spec.replicas &lt;= 2&quot;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨å½“æ—¶ä¹Ÿåªæ˜¯å®ç°äº† KEP-3488 çš„ä¸€éƒ¨åˆ†ã€‚</p><p>åœ¨è¿™ä¸ª PR ä¸­æ˜¯åœ¨å®ç° Authz çš„éƒ¨åˆ†ï¼Œè¿™å…è®¸ç”¨ CEL è¡¨è¾¾å¼ç¼–å†™å¤æ‚çš„ admission control è§„åˆ™ï¼Œ æ”¾ç½®åœ¨å£°æ˜å¼èµ„æºä¸­ï¼Œè€Œä¸æ˜¯æ„å»ºå’Œéƒ¨ç½² webhookã€‚</p><p>è™½ç„¶ admission webhook ä¸€ç›´æ˜¯æˆ‘ä»¬çµæ´»çš„ä¸ç¬¬ä¸‰æ–¹å·¥å…·é›†æˆçš„åŸºçŸ³ï¼Œä½†æ˜¯å¯¹äºæ–°ç”¨æˆ·æ¥è¯´ï¼Œå®ƒä»¬æœ‰å¾ˆå¤šå¤æ‚æ€§ï¼Œæ–°çš„ CEL ç³»ç»Ÿæœ‰æœ›æ¥ç®¡ä»…éœ€è¦å¯¹é»˜è®¤è§„åˆ™è¿›è¡Œå°ä¿®æ”¹çš„ç®€å•ç‹¬ç«‹æ¡ˆä¾‹ã€‚</p><p>ä»¥å‰ï¼Œè¡¨è¾¾å¼ä¸Šä¸‹æ–‡ä¼šå…¬å¼€æœ‰å…³å½“å‰è¯·æ±‚å’Œç›®æ ‡èµ„æºçš„ä¿¡æ¯ï¼Œç°åœ¨é€šè¿‡è¿™ä¸ª PR å¯ä»¥åœ¨æˆæƒå±‚ä¸­åŠ¨æ€æ£€æŸ¥ RBAC æƒé™ã€‚ ä¸€äº›æœ‰ç”¨çš„åœ°æ–¹å¯èƒ½æ˜¯ä½¿ç”¨ RBAC è¿›è¡Œæ¯ä¸ªå­—æ®µçš„æ›´æ–°æƒé™ï¼Œå…è®¸ RBAC æ£€æŸ¥ç‰¹å®šå¯¹è±¡è€Œä¸ä½¿ç”¨ resourceNames ç³»ç»Ÿï¼Œ æˆ–åŸºäºè¯·æ±‚è€…èº«ä»½é™åˆ¶å¯¹ç¨‹åºæ•æ„Ÿå­—æ®µï¼ˆä¾‹å¦‚ finalizers ï¼‰çš„è®¿é—®è€Œæ— éœ€ç”Ÿæˆå¤æ‚çš„ RBAC ç­–ç•¥ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">authorizer.group(<span class="string">&#x27;&#x27;</span>).resource(<span class="string">&#x27;pods&#x27;</span>).namespace(<span class="string">&#x27;default&#x27;</span>).check(<span class="string">&#x27;create&#x27;</span>).allowed()</span><br><span class="line">authorizer.path(<span class="string">&#x27;/healthz&#x27;</span>).check(<span class="string">&#x27;GET&#x27;</span>).allowed()</span><br><span class="line">authorizer.requestResource.check(<span class="string">&#x27;my-custom-verb&#x27;</span>).allowed()</span><br></pre></td></tr></table></figure><p>åœ¨ v1.27 è¿˜åŠ å…¥äº†<code>#115973</code>ï¼Œè¯¥åŠŸèƒ½å…è®¸åœ¨å¤±è´¥æ—¶ä½œä¸ºä¸»è¦æ“ä½œå‘å‡ºå®¡è®¡æ—¥å¿—äº‹ä»¶ï¼Œæˆ–è€…å¦‚æœéœ€è¦æ›´å¤šæ•°æ®ï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ªæˆ–å¤šä¸ªCELè¡¨è¾¾å¼ï¼Œä»¥æä¾›è¯¦ç»†çš„å€¼ï¼Œ è¿™äº›å€¼å°†å‘é€åˆ°å®¡è®¡å­ç³»ç»Ÿã€‚</p><p>è¿™æ—¢å¯ä»¥åœ¨å¼€å‘æ–°ç­–ç•¥æ—¶æä¾›å¼ºå¤§çš„è°ƒè¯•é€‰é¡¹ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œè¿è¡Œæ—¶åˆ†æã€‚ å…¶ä»– CEL admission ç‰¹æ€§åŒ…æ‹¬å„ç§æ£€æŸ¥ï¼Œä»¥é˜²æ­¢æ‚¨ä½¿ç”¨æ‰€æœ‰è¿™äº›æ–°åŠŸèƒ½æ„å¤–æ‹’ç»æœåŠ¡è‡ªå·±çš„ kube-apiserverï¼Œä»¥åŠæ”¹è¿›çš„ç±»å‹æ£€æŸ¥ã€‚</p><p>æœ¬æ¬¡å‡çº§åˆ° Beta é˜¶æ®µï¼ŒAPI version ä¹Ÿå°±éšä¹‹å‡çº§åˆ°äº†ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">admissionregistration.k8s.io/v1beta1</span></span><br></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œè¿˜å¼•å…¥äº†åŒ…æ‹¬ ValidatingAdmissionPolicy: support namespace access by cici37 Â· Pull Request <code>#118267</code> Â· kubernetes&#x2F;kubernetes ç­‰åœ¨å†…çš„ç‰¹æ€§ï¼Œè¿›ä¸€æ­¥å°† webhook æ¨å…¥åˆ°ä¸€ä¸ªæœ‰é™çš„ç”¨ä¾‹ç©ºé—´ä¸­ï¼ˆé˜²æ­¢æ»¥ç”¨ï¼‰ã€‚</p><h2 id="CRD-ä½¿ç”¨-CEL-è¿›è¡Œ-Validate-çš„ç‰¹æ€§å†æ¬¡è¾¾åˆ°-Beta"><a href="#CRD-ä½¿ç”¨-CEL-è¿›è¡Œ-Validate-çš„ç‰¹æ€§å†æ¬¡è¾¾åˆ°-Beta" class="headerlink" title="CRD ä½¿ç”¨ CEL è¿›è¡Œ Validate çš„ç‰¹æ€§å†æ¬¡è¾¾åˆ° Beta"></a>CRD ä½¿ç”¨ CEL è¿›è¡Œ Validate çš„ç‰¹æ€§å†æ¬¡è¾¾åˆ° Beta</h2><p>Kubernetes v1.23.0 æ­£å¼å‘å¸ƒåï¼Œå¼•å…¥äº† Common Expression Language (CEL) è¿›è¡Œ CRD Validationã€‚è¯¥ç‰¹æ€§è®¡åˆ’åœ¨ v1.25 è¾¾åˆ° Betaï¼Œè¿™æ¬¡æ˜¯å®ƒç¬¬äºŒæ¬¡å®£å¸ƒè¾¾åˆ° Beta äº†ã€‚</p><p>ä¾‹å¦‚ï¼ŒæŸä¸ª CRDs çš„å†…å®¹å¦‚ä¸‹ï¼Œå…¶ä¸­å®šä¹‰äº† <code>minReplicas</code> å°äº <code>replicas</code> å¹¶ä¸” <code>replicas</code> å°äº <code>maxReplicas</code> ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">...</span></span><br><span class="line"><span class="attr">openAPIV3Schema:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">  <span class="attr">properties:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">      <span class="attr">x-kubernetes-validations:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">rule:</span> <span class="string">&quot;self.minReplicas &lt;= self.replicas&quot;</span></span><br><span class="line">          <span class="attr">message:</span> <span class="string">&quot;replicas should be greater than or equal to minReplicas.&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">rule:</span> <span class="string">&quot;self.replicas &lt;= self.maxReplicas&quot;</span></span><br><span class="line">          <span class="attr">message:</span> <span class="string">&quot;replicas should be smaller than or equal to maxReplicas.&quot;</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="string">...</span></span><br><span class="line">        <span class="attr">minReplicas:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">        <span class="attr">replicas:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">        <span class="attr">maxReplicas:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">      <span class="attr">required:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">minReplicas</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">replicas</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">maxReplicas</span> </span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œå½“æœ‰å¦‚ä¸‹çš„è‡ªå®šä¹‰èµ„æºåˆ›å»ºæ—¶ï¼ŒKubernetes å°†ä¼šæ‹’ç»å…¶è¯·æ±‚ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">&quot;stable.example.com/v1&quot;</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomDeployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-new-deploy-object</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">minReplicas:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">20</span></span><br><span class="line">  <span class="attr">maxReplicas:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><p>å¹¶ä¸”è¿”å›å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">The CustomDeployment <span class="string">&quot;my-new-deploy-object&quot;</span> is invalid:</span><br><span class="line">* spec: Invalid value: map[string]interface &#123;&#125;&#123;<span class="string">&quot;maxReplicas&quot;</span>:10, <span class="string">&quot;minReplicas&quot;</span>:0, <span class="string">&quot;replicas&quot;</span>:20&#125;: replicas should be smaller than or equal to maxReplicas.</span><br></pre></td></tr></table></figure><p>è¿™æ¬¡è¿˜å¢åŠ äº† [KEP-2876]Add reason and fieldPath into CRD validation rules by cici37 Â· Pull Request <code>#118041</code> Â· kubernetes&#x2F;kubernetes è¿™ä¸ª PRï¼Œ æ–°å¢äº† <code>fieldPath</code> å’Œ <code>reason</code> å­—æ®µçš„é…ç½®ï¼Œå¯ä»¥æ›´åŠ æ–¹ä¾¿ä½¿ç”¨ã€‚</p><p>å…¶ä¸­ <code>reason</code> å­—æ®µå¯ä»¥ä¼ é€’ç»™è°ƒç”¨æ–¹çš„ HTTP status codeï¼Œç›®å‰æ”¯æŒ <code>FieldValueInvalid</code>, <code>FieldValueForbidden</code>,<code>FieldValueRequired</code>, <code>FieldValueDuplicate</code>ã€‚å¦‚æœæœªè®¾ç½®ï¼Œé»˜è®¤ä½¿ç”¨ <code>FieldValueInvalid</code> ã€‚</p><p>ä¸ä¹‹ç›¸å…³çš„ï¼Œè¿˜æœ‰ä¸€ä¸ªæ–°å¢çš„ Alpha ç‰¹æ€§ CRD Validation Ratcheting Â· Issue <code>#4008</code> Â· kubernetes&#x2F;enhancements</p><h2 id="éä¼˜é›…çš„èŠ‚ç‚¹å…³é—­ç‰¹æ€§è¾¾åˆ°-GA"><a href="#éä¼˜é›…çš„èŠ‚ç‚¹å…³é—­ç‰¹æ€§è¾¾åˆ°-GA" class="headerlink" title="éä¼˜é›…çš„èŠ‚ç‚¹å…³é—­ç‰¹æ€§è¾¾åˆ° GA"></a>éä¼˜é›…çš„èŠ‚ç‚¹å…³é—­ç‰¹æ€§è¾¾åˆ° GA</h2><p>å½“ä¸€ä¸ªèŠ‚ç‚¹è¢«å…³é—­ä½†æ²¡æœ‰è¢« Kubelet çš„ Node Shutdown Manager æ£€æµ‹åˆ°æ—¶ï¼ŒStatefulSet çš„ Pod å°†ä¼šåœç•™åœ¨æ­£åœ¨ç»ˆæ­¢çŠ¶æ€ï¼Œå¹¶ä¸”ä¸èƒ½ç§»åŠ¨åˆ°æ–°è¿è¡Œçš„èŠ‚ç‚¹ä¸Šã€‚</p><p>è¿™æ˜¯å› ä¸ºå…³é—­èŠ‚ç‚¹ä¸Šçš„ Kubelet ä¸å¯ç”¨æ¥åˆ é™¤ Pod ï¼Œæ‰€ä»¥ StatefulSet æ— æ³•åˆ›å»ºå…·æœ‰ç›¸åŒåç§°çš„æ–° Pod ã€‚å¦‚æœ Pod ä½¿ç”¨å·ï¼Œåˆ™ VolumeAttachments å°†ä¸ä¼šä»åŸå§‹å…³é—­èŠ‚ç‚¹ä¸­åˆ é™¤ï¼Œå› æ­¤è¿™äº› Pod ä½¿ç”¨çš„å·å°†æ— æ³•é™„åŠ åˆ°æ–°è¿è¡Œçš„èŠ‚ç‚¹ä¸Šã€‚</p><p>ç»“æœæ˜¯ï¼Œåœ¨ StatefulSet ä¸Šè¿è¡Œåº”ç”¨ç¨‹åºå°†æ— æ³•æ­£å¸¸å·¥ä½œã€‚å¦‚æœåŸå§‹å…³é—­èŠ‚é‡æ–°å¯åŠ¨ï¼Œåˆ™ Pods å°†è¢« Kubelet åˆ é™¤ï¼Œå¹¶åœ¨ä¸åŒè¿è¡Œä¸­åˆ›å»ºæ–° Pods ã€‚å¦‚æœåŸå§‹å…³é—­èŠ‚æ²¡æœ‰é‡æ–°å¯åŠ¨ï¼Œåˆ™è¿™äº› Pods å°†æ°¸è¿œåœç•™åœ¨æ­£åœ¨ç»ˆæ­¢çŠ¶æ€ä¸‹ã€‚</p><p>æ‰€è°“çš„éä¼˜é›…å…³é—­èŠ‚ç‚¹çš„ç‰¹æ€§å°±æ˜¯ä¸€ç§å¤„ç†æœªè¢« Kubelet çš„ Node Shutdown Manager æ£€æµ‹åˆ°çš„æƒ…å†µä¸‹è¿›è¡Œ node å…³é—­çš„æ–¹æ³•ã€‚ åœ¨æ­¤æƒ…å†µä¸‹å¼ºåˆ¶åˆ é™¤ pods ï¼Œè§¦å‘ VolumeAttachments çš„åˆ é™¤ï¼Œå¹¶åœ¨å¥åº· Node ä¸­åˆ›å»º pod ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºå¯ä»¥ç»§ç»­æ­£å¸¸å·¥ä½œã€‚ ç±»ä¼¼åœ°ï¼Œåœ¨é‡åˆ°ç¡¬ä»¶æ•…éšœæˆ–ç ´æŸæ“ä½œç³»ç»Ÿç­‰ä¸å¯æ¢å¤çŠ¶æ€æ—¶ä¹Ÿå¯ä»¥é‡‡å–æ­¤æ–¹æ³•ã€‚</p><p>è¿™ä¸ªç‰¹æ€§çš„ feature gate æ˜¯ NodeOutOfServiceVolumeDetachï¼Œåœ¨æ—§ç‰ˆæœ¬çš„ kube-controller-manager ä¹Ÿå¯ä»¥è‡ªè¡Œå¼€å¯ã€‚</p><p>ç›®å‰å®ƒè¿˜éœ€è¦äººå·¥æ“ä½œï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl taint nodes &lt;node-name&gt; node.kubernetes.io/out-of-service=nodeshutdown:NoExecute</span><br></pre></td></tr></table></figure><p>è¿™æ ·éæ­£å¸¸å…³é—­çš„èŠ‚ç‚¹ä¸Šçš„æœ‰çŠ¶æ€åº”ç”¨çš„ Pod åªè¦æ²¡æœ‰åŒ¹é…çš„å®¹å¿åº¦ï¼Œæ­¤æ±¡ç‚¹å°†è§¦å‘å¼ºåˆ¶åˆ é™¤è¯¥èŠ‚ç‚¹ä¸Šçš„ Podã€‚é™„åŠ åˆ°å…³é—­èŠ‚ç‚¹çš„æŒä¹…å·å°†è¢«åˆ†ç¦»ï¼Œå¹¶ä¸”æ–°çš„ Pod å°†æˆåŠŸåˆ›å»ºåœ¨å¦ä¸€ä¸ªè¿è¡Œä¸­çš„èŠ‚ç‚¹ä¸Šã€‚</p><p>è¿™ä¸ªç‰¹æ€§è¿˜æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚</p><h2 id="å…¶ä»–-2"><a href="#å…¶ä»–-2" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><ul><li>in-tree çš„ Ceph RBDï¼Œ Ceph FS çš„æ’ä»¶éƒ½åºŸå¼ƒäº†ï¼Œå¹¶ä¸”æ²¡æœ‰è¿ç§» CSI çš„è®¡åˆ’ï¼›</li><li><strong>Sidecar container çš„æ”¯æŒè¾¾åˆ° alpha çº§åˆ«ï¼›</strong></li><li>PodResources API è¾¾åˆ° GAï¼›</li><li>Node swap ç‰¹æ€§è¾¾åˆ° Beta, è¿™æ˜¯ä» v1.22 å¼•å…¥çš„ï¼›</li></ul><h1 id="Kubernetes-v1-29"><a href="#Kubernetes-v1-29" class="headerlink" title="Kubernetes v1.29"></a>Kubernetes v1.29</h1><h2 id="KEP-2876-åŸºäº-CEL-çš„-CRD-è§„åˆ™æ ¡éªŒæ­£å¼è¾¾åˆ°-GA"><a href="#KEP-2876-åŸºäº-CEL-çš„-CRD-è§„åˆ™æ ¡éªŒæ­£å¼è¾¾åˆ°-GA" class="headerlink" title="KEP-2876: åŸºäº CEL çš„ CRD è§„åˆ™æ ¡éªŒæ­£å¼è¾¾åˆ° GA"></a><a target="_blank" rel="noopener external nofollow noreferrer" href="https://moelove.info/2023/12/10/Kubernetes-v1.29-%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/#contents:kep-2876-%E5%9F%BA%E4%BA%8E-cel-%E7%9A%84-crd-%E8%A7%84%E5%88%99%E6%A0%A1%E9%AA%8C%E6%AD%A3%E5%BC%8F%E8%BE%BE%E5%88%B0-ga">KEP-2876: åŸºäº CEL çš„ CRD è§„åˆ™æ ¡éªŒæ­£å¼è¾¾åˆ° GA</a></h2><p>è¿™ä¸ªç‰¹æ€§å¯¹äºæ‰€æœ‰åœ¨ Kubernetes ä¸Šè¿›è¡Œå¼€å‘çš„å°ä¼™ä¼´æ¥è¯´åº”è¯¥éƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚ å› ä¸ºå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡ CRD æ¥å®ç° Kubernetes ä¸­çš„åŠŸèƒ½æ‰©å±•ã€‚</p><p>åœ¨é€šè¿‡ CRD å®ç°åŠŸèƒ½æ‰©å±•çš„æ—¶å€™ï¼Œä¸ºäº†èƒ½æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œå’Œæ›´å¯é çš„è¾“å…¥æ ¡éªŒï¼Œå°±éœ€è¦æ”¯æŒæ ¡éªŒäº†ã€‚</p><p>CRD ç›®å‰åŸç”Ÿæ”¯æŒä¸¤ç±»æ ¡éªŒèƒ½åŠ›ï¼š</p><ul><li>åŸºäº CRD ç»“æ„å®šä¹‰çš„æ ¡éªŒ</li><li>OpenAPIv3 çš„æ ¡éªŒè§„åˆ™</li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">controller-gen.kubebuilder.io/version:</span> <span class="string">v0.13.0</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kongplugins.configuration.konghq.com</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">configuration.konghq.com</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">categories:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kong-ingress-controller</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">KongPlugin</span></span><br><span class="line">    <span class="attr">listKind:</span> <span class="string">KongPluginList</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">kongplugins</span></span><br><span class="line">    <span class="attr">shortNames:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">kp</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">kongplugin</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">KongPlugin</span> <span class="string">is</span> <span class="string">the</span> <span class="string">Schema</span> <span class="string">for</span> <span class="string">the</span> <span class="string">kongplugins</span> <span class="string">API.</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">apiVersion:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">&#x27;APIVersion defines the versioned schema of this representation</span></span><br><span class="line"><span class="string">              of an object. Servers should convert recognized schemas to the latest</span></span><br><span class="line"><span class="string">              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources&#x27;</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">protocols:</span></span><br><span class="line">            <span class="attr">description:</span> <span class="string">Protocols</span> <span class="string">configures</span> <span class="string">plugin</span> <span class="string">to</span> <span class="string">run</span> <span class="string">on</span> <span class="string">requests</span> <span class="string">received</span> <span class="string">on</span></span><br><span class="line">              <span class="string">specific</span> <span class="string">protocols.</span></span><br><span class="line">            <span class="attr">items:</span></span><br><span class="line">              <span class="attr">description:</span> <span class="string">KongProtocol</span> <span class="string">is</span> <span class="string">a</span> <span class="string">valid</span> <span class="string">Kong</span> <span class="string">protocol.</span> <span class="string">This</span> <span class="string">alias</span> <span class="string">is</span> <span class="string">necessary</span></span><br><span class="line">                <span class="string">to</span> <span class="string">deal</span> <span class="string">with</span> <span class="string">https://github.com/kubernetes-sigs/controller-tools/issues/342</span></span><br><span class="line">              <span class="attr">enum:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">http</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">https</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">grpc</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">grpcs</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">tcp</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">tls</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">udp</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">        <span class="string">...</span></span><br><span class="line">        <span class="attr">x-kubernetes-validations:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">message:</span> <span class="string">Using</span> <span class="string">both</span> <span class="string">config</span> <span class="string">and</span> <span class="string">configFrom</span> <span class="string">fields</span> <span class="string">is</span> <span class="string">not</span> <span class="string">allowed.</span></span><br><span class="line">          <span class="attr">rule:</span> <span class="string">&#x27;!(has(self.config) &amp;&amp; has(self.configFrom))&#x27;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">message:</span> <span class="string">Using</span> <span class="string">both</span> <span class="string">configFrom</span> <span class="string">and</span> <span class="string">configPatches</span> <span class="string">fields</span> <span class="string">is</span> <span class="string">not</span> <span class="string">allowed.</span></span><br><span class="line">          <span class="attr">rule:</span> <span class="string">&#x27;!(has(self.configFrom) &amp;&amp; has(self.configPatches))&#x27;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">message:</span> <span class="string">The</span> <span class="string">plugin</span> <span class="string">field</span> <span class="string">is</span> <span class="string">immutable</span></span><br><span class="line">          <span class="attr">rule:</span> <span class="string">self.plugin</span> <span class="string">==</span> <span class="string">oldSelf.plugin</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šç¤ºä¾‹ä¸­å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>KongPlugin</code> çš„è‡ªå®šä¹‰èµ„æºï¼Œå…¶ä¸­ä½¿ç”¨ <code>openAPIV3Schema</code> å®šä¹‰äº† OpenAPI schema çš„æ ¡éªŒè§„åˆ™ã€‚</p><p>ä½†è¿™äº›å†…ç½®è§„åˆ™èƒ½è¾¾åˆ°çš„æ•ˆæœç›¸å¯¹æœ‰é™ï¼Œå¦‚æœæƒ³è¦å®ç°æ›´åŠ ä¸°å¯Œçš„æ ¡éªŒè§„åˆ™&#x2F;ç‰¹æ€§ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ï¼š</p><ul><li>Admission Webhook: å…³äº Adminssion webhook å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç«  <a target="_blank" rel="noopener external nofollow noreferrer" href="https://moelove.info/2021/11/30/%E7%90%86%E6%B8%85-Kubernetes-%E4%B8%AD%E7%9A%84%E5%87%86%E5%85%A5%E6%8E%A7%E5%88%B6Admission-Controller/">ç†æ¸… Kubernetes ä¸­çš„å‡†å…¥æ§åˆ¶ï¼ˆAdmission Controller) | MoeLove</a></li><li>ä½¿ç”¨è‡ªå®šä¹‰éªŒè¯å™¨ï¼šä¾‹å¦‚åŸºäº Open Policy Agent(OPA) çš„ Gatekeeperï¼Œå…³äº OPA å¯ä»¥å‚è€ƒ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://moelove.info/2021/12/06/Open-Policy-Agent-OPA-%E5%85%A5%E9%97%A8%E5%AE%9E%E8%B7%B5/">Open Policy Agent (OPA) å…¥é—¨å®è·µ | MoeLove</a></li></ul><p>ä¸è¿‡ <strong>æ— è®ºæ˜¯ Admission webhook è¿˜æ˜¯è‡ªå®šä¹‰éªŒè¯å™¨ï¼Œå®ƒä»¬ä¸ CRD è‡ªèº«éƒ½æ˜¯åˆ†ç¦»çš„ï¼Œå¹¶ä¸”è¿™ä¹Ÿä¼šå¯¼è‡´å¼€å‘ CRD çš„éš¾åº¦å’Œåç»­çš„ç»´æŠ¤æˆæœ¬å¢åŠ ã€‚</strong></p><p>ä¸ºäº†èƒ½è§£å†³è¿™äº›é—®é¢˜ï¼ŒKubernetes ç¤¾åŒºä¸º CRD å¼•å…¥äº†ä¸€ç§åŸºäº CELï¼ˆCommon Expression Languageï¼‰çš„æ ¡éªŒè§„åˆ™ï¼Œè¿™ä¸ªè§„åˆ™æ˜¯å¯ä»¥ç›´æ¥ åœ¨ CRD çš„å£°æ˜æ–‡ä»¶ä¸­ç¼–å†™çš„ï¼Œæ— éœ€ä½¿ç”¨ä»»ä½• Admission webhook æˆ–è€…è‡ªå®šä¹‰éªŒè¯å™¨ï¼Œå¤§å¤§ç®€åŒ–äº† CRD çš„å¼€å‘å’Œç»´æŠ¤æˆæœ¬ã€‚</p><p>æˆ‘ä»ç¤¾åŒºåˆšå¼€å§‹æƒ³è¦å¼•å…¥è¿™ä¸ªåŠŸèƒ½èµ·å°±ä¸€ç›´åœ¨æ–‡ç« ä¸­å®£ä¼ è¯¥åŠŸèƒ½äº†ï¼ŒæŒç»­å…³æ³¨çš„å°ä¼™ä¼´å¯¹è¿™ä¸ªåº”è¯¥ä¸ç®—é™Œç”Ÿäº†ã€‚ æˆ‘å¤§æ¦‚æŸ¥çœ‹äº†ä»¥ä¸‹æ–‡ç« ä¸­éƒ½æœ‰ä»‹ç» Kubernetes ä¸­ CEL ç›¸å…³ç‰¹æ€§çš„æ¼”è¿›è¿‡ç¨‹ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥é€ç¯‡é˜…è¯»ï¼š</p><ul><li>ä¸¤å¹´å‰çš„ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://moelove.info/2021/12/08/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kubernetes-v1.23.0-%E6%AD%A3%E5%BC%8F%E5%8F%91%E5%B8%83%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/">K8S ç”Ÿæ€å‘¨æŠ¥| Kubernetes v1.23.0 æ­£å¼å‘å¸ƒï¼Œæ–°ç‰¹æ€§ä¸€è§ˆ | MoeLove</a></li><li>ä¸€å¹´å‰çš„ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://moelove.info/2022/12/09/Kubernetes-v1.26-%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/">Kubernetes v1.26 æ–°ç‰¹æ€§ä¸€è§ˆ | MoeLove</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://moelove.info/2023/03/12/K8S-%E7%94%9F%E6%80%81%E5%91%A8%E6%8A%A5-Kubernetes-%E5%9F%BA%E4%BA%8E-CEL-%E7%9A%84%E6%8E%A7%E5%88%B6%E7%B3%BB%E7%BB%9F%E5%86%8D%E6%B7%BB%E6%96%B0%E7%89%B9%E6%80%A7/">K8S ç”Ÿæ€å‘¨æŠ¥| Kubernetes åŸºäº CEL çš„æ§åˆ¶ç³»ç»Ÿå†æ·»æ–°ç‰¹æ€§ | MoeLove</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://moelove.info/2023/04/03/Kubernetes-v1.27-%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/#%E5%9F%BA%E4%BA%8E-cel-%E7%9A%84-admission-control">Kubernetes v1.27 æ–°ç‰¹æ€§ä¸€è§ˆ | MoeLove</a></li></ul><p>åœ¨ Kubernetes v1.29 ç‰ˆæœ¬ä¸­åŸºäº CEL çš„ CRD æ ¡éªŒèƒ½åŠ›è¾¾åˆ° GAï¼Œåªéœ€è¦ä½¿ç”¨ <code>x-kubernetes-validations</code> å®šä¹‰æ ¡éªŒè§„åˆ™å³å¯ï¼Œ å®ƒè¶³å¤Ÿè½»é‡ä¸”å®‰å…¨ï¼Œå¯ä»¥ç›´æ¥åœ¨ kube-apiserver ä¸­è¿è¡Œï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">controller-gen.kubebuilder.io/version:</span> <span class="string">v0.13.0</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kongplugins.configuration.konghq.com</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">configuration.konghq.com</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line">  <span class="attr">versions:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">v1</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">openAPIV3Schema:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">KongPlugin</span> <span class="string">is</span> <span class="string">the</span> <span class="string">Schema</span> <span class="string">for</span> <span class="string">the</span> <span class="string">kongplugins</span> <span class="string">API.</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">plugin:</span></span><br><span class="line">        <span class="string">...</span></span><br><span class="line">        <span class="attr">x-kubernetes-validations:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">message:</span> <span class="string">Using</span> <span class="string">both</span> <span class="string">config</span> <span class="string">and</span> <span class="string">configFrom</span> <span class="string">fields</span> <span class="string">is</span> <span class="string">not</span> <span class="string">allowed.</span></span><br><span class="line">          <span class="attr">rule:</span> <span class="string">&#x27;!(has(self.config) &amp;&amp; has(self.configFrom))&#x27;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">message:</span> <span class="string">The</span> <span class="string">plugin</span> <span class="string">field</span> <span class="string">is</span> <span class="string">immutable</span></span><br><span class="line">          <span class="attr">rule:</span> <span class="string">self.plugin</span> <span class="string">==</span> <span class="string">oldSelf.plugin</span></span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚å…¶ä¸­çš„è¿™å¥ <code>self.plugin == oldSelf.plugin</code>ï¼Œ<code>self</code> å’Œ <code>oldSelf</code> ä»£è¡¨äº†å˜åŒ–å‰åçš„èµ„æºå¯¹è±¡ï¼Œ ä¸€æ—¦å®šä¹‰äº† <code>plugin</code> å­—æ®µçš„å†…å®¹ï¼Œåˆ™ä¸å…è®¸ä¿®æ”¹å®ƒã€‚</p><p>æ­¤å¤–ï¼ŒCEL è¿˜æœ‰éå¸¸ä¸°å¯Œçš„ç‰¹æ€§ï¼Œå¯ä»¥é€šè¿‡åœ¨çº¿çš„ Playground æ¥ä½“éªŒå®ƒ <a target="_blank" rel="noopener external nofollow noreferrer" href="https://playcel.undistro.io/">https://playcel.undistro.io/</a></p><p>æ­£å¦‚æˆ‘å‰é¢æåˆ°çš„ï¼Œè¿™ä¸ªç‰¹æ€§å¼•å…¥çš„æ—¶é—´å·²ç»ä¸¤å¹´å¤šäº†ï¼Œåœ¨ Kubernetes v1.25 ä¸­è¾¾åˆ° Beta å¹¶é»˜è®¤å¼€å¯ï¼Œå¦‚ä»Šç»ˆäºè¾¾åˆ°äº† GAã€‚</p><p>é¢å¤–ä¸€è¯´ï¼ŒKubernetes Gateway API é¡¹ç›®æ­£åœ¨å°†å®ƒçš„æ‰€æœ‰ Admission webhook åˆ æ‰ï¼Œå…¨éƒ¨ä½¿ç”¨åŸºäº CEL çš„è§„åˆ™è¿›è¡Œæ ¡éªŒï¼Œ è¿™å¤§æ¦‚æ˜¯ç›®å‰ç¤¾åŒºä¸­æœ€å¤§çš„ä¸€ä¸ªç”¨ä¾‹äº†ã€‚</p><h2 id="KEP-3668-ä¸ºåŠ¨æ€å’Œé™æ€åˆ†é…é¢„ç•™-NodePort-ç«¯å£èŒƒå›´è¾¾åˆ°-stable"><a href="#KEP-3668-ä¸ºåŠ¨æ€å’Œé™æ€åˆ†é…é¢„ç•™-NodePort-ç«¯å£èŒƒå›´è¾¾åˆ°-stable" class="headerlink" title="KEP-3668: ä¸ºåŠ¨æ€å’Œé™æ€åˆ†é…é¢„ç•™ NodePort ç«¯å£èŒƒå›´è¾¾åˆ° stable"></a><a target="_blank" rel="noopener external nofollow noreferrer" href="https://moelove.info/2023/12/10/Kubernetes-v1.29-%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/#contents:kep-3668-%E4%B8%BA%E5%8A%A8%E6%80%81%E5%92%8C%E9%9D%99%E6%80%81%E5%88%86%E9%85%8D%E9%A2%84%E7%95%99-nodeport-%E7%AB%AF%E5%8F%A3%E8%8C%83%E5%9B%B4%E8%BE%BE%E5%88%B0-stable">KEP-3668: ä¸ºåŠ¨æ€å’Œé™æ€åˆ†é…é¢„ç•™ NodePort ç«¯å£èŒƒå›´è¾¾åˆ° stable</a></h2><p>ä¼—æ‰€å‘¨çŸ¥ Kubernetes åŸç”Ÿçš„ Service å¯¹è±¡æœ‰ä¸€ç§ NodePort çš„ç±»å‹ï¼Œç”¨äºå°†é›†ç¾¤å†…çš„æœåŠ¡æš´éœ²åˆ°é›†ç¾¤å¤–ã€‚</p><p>åœ¨å½“å‰æƒ…å†µä¸‹ï¼Œå¦‚æœç”¨æˆ·æƒ³è¦æ–°å»ºä¸€ä¸ª NodePortï¼Œå¹¶ä¸ºå®ƒå›ºå®šçš„æŒ‡å®šä¸€ä¸ª Portï¼Œå…¶å®æ˜¯å­˜åœ¨ä¸€å®šçš„é£é™©çš„ã€‚ æœ‰å¯èƒ½æŒ‡å®šçš„ Port å·²ç»è¢«åˆ†é…å‡ºå»äº†ï¼Œè¿™æ ·å°±ä¼šå†²çªï¼Œå¯¼è‡´ Service åˆ›å»ºå¤±è´¥ã€‚</p><p>è¿™ä¸ª KEP æå‡ºäº†ä¸º NodePort ç±»å‹çš„ Services åŠ¨ã€é™æ€åœ°é¢„ç•™ä¸€æ®µå¯é€‰åŒºé—´ï¼Œå¹¶ä¸”æ”¯æŒä¸¤ç§æ–¹å¼è¿›è¡Œ Port é…ç½®ï¼š</p><ul><li>è‡ªåŠ¨åŒ–åœ°éšæœºç”Ÿæˆï¼ˆç”± Kubernetes æŒ‰ç…§è§„åˆ™è‡ªåŠ¨ç”Ÿæˆï¼‰</li><li>æ‰‹å·¥è®¾ç½®ï¼ˆç”±ç”¨æˆ·æ ¹æ®éœ€æ±‚è‡ªè¡Œè®¾å®šï¼‰ã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p>kube-apiserver å¯ä»¥é€šè¿‡ <code>--service-node-port-range</code> æ§åˆ¶ NodePort å¯ä»¥ä½¿ç”¨çš„ç«¯å£èŒƒå›´ï¼Œé»˜è®¤æ˜¯ <code>30000-32767</code>ã€‚åœ¨è¿™ä¸ª KEP ä¸­å¼•å…¥çš„è®¡ç®—å…¬å¼æ˜¯ï¼š<code>min(max($min, node-range-size/$step), $max)</code> ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š</p><ul><li>Service Node Port èŒƒå›´: 30000-32767</li><li>èŒƒå›´å¤§å°: 32767 - 30000 &#x3D; 2767</li><li>Band Offset: min(max(16,2767&#x2F;32),128) &#x3D; min(86,128) &#x3D; 86</li><li>Static band start: 30000</li><li>Static band ends: 30086</li></ul><p>æŒ‰ç…§è¿™ç§æ–¹å¼è®¡ç®—ï¼Œä¹Ÿå°±æ˜¯ 30000-30086 ä½œä¸º static æ®µï¼Œä¹‹åçš„ä½œä¸º dynamic æ®µã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line"> â”‚   static    â”‚                    dynamic                  â”‚</span><br><span class="line"> â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line"></span><br><span class="line"> â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º</span><br><span class="line">30000        30086                                          32767</span><br></pre></td></tr></table></figure><p>å¦‚æœç”¨æˆ·æƒ³è¦è‡ªå·±æŒ‡å®šä¸€ä¸ª NodePort çš„ç«¯å£ï¼Œè‹¥åœ¨ static èŒƒå›´å†…ï¼Œåˆ™ç›¸å¯¹æ¥è¯´ä¸å®¹æ˜“å‡ºç°å†²çªã€‚</p><p>ä¸è¿‡ï¼Œæ€»ä½“æ¥è¯´è¿™ä¸ªç‰¹æ€§å®é™…ä¸Šæ˜¯ä¸€ä¸ª Kubernetes å†…éƒ¨çš„ç‰¹æ€§ï¼Œå¤šæ•°æƒ…å†µä¸‹åªè¦è®°ä½ä¸€ä¸ªåŸåˆ™ï¼šâ€œæ‰‹åŠ¨æŒ‡å®š NodePort æ—¶å°½é‡é€‰æ‹©åœ¨ static èŒƒå›´ï¼ˆå‰æ®µï¼‰å†…å³å¯â€ã€‚å¦‚æœç”¨æˆ·æŒ‡å®šçš„ Port åœ¨ dynamic èŒƒå›´å†…ï¼Œå¦‚æœè¯¥ Port å°šæœªè¢«åˆ†é…ï¼Œåˆ™ä¹Ÿå¯ä»¥åˆ›å»ºæˆåŠŸã€‚</p><p>è¿™ç§è®¡ç®—æ–¹å¼å®é™…ä¸Šæ˜¯æ¥è‡ªäº KEP-3070ï¼Œç”¨äºç»™ Service åˆ†é… ClusterIP ä½¿ç”¨çš„ã€‚</p><h2 id="KEP-753ï¼šSidecarContainers-ç‰¹æ€§è¾¾åˆ°-Beta-å¹¶é»˜è®¤å¯ç”¨"><a href="#KEP-753ï¼šSidecarContainers-ç‰¹æ€§è¾¾åˆ°-Beta-å¹¶é»˜è®¤å¯ç”¨" class="headerlink" title="KEP-753ï¼šSidecarContainers ç‰¹æ€§è¾¾åˆ° Beta å¹¶é»˜è®¤å¯ç”¨"></a><a target="_blank" rel="noopener external nofollow noreferrer" href="https://moelove.info/2023/12/10/Kubernetes-v1.29-%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/#contents:kep-753sidecarcontainers-%E7%89%B9%E6%80%A7%E8%BE%BE%E5%88%B0-beta-%E5%B9%B6%E9%BB%98%E8%AE%A4%E5%90%AF%E7%94%A8">KEP-753ï¼šSidecarContainers ç‰¹æ€§è¾¾åˆ° Beta å¹¶é»˜è®¤å¯ç”¨</a></h2><p>Sidecars æ˜¯ä¸€ç§è¾…åŠ©å®¹å™¨ï¼Œå®ƒä»¬èƒ½å¤Ÿç»™ä¸»å®¹å™¨æ·»åŠ é¢å¤–åŠŸèƒ½ã€‚å°½ç®¡è¿™ç§æ¨¡å¼åœ¨ Service Mesh åœºæ™¯ç”¨ä¾‹æ›´å¤šï¼Œä½†å¾ˆå¤šç”¨æˆ·ä¹Ÿä¼šåœ¨é Service Mesh åœºæ™¯ä¸‹ä½¿ç”¨ï¼Œæ¯”å¦‚åƒæ—¥å¿—è®°å½•ã€ç›‘æ§ç­‰åœºæ™¯ã€‚</p><p>ä½†æ˜¯ä¹‹å‰ Sidecars åœ¨è¿™äº›åœºæ™¯ä¸­ä½¿ç”¨å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚å½“ Pod åˆ é™¤çš„æ—¶å€™ï¼Œç”±äº Sidecar å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†çš„ç¼ºå¤±ï¼Œä¼šå¯¼è‡´è¿™äº›æœåŠ¡å’Œä¸»å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸä¸åŒæ­¥ï¼Œè¿›è€Œå½±å“æœåŠ¡çš„å¯é æ€§ã€‚</p><p>è¿™ä¸ª KEP åœ¨ Pod è§„èŒƒä¸­å°† Sidecar å®¹å™¨å®šä¹‰ä¸º init containers çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”æŒ‡å®šå…¶å…·æœ‰â€œå§‹ç»ˆé‡å¯â€ç­–ç•¥ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">moelove-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">initContainers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">log</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">moelove/fluentbit</span></span><br><span class="line">    <span class="attr">restartPolicy:</span> <span class="string">Always</span></span><br><span class="line">    <span class="string">...</span></span><br></pre></td></tr></table></figure><p>åœ¨ Kubernetes v1.29 ç‰ˆæœ¬ä¸­è¯¥ç‰¹æ€§å°†é»˜è®¤å¯ç”¨ï¼ŒåŒæ—¶ Sidecar containers çš„åœæ­¢é¡ºåºå°†æŒ‰ç…§ä¸å®ƒä»¬å¯åŠ¨æ—¶å€™ç›¸åçš„é¡ºåºæ¥è¿›è¡Œï¼Œè¿™æ ·ä¸€æ–¹é¢å¯ä»¥ç¡®ä¿æ˜¯ä¸»å®¹å™¨å…ˆåœæ­¢çš„ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿä¾¿äºæ§åˆ¶æ‰€æœ‰ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><h2 id="KEP-3960-PreStop-Hook-å¼•å…¥-Sleep-åŠ¨ä½œï¼ˆAlphaï¼‰"><a href="#KEP-3960-PreStop-Hook-å¼•å…¥-Sleep-åŠ¨ä½œï¼ˆAlphaï¼‰" class="headerlink" title="KEP-3960: PreStop Hook å¼•å…¥ Sleep åŠ¨ä½œï¼ˆAlphaï¼‰"></a><a target="_blank" rel="noopener external nofollow noreferrer" href="https://moelove.info/2023/12/10/Kubernetes-v1.29-%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/#contents:kep-3960-prestop-hook-%E5%BC%95%E5%85%A5-sleep-%E5%8A%A8%E4%BD%9Calpha">KEP-3960: PreStop Hook å¼•å…¥ Sleep åŠ¨ä½œï¼ˆAlphaï¼‰</a></h2><p>è¿™ä¸ª KEP ä¹Ÿæ¯”è¾ƒæœ‰æ„æ€ï¼Œä¸»è¦æ˜¯ä¸ºäº†ç®€åŒ–ä¸€ä¸ªæœ€å¸¸è§çš„éœ€æ±‚ã€‚</p><p>å¾ˆå¤šåº”ç”¨ Pod åœ¨å…³é—­çš„æ—¶å€™ï¼Œéœ€è¦æ–­å¼€è¿æ¥ï¼Œä»¥å…å½±å“ç”¨æˆ·æµé‡ã€‚æ‰€ä»¥å¾ˆå¤šæ—¶å€™ä¼šåœ¨å…³é—­å‰è®¾ç½® PreStop æ¥è¿›è¡Œä¸€äº›ç›¸å…³çš„å¤„ç†æˆ–è€…ç­‰å¾…ã€‚</p><p>ä½†æ˜¯å½“å‰çš„ PreStop Hook åªæ”¯æŒ <code>exec</code> å’Œ <code>httpGet</code> è¿™ä¸¤ç§ï¼Œè¿™ä¸ª KEP æ˜¯æƒ³è¦å®ç°ä¸€ç§åŸç”Ÿçš„ <code>sleep</code> æ“ä½œï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.25.3</span></span><br><span class="line">        <span class="attr">lifecycle:</span></span><br><span class="line">          <span class="attr">preStop:</span></span><br><span class="line">            <span class="attr">sleep:</span></span><br><span class="line">              <span class="attr">seconds:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¯ä»¥å¾ˆç®€å•äº†ã€‚åœ¨å¼•å…¥è¿™ä¸ª KEP ä¹‹å‰ï¼Œéœ€è¦è®¾ç½®ä¸ºç±»ä¼¼ exec <code>sh -c &quot;sleep 5&quot;</code> è¿™æ ·ï¼Œè¿™éœ€è¦å®¹å™¨å†…è¿˜åŒ…å« <code>sleep</code> è¿™ä¸ªå‘½ä»¤æ‰è¡Œã€‚</p><p>ä¸è¿‡è¿™ä¸ªç‰¹æ€§ç›®å‰å¤„äº Alphaï¼Œèƒ½å¦æœ€ç»ˆ GA è¿˜éœ€è¦çœ‹çœ‹ç¤¾åŒºçš„åé¦ˆã€‚</p><h2 id="KEP-4193ï¼šæ”¹å–„-service-account-token-ç»‘å®šæœºåˆ¶ï¼ˆAlphaï¼‰"><a href="#KEP-4193ï¼šæ”¹å–„-service-account-token-ç»‘å®šæœºåˆ¶ï¼ˆAlphaï¼‰" class="headerlink" title="KEP-4193ï¼šæ”¹å–„ service account token ç»‘å®šæœºåˆ¶ï¼ˆAlphaï¼‰"></a><a target="_blank" rel="noopener external nofollow noreferrer" href="https://moelove.info/2023/12/10/Kubernetes-v1.29-%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/#contents:kep-4193%E6%94%B9%E5%96%84-service-account-token-%E7%BB%91%E5%AE%9A%E6%9C%BA%E5%88%B6alpha">KEP-4193ï¼šæ”¹å–„ service account token ç»‘å®šæœºåˆ¶ï¼ˆAlphaï¼‰</a></h2><p>åœ¨ Kubernetes ä¸­ï¼Œservice account token æ˜¯ä¿éšœå®‰å…¨æ€§ä¸å¯æˆ–ç¼ºçš„ä¸€ç¯ã€‚å®ƒä»¬ç”¨äºéªŒè¯é›†ç¾¤ä¸­å„ä¸ªå·¥ä½œè´Ÿè½½ï¼Œå¹¶ä¸”å¯ä»¥é˜²æ­¢æœªç»æˆæƒè®¿é—®ã€‚</p><p>Kubernetes v1.29 ä¸­è¿›ä¸€æ­¥åŠ å¼ºäº†å¯¹è¿™äº›ä»¤ç‰Œçš„å®‰å…¨ä¿æŠ¤ï¼šç°åœ¨æ¯ä¸ª service account ä»…èƒ½ä¸ç‰¹å®š Pod å®ä¾‹ç›¸å…³è”ï¼Œåœ¨å¤–æ³„åä¹Ÿæ— æ³•è¢«æ»¥ç”¨ã€‚è¿™ç§æ–¹å¼æœ‰æ•ˆåœ°å°† service account å’Œ Pod ç”Ÿå‘½å‘¨æœŸæ†ç»‘åœ¨ä¸€èµ·ï¼Œå¤§å¤§å‡å°‘äº†æ”»å‡»è€…åˆ©ç”¨ç›—å– token è¿›è¡Œæ”»å‡»çš„å¯èƒ½ã€‚</p><p>åœ¨ v1.29 ä¸­ kube-apiserver æœ‰å¦‚ä¸‹ç›¸å…³çš„ feature gates å¯ä»¥æ§åˆ¶ç›¸å…³çš„ç‰¹æ€§ï¼Œå½“ç„¶é™¤äº† KEP-4193 å¤–ï¼Œè¿™ä¸ªç‰ˆæœ¬ä¸­ä¹Ÿæ¨è¿›äº† KEP-2799ï¼Œå‡å°‘äº†åŸºäº secret çš„ service account tokenã€‚è¿™æœ‰åŠ©äºç¼©çŸ­ Token çš„æœ‰æ•ˆæ—¶é—´ï¼Œå°½å¯èƒ½çš„å‡å°‘æ”»å‡»é¢ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LegacyServiceAccountTokenCleanUp=true|false (BETA - default=true)</span><br><span class="line">ServiceAccountTokenJTI=true|false (ALPHA - default=false)</span><br><span class="line">ServiceAccountTokenNodeBinding=true|false (ALPHA - default=false)</span><br><span class="line">ServiceAccountTokenNodeBindingValidation=true|false (ALPHA - default=false)</span><br><span class="line">ServiceAccountTokenPodNodeInfo=true|false (ALPHA - default=false)</span><br></pre></td></tr></table></figure><h2 id="KEP-727ï¼šKubelet-Resource-Metrics-è¾¾åˆ°-GA"><a href="#KEP-727ï¼šKubelet-Resource-Metrics-è¾¾åˆ°-GA" class="headerlink" title="KEP-727ï¼šKubelet Resource Metrics è¾¾åˆ° GA"></a><a target="_blank" rel="noopener external nofollow noreferrer" href="https://moelove.info/2023/12/10/Kubernetes-v1.29-%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/#contents:kep-727kubelet-resource-metrics-%E8%BE%BE%E5%88%B0-ga">KEP-727ï¼šKubelet Resource Metrics è¾¾åˆ° GA</a></h2><p>è¿™æ˜¯ä¸€ä¸ªæœ‰å¾ˆé•¿å†å²çš„ KEP äº†ï¼Œä»å¼€å§‹æå‡ºåˆ°ç°åœ¨ GA ç”¨äº† 5 å¹´çš„æ—¶é—´ï¼Œä¸­é—´ä¹Ÿå‘ç”Ÿäº†å¾ˆå¤šæœ‰è¶£çš„äº‹æƒ…ã€‚è¿™æ¬¡ä¸»è¦æ¶‰åŠçš„éƒ¨åˆ†æ˜¯å¦‚ä¸‹ metricsï¼š</p><ul><li><code>container_cpu_usage_seconds_total</code></li><li><code>container_memory_working_set_bytes</code></li><li><code>container_start_time_seconds</code></li><li><code>node_cpu_usage_seconds_total</code></li><li><code>node_memory_working_set_bytes</code></li><li><code>pod_cpu_usage_seconds_total</code></li><li><code>pod_memory_working_set_bytes</code></li><li><code>resource_scrape_error</code></li></ul><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹çš„è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># HELP container_cpu_usage_seconds_total [STABLE] Cumulative cpu time consumed by the container in core-seconds</span><br><span class="line"># TYPE container_cpu_usage_seconds_total counter</span><br><span class="line">container_cpu_usage_seconds_total&#123;container=&quot;coredns&quot;,namespace=&quot;kube-system&quot;,pod=&quot;coredns-55968cc89d-bhhbx&quot;&#125; 0.195744 1691361886865</span><br><span class="line"># HELP container_memory_working_set_bytes [STABLE] Current working set of the container in bytes</span><br><span class="line"># TYPE container_memory_working_set_bytes gauge</span><br><span class="line">container_memory_working_set_bytes&#123;container=&quot;coredns&quot;,namespace=&quot;kube-system&quot;,pod=&quot;coredns-55968cc89d-bhhbx&quot;&#125; 1.675264e+07 1691361886865</span><br><span class="line"># HELP container_start_time_seconds [STABLE] Start time of the container since unix epoch in seconds</span><br><span class="line"># TYPE container_start_time_seconds gauge</span><br><span class="line">container_start_time_seconds&#123;container=&quot;coredns&quot;,namespace=&quot;kube-system&quot;,pod=&quot;coredns-55968cc89d-bhhbx&quot;&#125; 1.6913618235901163e+09 1691361823590</span><br><span class="line"># HELP node_cpu_usage_seconds_total [STABLE] Cumulative cpu time consumed by the node in core-seconds</span><br><span class="line"># TYPE node_cpu_usage_seconds_total counter</span><br><span class="line">node_cpu_usage_seconds_total 514578.636 1691361887931</span><br><span class="line"># HELP node_memory_working_set_bytes [STABLE] Current working set of the node in bytes</span><br><span class="line"># TYPE node_memory_working_set_bytes gauge</span><br><span class="line">node_memory_working_set_bytes 1.9501084672e+10 1691361887931</span><br><span class="line"># HELP pod_cpu_usage_seconds_total [STABLE] Cumulative cpu time consumed by the pod in core-seconds</span><br><span class="line"># TYPE pod_cpu_usage_seconds_total counter</span><br><span class="line">pod_cpu_usage_seconds_total&#123;namespace=&quot;kube-system&quot;,pod=&quot;coredns-55968cc89d-bhhbx&quot;&#125; 1.30598 1691361880003</span><br><span class="line"># HELP pod_memory_working_set_bytes [STABLE] Current working set of the pod in bytes</span><br><span class="line"># TYPE pod_memory_working_set_bytes gauge</span><br><span class="line">pod_memory_working_set_bytes&#123;namespace=&quot;kube-system&quot;,pod=&quot;coredns-55968cc89d-bhhbx&quot;&#125; 1.6715776e+07 1691361880003</span><br><span class="line"># HELP resource_scrape_error [STABLE] 1 if there was an error while getting container metrics, 0 otherwise</span><br><span class="line"># TYPE resource_scrape_error gauge</span><br><span class="line">resource_scrape_error 0</span><br><span class="line"># HELP scrape_error [ALPHA] 1 if there was an error while getting container metrics, 0 otherwise</span><br><span class="line"># TYPE scrape_error gauge</span><br><span class="line">scrape_error 0</span><br></pre></td></tr></table></figure><h2 id="KEP-3466-Kubernetes-Component-Health-SLIs-è¾¾åˆ°-GA"><a href="#KEP-3466-Kubernetes-Component-Health-SLIs-è¾¾åˆ°-GA" class="headerlink" title="KEP-3466: Kubernetes Component Health SLIs è¾¾åˆ° GA"></a><a target="_blank" rel="noopener external nofollow noreferrer" href="https://moelove.info/2023/12/10/Kubernetes-v1.29-%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/#contents:kep-3466-kubernetes-component-health-slis-%E8%BE%BE%E5%88%B0-ga">KEP-3466: Kubernetes Component Health SLIs è¾¾åˆ° GA</a></h2><p>è¿™ä¸ª KEP çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è®©æ¯ä¸ªç»„ä»¶æš´éœ²å®ƒä»¬è‡ªå·±çš„å¥åº·çŠ¶æ€ï¼Œä»¥ä¾¿äºå¯ä»¥æ ¹æ®å…¶å¥åº·çŠ¶æ€çš„ SLI è®¡ç®—é›†ç¾¤çš„ SLOã€‚</p><p>å¾ˆä¹…ä¹‹å‰ Kubernetes ä¸­å­˜åœ¨ä¸€ä¸ª ComponentStatusï¼Œå¯ä»¥ç”¨äºæŸ¥çœ‹é›†ç¾¤ä¸­ç»„ä»¶çš„çŠ¶æ€ã€‚ä½†æ­£å¦‚ä¸‹æ–¹æ‰€ç¤ºï¼Œåœ¨ v1.19 å·²ç»å®é™…ä¸ŠåºŸå¼ƒäº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">moelove@k8s-test:~$ kubectl  get cs</span><br><span class="line">Warning: v1 ComponentStatus is deprecated <span class="keyword">in</span> v1.19+</span><br><span class="line">NAME                 STATUS    MESSAGE   ERROR</span><br><span class="line">scheduler            Healthy   ok        </span><br><span class="line">etcd-0               Healthy   ok        </span><br><span class="line">controller-manager   Healthy   ok </span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æœŸæœ›èƒ½é€šè¿‡è¿™ä¸ª KEP ä½¿ç”¨å„ä¸ªç»„ä»¶çš„å¥åº·çŠ¶æ€ä½œä¸º SLIï¼Œé‡‡é›†èšåˆåï¼Œè®¡ç®—å‡ºé›†ç¾¤çš„ SLOã€‚è¿›è€Œå¯ä»¥ç»™å‡º SLAã€‚ï¼ˆå…³äºå®ƒä»¬ä¹‹é—´çš„å…³ç³»æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥æœç´¢ä¸‹ç›¸å…³å†…å®¹ï¼‰</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹çš„è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">tao@moelove:/$ kubectl get --raw &quot;/metrics/slis&quot;</span><br><span class="line"># HELP kubernetes_healthcheck [STABLE] This metric records the result of a single healthcheck.</span><br><span class="line"># TYPE kubernetes_healthcheck gauge</span><br><span class="line">kubernetes_healthcheck&#123;name=&quot;etcd&quot;,type=&quot;healthz&quot;&#125; 1</span><br><span class="line">kubernetes_healthcheck&#123;name=&quot;etcd&quot;,type=&quot;livez&quot;&#125; 1</span><br><span class="line">kubernetes_healthcheck&#123;name=&quot;etcd&quot;,type=&quot;readyz&quot;&#125; 1</span><br><span class="line">kubernetes_healthcheck&#123;name=&quot;etcd-readiness&quot;,type=&quot;readyz&quot;&#125; 1</span><br><span class="line">kubernetes_healthcheck&#123;name=&quot;informer-sync&quot;,type=&quot;readyz&quot;&#125; 1</span><br><span class="line">kubernetes_healthcheck&#123;name=&quot;ping&quot;,type=&quot;healthz&quot;&#125; 1</span><br><span class="line">kubernetes_healthcheck&#123;name=&quot;ping&quot;,type=&quot;livez&quot;&#125; 1</span><br><span class="line">kubernetes_healthcheck&#123;name=&quot;ping&quot;,type=&quot;readyz&quot;&#125; 1</span><br></pre></td></tr></table></figure><h2 id="å·²çŸ¥é—®é¢˜"><a href="#å·²çŸ¥é—®é¢˜" class="headerlink" title="å·²çŸ¥é—®é¢˜"></a><a target="_blank" rel="noopener external nofollow noreferrer" href="https://moelove.info/2023/12/10/Kubernetes-v1.29-%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/#contents:%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98">å·²çŸ¥é—®é¢˜</a></h2><p><code>EventedPLEG</code> è¿™ä¸ªç‰¹æ€§åœ¨ v1.27 ä¸­å‡çº§åˆ°äº† Betaï¼Œä½†æ˜¯åœ¨æ–°ç‰ˆæœ¬çš„æµ‹è¯•ä¸­å‘ç°äº†æ¯”è¾ƒå¤šçš„é—®é¢˜ï¼Œæ‰€ä»¥ç°åœ¨å°†å®ƒé»˜è®¤ç¦ç”¨äº†ï¼Œå¾…ç¤¾åŒºä¿®å¤åä¼šå†æ‰“å¼€ã€‚<strong>å»ºè®®åœ¨ v1.29 ä¸­å…ˆå…³é—­æ­¤ç‰¹æ€§</strong></p><h2 id="å…¶ä»–-3"><a href="#å…¶ä»–-3" class="headerlink" title="å…¶ä»–"></a><a target="_blank" rel="noopener external nofollow noreferrer" href="https://moelove.info/2023/12/10/Kubernetes-v1.29-%E6%96%B0%E7%89%B9%E6%80%A7%E4%B8%80%E8%A7%88/#contents:%E5%85%B6%E4%BB%96">å…¶ä»–</a></h2><ul><li>KEP-2495: PV&#x2F;PVC <code>ReadWriteOncePod</code> è¾¾åˆ° GA</li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/kubernetes/enhancements/issues/3107">NodeExpandSecret</a> ç‰¹æ€§è¾¾åˆ° GA</li><li>kube-proxy æœ‰äº†ä¸ª nftables çš„æ–°åç«¯</li></ul></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…:</span> <span class="post-copyright-info"><a href="https://xiaowu95.wang">å°äº”</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥:</span> <span class="post-copyright-info"><a href="https://xiaowu95.wang/posts/1dca4389/">https://xiaowu95.wang/posts/1dca4389/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜:</span> <span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://xiaowu95.wang" target="_blank">å°äº”çš„ä¸ªäººæ‚è´§é“º</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/k8s/">k8s</a><a class="post-meta__tags" href="/tags/%E5%AE%B9%E5%99%A8%E5%8C%96/">å®¹å™¨åŒ–</a><a class="post-meta__tags" href="/tags/k3s/">k3s</a></div><div class="post-share"><div class="social-share" data-image="/img/nba-logo8.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>æ„Ÿè°¢æ”¯æŒ</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wxpay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-lazy-src="/img/wxpay.jpg" alt="å¾®ä¿¡"></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-lazy-src="/img/alipay.jpg" alt="æ”¯ä»˜å®"></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/b979a46f/" title="k8såœ¨ä¸åŒæˆ–ç›¸åŒnamespaceä¸‹æœåŠ¡é—´è®¿é—®"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo26.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">k8såœ¨ä¸åŒæˆ–ç›¸åŒnamespaceä¸‹æœåŠ¡é—´è®¿é—®</div></div><div class="info-2"><div class="info-item-1">åŒä¸€ä¸ªåç§°ç©ºé—´ k8sç»™æ¯ä¸ªå†…éƒ¨å¾®æœåŠ¡æä¾›äº†ä¸€ä¸ªå†…éƒ¨ä½¿ç”¨çš„hostï¼Œå°±æ˜¯.ã€‚å¯ä»¥åœ¨ä»£ç ä¸­ç›´æ¥è®¿é—®[http:&#x2F;&#x2F;.:],æ¥è¾¾åˆ°è®¿é—®å¦ä¸€ä¸ªæœåŠ¡ã€‚å¦‚æœæ˜¯éƒ¨ç½²åˆ°é»˜è®¤namespaceä¸‹çš„æœåŠ¡ï¼Œnamespaceä¸ºâ€œdefaultâ€ã€‚ ä¸åŒåç§°ç©ºé—´ æ— è®ºæ˜¯ç›¸åŒè¿˜æ˜¯ä¸åŒåç§°ç©ºé—´éƒ½å¯ä»¥é€šè¿‡&#123;SERVICE_NAME&#125;.&#123;NAMESPACE_NAME&#125;.svc.cluster.localæˆ–è€…&#123;SERVICE_NAME&#125;.&#123;NAMESPACE_NAME&#125;jinxè®¿é—® æ‰€ä»¥,Namespaceæ˜¯å½¢æˆé€»è¾‘ä¸Šçš„&quot;ç»„&quot;ï¼Œä»¥æ–¹ä¾¿ä¸åŒçš„ç»„çš„èµ„æºè¿›è¡Œéš”ç¦»ä½¿ç”¨å’Œç®¡ç†ã€‚ ä¾‹å­: &quot;default.svc.cluster.local&quot;ã€‚&quot;default&quot; æ˜¯æˆ‘ä»¬æ­£åœ¨æ“ä½œçš„å‘½åç©ºé—´ã€‚ &quot;svc&quot; è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª Serviceã€‚&quot;cluster.local&quot; æ˜¯ä½ çš„é›†ç¾¤åŸŸï¼Œåœ¨ä½ è‡ªå·±çš„é›†ç¾¤ä¸­å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚</div></div></div></a><a class="pagination-related" href="/posts/e30c6174/" title="k8sçŸ¥è¯†è¡¥å……è®°å½•"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo30.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">k8sçŸ¥è¯†è¡¥å……è®°å½•</div></div><div class="info-2"><div class="info-item-1">ç½‘ç«™è®°å½•K8Sè®­ç»ƒè¥kubectlè‡ªåŠ¨è¡¥å…¨ä»¥åŠå‘½ä»¤å¤§å…¨kubectlè‡ªåŠ¨è¡¥å…¨ä»¥åŠå‘½ä»¤å¤§å…¨githubåœ°å€k8sä¸­æ–‡æ–‡æ¡£1k8sä¸­æ–‡æ–‡æ¡£2k8s API å‚è€ƒå…³äºDeploymentçš„èµ„æºæ–‡ä»¶ç¼–å†™123451,åœ¨Deploymentä¸­å¿…é¡»å†™matchLables, 2,åœ¨å®šä¹‰æ¨¡æ¿çš„æ—¶å€™å¿…é¡»å®šä¹‰labels,å› ä¸ºDeployment.spec.selectoræ˜¯å¿…é¡»å­—æ®µ,è€Œä»–åˆå¿…é¡»å’Œtemplate.labelså¯¹åº”, 3,templateé‡Œé¢å®šä¹‰çš„å†…å®¹ä¼šåº”ç”¨åˆ°ä¸‹é¢æ‰€æœ‰çš„å‰¯æœ¬é›†é‡Œé¢,åœ¨template.spec.containersé‡Œé¢ä¸èƒ½å®šä¹‰labelsæ ‡ç­¾. æŒ‡ä»¤è®°å½•k8s æ¸…ç†namespace(å‘½åç©ºé—´)èµ„æº12345671. æŸ¥æ‰¾æ‰€æœ‰å½“å‰namespaceä¸‹çš„èµ„æºkubectl api-resources --verbs=list --namespaced -o name | xargs -n 1 kubectl get --show-kind --ignore-not-found -n &lt;ns&gt;2. åˆ é™¤å¯¹åº”èµ„æºkubectl get ingress -n ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/bbffb116/" title="kubeconfigæ–‡ä»¶è¯¦è§£"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo26.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2023-09-26</div><div class="info-item-2">kubeconfigæ–‡ä»¶è¯¦è§£</div></div><div class="info-2"><div class="info-item-1">åœ¨nodeèŠ‚ç‚¹ä¸Šå¯ä»¥æ‰§è¡Œkubectlå‘½ä»¤å—ï¼Ÿ 12[root@k8s-node1 ~]# kubectl get nodeThe connection to the server localhost:8080 was refused - did you specify the right host or port? localhost:8080 è¿™ä¸ªç«¯å£æ˜¯k8s apiï¼ˆkube-apiserveréå®‰å…¨ç«¯å£ï¼‰çš„ç«¯å£ï¼Œ*åœ¨masterä¸Šé¢å¯ä»¥æ‰§è¡ŒæˆåŠŸå…¶å®èµ°çš„æ˜¯é…ç½®æ–‡ä»¶ã€‚ä½†æ˜¯åœ¨nodeä¸Šè¿æ¥çš„æ˜¯æœ¬åœ°çš„éå®‰å…¨ç«¯å£ã€‚* å…¶å®è¿˜æœ‰ä¸€ä¸ªå¯¹å¤–ç«¯å£æ˜¯6443ï¼Œè¿™ä¸ªæ˜¯kube-apiserverç›‘å¬çš„ï¼Œmasterip:6443å®‰å…¨ç«¯å£ 12[root@k8s-master ~]# netstat -tpln | grep 6443tcp6 0 0 :::6443 :::* LISTEN 92617/kube-apiserve ä»€ä¹ˆå«å®‰å…¨ç«¯å£ï¼Œä»€ä¹ˆå«éå®‰å…¨ç«¯å£ kube-apiserve...</div></div></div></a><a class="pagination-related" href="/posts/67fd0ae0/" title="helmå‘½ä»¤"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2025-01-10</div><div class="info-item-2">helmå‘½ä»¤</div></div><div class="info-2"><div class="info-item-1">æŸ¥çœ‹æ‰€æœ‰repo1helm repo list åˆ é™¤repo1helm repo remove stable æ·»åŠ repo1helm repo add stable https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts æ›´æ–°1helm repo update ä¸‹è½½æŒ‡å®šç‰ˆæœ¬Rancher ç‰ˆæœ¬ tgz å‹ç¼©åŒ…åˆ°æœ¬åœ°1helm fetch rancher-stable/rancher --version=v2.5.8 éƒ¨ç½²å‡çº§,æŠŠè¯»å–çš„éƒ¨ç½²å‚æ•°ä½¿ç”¨ --set &lt;key&gt;=&lt;value&gt; çš„æ–¹å¼æ·»åŠ åˆ°å‘½ä»¤ä¸­1234helm upgrade rancher rancher-stable/rancher \--namespace cattle-system \--set ingress.tls.source=secret \--set hostname=&lt;domain_name&gt; helmå‘½ä»¤å¤§å…¨ - é“¾æ¥</div></div></div></a><a class="pagination-related" href="/posts/af2a1e86/" title="helmçš„å®‰è£…"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo21.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2023-08-09</div><div class="info-item-2">helmçš„å®‰è£…</div></div><div class="info-2"><div class="info-item-1">ä¸‹è½½helm3.81wget https://get.helm.sh/helm-v3.8.0-linux-amd64.tar.gz è§£å‹1tar -zxvf helm-v3.8.0-linux-amd64.tar.gz èµ‹æƒ1mv linux-amd64/helm /usr/local/bin/helm &amp;&amp; chmod +x /usr/local/bin/helm</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-lazy-src="/img/avatar.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">å°äº”</div><div class="author-info-description">Tomorrow will be better,Everything will be fine</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">554</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">168</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">55</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/wang-xiaowu"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons"><a class="social-icon" href="/random" target="_blank" title="éšä¾¿é€›é€›"><i class="fa-solid fa-shuffle"></i></a><a class="social-icon" href="mailto:wangxiaowu950330@foxmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/30655189?spm_id_from=333.1007.0.0" rel="external nofollow noreferrer" target="_blank" title="BiliBili"><i class="fa-brands fa-bilibili"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa-solid fa-rss"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Kubernetes-v1-22"><span class="toc-number">1.</span> <span class="toc-text">Kubernetes v1.22</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Server-side-Apply-%E7%89%B9%E6%80%A7%E8%BE%BE%E5%88%B0-GA"><span class="toc-number">1.1.</span> <span class="toc-text">Server-side Apply ç‰¹æ€§è¾¾åˆ° GA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pod-Security-Policy-%E7%9A%84%E6%9B%BF%E4%BB%A3%E5%93%81"><span class="toc-number">1.2.</span> <span class="toc-text">Pod Security Policy çš„æ›¿ä»£å“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-swap-%E6%94%AF%E6%8C%81"><span class="toc-number">1.3.</span> <span class="toc-text">Node swap æ”¯æŒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%87%AD%E8%AF%81%E6%8F%90%E4%BE%9B%E5%B7%A5%E5%85%B7"><span class="toc-number">1.4.</span> <span class="toc-text">å¤–éƒ¨å®¢æˆ·ç«¯å‡­è¯æä¾›å·¥å…·</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E7%B4%A2%E5%BC%95%E7%9A%84-Job-API"><span class="toc-number">1.5.</span> <span class="toc-text">å¯ç´¢å¼•çš„ Job API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA-Job-API-%E5%A2%9E%E5%8A%A0-suspend-%E5%AD%97%E6%AE%B5"><span class="toc-number">1.6.</span> <span class="toc-text">ä¸º Job API å¢åŠ  suspend å­—æ®µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSR-%E7%9A%84%E6%9C%89%E6%95%88%E6%9C%9F"><span class="toc-number">1.7.</span> <span class="toc-text">CSR çš„æœ‰æ•ˆæœŸ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E8%B5%84%E6%BA%90%E7%9A%84-QoS"><span class="toc-number">1.8.</span> <span class="toc-text">å†…å­˜èµ„æºçš„ QoS</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kubernetes-v1-23"><span class="toc-number">2.</span> <span class="toc-text">Kubernetes v1.23</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E-kubectl-alpha-events-%E5%91%BD%E4%BB%A4"><span class="toc-number">2.1.</span> <span class="toc-text">æ–°å¢ kubectl alpha events å‘½ä»¤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IPv4-IPv6-%E5%8F%8C%E6%A0%88%E6%94%AF%E6%8C%81%E8%BE%BE%E5%88%B0-GA"><span class="toc-number">2.2.</span> <span class="toc-text">IPv4&#x2F;IPv6 åŒæ ˆæ”¯æŒè¾¾åˆ° GA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PodSecurity-Admission-%E8%BE%BE%E5%88%B0-Beta"><span class="toc-number">2.3.</span> <span class="toc-text">PodSecurity Admission è¾¾åˆ° Beta</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IngressClass-%E6%94%AF%E6%8C%81-namespace-%E7%BA%A7%E5%88%AB%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">2.4.</span> <span class="toc-text">IngressClass æ”¯æŒ namespace çº§åˆ«çš„å‚æ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Probe-%E4%B8%AD%E5%A2%9E%E5%8A%A0-gRPC-%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%94%AF%E6%8C%81"><span class="toc-number">2.5.</span> <span class="toc-text">Probe ä¸­å¢åŠ  gRPC åè®®çš„æ”¯æŒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E-OpenAPI-V3"><span class="toc-number">2.6.</span> <span class="toc-text">æ–°å¢ OpenAPI V3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CRD-Validation-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%AD%E8%A8%80"><span class="toc-number">2.7.</span> <span class="toc-text">CRD Validation è¡¨è¾¾å¼è¯­è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HPA-v2-API-%E8%BE%BE%E5%88%B0-GA"><span class="toc-number">2.8.</span> <span class="toc-text">HPA v2 API è¾¾åˆ° GA</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kubernetes-v1-24"><span class="toc-number">3.</span> <span class="toc-text">Kubernetes v1.24</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%84beta-API%E9%BB%98%E8%AE%A4%E5%85%B3%E9%97%AD"><span class="toc-number">3.1.</span> <span class="toc-text">å„beta APIé»˜è®¤å…³é—­</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OpenAPI-v3"><span class="toc-number">3.2.</span> <span class="toc-text">OpenAPI v3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%AE%B9%E9%87%8F%E4%B8%8E%E5%AD%98%E5%82%A8%E5%8D%B7%E6%89%A9%E5%B1%95%E5%8F%8C%E5%8F%8C%E8%BF%8E%E6%9D%A5%E9%80%9A%E7%94%A8%E7%89%88%E6%9C%AC"><span class="toc-number">3.3.</span> <span class="toc-text">å­˜å‚¨å®¹é‡ä¸å­˜å‚¨å·æ‰©å±•åŒåŒè¿æ¥é€šç”¨ç‰ˆæœ¬</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NonPreemptingPriority%E8%BF%8E%E6%9D%A5%E7%A8%B3%E5%AE%9A%E7%89%88"><span class="toc-number">3.4.</span> <span class="toc-text">NonPreemptingPriorityè¿æ¥ç¨³å®šç‰ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E6%8F%92%E4%BB%B6%E8%BF%81%E7%A7%BB"><span class="toc-number">3.5.</span> <span class="toc-text">å­˜å‚¨æ’ä»¶è¿ç§»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gRPC%E6%8E%A2%E9%92%88%E5%8D%87%E7%BA%A7%E8%87%B3beta%E7%89%88"><span class="toc-number">3.6.</span> <span class="toc-text">gRPCæ¢é’ˆå‡çº§è‡³betaç‰ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kubelet%E8%AF%81%E4%B9%A6%E6%8F%90%E4%BE%9B%E7%A8%8B%E5%BA%8F%E5%8D%87%E7%BA%A7%E8%87%B3beta%E7%89%88"><span class="toc-number">3.7.</span> <span class="toc-text">Kubeletè¯ä¹¦æä¾›ç¨‹åºå‡çº§è‡³betaç‰ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E4%B8%BA%E6%9C%8D%E5%8A%A1%E5%88%86%E9%85%8DIP%E6%97%B6%E5%8F%91%E7%94%9F%E5%86%B2%E7%AA%81"><span class="toc-number">3.8.</span> <span class="toc-text">é¿å…ä¸ºæœåŠ¡åˆ†é…IPæ—¶å‘ç”Ÿå†²çª</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kubernetes-v1-25"><span class="toc-number">4.</span> <span class="toc-text">Kubernetes v1.25</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#core-CSI-Migration-%E8%BE%BE%E5%88%B0-Stable"><span class="toc-number">4.1.</span> <span class="toc-text">core CSI Migration è¾¾åˆ° Stable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cgroup-v2-%E6%94%AF%E6%8C%81%E8%BE%BE%E5%88%B0-GA"><span class="toc-number">4.2.</span> <span class="toc-text">cgroup v2 æ”¯æŒè¾¾åˆ° GA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PodSecurity-%E7%89%B9%E6%80%A7%E8%BE%BE%E5%88%B0-GA"><span class="toc-number">4.3.</span> <span class="toc-text">PodSecurity ç‰¹æ€§è¾¾åˆ° GA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E6%AD%A5%E6%94%AF%E6%8C%81-user-namespaces"><span class="toc-number">4.4.</span> <span class="toc-text">åˆæ­¥æ”¯æŒ user namespaces</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CronJobTimeZone-%E8%BE%BE%E5%88%B0-Beta-%E7%BA%A7%E5%88%AB"><span class="toc-number">4.5.</span> <span class="toc-text">CronJobTimeZone è¾¾åˆ° Beta çº§åˆ«</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E5%85%A5-alpha-%E7%89%B9%E6%80%A7-ContainerCheckpoint"><span class="toc-number">4.6.</span> <span class="toc-text">å¼•å…¥ alpha ç‰¹æ€§ ContainerCheckpoint</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA-kubectl-%E5%BC%95%E5%85%A5-kuberc-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">4.7.</span> <span class="toc-text">ä¸º kubectl å¼•å…¥ kuberc é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA-kubectl-%E6%B7%BB%E5%8A%A0-subresource-%E7%9A%84%E8%A1%A5%E5%85%A8"><span class="toc-number">4.8.</span> <span class="toc-text">ä¸º kubectl æ·»åŠ  --subresource çš„è¡¥å…¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">4.9.</span> <span class="toc-text">å…¶ä»–</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kubernetes-v1-26"><span class="toc-number">5.</span> <span class="toc-text">Kubernetes v1.26</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3294-%E5%85%81%E8%AE%B8%E8%B7%A8-namespace-%E6%8C%81%E4%B9%85%E5%8C%96%E5%8D%B7%E5%BF%AB%E7%85%A7%E5%BC%95%E7%94%A8"><span class="toc-number">5.1.</span> <span class="toc-text">#3294 å…è®¸è·¨ namespace æŒä¹…åŒ–å·å¿«ç…§å¼•ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3488-%E5%85%81%E8%AE%B8%E4%BD%BF%E7%94%A8-CEL-%E8%BF%9B%E8%A1%8C-Admission-Control"><span class="toc-number">5.2.</span> <span class="toc-text">#3488 å…è®¸ä½¿ç”¨ CEL è¿›è¡Œ Admission Control</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3545-%E6%94%B9%E5%96%84-NUMA-%E4%B8%AD%E7%9A%84%E6%8B%93%E6%89%91%E7%AE%A1%E7%90%86"><span class="toc-number">5.3.</span> <span class="toc-text">#3545 æ”¹å–„ NUMA ä¸­çš„æ‹“æ‰‘ç®¡ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#113274-%E4%B8%BA-Pod-%E8%B0%83%E5%BA%A6%E5%A2%9E%E5%8A%A0%E8%B0%83%E5%BA%A6%E5%B0%B1%E7%BB%AA%E7%9A%84%E6%9C%BA%E5%88%B6"><span class="toc-number">5.4.</span> <span class="toc-text">#113274 ä¸º Pod è°ƒåº¦å¢åŠ è°ƒåº¦å°±ç»ªçš„æœºåˆ¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%BB%E9%99%A4-CRI-v1alpha2"><span class="toc-number">5.5.</span> <span class="toc-text">ç§»é™¤ CRI v1alpha2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#111333-Auth-API-%E5%85%81%E8%AE%B8%E8%8E%B7%E5%8F%96-User-%E5%B1%9E%E6%80%A7"><span class="toc-number">5.6.</span> <span class="toc-text">#111333 Auth API å…è®¸è·å– User å±æ€§</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3386-%E5%87%8F%E5%B0%91-Kubelet-%E5%9C%A8-PLEG-%E4%B8%AD%E7%9A%84-CPU-%E6%B6%88%E8%80%97"><span class="toc-number">5.7.</span> <span class="toc-text">#3386 å‡å°‘ Kubelet åœ¨ PLEG ä¸­çš„ CPU æ¶ˆè€—</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96-1"><span class="toc-number">5.8.</span> <span class="toc-text">å…¶ä»–</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kubernetes-v1-27"><span class="toc-number">6.</span> <span class="toc-text">Kubernetes v1.27</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SeccompDefault-%E8%BE%BE%E5%88%B0-Stable"><span class="toc-number">6.1.</span> <span class="toc-text">SeccompDefault è¾¾åˆ° Stable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pod-%E8%B0%83%E5%BA%A6%E5%B0%B1%E7%BB%AA%E6%9C%BA%E5%88%B6%E8%BE%BE%E5%88%B0-Beta"><span class="toc-number">6.2.</span> <span class="toc-text">Pod è°ƒåº¦å°±ç»ªæœºåˆ¶è¾¾åˆ° Beta</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E-NodeLogQuery-%E7%89%B9%E6%80%A7-KEP-2258"><span class="toc-number">6.3.</span> <span class="toc-text">æ–°å¢ NodeLogQuery ç‰¹æ€§ - KEP-2258</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-CEL-%E7%9A%84-Admission-Control"><span class="toc-number">6.4.</span> <span class="toc-text">åŸºäº CEL çš„ Admission Control</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pod-In-place-%E5%8E%9F%E5%9C%B0%E4%BC%B8%E7%BC%A9%E8%83%BD%E5%8A%9B"><span class="toc-number">6.5.</span> <span class="toc-text">Pod In-place åŸåœ°ä¼¸ç¼©èƒ½åŠ›</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%BA%9F%E5%BC%83%E6%8F%90%E9%86%92"><span class="toc-number">6.6.</span> <span class="toc-text">ä¸€äº›åºŸå¼ƒæé†’</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%86%8D%E6%8F%90%E4%BE%9B%E7%9A%84API%E7%89%88%E6%9C%AC%EF%BC%9A"><span class="toc-number">6.6.1.</span> <span class="toc-text">ä¸å†æä¾›çš„APIç‰ˆæœ¬ï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%B2%E5%BC%83%E7%94%A8%EF%BC%8C%E5%9C%A8%E4%B8%8B%E4%B8%80%E4%B8%AA%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83%E4%B9%8B%E5%89%8D%E5%AE%9E%E7%8E%B0%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88%EF%BC%9A"><span class="toc-number">6.6.2.</span> <span class="toc-text">å·²å¼ƒç”¨ï¼Œåœ¨ä¸‹ä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒä¹‹å‰å®ç°æ›¿ä»£æ–¹æ¡ˆï¼š</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%B2%E5%88%A0%E9%99%A4"><span class="toc-number">6.6.3.</span> <span class="toc-text">å·²åˆ é™¤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kubernetes-v1-28"><span class="toc-number">7.</span> <span class="toc-text">Kubernetes v1.28</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Kubernetes-%E9%9B%86%E7%BE%A4%E5%8F%AF%E4%BB%A5%E7%9C%9F%E6%AD%A3%E5%B9%B4%E5%BA%A6%E5%8D%87%E7%BA%A7%E4%BA%86"><span class="toc-number">7.1.</span> <span class="toc-text">Kubernetes é›†ç¾¤å¯ä»¥çœŸæ­£å¹´åº¦å‡çº§äº†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-CEL-%E7%9A%84-Admission-Control-%E8%BE%BE%E5%88%B0-Beta"><span class="toc-number">7.2.</span> <span class="toc-text">åŸºäº CEL çš„ Admission Control è¾¾åˆ° Beta</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CRD-%E4%BD%BF%E7%94%A8-CEL-%E8%BF%9B%E8%A1%8C-Validate-%E7%9A%84%E7%89%B9%E6%80%A7%E5%86%8D%E6%AC%A1%E8%BE%BE%E5%88%B0-Beta"><span class="toc-number">7.3.</span> <span class="toc-text">CRD ä½¿ç”¨ CEL è¿›è¡Œ Validate çš„ç‰¹æ€§å†æ¬¡è¾¾åˆ° Beta</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E4%BC%98%E9%9B%85%E7%9A%84%E8%8A%82%E7%82%B9%E5%85%B3%E9%97%AD%E7%89%B9%E6%80%A7%E8%BE%BE%E5%88%B0-GA"><span class="toc-number">7.4.</span> <span class="toc-text">éä¼˜é›…çš„èŠ‚ç‚¹å…³é—­ç‰¹æ€§è¾¾åˆ° GA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96-2"><span class="toc-number">7.5.</span> <span class="toc-text">å…¶ä»–</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kubernetes-v1-29"><span class="toc-number">8.</span> <span class="toc-text">Kubernetes v1.29</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#KEP-2876-%E5%9F%BA%E4%BA%8E-CEL-%E7%9A%84-CRD-%E8%A7%84%E5%88%99%E6%A0%A1%E9%AA%8C%E6%AD%A3%E5%BC%8F%E8%BE%BE%E5%88%B0-GA"><span class="toc-number">8.1.</span> <span class="toc-text">KEP-2876: åŸºäº CEL çš„ CRD è§„åˆ™æ ¡éªŒæ­£å¼è¾¾åˆ° GA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KEP-3668-%E4%B8%BA%E5%8A%A8%E6%80%81%E5%92%8C%E9%9D%99%E6%80%81%E5%88%86%E9%85%8D%E9%A2%84%E7%95%99-NodePort-%E7%AB%AF%E5%8F%A3%E8%8C%83%E5%9B%B4%E8%BE%BE%E5%88%B0-stable"><span class="toc-number">8.2.</span> <span class="toc-text">KEP-3668: ä¸ºåŠ¨æ€å’Œé™æ€åˆ†é…é¢„ç•™ NodePort ç«¯å£èŒƒå›´è¾¾åˆ° stable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KEP-753%EF%BC%9ASidecarContainers-%E7%89%B9%E6%80%A7%E8%BE%BE%E5%88%B0-Beta-%E5%B9%B6%E9%BB%98%E8%AE%A4%E5%90%AF%E7%94%A8"><span class="toc-number">8.3.</span> <span class="toc-text">KEP-753ï¼šSidecarContainers ç‰¹æ€§è¾¾åˆ° Beta å¹¶é»˜è®¤å¯ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KEP-3960-PreStop-Hook-%E5%BC%95%E5%85%A5-Sleep-%E5%8A%A8%E4%BD%9C%EF%BC%88Alpha%EF%BC%89"><span class="toc-number">8.4.</span> <span class="toc-text">KEP-3960: PreStop Hook å¼•å…¥ Sleep åŠ¨ä½œï¼ˆAlphaï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KEP-4193%EF%BC%9A%E6%94%B9%E5%96%84-service-account-token-%E7%BB%91%E5%AE%9A%E6%9C%BA%E5%88%B6%EF%BC%88Alpha%EF%BC%89"><span class="toc-number">8.5.</span> <span class="toc-text">KEP-4193ï¼šæ”¹å–„ service account token ç»‘å®šæœºåˆ¶ï¼ˆAlphaï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KEP-727%EF%BC%9AKubelet-Resource-Metrics-%E8%BE%BE%E5%88%B0-GA"><span class="toc-number">8.6.</span> <span class="toc-text">KEP-727ï¼šKubelet Resource Metrics è¾¾åˆ° GA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KEP-3466-Kubernetes-Component-Health-SLIs-%E8%BE%BE%E5%88%B0-GA"><span class="toc-number">8.7.</span> <span class="toc-text">KEP-3466: Kubernetes Component Health SLIs è¾¾åˆ° GA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%B2%E7%9F%A5%E9%97%AE%E9%A2%98"><span class="toc-number">8.8.</span> <span class="toc-text">å·²çŸ¥é—®é¢˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96-3"><span class="toc-number">8.9.</span> <span class="toc-text">å…¶ä»–</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/d31147a5/" title="Clawdbotå®Œæ•´é…ç½®æŒ‡å—"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo16.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Clawdbotå®Œæ•´é…ç½®æŒ‡å—"></a><div class="content"><a class="title" href="/posts/d31147a5/" title="Clawdbotå®Œæ•´é…ç½®æŒ‡å—">Clawdbotå®Œæ•´é…ç½®æŒ‡å—</a><time datetime="2026-02-11T10:15:08.000Z" title="å‘è¡¨äº 2026-02-11 18:15:08">2026-02-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4d3a9a89/" title="å¤„ç† Rancher è¿æ¥èŠ‚ç‚¹ &quot;Cluster agent is not connected&quot;"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo29.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="å¤„ç† Rancher è¿æ¥èŠ‚ç‚¹ &quot;Cluster agent is not connected&quot;"></a><div class="content"><a class="title" href="/posts/4d3a9a89/" title="å¤„ç† Rancher è¿æ¥èŠ‚ç‚¹ &quot;Cluster agent is not connected&quot;">å¤„ç† Rancher è¿æ¥èŠ‚ç‚¹ &quot;Cluster agent is not connected&quot;</a><time datetime="2026-02-03T06:02:28.000Z" title="å‘è¡¨äº 2026-02-03 14:02:28">2026-02-03</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/nba-logo8.jpg)"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2019 - 2026 By å°äº”</span><span class="framework-info"><span>æ¡†æ¶</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.1</a></span></div><div class="footer_custom_text"><a href="https://www.foreverblog.cn/" rel="external nofollow noreferrer" target="_blank"><img src="/img/loading.gif" data-lazy-src="https://img.foreverblog.cn/logo_en_default.png" alt="åå¹´ä¹‹çº¦" style="width:auto;height:16px"></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.1/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.1/source/js/main.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.1/source/js/tw_cn.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(()=>{const e=()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");if(0===e.length)return;const t=()=>(e=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";e.forEach(((e,n)=>{const d=e.firstElementChild,a=`mermaid-${n}`,r=`%%{init:{ 'theme':'${t}'}}%%\n`+d.textContent,i=mermaid.render(a,r),m=e=>{d.insertAdjacentHTML("afterend",e)};"string"==typeof i?m(i):i.then((({svg:e})=>m(e)))}))})(e);btf.addGlobalFn("themeChange",t,"mermaid"),window.loadMermaid?t():btf.getScript("https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js").then(t)};btf.addGlobalFn("encrypt",e,"mermaid"),window.pjax?e():document.addEventListener("DOMContentLoaded",e)})()</script><script>(()=>{const t=(e,a)=>{"object"==typeof e&&null!==e&&Object.keys(e).forEach((r=>{const n=e[r];"object"==typeof n&&null!==n&&(n[a]?e[r]=n[a]:t(n,a))}))},e=e=>{window.loadChartJS=!0,Array.from(e).forEach(((e,a)=>{const r=e.firstElementChild,n=e.getAttribute("data-chartjs-id")||"chartjs-"+a,d=e.getAttribute("data-width"),o=document.getElementById(n);o&&o.parentNode.remove();const c=r.textContent,l=document.createElement("canvas");l.id=n;const s=document.createElement("div");s.className="chartjs-wrap",d&&(s.style.width=d),s.appendChild(l),r.insertAdjacentElement("afterend",s);const h=document.getElementById(n).getContext("2d"),i=JSON.parse(c),m="dark"===document.documentElement.getAttribute("data-theme")?"dark-mode":"light-mode";(t=>{"dark-mode"===t?(Chart.defaults.color="rgba(255, 255, 255, 0.8)",Chart.defaults.borderColor="rgba(255, 255, 255, 0.2)",Chart.defaults.scale.ticks.backdropColor="transparent"):(Chart.defaults.color="rgba(0, 0, 0, 0.8)",Chart.defaults.borderColor="rgba(0, 0, 0, 0.1)",Chart.defaults.scale.ticks.backdropColor="transparent")})(m),t(i,m),new Chart(h,i)}))},a=()=>{const t=document.querySelectorAll("#article-container .chartjs-container");0!==t.length&&(window.loadChartJS?e(t):btf.getScript("https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js").then((()=>e(t))))};btf.addGlobalFn("themeChange",a,"chartjs"),btf.addGlobalFn("encrypt",a,"chartjs"),window.pjax?a():document.addEventListener("DOMContentLoaded",a)})()</script></div><div class="aplayer no-destroy" data-id="9061017364" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listfolded="false" data-order="random" data-lrctype="1" data-preload="none" data-autoplay="false" muted></div><div class="app-refresh" id="app-refresh"><div class="app-refresh-wrap"><label>ç½‘ç«™å·²æ›´æ–°æœ€æ–°ç‰ˆæœ¬</label> <a href="javascript:void(0)" rel="external nofollow noreferrer" onclick="location.reload()">ç‚¹å‡»åˆ·æ–°</a></div></div><script>function showNotification(){if(GLOBAL_CONFIG.Snackbar){var t="light"===document.documentElement.getAttribute("data-theme")?GLOBAL_CONFIG.Snackbar.bgLight:GLOBAL_CONFIG.Snackbar.bgDark,e=GLOBAL_CONFIG.Snackbar.position;Snackbar.show({text:"å·²æ›´æ–°æœ€æ–°ç‰ˆæœ¬",backgroundColor:t,duration:5e5,pos:e,actionText:"ç‚¹å‡»åˆ·æ–°",actionTextColor:"#fff",onActionClick:function(t){location.reload()}})}else{var o=`top: 0; background: ${"light"===document.documentElement.getAttribute("data-theme")?"#49b1f5":"#1f1f1f"};`;document.getElementById("app-refresh").style.cssText=o}}"serviceWorker"in navigator&&(navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("controllerchange",(function(){showNotification()})),window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js")})))</script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="/js/diytitle.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!0,document.body.addEventListener("input",POWERMODE)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/metingjs/dist/Meting.min.js"></script><script>btf.addGlobalFn("pjaxSend",(()=>{if(window.aplayers)for(let a=0;a<window.aplayers.length;a++)window.aplayers[a].options.fixed||window.aplayers[a].destroy()}),"destroyAplayer"),btf.addGlobalFn("pjaxComplete",loadMeting,"runMetingJS")</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>(()=>{window.pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/talking/"]):not([href="/artitalk/"])',selectors:['meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]','meta[property="og:description"]','link[rel="canonical"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"],cacheBust:!1,analytics:!0,scrollRestoration:!1});const e=e=>{e&&Object.values(e).forEach((e=>{try{e()}catch(e){console.debug("Pjax callback failed:",e)}}))};document.addEventListener("pjax:send",(()=>{btf.removeGlobalFnEvent("pjaxSendOnce"),btf.removeGlobalFnEvent("themeChange");const t=document.body.classList;t.contains("read-mode")&&t.remove("read-mode"),e(window.globalFn.pjaxSend)})),document.addEventListener("pjax:complete",(()=>{btf.removeGlobalFnEvent("pjaxCompleteOnce"),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),a=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(a)),e.parentNode.replaceChild(t,e)})),e(window.globalFn.pjaxComplete)})),document.addEventListener("pjax:error",(e=>{if(404===e.request.status){!0?pjax.loadUrl("/404"):window.location.href="/404"}}))})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div id="algolia-search-input"><div class="ais-SearchBox"><form class="ais-SearchBox-form" action="" role="search" novalidate><input class="ais-SearchBox-input" type="search" placeholder="æœç´¢æ–‡ç« " autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" maxlength="512" aria-label="Search"><button class="ais-SearchBox-submit" type="submit" title="Submit the search query" style="display:none"><svg class="ais-SearchBox-submitIcon" width="10" height="10" viewBox="0 0 40 40" aria-hidden="true"><path d="M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z"></path></svg></button></form></div><hr><div id="algolia-search-results"><div id="algolia-hits"><div id="algolia-hits-empty" style="display:none"></div><div class="ais-Hits" style="display:none"><ol class="ais-Hits-list"></ol></div></div><div class="ais-Pagination" id="algolia-pagination" style="display:none"><ul class="ais-Pagination-list"></ul></div><div id="algolia-info"><span class="ais-Stats-text"></span><a class="algolia-poweredBy" href="https://www.algolia.com/?utm_source=algoliasearch.js&amp;utm_medium=website&amp;utm_content=localhost&amp;utm_campaign=poweredby" target="_blank" aria-label="Search by Algolia" rel="noopener noreferrer"><svg class="ais-PoweredBy-logo" height="1.2em" viewBox="0 0 572 64" style="width:auto"><path fill="#36395A" d="M16 48.3c-3.4 0-6.3-.6-8.7-1.7A12.4 12.4 0 0 1 1.9 42C.6 40 0 38 0 35.4h6.5a6.7 6.7 0 0 0 3.9 6c1.4.7 3.3 1.1 5.6 1.1 2.2 0 4-.3 5.4-1a7 7 0 0 0 3-2.4 6 6 0 0 0 1-3.4c0-1.5-.6-2.8-1.9-3.7-1.3-1-3.3-1.6-5.9-1.8l-4-.4c-3.7-.3-6.6-1.4-8.8-3.4a10 10 0 0 1-3.3-7.9c0-2.4.6-4.6 1.8-6.4a12 12 0 0 1 5-4.3c2.2-1 4.7-1.6 7.5-1.6s5.5.5 7.6 1.6a12 12 0 0 1 5 4.4c1.2 1.8 1.8 4 1.8 6.7h-6.5a6.4 6.4 0 0 0-3.5-5.9c-1-.6-2.6-1-4.4-1s-3.2.3-4.4 1c-1.1.6-2 1.4-2.6 2.4-.5 1-.8 2-.8 3.1a5 5 0 0 0 1.5 3.6c1 1 2.6 1.7 4.7 1.9l4 .3c2.8.2 5.2.8 7.2 1.8 2.1 1 3.7 2.2 4.9 3.8a9.7 9.7 0 0 1 1.7 5.8c0 2.5-.7 4.7-2 6.6a13 13 0 0 1-5.6 4.4c-2.4 1-5.2 1.6-8.4 1.6Zm35.6 0c-2.6 0-4.8-.4-6.7-1.3a13 13 0 0 1-4.7-3.5 17.1 17.1 0 0 1-3.6-10.4v-1c0-2 .3-3.8 1-5.6a13 13 0 0 1 7.3-8.3 15 15 0 0 1 6.3-1.4A13.2 13.2 0 0 1 64 24.3c1 2.2 1.6 4.6 1.6 7.2V34H39.4v-4.3h21.8l-1.8 2.2c0-2-.3-3.7-.9-5.1a7.3 7.3 0 0 0-2.7-3.4c-1.2-.7-2.7-1.1-4.6-1.1s-3.4.4-4.7 1.3a8 8 0 0 0-2.9 3.6c-.6 1.5-.9 3.3-.9 5.4 0 2 .3 3.7 1 5.3a7.9 7.9 0 0 0 2.8 3.7c1.3.8 3 1.3 5 1.3s3.8-.5 5.1-1.3c1.3-1 2.1-2 2.4-3.2h6a11.8 11.8 0 0 1-7 8.7 16 16 0 0 1-6.4 1.2ZM80 48c-2.2 0-4-.3-5.7-1a8.4 8.4 0 0 1-3.7-3.3 9.7 9.7 0 0 1-1.3-5.2c0-2 .5-3.8 1.5-5.2a9 9 0 0 1 4.3-3.1c1.8-.7 4-1 6.7-1H89v4.1h-7.5c-2 0-3.4.5-4.4 1.4-1 1-1.6 2.1-1.6 3.6s.5 2.7 1.6 3.6c1 1 2.5 1.4 4.4 1.4 1.1 0 2.2-.2 3.2-.7 1-.4 1.9-1 2.6-2 .6-1 1-2.4 1-4.2l1.7 2.1c-.2 2-.7 3.8-1.5 5.2a9 9 0 0 1-3.4 3.3 12 12 0 0 1-5.3 1Zm9.5-.7v-8.8h-1v-10c0-1.8-.5-3.2-1.4-4.1-1-1-2.4-1.4-4.2-1.4a142.9 142.9 0 0 0-10.2.4v-5.6a74.8 74.8 0 0 1 8.6-.4c3 0 5.5.4 7.5 1.2s3.4 2 4.4 3.6c1 1.7 1.4 4 1.4 6.7v18.4h-5Zm12.9 0V17.8h5v12.3h-.2c0-4.2 1-7.4 2.8-9.5a11 11 0 0 1 8.3-3.1h1v5.6h-2a9 9 0 0 0-6.3 2.2c-1.5 1.5-2.2 3.6-2.2 6.4v15.6h-6.4Zm34.4 1a15 15 0 0 1-6.6-1.3c-1.9-.9-3.4-2-4.7-3.5a15.5 15.5 0 0 1-2.7-5c-.6-1.7-1-3.6-1-5.4v-1c0-2 .4-3.8 1-5.6a15 15 0 0 1 2.8-4.9c1.3-1.5 2.8-2.6 4.6-3.5a16.4 16.4 0 0 1 13.3.2c2 1 3.5 2.3 4.8 4a12 12 0 0 1 2 6H144c-.2-1.6-1-3-2.2-4.1a7.5 7.5 0 0 0-5.2-1.7 8 8 0 0 0-4.7 1.3 8 8 0 0 0-2.8 3.6 13.8 13.8 0 0 0 0 10.3c.6 1.5 1.5 2.7 2.8 3.6s2.8 1.3 4.8 1.3c1.5 0 2.7-.2 3.8-.8a7 7 0 0 0 2.6-2c.7-1 1-2 1.2-3.2h6.2a11 11 0 0 1-2 6.2 15.1 15.1 0 0 1-11.8 5.5Zm19.7-1v-40h6.4V31h-1.3c0-3 .4-5.5 1.1-7.6a9.7 9.7 0 0 1 3.5-4.8A9.9 9.9 0 0 1 172 17h.3c3.5 0 6 1.1 7.9 3.5 1.7 2.3 2.6 5.7 2.6 10v16.8h-6.4V29.6c0-2.1-.6-3.8-1.8-5a6.4 6.4 0 0 0-4.8-1.8c-2 0-3.7.7-5 2a7.8 7.8 0 0 0-1.9 5.5v17h-6.4Zm63.8 1a12.2 12.2 0 0 1-10.9-6.2 19 19 0 0 1-1.8-7.3h1.4v12.5h-5.1v-40h6.4v19.8l-2 3.5c.2-3.1.8-5.7 1.9-7.7a11 11 0 0 1 4.4-4.5c1.8-1 3.9-1.5 6.1-1.5a13.4 13.4 0 0 1 12.8 9.1c.7 1.9 1 3.8 1 6v1c0 2.2-.3 4.1-1 6a13.6 13.6 0 0 1-13.2 9.4Zm-1.2-5.5a8.4 8.4 0 0 0 7.9-5c.7-1.5 1.1-3.3 1.1-5.3s-.4-3.8-1.1-5.3a8.7 8.7 0 0 0-3.2-3.6 9.6 9.6 0 0 0-9.2-.2 8.5 8.5 0 0 0-3.3 3.2c-.8 1.4-1.3 3-1.3 5v2.3a9 9 0 0 0 1.3 4.8 9 9 0 0 0 3.4 3c1.4.7 2.8 1 4.4 1Zm27.3 3.9-10-28.9h6.5l9.5 28.9h-6Zm-7.5 12.2v-5.7h4.9c1 0 2-.1 2.9-.4a4 4 0 0 0 2-1.4c.4-.7.9-1.6 1.2-2.7l8.6-30.9h6.2l-9.3 32.4a14 14 0 0 1-2.5 5 8.9 8.9 0 0 1-4 2.8c-1.5.6-3.4.9-5.6.9h-4.4Zm9-12.2v-5.2h6.4v5.2H248Z"></path><path fill="#003DFF" d="M534.4 9.1H528a.8.8 0 0 1-.7-.7V1.8c0-.4.2-.7.6-.8l6.5-1c.4 0 .8.2.9.6v7.8c0 .4-.4.7-.8.7zM428 35.2V.8c0-.5-.3-.8-.7-.8h-.2l-6.4 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.5 0 .8-.4.8-.8V43c0-.4-.3-.7-.6-.8-4.5-.5-4.5-6-4.5-7zm106.5-21.8H528c-.4 0-.7.4-.7.8v34c0 .4.3.8.7.8h6.5c.4 0 .8-.4.8-.8v-34c0-.5-.4-.8-.8-.8zm-17.7 21.8V.8c0-.5-.3-.8-.8-.8l-6.5 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.4 0 .8-.4.8-.8V43c0-.4-.3-.7-.7-.8-4.4-.5-4.4-6-4.4-7zm-22.2-20.6a16.5 16.5 0 0 1 8.6 9.3c.8 2.2 1.3 4.8 1.3 7.5a19.4 19.4 0 0 1-4.6 12.6 14.8 14.8 0 0 1-5.2 3.6c-2 .9-5.2 1.4-6.8 1.4a21 21 0 0 1-6.7-1.4 15.4 15.4 0 0 1-8.6-9.3 21.3 21.3 0 0 1 0-14.4 15.2 15.2 0 0 1 8.6-9.3c2-.8 4.3-1.2 6.7-1.2s4.6.4 6.7 1.2zm-6.7 27.6c2.7 0 4.7-1 6.2-3s2.2-4.3 2.2-7.8-.7-6.3-2.2-8.3-3.5-3-6.2-3-4.7 1-6.1 3c-1.5 2-2.2 4.8-2.2 8.3s.7 5.8 2.2 7.8 3.5 3 6.2 3zm-88.8-28.8c-6.2 0-11.7 3.3-14.8 8.2a18.6 18.6 0 0 0 4.8 25.2c1.8 1.2 4 1.8 6.2 1.7s.1 0 .1 0h.9c4.2-.7 8-4 9.1-8.1v7.4c0 .4.3.7.8.7h6.4a.7.7 0 0 0 .7-.7V14.2c0-.5-.3-.8-.7-.8h-13.5zm6.3 26.5a9.8 9.8 0 0 1-5.7 2h-.5a10 10 0 0 1-9.2-14c1.4-3.7 5-6.3 9-6.3h6.4v18.3zm152.3-26.5h13.5c.5 0 .8.3.8.7v33.7c0 .4-.3.7-.8.7h-6.4a.7.7 0 0 1-.8-.7v-7.4c-1.2 4-4.8 7.4-9 8h-.1a4.2 4.2 0 0 1-.5.1h-.9a10.3 10.3 0 0 1-7-2.6c-4-3.3-6.5-8.4-6.5-14.2 0-3.7 1-7.2 3-10 3-5 8.5-8.3 14.7-8.3zm.6 28.4c2.2-.1 4.2-.6 5.7-2V21.7h-6.3a9.8 9.8 0 0 0-9 6.4 10.2 10.2 0 0 0 9.1 13.9h.5zM452.8 13.4c-6.2 0-11.7 3.3-14.8 8.2a18.5 18.5 0 0 0 3.6 24.3 10.4 10.4 0 0 0 13 .6c2.2-1.5 3.8-3.7 4.5-6.1v7.8c0 2.8-.8 5-2.2 6.3-1.5 1.5-4 2.2-7.5 2.2l-6-.3c-.3 0-.7.2-.8.5l-1.6 5.5c-.1.4.1.8.5 1h.1c2.8.4 5.5.6 7 .6 6.3 0 11-1.4 14-4.1 2.7-2.5 4.2-6.3 4.5-11.4V14.2c0-.5-.4-.8-.8-.8h-13.5zm6.3 8.2v18.3a9.6 9.6 0 0 1-5.6 2h-1a10.3 10.3 0 0 1-8.8-14c1.4-3.7 5-6.3 9-6.3h6.4zM291 31.5A32 32 0 0 1 322.8 0h30.8c.6 0 1.2.5 1.2 1.2v61.5c0 1.1-1.3 1.7-2.2 1l-19.2-17a18 18 0 0 1-11 3.4 18.1 18.1 0 1 1 18.2-14.8c-.1.4-.5.7-.9.6-.1 0-.3 0-.4-.2l-3.8-3.4c-.4-.3-.6-.8-.7-1.4a12 12 0 1 0-2.4 8.3c.4-.4 1-.5 1.6-.2l14.7 13.1v-46H323a26 26 0 1 0 10 49.7c.8-.4 1.6-.2 2.3.3l3 2.7c.3.2.3.7 0 1l-.2.2a32 32 0 0 1-47.2-28.6z"></path></svg></a></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@5.39.0/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.1/source/js/search/algolia.min.js"></script></div></div><script data-pjax>if(document.getElementById("recent-posts")&&"/"==location.pathname){var parent=document.getElementById("recent-posts"),child='<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo3.jpg" alt="/img/nba-logo3.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2024-02-02</span><a class="blog-slider__title" href="posts/1bcb0ad4/">å•ç¯å¢ƒ,å¤šåˆ†æ”¯å¹¶è¡Œå¼€å‘æ–¹æ¡ˆ(æµé‡æŸ“è‰²/istio)</a><div class="blog-slider__text">å•ç¯å¢ƒ,å¤šåˆ†æ”¯å¹¶è¡Œå¼€å‘æ–¹æ¡ˆ(æµé‡æŸ“è‰²/istio)</div><a class="blog-slider__button" href="posts/1bcb0ad4/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="/img/nba-logo22.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-06-14</span><a class="blog-slider__title" href="posts/aa43cc95/">è®°å½•k8sç¯å¢ƒä¸‹ç»“åˆalinodeçš„ä½¿ç”¨</a><div class="blog-slider__text">è®°å½•k8sç¯å¢ƒä¸‹ç»“åˆalinodeçš„ä½¿ç”¨</div><a class="blog-slider__button" href="posts/aa43cc95/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo29.jpg" alt="/img/nba-logo29.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-12-13</span><a class="blog-slider__title" href="posts/15957791/">k8sç¯å¢ƒä¸‹,nginxåšwebsocketè´Ÿè½½çš„æ–¹æ¡ˆæ¢³ç†</a><div class="blog-slider__text">k8sç¯å¢ƒä¸‹,nginxåšwebsocketè´Ÿè½½çš„æ–¹æ¡ˆæ¢³ç†</div><a class="blog-slider__button" href="posts/15957791/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="/img/nba-logo22.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-09-26</span><a class="blog-slider__title" href="posts/4ecfb081/">è®°å½•ä¸€æ¬¡k8sç½‘ç»œDNSé—®é¢˜æ’æŸ¥è¿‡ç¨‹</a><div class="blog-slider__text">è®°å½•ä¸€æ¬¡k8sç½‘ç»œDNSé—®é¢˜æ’æŸ¥è¿‡ç¨‹</div><a class="blog-slider__button" href="posts/4ecfb081/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="/img/nba-logo22.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-09-26</span><a class="blog-slider__title" href="posts/37032a87/">k3sé«˜å¯ç”¨å®‰è£…</a><div class="blog-slider__text">k3sé«˜å¯ç”¨å®‰è£…</div><a class="blog-slider__button" href="posts/37032a87/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo5.jpg" alt="/img/nba-logo5.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-11-27</span><a class="blog-slider__title" href="posts/20b19ed4/">åˆ†è¯æœç´¢éœ€æ±‚æ•´ç†</a><div class="blog-slider__text">åˆ†è¯æœç´¢éœ€æ±‚æ•´ç†</div><a class="blog-slider__button" href="posts/20b19ed4/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo26.jpg" alt="/img/nba-logo26.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-12-02</span><a class="blog-slider__title" href="posts/6de14387/">æ•´ç†wsl2é…åˆå¼€å‘çš„ä¸€äº›é…ç½®</a><div class="blog-slider__text">æ•´ç†wsl2é…åˆå¼€å‘çš„ä¸€äº›é…ç½®</div><a class="blog-slider__button" href="posts/6de14387/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="/img/nba-logo22.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-12-11</span><a class="blog-slider__title" href="posts/fb9adcb6/">è®°å½•windows11+wsl2ç¯å¢ƒæ­é…</a><div class="blog-slider__text">windows11+wsl2å¼€å‘ç¯å¢ƒé…ç½®</div><a class="blog-slider__button" href="posts/fb9adcb6/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo26.jpg" alt="/img/nba-logo26.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2026-01-28</span><a class="blog-slider__title" href="posts/2a9d73ff/">æ•™ä½ å¦‚ä½•é›¶æˆæœ¬ä»0åˆ°1ï¼Œå¼€å‘ä¸Šçº¿ä¸€ä¸ªå¯¹æ¥äº†openAIçš„æœºå™¨äºº</a><div class="blog-slider__text">æ•™ä½ å¦‚ä½•é›¶æˆæœ¬ä»0åˆ°1ï¼Œå¼€å‘ä¸Šçº¿ä¸€ä¸ªå¯¹æ¥äº†openAIçš„æœºå™¨äºº</div><a class="blog-slider__button" href="posts/2a9d73ff/">è¯¦æƒ…</a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';console.log("å·²æŒ‚è½½swiper"),parent.insertAdjacentHTML("afterbegin",child)}</script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper@0.18/swiper/swiperindex.js"></script><style></style><script data-pjax>function history_calendar_injector_config(){var i=document.getElementsByClassName("sticky_layout")[0];console.log("å·²æŒ‚è½½history_calendar"),i.insertAdjacentHTML("afterbegin",'<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>é‚£å¹´ä»Šæ—¥</span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>')}document.getElementsByClassName("sticky_layout")[0]&&"/"===location.pathname&&history_calendar_injector_config()</script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"right",width:150,height:300,hOffset:20,vOffset:-20},mobile:{show:!0},log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/"})</script></body></html>