<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>关于Sidecar注入以及问题记录 | 小五的个人杂货铺</title><meta name="author" content="小五"><meta name="copyright" content="小五"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="安装 Sidecar注入为了充分利用 Istio 的所有特性，网格中的 Pod 必须运行一个 Istio Sidecar 代理。 下面的章节描述了向 Pod 中注入 Istio Sidecar 的两种方法：使用 istioctl 手动注入或启用 Pod 所属命名空间的 Istio Sidecar 注入器自动注入。 当 Pod 所属命名空间启用自动注入后，自动注入器会使用准入控制器在创建 Pod 时"><meta property="og:type" content="article"><meta property="og:title" content="关于Sidecar注入以及问题记录"><meta property="og:url" content="https://xiaowu95.wang/posts/46b7d67b/"><meta property="og:site_name" content="小五的个人杂货铺"><meta property="og:description" content="安装 Sidecar注入为了充分利用 Istio 的所有特性，网格中的 Pod 必须运行一个 Istio Sidecar 代理。 下面的章节描述了向 Pod 中注入 Istio Sidecar 的两种方法：使用 istioctl 手动注入或启用 Pod 所属命名空间的 Istio Sidecar 注入器自动注入。 当 Pod 所属命名空间启用自动注入后，自动注入器会使用准入控制器在创建 Pod 时"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://xiaowu95.wang/img/nba-logo28.jpg"><meta property="article:published_time" content="2024-05-29T07:31:18.000Z"><meta property="article:modified_time" content="2024-05-29T07:31:18.000Z"><meta property="article:author" content="小五"><meta property="article:tag" content="云原生"><meta property="article:tag" content="k8s"><meta property="article:tag" content="istio"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://xiaowu95.wang/img/nba-logo28.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://xiaowu95.wang/posts/46b7d67b/"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="kHfLZxYQ7y3s3AR7gyJDdJkQvGNjQsvopp6N3gEEx0s"><meta name="baidu-site-verification" content="codeva-aVS4F6wAjS"><link rel="manifest" href="/wang-xiaowu/pwa/site.webmanifest"><meta name="msapplication-TileColor" content="#fff"><link rel="apple-touch-icon" sizes="180x180" href="/wang-xiaowu/pwa/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/wang-xiaowu/pwa/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/wang-xiaowu/pwa/favicon-16x16.png"><link rel="mask-icon" href="/wang-xiaowu/pwa/safari-pinned-tab.svg" color="#5bbad5"><link rel="stylesheet" href="/css/index.css?v=5.2.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise(((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach((([e,t])=>n.setAttribute(e,t))),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)})),getCSS:(e,t)=>new Promise(((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)})),addGlobalFn:(e,t,o=!1,a=window)=>{const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),c=window.matchMedia("(prefers-color-scheme: dark)"),r=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(r.matches)a();else if(c.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}c.addEventListener("change",(()=>{void 0===t.get("theme")&&(e.matches?o():a())}))}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?86cb34987e15c900c39e12ebdf08c50d";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),btf.addGlobalFn("pjaxComplete",(()=>{_hmt.push(["_trackPageview",window.location.pathname])}),"baidu_analytics")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-1MFQ47191J"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-1MFQ47191J"),btf.addGlobalFn("pjaxComplete",(()=>{gtag("config","G-1MFQ47191J",{page_path:window.location.pathname})}),"google_analytics")</script><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"M91QAWRVY4",apiKey:"ecc30a5e06136e1cc491685e39801190",indexName:"xiaowu-blog",hitsPerPage:6,languages:{input_placeholder:"搜索文章",hits_empty:"未找到符合您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"簡"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:400,highlightFullpage:!0,highlightMacStyle:!0},copy:{success:"复制成功",error:"复制失败",noSupport:"浏览器不支持"},relativeDate:{homepage:!0,post:!0},runtime:"天",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:150,languages:{author:"作者: 小五",link:"链接: ",source:"来源: 小五的个人杂货铺",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"已切换为繁体中文",cht_to_chs:"已切换为简体中文",day_to_night:"已切换为深色模式",night_to_day:"已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!0,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"关于Sidecar注入以及问题记录",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,isShuoshuo:!1}</script><script src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><link rel="stylesheet" href="/css/font.css"><style>.app-refresh{position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease}.app-refresh-wrap{display:flex;color:#fff;height:100%;align-items:center;justify-content:center}.app-refresh-wrap a{color:#fff;text-decoration:underline;cursor:pointer}</style><link rel="stylesheet" href="/css/titleStyle.css"><link rel="stylesheet" href="/css/mouse.css"><link rel="stylesheet" href="/css/custom.css"><style>.card-announcement .social-button{margin:.6rem 0 0 0;text-align:center}.card-announcement .social-button a{display:block;background-color:var(--btn-bg);color:var(--btn-color);text-align:center;line-height:2.4;margin:4px 0}.card-announcement .social-button a:hover{background-color:var(--btn-hover-color)}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiperstyle.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="alternate" href="/atom.xml" title="小五的个人杂货铺" type="application/atom+xml"></head><body><script>window.paceOptions={restartOnPushState:!1},btf.addGlobalFn("pjaxSend",(()=>{Pace.restart()}),"pace_restart")</script><link rel="stylesheet" href="/css/pace.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-lazy-src="/img/avatar.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">550</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">163</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">58</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/github/"><i class="fa-fw fa-solid fa-address-card"></i> <span>关于我</span></a></div><div class="menus_item"><a class="site-page" href="/ac/"><i class="fa-fw fa-solid fa-wind"></i> <span>便携小空调</span></a></div><div class="menus_item"><a class="site-page" href="/talking/"><i class="fa-fw fa-solid fa-walkie-talkie"></i> <span>博客短记</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i> <span>目录</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-otter"></i> <span>杂记</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/songs/"><i class="fa-fw fas fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>图库</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa-solid fa-film"></i> <span>影视|番剧</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book faa-fload"></i> <span>书单</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad faa-fload"></i> <span>游戏</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-bilibili"></i> <span>BiliBili追番</span></a></li><li><a class="site-page child" href="/cinemas/"><i class="fa-fw fa-solid fa-video"></i> <span>BiliBili追剧</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-user-group"></i> <span>友链</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-mug-saucer"></i> <span>Website Memo</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://console.leancloud.app/apps"><span>🚀 LeanCloud</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.com/dashboard"><span>🚀 Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://tongji.baidu.com/main/overview/10000432799/overview/index"><span>🚀 百度统计</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://ziyuan.baidu.com/dashboard/index"><span>🚀 百度站点管理</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://analytics.google.com/analytics/web/"><span>🚀 谷歌分析</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://search.google.com/search-console?hl=zh-cn"><span>🚀 谷歌站点管理</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.google.com/adsense/new/u/0/pub-1375421173355613/home"><span>🚀 谷歌广告联盟</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.algolia.com/"><span>🚀 Algolia</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://sms-activate.org/cn/"><span>🚀 Sms-activate</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chatgpt.com/"><span>🚀 ChatGPT</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://poe.com/"><span>🚀 Poe聚合</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.idc.net/clientarea"><span>🚀 后浪云</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.west.cn/"><span>🚀 西部数据</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://shandianpro.com/#/dashboard"><span>🚀 闪电</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.huojian.homes/"><span>🚀 小火箭</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/winston779/gougou"><span>🚀 狗狗加速</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/nba-logo28.jpg)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">小五的个人杂货铺</span></a><a class="nav-page-title" href="/"><span class="site-name">关于Sidecar注入以及问题记录</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/github/"><i class="fa-fw fa-solid fa-address-card"></i> <span>关于我</span></a></div><div class="menus_item"><a class="site-page" href="/ac/"><i class="fa-fw fa-solid fa-wind"></i> <span>便携小空调</span></a></div><div class="menus_item"><a class="site-page" href="/talking/"><i class="fa-fw fa-solid fa-walkie-talkie"></i> <span>博客短记</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i> <span>目录</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-otter"></i> <span>杂记</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/songs/"><i class="fa-fw fas fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>图库</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa-solid fa-film"></i> <span>影视|番剧</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book faa-fload"></i> <span>书单</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad faa-fload"></i> <span>游戏</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-bilibili"></i> <span>BiliBili追番</span></a></li><li><a class="site-page child" href="/cinemas/"><i class="fa-fw fa-solid fa-video"></i> <span>BiliBili追剧</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-user-group"></i> <span>友链</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-mug-saucer"></i> <span>Website Memo</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://console.leancloud.app/apps"><span>🚀 LeanCloud</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.com/dashboard"><span>🚀 Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://tongji.baidu.com/main/overview/10000432799/overview/index"><span>🚀 百度统计</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://ziyuan.baidu.com/dashboard/index"><span>🚀 百度站点管理</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://analytics.google.com/analytics/web/"><span>🚀 谷歌分析</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://search.google.com/search-console?hl=zh-cn"><span>🚀 谷歌站点管理</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.google.com/adsense/new/u/0/pub-1375421173355613/home"><span>🚀 谷歌广告联盟</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.algolia.com/"><span>🚀 Algolia</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://sms-activate.org/cn/"><span>🚀 Sms-activate</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chatgpt.com/"><span>🚀 ChatGPT</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://poe.com/"><span>🚀 Poe聚合</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.idc.net/clientarea"><span>🚀 后浪云</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.west.cn/"><span>🚀 西部数据</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://shandianpro.com/#/dashboard"><span>🚀 闪电</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.huojian.homes/"><span>🚀 小火箭</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/winston779/gougou"><span>🚀 狗狗加速</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">关于Sidecar注入以及问题记录<a class="post-edit-link" href="https://github.com/wang-xiaowu/wang-xiaowu.github.io/issues/new?_posts/ServiceMesh/istio/关于Sidecar注入以及问题记录.md" rel="external nofollow noreferrer" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-05-29T07:31:18.000Z" title="发表于 2024-05-29 15:31:18">2024-05-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-05-29T07:31:18.000Z" title="更新于 2024-05-29 15:31:18">2024-05-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/istio/">istio</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>14分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;距离上一次更新该文章已经过了&quot;,&quot;messageNext&quot;:&quot;天，文章所描述的內容可能已经发生变化，请留意。&quot;,&quot;postUpdate&quot;:&quot;2024-05-29 15:31:18&quot;}" hidden></div><h1 id="安装-Sidecar"><a href="#安装-Sidecar" class="headerlink" title="安装 Sidecar"></a>安装 Sidecar</h1><h2 id="注入"><a href="#注入" class="headerlink" title="注入"></a>注入</h2><p>为了充分利用 Istio 的所有特性，网格中的 Pod 必须运行一个 Istio Sidecar 代理。</p><p>下面的章节描述了向 Pod 中注入 Istio Sidecar 的两种方法：使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://istio.io/latest/zh/docs/reference/commands/istioctl"><code>istioctl</code></a> 手动注入或启用 Pod 所属命名空间的 Istio Sidecar 注入器自动注入。</p><p>当 Pod 所属命名空间启用自动注入后，自动注入器会使用准入控制器在创建 Pod 时自动注入代理配置。</p><p>手动注入直接修改配置，如 Deployment，并将代理配置注入其中。</p><p>如果您不确定使用哪一种方法，建议使用自动注入。</p><h3 id="自动注入-Sidecar"><a href="#自动注入-Sidecar" class="headerlink" title="自动注入 Sidecar"></a>自动注入 Sidecar</h3><p>使用 Istio 提供的<a target="_blank" rel="noopener external nofollow noreferrer" href="https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/admission-controllers/">准入控制器变更 Webhook</a>， 可以将 Sidecar 自动添加到可用的 Kubernetes Pod 中。</p><p>虽然准入控制器默认情况下是启用的，但一些 Kubernetes 发行版会禁用这些控制器。 如果出现这种情况，根据指示说明来<a target="_blank" rel="noopener external nofollow noreferrer" href="https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/admission-controllers/#how-do-i-turn-on-an-admission-controller">启用准入控制器</a>。</p><p>当您在一个命名空间中设置了 <code>istio-injection=enabled</code> 标签，且 Injection Webhook 被启用后，任何新的 Pod 都有将在创建时自动添加 Sidecar。</p><p>请注意，区别于手动注入，自动注入发生在 Pod 层面。您将看不到 Deployment 本身有任何更改。 取而代之，需要检查单独的 Pod（使用 <code>kubectl describe</code>）来查询被注入的代理。</p><h4 id="部署应用"><a href="#部署应用" class="headerlink" title="部署应用"></a>部署应用</h4><p>部署 sleep 应用，验证 Deployment 和 Pod 只有一个容器。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f samples/sleep/sleep.yaml</span><br><span class="line">$ kubectl get deployment -o wide</span><br><span class="line">NAME    READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES                    SELECTOR</span><br><span class="line"><span class="built_in">sleep</span>   1/1     1            1           12s   <span class="built_in">sleep</span>        curlimages/curl           app=<span class="built_in">sleep</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod</span><br><span class="line">NAME                    READY   STATUS    RESTARTS   AGE</span><br><span class="line">sleep-8f795f47d-hdcgs   1/1     Running   0          42s</span><br></pre></td></tr></table></figure><p>将 <code>default</code> 命名空间标记为 <code>istio-injection=enabled</code>。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl label namespace default istio-injection=enabled --overwrite</span><br><span class="line">$ kubectl get namespace -L istio-injection</span><br><span class="line">NAME                 STATUS   AGE     ISTIO-INJECTION</span><br><span class="line">default              Active   5m9s    enabled</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>注入发生在 Pod 创建时。杀死正在运行的 Pod 并验证新创建的 Pod 是否注入 Sidecar。 原来的 Pod 具有 <code>1/1 READY</code> 个容器，注入 Sidecar 后的 Pod 则具有 READY 为 <code>2/2 READY</code> 个容器。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl delete pod -l app=<span class="built_in">sleep</span></span><br><span class="line">$ kubectl get pod -l app=<span class="built_in">sleep</span></span><br><span class="line">pod <span class="string">&quot;sleep-776b7bcdcd-7hpnk&quot;</span> deleted</span><br><span class="line">NAME                     READY     STATUS        RESTARTS   AGE</span><br><span class="line">sleep-776b7bcdcd-7hpnk   1/1       Terminating   0          1m</span><br><span class="line">sleep-776b7bcdcd-bhn9m   2/2       Running       0          7s</span><br></pre></td></tr></table></figure><p>查看已注入 Pod 的详细状态。您应该看到被注入的 <code>istio-proxy</code> 容器和对应的卷。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl describe pod -l app=<span class="built_in">sleep</span></span><br><span class="line">...</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age   From               Message</span><br><span class="line">  ----    ------     ----  ----               -------</span><br><span class="line">  ...</span><br><span class="line">  Normal  Created    11s   kubelet            Created container istio-init</span><br><span class="line">  Normal  Started    11s   kubelet            Started container istio-init</span><br><span class="line">  ...</span><br><span class="line">  Normal  Created    10s   kubelet            Created container <span class="built_in">sleep</span></span><br><span class="line">  Normal  Started    10s   kubelet            Started container <span class="built_in">sleep</span></span><br><span class="line">  ...</span><br><span class="line">  Normal  Created    9s    kubelet            Created container istio-proxy</span><br><span class="line">  Normal  Started    8s    kubelet            Started container istio-proxy</span><br></pre></td></tr></table></figure><p>禁用 <code>default</code> 命名空间的注入，并确认新的 Pod 在创建时没有 Sidecar。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl label namespace default istio-injection-</span><br><span class="line">$ kubectl delete pod -l app=<span class="built_in">sleep</span></span><br><span class="line">$ kubectl get pod</span><br><span class="line">namespace/default labeled</span><br><span class="line">pod <span class="string">&quot;sleep-776b7bcdcd-bhn9m&quot;</span> deleted</span><br><span class="line">NAME                     READY     STATUS        RESTARTS   AGE</span><br><span class="line">sleep-776b7bcdcd-bhn9m   2/2       Terminating   0          2m</span><br><span class="line">sleep-776b7bcdcd-gmvnr   1/1       Running       0          2s</span><br></pre></td></tr></table></figure><h4 id="控制注入策略"><a href="#控制注入策略" class="headerlink" title="控制注入策略"></a>控制注入策略</h4><p>在上面例子中，您在命名空间层级启用和禁用了注入。 注入也可以通过配置 Pod 上的 <code>sidecar.istio.io/inject</code> 标签，在每个 Pod 的基础上进行控制。</p><table><thead><tr><th>资源</th><th>标签</th><th>启用的值</th><th>禁用的值</th></tr></thead><tbody><tr><td>Namespace</td><td><code>istio-injection</code></td><td><code>enabled</code></td><td><code>disabled</code></td></tr><tr><td>Pod</td><td><code>sidecar.istio.io/inject</code></td><td><code>&quot;true&quot;</code></td><td><code>&quot;false&quot;</code></td></tr></tbody></table><p>如果您正在使用<a target="_blank" rel="noopener external nofollow noreferrer" href="https://istio.io/latest/zh/docs/setup/upgrade/canary/">控制平面修订版</a>，将通过匹配 <code>istio.io/rev</code> 标签来转为使用特定修订版的标签。例如，对于名为 <code>canary</code> 的修订版：</p><table><thead><tr><th>资源</th><th>启用的标签</th><th>禁用的标签</th></tr></thead><tbody><tr><td>Namespace</td><td><code>istio.io/rev=canary</code></td><td><code>istio-injection=disabled</code></td></tr><tr><td>Pod</td><td><code>istio.io/rev=canary</code></td><td><code>sidecar.istio.io/inject=&quot;false&quot;</code></td></tr></tbody></table><p>如果 <code>istio-injection</code> 标签和 <code>istio.io/rev</code> 标签在同一个命名空间中，则优先使用 <code>istio-injection</code> 标签。</p><p>按照以下逻辑配置注入器：</p><ol><li>如果禁用其中任何一个标签（<code>istio-injection</code> 或 <code>sidecar.istio.io/inject</code>）， 则不会注入 Pod。</li><li>如果启用其中任何一个标签（<code>istio-injection</code> 或 <code>sidecar.istio.io/inject</code> 或 <code>istio.io/rev</code>）， 则会注入 Pod。</li><li>如果两个标签都没有设置，且启用了 <code>.values.sidecarInjectorWebhook.enableNamespacesByDefault</code>， 则会注入 Pod。这在默认情况下是不启用的，所以 Pod 通常不会被注入。</li></ol><h3 id="手动注入-Sidecar"><a href="#手动注入-Sidecar" class="headerlink" title="手动注入 Sidecar"></a>手动注入 Sidecar</h3><p>要手动注入 Deployment，请使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://istio.io/latest/zh/docs/reference/commands/istioctl/#istioctl-kube-inject"><code>istioctl kube-inject</code></a>：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ istioctl kube-inject -f samples/sleep/sleep.yaml | kubectl apply -f -</span><br><span class="line">serviceaccount/sleep created</span><br><span class="line">service/sleep created</span><br><span class="line">deployment.apps/sleep created</span><br></pre></td></tr></table></figure><p>默认情况下将使用集群内的配置，或者使用该配置的本地副本来完成注入。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl -n istio-system get configmap istio-sidecar-injector -o=jsonpath=<span class="string">&#x27;&#123;.data.config&#125;&#x27;</span> &gt; inject-config.yaml</span><br><span class="line">$ kubectl -n istio-system get configmap istio-sidecar-injector -o=jsonpath=<span class="string">&#x27;&#123;.data.values&#125;&#x27;</span> &gt; inject-values.yaml</span><br><span class="line">$ kubectl -n istio-system get configmap istio -o=jsonpath=<span class="string">&#x27;&#123;.data.mesh&#125;&#x27;</span> &gt; mesh-config.yaml</span><br></pre></td></tr></table></figure><p>指定输入文件，运行 <code>kube-inject</code> 并部署。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ istioctl kube-inject \</span><br><span class="line">    --injectConfigFile inject-config.yaml \</span><br><span class="line">    --meshConfigFile mesh-config.yaml \</span><br><span class="line">    --valuesFile inject-values.yaml \</span><br><span class="line">    --filename samples/sleep/sleep.yaml \</span><br><span class="line">    | kubectl apply -f -</span><br><span class="line">serviceaccount/sleep created</span><br><span class="line">service/sleep created</span><br><span class="line">deployment.apps/sleep created</span><br></pre></td></tr></table></figure><p>验证 Sidecar 是否已经被注入到 READY 列下 <code>2/2</code> 的 Sleep Pod 中。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pod  -l app=<span class="built_in">sleep</span></span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE</span><br><span class="line">sleep-64c6f57bc8-f5n4x   2/2     Running   0          24s</span><br></pre></td></tr></table></figure><h2 id="自定义注入"><a href="#自定义注入" class="headerlink" title="自定义注入"></a>自定义注入</h2><p>通常，Pod 的注入是基于 Sidecar 注入模板，在 <code>istio-sidecar-injector</code> Configmap 中配置。每个 Pod 的配置可用于覆盖各个 Pod 上的选项。可通过在 Pod 中添加一个 <code>istio-proxy</code> 容器来完成。Sidecar 注入将会把自定义的任何配置视为默认注入模板的覆盖。</p><p>自定义这些设置时，需格外小心，因为允许完全自定义生成的 Pod，包括进行一些更改而导致 Sidecar 容器无法正常运行。</p><p>例如，以下配置可自定义各种设置，包括降低 CPU 请求，添加 Volume 挂载，和添加 <code>preStop</code> Hook：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">example</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">hello</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">alpine</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">istio-proxy</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">auto</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">requests:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;100m&quot;</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/etc/certs</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">certs</span></span><br><span class="line">    <span class="attr">lifecycle:</span></span><br><span class="line">      <span class="attr">preStop:</span></span><br><span class="line">        <span class="attr">exec:</span></span><br><span class="line">          <span class="attr">command:</span> [<span class="string">&quot;sleep&quot;</span>, <span class="string">&quot;10&quot;</span>]</span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">certs</span></span><br><span class="line">    <span class="attr">secret:</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">istio-certs</span></span><br></pre></td></tr></table></figure><p>通常，可以设置 Pod 中的任何字段。但是必须注意某些字段：</p><ul><li>Kubernetes 要求在注入运行之前配置 <code>image</code>。虽然可以您可以设置一个指定的 Image 来覆盖默认的 <code>image</code> 配置，但建议将 <code>image</code> 设置为 <code>auto</code>，可使 Sidecar 注入自动选择要使用的 Image。</li><li><code>Pod</code> 中一些字段取决于相关设置。例如，CPU 请求必须小于 CPU 限制。 如果两个字段没有一起配置，Pod 可能会无法启动。</li></ul><p>另外，某些字段可通过在 Pod 上的<a target="_blank" rel="noopener external nofollow noreferrer" href="https://istio.io/latest/zh/docs/reference/config/annotations/">注解</a>进行配置， 但是不建议使用上述方法进行自定义设置。必须特别注意某些注解：</p><ul><li>如果设置了 <code>sidecar.istio.io/proxyCPU</code>，则务必显式设置 <code>sidecar.istio.io/proxyCPULimit</code>。 否则该 Sidecar 的 <code>cpu</code> 限制将被设置为 unlimited。</li><li>如果设置了 <code>sidecar.istio.io/proxyMemory</code>，则务必显式设置 <code>sidecar.istio.io/proxyMemoryLimit</code>。 否则该 Sidecar 的 <code>memory</code> 限制将被设置为 unlimited。</li></ul><p>例如，参见以下不完整的资源注解配置和相应注入的资源设置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">annotations:</span></span><br><span class="line">        <span class="attr">sidecar.istio.io/proxyCPU:</span> <span class="string">&quot;200m&quot;</span></span><br><span class="line">        <span class="attr">sidecar.istio.io/proxyMemoryLimit:</span> <span class="string">&quot;5Gi&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">istio-proxy</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">limits:</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">5Gi</span></span><br><span class="line">      <span class="attr">requests:</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">200m</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">5Gi</span></span><br><span class="line">      <span class="attr">securityContext:</span></span><br><span class="line">        <span class="attr">allowPrivilegeEscalation:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="自定义模板（试验特性）"><a href="#自定义模板（试验特性）" class="headerlink" title="自定义模板（试验特性）"></a>自定义模板（试验特性）</h3><p>此功能为试验特性功能，可随时更改或删除。</p><p>可以在安装时定义一个完全自定义的模板。 例如，定义一个自定义模板，将 <code>GREETING</code> 环境变量注入到 <code>istio-proxy</code> 容器中：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">install.istio.io/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">IstioOperator</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">istio</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">values:</span></span><br><span class="line">    <span class="attr">sidecarInjectorWebhook:</span></span><br><span class="line">      <span class="attr">templates:</span></span><br><span class="line">        <span class="attr">custom:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          spec:</span></span><br><span class="line"><span class="string">            containers:</span></span><br><span class="line"><span class="string">            - name: istio-proxy</span></span><br><span class="line"><span class="string">              env:</span></span><br><span class="line"><span class="string">              - name: GREETING</span></span><br><span class="line"><span class="string">                value: hello-world</span></span><br></pre></td></tr></table></figure><p>默认情况下，<code>istio</code> 会使用自动创建的 <code>sidecar</code> 模板对 Pod 进行注入。 这可通过 <code>inject.istio.io/templates</code> 注解来替换。 例如要应用默认模板和自定义模板，您可以设置 <code>inject.istio.io/templates=sidecar,custom</code>。</p><p>除了 <code>sidecar</code> 之外，默认还会提供 <code>gateway</code> 模板以支持将代理注入到 Gateway Deployment 中。</p><h1 id="Sidecar-自动注入问题"><a href="#Sidecar-自动注入问题" class="headerlink" title="Sidecar 自动注入问题"></a>Sidecar 自动注入问题</h1><h2 id="注入的结果和预期不一致"><a href="#注入的结果和预期不一致" class="headerlink" title="注入的结果和预期不一致"></a>注入的结果和预期不一致</h2><p>不一致包括 sidecar 的非预期注入和预期未注入。</p><ol><li><p>确保您的 pod 不在 <code>kube-system</code> 或 <code>kube-public</code> 名称空间中。这些命名空间中的 pod 将忽略 sidecar 自动注入。</p></li><li><p>确保您的 pod 在其 pod 定义中没有 <code>hostNetwork：true</code>。<code>hostNetwork：true</code> 的 pod 将忽略 sidecar 自动注入。</p><p>sidecar 模型假定 iptables 会拦截所有 pod 中的流量给 Envoy，但是 <code>hostNetwork：true</code> 的 pod 不符合此假设，并且会导致主机级别的路由失败。</p></li><li><p>通过检查 webhook 的 <code>namespaceSelector</code> 以确定目标命名空间是否包含在 webhook 范围内。</p><p>包含在范围内的 <code>namespaceSelector</code> 如下所示：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get mutatingwebhookconfiguration istio-sidecar-injector -o yaml | grep <span class="string">&quot;namespaceSelector:&quot;</span> -A5</span><br><span class="line">  namespaceSelector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      istio-injection: enabled</span><br><span class="line">  rules:</span><br><span class="line">  - apiGroups:</span><br><span class="line">    - <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>在有 <code>istio-injection=enabled</code> 标签的命名空间中创建 pod 就会调用注入 webhook。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get namespace -L istio-injection</span><br><span class="line">NAME           STATUS    AGE       ISTIO-INJECTION</span><br><span class="line">default        Active    18d       enabled</span><br><span class="line">istio-system   Active    3d</span><br><span class="line">kube-public    Active    18d</span><br><span class="line">kube-system    Active    18d</span><br></pre></td></tr></table></figure><p>不包含在注入范围的 <code>namespaceSelector</code> 如下所示：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get mutatingwebhookconfiguration istio-sidecar-injector -o yaml | grep <span class="string">&quot;namespaceSelector:&quot;</span> -A5</span><br><span class="line">  namespaceSelector:</span><br><span class="line">    matchExpressions:</span><br><span class="line">    - key: istio-injection</span><br><span class="line">      operator: NotIn</span><br><span class="line">      values:</span><br><span class="line">      - disabled</span><br><span class="line">  rules:</span><br><span class="line">  - apiGroups:</span><br><span class="line">    - <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>在没有标记 <code>istio-injection=disabled</code> 标签的命名空间中创建 pod，注入 webhook 就会被调用。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get namespace -L istio-injection</span><br><span class="line">NAME           STATUS    AGE       ISTIO-INJECTION</span><br><span class="line">default        Active    18d</span><br><span class="line">istio-system   Active    3d        disabled</span><br><span class="line">kube-public    Active    18d       disabled</span><br><span class="line">kube-system    Active    18d       disabled</span><br></pre></td></tr></table></figure><p>验证应用程序 pod 的命名空间是否已相应地被正确（重新）标记，例如：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl label namespace istio-system istio-injection=disabled --overwrite</span><br></pre></td></tr></table></figure><p>（对所有需要自动注入 webhook 的命名空间都重复上述步骤）</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl label namespace default istio-injection=enabled --overwrite</span><br></pre></td></tr></table></figure></li><li><p>检查默认策略</p><p>在 <code>istio-sidecar-injector configmap</code> 中检查默认注入策略。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl -n istio-system get configmap istio-sidecar-injector -o jsonpath=<span class="string">&#x27;&#123;.data.config&#125;&#x27;</span> | grep policy:</span><br><span class="line">policy: enabled</span><br></pre></td></tr></table></figure><p>策略允许的值为 <code>disabled</code> 或者 <code>enabled</code>。仅当 webhook 的 <code>namespaceSelector</code> 与目标命名空间匹配时，默认策略才会生效。无法识别的策略值默认为 <code>disabled</code>。</p></li><li><p>检查每个 pod 的注解</p><p>可以使用 pod template spec metadata 中的注解 <code>sidecar.istio.io/inject</code> 来覆盖默认策略，如果这样的话 deployment 相应的 metadata 将被忽略。注释值为 <code>true</code> 会被强制注入 sidecar，为 <code>false</code> 则会强制不注入 sidecar。</p><p>以下注解会覆盖默认策略并强制注入 sidecar：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get deployment <span class="built_in">sleep</span> -o yaml | grep <span class="string">&quot;sidecar.istio.io/inject:&quot;</span> -C3</span><br><span class="line">template:</span><br><span class="line">  metadata:</span><br><span class="line">    annotations:</span><br><span class="line">      sidecar.istio.io/inject: <span class="string">&quot;true&quot;</span></span><br><span class="line">    labels:</span><br><span class="line">      app: <span class="built_in">sleep</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="pods-不能创建"><a href="#pods-不能创建" class="headerlink" title="pods 不能创建"></a>pods 不能创建</h2><p>在失败的 pod 的 deployment 上运行 <code>kubectl describe -n namespace deployment name</code>。通常能在事件中看到调用注入 webhook 失败的原因。</p><h3 id="x509-证书相关的错误"><a href="#x509-证书相关的错误" class="headerlink" title="x509 证书相关的错误"></a>x509 证书相关的错误</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Warning  FailedCreate  3m (x17 over 8m)  replicaset-controller  Error creating: Internal error occurred: \</span><br><span class="line">    failed calling admission webhook <span class="string">&quot;sidecar-injector.istio.io&quot;</span>: Post https://istio-sidecar-injector.istio-system.svc:443/inject: \</span><br><span class="line">    x509: certificate signed by unknown authority (possibly because of <span class="string">&quot;crypto/rsa: verification error&quot;</span> <span class="keyword">while</span> trying \</span><br><span class="line">    to verify candidate authority certificate <span class="string">&quot;Kubernetes.cluster.local&quot;</span>)</span><br></pre></td></tr></table></figure><p><code>x509: certificate signed by unknown authority</code> 错误通常由 webhook 配置中的空 <code>caBundle</code> 引起。</p><p>验证 <code>mutatingwebhookconfiguration</code> 配置中的 <code>caBundle</code> 是否与 <code>istio-sidecar-injector</code> 中 pod 安装的根证书匹配。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get mutatingwebhookconfiguration istio-sidecar-injector -o yaml -o jsonpath=<span class="string">&#x27;&#123;.webhooks[0].clientConfig.caBundle&#125;&#x27;</span> | <span class="built_in">md5sum</span></span><br><span class="line">4b95d2ba22ce8971c7c92084da31faf0  -</span><br><span class="line">$ kubectl -n istio-system get secret istio.istio-sidecar-injector-service-account -o jsonpath=<span class="string">&#x27;&#123;.data.root-cert\.pem&#125;&#x27;</span> | <span class="built_in">md5sum</span></span><br><span class="line">4b95d2ba22ce8971c7c92084da31faf0  -</span><br></pre></td></tr></table></figure><p>CA 证书必须匹配，否则需要重新启动 sidecar-injector pods。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl -n istio-system patch deployment istio-sidecar-injector \</span><br><span class="line">    -p <span class="string">&quot;&#123;\&quot;spec\&quot;:&#123;\&quot;template\&quot;:&#123;\&quot;metadata\&quot;:&#123;\&quot;labels\&quot;:&#123;\&quot;date\&quot;:\&quot;`date +&#x27;%s&#x27;`\&quot;&#125;&#125;&#125;&#125;&#125;&quot;</span></span><br><span class="line">deployment.extensions <span class="string">&quot;istio-sidecar-injector&quot;</span> patched</span><br></pre></td></tr></table></figure><h3 id="deployment-状态中出现-no-such-hosts-或-no-endpoints-available"><a href="#deployment-状态中出现-no-such-hosts-或-no-endpoints-available" class="headerlink" title="deployment 状态中出现 no such hosts 或 no endpoints available"></a>deployment 状态中出现 <code>no such hosts</code> 或 <code>no endpoints available</code></h3><p>注入是失效关闭的（fail-close）。如果 <code>istio-sidecar-injector</code> pod 尚未准备就绪，则无法创建 pod。在这种情况下，则会出现 <code>no endpoints available</code>。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Internal error occurred: failed calling admission webhook <span class="string">&quot;istio-sidecar-injector.istio.io&quot;</span>: \</span><br><span class="line">    Post https://istio-sidecar-injector.istio-system.svc:443/admitPilot?<span class="built_in">timeout</span>=30s: \</span><br><span class="line">    no endpoints available <span class="keyword">for</span> service <span class="string">&quot;istio-sidecar-injector&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$  kubectl -n istio-system get pod -listio=sidecar-injector</span><br><span class="line">NAME                            READY     STATUS    RESTARTS   AGE</span><br><span class="line">istio-sidecar-injector-5dbbbdb746-d676g   1/1       Running   0          2d</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl -n istio-system get endpoints istio-sidecar-injector</span><br><span class="line">NAME           ENDPOINTS                          AGE</span><br><span class="line">istio-sidecar-injector   10.48.6.108:15014,10.48.6.108:443   3d</span><br></pre></td></tr></table></figure><p>如果 pod 或 endpoint 尚未准备就绪，可以通过检查 pod 日志和状态查找有关 webhook pod 无法启动的原因。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">for</span> pod <span class="keyword">in</span> $(kubectl -n istio-system get pod -listio=sidecar-injector -o jsonpath=<span class="string">&#x27;&#123;.items[*].metadata.name&#125;&#x27;</span>); <span class="keyword">do</span> \</span><br><span class="line">    kubectl -n istio-system logs <span class="variable">$&#123;pod&#125;</span> \</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">$ <span class="keyword">for</span> pod <span class="keyword">in</span> $(kubectl -n istio-system get pod -listio=sidecar-injector -o name); <span class="keyword">do</span> \</span><br><span class="line">    kubectl -n istio-system describe <span class="variable">$&#123;pod&#125;</span> \</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h2 id="如果-Kubernetes-API-server-有代理设置的话，sidecar-的自动注入功能是不能用的"><a href="#如果-Kubernetes-API-server-有代理设置的话，sidecar-的自动注入功能是不能用的" class="headerlink" title="如果 Kubernetes API server 有代理设置的话，sidecar 的自动注入功能是不能用的"></a>如果 Kubernetes API server 有代理设置的话，sidecar 的自动注入功能是不能用的</h2><p>当 Kubernetes API server 包含诸如以下的代理设置时：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http_proxy</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">http://proxy-wsa.esl.foo.com:80</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">https_proxy</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">http://proxy-wsa.esl.foo.com:80</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">no_proxy</span></span><br><span class="line">    <span class="attr">value:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">,localhost,dockerhub.foo.com,devhub-docker.foo.com,10.84.100.125,10.84.100.126,10.84.100.127</span></span><br></pre></td></tr></table></figure><p>使用这些设置，sidecar 自动注入就会失败。相关的报错可以在 <code>kube-apiserver</code> 日志中找到：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">W0227 21:51:03.156818       1 admission.go:257] Failed calling webhook, failing open sidecar-injector.istio.io: failed calling admission webhook <span class="string">&quot;sidecar-injector.istio.io&quot;</span>: Post https://istio-sidecar-injector.istio-system.svc:443/inject: Service Unavailable</span><br></pre></td></tr></table></figure><p>根据 <code>*_proxy</code> 相关的的环境变量设置，确保 pod 和 service CIDRs 是没有被代理的。检查 <code>kube-apiserver</code> 的运行日志验证是否有请求正在被代理。</p><p>一种解决方法是在 <code>kube-apiserver</code> 的配置中删除代理设置，另一种解决方法是把 <code>istio-sidecar-injector.istio-system.svc</code> 或者 <code>.svc</code> 加到 <code>no_proxy</code> 的 <code>value</code> 里面。每种解决方法都需要重新启动 <code>kube-apiserver</code>。</p><p>Kubernetes 与此有关的一个 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/kubernetes/kubeadm/issues/666">issue</a> 已被 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/kubernetes/kubernetes/pull/58698#discussion_r163879443">PR #58698</a> 解决。</p><h2 id="在-pods-中使用-tcpdump-的限制"><a href="#在-pods-中使用-tcpdump-的限制" class="headerlink" title="在 pods 中使用 tcpdump 的限制"></a>在 pods 中使用 <code>tcpdump</code> 的限制</h2><p><code>tcpdump</code> 在 sidecar 中不能工作 - 因为该容器不以 root 身份运行。但是由于同一 pod 内容器的网络命名空间是共享的，因此 pod 中的其他容器也能看到所有数据包。<code>iptables</code> 也能查看到 pod 级别的相关配置。</p><p>Envoy 和应用程序之间的通信是通过 127.0.0.1 进行的，这个通讯过程未加密。</p><h2 id="群集不会自动缩小"><a href="#群集不会自动缩小" class="headerlink" title="群集不会自动缩小"></a>群集不会自动缩小</h2><p>由于 Sidecar 容器安装了本地存储卷，因此节点自动缩放器无法使用注入的 Pod 驱逐节点。这是一个<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/istio/istio/issues/19395">已知的问题</a>。解决方法是向 Pod 添加注释 <code>“cluster-autoscaler.kubernetes.io/safe-to-evict”：“true”</code>。</p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者:</span> <span class="post-copyright-info"><a href="https://xiaowu95.wang">小五</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接:</span> <span class="post-copyright-info"><a href="https://xiaowu95.wang/posts/46b7d67b/">https://xiaowu95.wang/posts/46b7d67b/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://xiaowu95.wang" target="_blank">小五的个人杂货铺</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a><a class="post-meta__tags" href="/tags/k8s/">k8s</a><a class="post-meta__tags" href="/tags/istio/">istio</a></div><div class="post-share"><div class="social-share" data-image="/img/nba-logo28.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>感谢支持</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wxpay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-lazy-src="/img/wxpay.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-lazy-src="/img/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/57f0584f/" title="gRPC配置参数使用记录"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo29.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">gRPC配置参数使用记录</div></div><div class="info-2"><div class="info-item-1">参考： 参数配置 service_config 重试</div></div></div></a><a class="pagination-related" href="/posts/598d2dd4/" title="Nginx配置gRPC协议"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo7.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Nginx配置gRPC协议</div></div><div class="info-2"><div class="info-item-1">Nginx配置gRPC请求Nginx 在 1.13.10 中，新增了对gRPC的原生支持。有了对 gRPC 的支持，NGINX 就可以代理 gRPC TCP 连接，还可以终止、检查和跟踪 gRPC 的方法调用。 Nginx需要引入模块：--with-http_ssl_module --with-http_v2_module 为已经安装的Nginx添加新的编译模块： 进入解压的Nginx目录 执行命令：./configure --with-http_ssl_module --with-http_v2_module 执行命令：make &amp;&amp; make install。执行make install时会将原有的文件替换掉，且会备份之前的文件 使用基础使用方式在客户端和服务器端之间插入 NGINX，NGINX 为服务器端的应用程序提供了一个稳定可靠的网关。 NGINX 使用 HTTP 服务器监听 gRPC 流量，并使用 grpc_pass 指令代理流量。 为 NGINX 创建以下代理配置，在端口 80 上侦听未加密的 gRPC 流量并将请求转发到端口 50051...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/a28b97ff/" title="EnvoyFilter-ChatGPT译文"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo26.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2024-02-02</div><div class="info-item-2">EnvoyFilter-ChatGPT译文</div></div><div class="info-2"><div class="info-item-1">介绍 EnvoyFilter 提供了一种机制，可以自定义 Istio Pilot 生成的 Envoy 配置。使用 EnvoyFilter 修改某些字段的值、添加特定过滤器，甚至添加全新的监听器、集群等。这个功能必须小心使用，因为不正确的配置可能会破坏整个网格。与其他 Istio 网络对象不同，EnvoyFilters 是附加应用的。在特定命名空间中给定工作负载可以存在任意数量的 EnvoyFilters 。这些 EnvoyFilters 的应用顺序如下：所有位于配置根命名空间中的 EnvoyFilters ，然后是匹配工作负载命名空间中所有匹配到的 EnvoyFilters。 注意点注意1：此 API 的某些方面与 Istio 网络子系统以及Envoy XDS API 的内部实现密切相关。虽然EnvoyFilter API本身将保持向后兼容性，但通过此机制提供的任何 envoy 配置都应该在Istio代理版本升级时进行仔细监控，以确保已弃用字段被适当地删除和替换。 注意2：当多个Envoy Filters...</div></div></div></a><a class="pagination-related" href="/posts/fa103d3a/" title="idea添加对istio的智能提示"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2024-02-02</div><div class="info-item-2">idea添加对istio的智能提示</div></div><div class="info-2"><div class="info-item-1">转自: https://blog.51cto.com/u_15127588/3305078 JetBrains 系列 IDE 有一个非常好用的 Kubernetes 的官方插件：JetBrains Kubernetes Plugin 。该插件支持资源对象关键字的自动补全和语法检查，这对于编写或者修改 YAML 文件非常方便。但是此前版本不支持 自定义的 CRD 对象，这对于该插件的易用性来说，略有一些遗憾。 现在新版的 Kubernetes 插件已经支持通过文件导入或者 URL 导入 CRD 定义文件，从而支持任意 CRD 资源对象的关键字自动补全和语法检查。 12Custom resource definition (CRD) supportCustom resources can be validated by providing complementary OpenAPI 2.0 files with CRD schemas and/or CRD resource definitions (YAML) (limited support). 下面以服务网格 Istio...</div></div></div></a><a class="pagination-related" href="/posts/43409a5/" title="利用istio实现灰度发布"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo28.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2024-02-02</div><div class="info-item-2">利用istio实现灰度发布</div></div><div class="info-2"><div class="info-item-1">Kubernetes 中如何实现灰度发布当你Kubernetes 集群中部署业务时，可以利用 Kubernetes 原生提供的灰度发布的方式去上线业务。这种方式是通过在旧版本和新版本的服务之间，定义一个差异化的 Label，根据不同版本之间的公共 Label 负载流量到后端 Pod，最终实现根据 Pod 的副本数控制流量的百分比。 如下图所示：用户定义了两个 Deployment 对象，其中旧版本名为 frontend-stable，有3个副本。新版本为 frontend-canary，有1个副本。此时定义了一个 Service 对象，使用它们之间公共的 Label 进行选择。这就使得用户访问 frontend 这个 Service 时，能以 3:1 的比例同时访问到两个版本。并且还可以通过调整副本数持续控制流量比例，最终达到完整上线。 Kubernetes 默认的实现方式在简单的部署场景下很有效，但是在一些复杂场景中，仍然会有较大的局限，如： 业务配置自动伸缩后，会直接影响灰度发布的流量比例 低百分比的流量控制占用资源高，如 1 % 的流量到达新版本，则至少需要 100...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-lazy-src="/img/avatar.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">小五</div><div class="author-info-description">Tomorrow will be better,Everything will be fine</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">550</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">163</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">58</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/wang-xiaowu"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons"><a class="social-icon" href="/random" target="_blank" title="随便逛逛"><i class="fa-solid fa-shuffle"></i></a><a class="social-icon" href="mailto:wangxiaowu950330@foxmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/30655189?spm_id_from=333.1007.0.0" rel="external nofollow noreferrer" target="_blank" title="BiliBili"><i class="fa-brands fa-bilibili"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa-solid fa-rss"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Sidecar"><span class="toc-number">1.</span> <span class="toc-text">安装 Sidecar</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5"><span class="toc-number">1.1.</span> <span class="toc-text">注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%85%A5-Sidecar"><span class="toc-number">1.1.1.</span> <span class="toc-text">自动注入 Sidecar</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">部署应用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%B3%A8%E5%85%A5%E7%AD%96%E7%95%A5"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">控制注入策略</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E6%B3%A8%E5%85%A5-Sidecar"><span class="toc-number">1.1.2.</span> <span class="toc-text">手动注入 Sidecar</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E5%85%A5"><span class="toc-number">1.2.</span> <span class="toc-text">自定义注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E6%9D%BF%EF%BC%88%E8%AF%95%E9%AA%8C%E7%89%B9%E6%80%A7%EF%BC%89"><span class="toc-number">1.2.1.</span> <span class="toc-text">自定义模板（试验特性）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Sidecar-%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%85%A5%E9%97%AE%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">Sidecar 自动注入问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5%E7%9A%84%E7%BB%93%E6%9E%9C%E5%92%8C%E9%A2%84%E6%9C%9F%E4%B8%8D%E4%B8%80%E8%87%B4"><span class="toc-number">2.1.</span> <span class="toc-text">注入的结果和预期不一致</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pods-%E4%B8%8D%E8%83%BD%E5%88%9B%E5%BB%BA"><span class="toc-number">2.2.</span> <span class="toc-text">pods 不能创建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#x509-%E8%AF%81%E4%B9%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%94%99%E8%AF%AF"><span class="toc-number">2.2.1.</span> <span class="toc-text">x509 证书相关的错误</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deployment-%E7%8A%B6%E6%80%81%E4%B8%AD%E5%87%BA%E7%8E%B0-no-such-hosts-%E6%88%96-no-endpoints-available"><span class="toc-number">2.2.2.</span> <span class="toc-text">deployment 状态中出现 no such hosts 或 no endpoints available</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C-Kubernetes-API-server-%E6%9C%89%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE%E7%9A%84%E8%AF%9D%EF%BC%8Csidecar-%E7%9A%84%E8%87%AA%E5%8A%A8%E6%B3%A8%E5%85%A5%E5%8A%9F%E8%83%BD%E6%98%AF%E4%B8%8D%E8%83%BD%E7%94%A8%E7%9A%84"><span class="toc-number">2.3.</span> <span class="toc-text">如果 Kubernetes API server 有代理设置的话，sidecar 的自动注入功能是不能用的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8-pods-%E4%B8%AD%E4%BD%BF%E7%94%A8-tcpdump-%E7%9A%84%E9%99%90%E5%88%B6"><span class="toc-number">2.4.</span> <span class="toc-text">在 pods 中使用 tcpdump 的限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BE%A4%E9%9B%86%E4%B8%8D%E4%BC%9A%E8%87%AA%E5%8A%A8%E7%BC%A9%E5%B0%8F"><span class="toc-number">2.5.</span> <span class="toc-text">群集不会自动缩小</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/c75c82a0/" title="使用 TypeScript 创建 Koa 服务器"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo16.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="使用 TypeScript 创建 Koa 服务器"></a><div class="content"><a class="title" href="/posts/c75c82a0/" title="使用 TypeScript 创建 Koa 服务器">使用 TypeScript 创建 Koa 服务器</a><time datetime="2025-10-11T06:00:11.000Z" title="发表于 2025-10-11 14:00:11">2025-10-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/c9d8bfa7/" title="Nodejs应用提取heap并加以分析的一些常用方法"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo24.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Nodejs应用提取heap并加以分析的一些常用方法"></a><div class="content"><a class="title" href="/posts/c9d8bfa7/" title="Nodejs应用提取heap并加以分析的一些常用方法">Nodejs应用提取heap并加以分析的一些常用方法</a><time datetime="2025-09-28T07:54:43.000Z" title="发表于 2025-09-28 15:54:43">2025-09-28</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/nba-logo28.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By 小五</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a href="https://www.foreverblog.cn/" rel="external nofollow noreferrer" target="_blank"><img src="/img/loading.gif" data-lazy-src="https://img.foreverblog.cn/logo_en_default.png" alt="十年之约" style="width:auto;height:16px"></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.2.2/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.2.2/source/js/main.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.2.2/source/js/tw_cn.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(()=>{const e=()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");if(0===e.length)return;const t=()=>(e=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";e.forEach(((e,n)=>{const d=e.firstElementChild,a=`mermaid-${n}`,r=`%%{init:{ 'theme':'${t}'}}%%\n`+d.textContent,i=mermaid.render(a,r),m=e=>{d.insertAdjacentHTML("afterend",e)};"string"==typeof i?m(i):i.then((({svg:e})=>m(e)))}))})(e);btf.addGlobalFn("themeChange",t,"mermaid"),window.loadMermaid?t():btf.getScript("https://cdn.jsdelivr.net/npm/mermaid@11.4.0/dist/mermaid.min.js").then(t)};btf.addGlobalFn("encrypt",e,"mermaid"),window.pjax?e():document.addEventListener("DOMContentLoaded",e)})()</script><script>(()=>{const t=document.querySelectorAll("#article-container .chartjs-container");if(0===t.length)return;const e=(t,a)=>{"object"==typeof t&&null!==t&&Object.keys(t).forEach((r=>{const n=t[r];"object"==typeof n&&null!==n&&(n[a]?t[r]=n[a]:e(n,a))}))},a=()=>{window.loadChartJS=!0,Array.from(t).forEach(((t,a)=>{const r=t.firstElementChild,n=t.getAttribute("data-chartjs-id")||"chartjs-"+a,d=t.getAttribute("data-width"),o=document.getElementById(n);o&&o.parentNode.remove();const c=r.textContent,l=document.createElement("canvas");l.id=n;const s=document.createElement("div");s.className="chartjs-wrap",d&&(s.style.width=d),s.appendChild(l),r.insertAdjacentElement("afterend",s);const h=document.getElementById(n).getContext("2d"),i=JSON.parse(c),m="dark"===document.documentElement.getAttribute("data-theme")?"dark-mode":"light-mode";(t=>{"dark-mode"===t?(Chart.defaults.color="rgba(255, 255, 255, 0.8)",Chart.defaults.borderColor="rgba(255, 255, 255, 0.2)",Chart.defaults.scale.ticks.backdropColor="transparent"):(Chart.defaults.color="rgba(0, 0, 0, 0.8)",Chart.defaults.borderColor="rgba(0, 0, 0, 0.1)",Chart.defaults.scale.ticks.backdropColor="transparent")})(m),e(i,m),new Chart(h,i)}))},r=()=>{window.loadChartJS?a():btf.getScript("https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js").then(a)};btf.addGlobalFn("themeChange",a,"chartjs"),btf.addGlobalFn("encrypt",a,"chartjs"),window.pjax?r():document.addEventListener("DOMContentLoaded",r)})()</script></div><div class="aplayer no-destroy" data-id="9061017364" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listfolded="false" data-order="random" data-lrctype="1" data-preload="none" data-autoplay="false" muted></div><div class="app-refresh" id="app-refresh"><div class="app-refresh-wrap"><label>网站已更新最新版本</label> <a href="javascript:void(0)" rel="external nofollow noreferrer" onclick="location.reload()">点击刷新</a></div></div><script>function showNotification(){if(GLOBAL_CONFIG.Snackbar){var t="light"===document.documentElement.getAttribute("data-theme")?GLOBAL_CONFIG.Snackbar.bgLight:GLOBAL_CONFIG.Snackbar.bgDark,e=GLOBAL_CONFIG.Snackbar.position;Snackbar.show({text:"已更新最新版本",backgroundColor:t,duration:5e5,pos:e,actionText:"点击刷新",actionTextColor:"#fff",onActionClick:function(t){location.reload()}})}else{var o=`top: 0; background: ${"light"===document.documentElement.getAttribute("data-theme")?"#49b1f5":"#1f1f1f"};`;document.getElementById("app-refresh").style.cssText=o}}"serviceWorker"in navigator&&(navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("controllerchange",(function(){showNotification()})),window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js")})))</script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="/js/diytitle.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!0,document.body.addEventListener("input",POWERMODE)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/metingjs/dist/Meting.min.js"></script><script>btf.addGlobalFn("pjaxSend",(()=>{if(window.aplayers)for(let a=0;a<window.aplayers.length;a++)window.aplayers[a].options.fixed||window.aplayers[a].destroy()}),"destroyAplayer"),btf.addGlobalFn("pjaxComplete",loadMeting,"runMetingJS")</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>(()=>{window.pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/talking/"]):not([href="/artitalk/"])',selectors:['link[rel="canonical"]','meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"],cacheBust:!1,analytics:!0,scrollRestoration:!1});const e=e=>{e&&Object.values(e).forEach((e=>e()))};document.addEventListener("pjax:send",(()=>{btf.removeGlobalFnEvent("pjaxSendOnce"),btf.removeGlobalFnEvent("themeChange");const t=document.body.classList;t.contains("read-mode")&&t.remove("read-mode"),e(window.globalFn.pjaxSend)})),document.addEventListener("pjax:complete",(()=>{btf.removeGlobalFnEvent("pjaxCompleteOnce"),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),a=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(a)),e.parentNode.replaceChild(t,e)})),e(window.globalFn.pjaxComplete)})),document.addEventListener("pjax:error",(e=>{404===e.request.status&&pjax.loadUrl("/404")}))})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@5.12.0/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.75.3/dist/instantsearch.production.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.2.2/source/js/search/algolia.min.js"></script></div></div><script data-pjax>if(document.getElementById("recent-posts")&&"/"==location.pathname){var parent=document.getElementById("recent-posts"),child='<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo25.jpg" alt="/img/nba-logo25.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2024-02-02</span><a class="blog-slider__title" href="posts/1bcb0ad4/">单环境,多分支并行开发方案(流量染色/istio)</a><div class="blog-slider__text">单环境,多分支并行开发方案(流量染色/istio)</div><a class="blog-slider__button" href="posts/1bcb0ad4/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo15.jpg" alt="/img/nba-logo15.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-04-06</span><a class="blog-slider__title" href="posts/2a9d73ff/">教你如何零成本从0到1，开发上线一个对接了openAI的机器人</a><div class="blog-slider__text">教你如何零成本从0到1，开发上线一个对接了openAI的机器人</div><a class="blog-slider__button" href="posts/2a9d73ff/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo3.jpg" alt="/img/nba-logo3.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-06-14</span><a class="blog-slider__title" href="posts/aa43cc95/">记录k8s环境下结合alinode的使用</a><div class="blog-slider__text">记录k8s环境下结合alinode的使用</div><a class="blog-slider__button" href="posts/aa43cc95/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo29.jpg" alt="/img/nba-logo29.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-12-13</span><a class="blog-slider__title" href="posts/15957791/">k8s环境下,nginx做websocket负载的方案梳理</a><div class="blog-slider__text">k8s环境下,nginx做websocket负载的方案梳理</div><a class="blog-slider__button" href="posts/15957791/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo12.jpg" alt="/img/nba-logo12.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-09-26</span><a class="blog-slider__title" href="posts/4ecfb081/">记录一次k8s网络DNS问题排查过程</a><div class="blog-slider__text">记录一次k8s网络DNS问题排查过程</div><a class="blog-slider__button" href="posts/4ecfb081/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo12.jpg" alt="/img/nba-logo12.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-09-26</span><a class="blog-slider__title" href="posts/37032a87/">k3s高可用安装</a><div class="blog-slider__text">k3s高可用安装</div><a class="blog-slider__button" href="posts/37032a87/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo17.jpg" alt="/img/nba-logo17.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-11-27</span><a class="blog-slider__title" href="posts/20b19ed4/">分词搜索需求整理</a><div class="blog-slider__text">分词搜索需求整理</div><a class="blog-slider__button" href="posts/20b19ed4/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo9.jpg" alt="/img/nba-logo9.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-12-02</span><a class="blog-slider__title" href="posts/6de14387/">整理wsl2配合开发的一些配置</a><div class="blog-slider__text">整理wsl2配合开发的一些配置</div><a class="blog-slider__button" href="posts/6de14387/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo30.jpg" alt="/img/nba-logo30.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-12-11</span><a class="blog-slider__title" href="posts/fb9adcb6/">记录windows11+wsl2环境搭配</a><div class="blog-slider__text">windows11+wsl2开发环境配置</div><a class="blog-slider__button" href="posts/fb9adcb6/">详情</a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';console.log("已挂载swiper"),parent.insertAdjacentHTML("afterbegin",child)}</script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper@0.18/swiper/swiperindex.js"></script><style></style><script data-pjax>function history_calendar_injector_config(){var i=document.getElementsByClassName("sticky_layout")[0];console.log("已挂载history_calendar"),i.insertAdjacentHTML("afterbegin",'<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>那年今日</span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>')}document.getElementsByClassName("sticky_layout")[0]&&"/"===location.pathname&&history_calendar_injector_config()</script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"right",width:150,height:300,hOffset:20,vOffset:-20},mobile:{show:!0},log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/"})</script></body></html>