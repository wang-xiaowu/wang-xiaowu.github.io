<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>elasticsearchçš„dslä½¿ç”¨ | å°äº”çš„ä¸ªäººæ‚è´§é“º</title><meta name="author" content="å°äº”"><meta name="copyright" content="å°äº”"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="1.DSLæŸ¥è¯¢æ–‡æ¡£elasticsearchçš„æŸ¥è¯¢ä¾ç„¶æ˜¯åŸºäºJSONé£æ ¼çš„DSLæ¥å®ç°çš„ã€‚ 1.1.DSLæŸ¥è¯¢åˆ†ç±»Elasticsearchæä¾›äº†åŸºäºJSONçš„DSLï¼ˆDomain Specific Languageï¼‰æ¥å®šä¹‰æŸ¥è¯¢ã€‚å¸¸è§çš„æŸ¥è¯¢ç±»å‹åŒ…æ‹¬ï¼š  æŸ¥è¯¢æ‰€æœ‰ï¼šæŸ¥è¯¢å‡ºæ‰€æœ‰æ•°æ®ï¼Œä¸€èˆ¬æµ‹è¯•ç”¨ã€‚ä¾‹å¦‚ï¼šmatch_all  å…¨æ–‡æ£€ç´¢ï¼ˆfull textï¼‰æŸ¥è¯¢ï¼šåˆ©ç”¨åˆ†è¯å™¨å¯¹ç”¨æˆ·è¾“å…¥å†…å®¹åˆ†è¯ï¼Œç„¶åå»å€’æ’ç´¢å¼•"><meta property="og:type" content="article"><meta property="og:title" content="elasticsearchçš„dslä½¿ç”¨"><meta property="og:url" content="https://xiaowu95.wang/posts/4bb6b4d2/"><meta property="og:site_name" content="å°äº”çš„ä¸ªäººæ‚è´§é“º"><meta property="og:description" content="1.DSLæŸ¥è¯¢æ–‡æ¡£elasticsearchçš„æŸ¥è¯¢ä¾ç„¶æ˜¯åŸºäºJSONé£æ ¼çš„DSLæ¥å®ç°çš„ã€‚ 1.1.DSLæŸ¥è¯¢åˆ†ç±»Elasticsearchæä¾›äº†åŸºäºJSONçš„DSLï¼ˆDomain Specific Languageï¼‰æ¥å®šä¹‰æŸ¥è¯¢ã€‚å¸¸è§çš„æŸ¥è¯¢ç±»å‹åŒ…æ‹¬ï¼š  æŸ¥è¯¢æ‰€æœ‰ï¼šæŸ¥è¯¢å‡ºæ‰€æœ‰æ•°æ®ï¼Œä¸€èˆ¬æµ‹è¯•ç”¨ã€‚ä¾‹å¦‚ï¼šmatch_all  å…¨æ–‡æ£€ç´¢ï¼ˆfull textï¼‰æŸ¥è¯¢ï¼šåˆ©ç”¨åˆ†è¯å™¨å¯¹ç”¨æˆ·è¾“å…¥å†…å®¹åˆ†è¯ï¼Œç„¶åå»å€’æ’ç´¢å¼•"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://xiaowu95.wang/img/nba-logo23.jpg"><meta property="article:published_time" content="2021-09-19T16:00:00.000Z"><meta property="article:modified_time" content="2023-06-16T02:13:02.000Z"><meta property="article:author" content="å°äº”"><meta property="article:tag" content="elasticsearch"><meta property="article:tag" content="elastic stack"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://xiaowu95.wang/img/nba-logo23.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "elasticsearchçš„dslä½¿ç”¨",
  "url": "https://xiaowu95.wang/posts/4bb6b4d2/",
  "image": "https://xiaowu95.wang/img/nba-logo23.jpg",
  "datePublished": "2021-09-19T16:00:00.000Z",
  "dateModified": "2023-06-16T02:13:02.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "å°äº”",
      "url": "https://xiaowu95.wang"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://xiaowu95.wang/posts/4bb6b4d2/"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="kHfLZxYQ7y3s3AR7gyJDdJkQvGNjQsvopp6N3gEEx0s"><meta name="baidu-site-verification" content="codeva-aVS4F6wAjS"><link rel="manifest" href="/wang-xiaowu/pwa/site.webmanifest"><meta name="msapplication-TileColor" content="#fff"><link rel="apple-touch-icon" sizes="180x180" href="/wang-xiaowu/pwa/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/wang-xiaowu/pwa/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/wang-xiaowu/pwa/favicon-16x16.png"><link rel="mask-icon" href="/wang-xiaowu/pwa/safari-pinned-tab.svg" color="#5bbad5"><link rel="stylesheet" href="/css/index.css?v=5.5.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.33/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise(((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach((([e,t])=>n.setAttribute(e,t))),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)})),getCSS:(e,t)=>new Promise(((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)})),addGlobalFn:(e,t,o=!1,a=window)=>{const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),c=window.matchMedia("(prefers-color-scheme: dark)"),r=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(r.matches)a();else if(c.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}c.addEventListener("change",(()=>{void 0===t.get("theme")&&(e.matches?o():a())}))}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?86cb34987e15c900c39e12ebdf08c50d";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),btf.addGlobalFn("pjaxComplete",(()=>{_hmt.push(["_trackPageview",window.location.pathname])}),"baidu_analytics")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-1MFQ47191J"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-1MFQ47191J"),btf.addGlobalFn("pjaxComplete",(()=>{gtag("config","G-1MFQ47191J",{page_path:window.location.pathname})}),"google_analytics")</script><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"M91QAWRVY4",apiKey:"ecc30a5e06136e1cc491685e39801190",indexName:"xiaowu-blog",hitsPerPage:6,languages:{hits_empty:"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}",hits_stats:"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œè€—æ—¶ ${time} æ¯«ç§’"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"ç¹",msgToSimplifiedChinese:"ç°¡"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:400,highlightFullpage:!0,highlightMacStyle:!0},copy:{success:"å¤åˆ¶æˆåŠŸ",error:"å¤åˆ¶å¤±è´¥",noSupport:"æµè§ˆå™¨ä¸æ”¯æŒ"},relativeDate:{homepage:!0,post:!0},runtime:"å¤©",dateSuffix:{just:"åˆšåˆš",min:"åˆ†é’Ÿå‰",hour:"å°æ—¶å‰",day:"å¤©å‰",month:"ä¸ªæœˆå‰"},copyright:{limitCount:150,languages:{author:"ä½œè€…: å°äº”",link:"é“¾æ¥: ",source:"æ¥æº: å°äº”çš„ä¸ªäººæ‚è´§é“º",info:"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"å·²åˆ‡æ¢ä¸ºç¹ä½“ä¸­æ–‡",cht_to_chs:"å·²åˆ‡æ¢ä¸ºç®€ä½“ä¸­æ–‡",day_to_night:"å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼",night_to_day:"å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"åŠ è½½æ›´å¤š"},isPhotoFigcaption:!1,islazyloadPlugin:!0,isAnchor:!0,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"elasticsearchçš„dslä½¿ç”¨",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><script src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><link rel="stylesheet" href="/css/font.css"><style>.app-refresh{position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease}.app-refresh-wrap{display:flex;color:#fff;height:100%;align-items:center;justify-content:center}.app-refresh-wrap a{color:#fff;text-decoration:underline;cursor:pointer}</style><link rel="stylesheet" href="/css/titleStyle.css"><link rel="stylesheet" href="/css/mouse.css"><link rel="stylesheet" href="/css/custom.css"><style>.card-announcement .social-button{margin:.6rem 0 0 0;text-align:center}.card-announcement .social-button a{display:block;background-color:var(--btn-bg);color:var(--btn-color);text-align:center;line-height:2.4;margin:4px 0}.card-announcement .social-button a:hover{background-color:var(--btn-hover-color)}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiperstyle.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="alternate" href="/atom.xml" title="å°äº”çš„ä¸ªäººæ‚è´§é“º" type="application/atom+xml"></head><body><script>window.paceOptions={restartOnPushState:!1},btf.addGlobalFn("pjaxSend",(()=>{Pace.restart()}),"pace_restart")</script><link rel="stylesheet" href="/css/pace.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-lazy-src="/img/avatar.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">554</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">168</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">55</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/github/"><i class="fa-fw fa-solid fa-address-card"></i> <span>å…³äºæˆ‘</span></a></div><div class="menus_item"><a class="site-page" href="/ac/"><i class="fa-fw fa-solid fa-wind"></i> <span>ä¾¿æºå°ç©ºè°ƒ</span></a></div><div class="menus_item"><a class="site-page" href="/talking/"><i class="fa-fw fa-solid fa-walkie-talkie"></i> <span>åšå®¢çŸ­è®°</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i> <span>ç›®å½•</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-otter"></i> <span>æ‚è®°</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/songs/"><i class="fa-fw fas fa-music"></i> <span>éŸ³ä¹</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>å›¾åº“</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa-solid fa-film"></i> <span>å½±è§†|ç•ªå‰§</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book faa-fload"></i> <span>ä¹¦å•</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad faa-fload"></i> <span>æ¸¸æˆ</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-bilibili"></i> <span>BiliBiliè¿½ç•ª</span></a></li><li><a class="site-page child" href="/cinemas/"><i class="fa-fw fa-solid fa-video"></i> <span>BiliBiliè¿½å‰§</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i> <span>ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-user-group"></i> <span>å‹é“¾</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-mug-saucer"></i> <span>Website Memo</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://console.leancloud.app/apps"><span>ğŸš€ LeanCloud</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.com/dashboard"><span>ğŸš€ Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://tongji.baidu.com/main/overview/10000432799/overview/index"><span>ğŸš€ ç™¾åº¦ç»Ÿè®¡</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://ziyuan.baidu.com/dashboard/index"><span>ğŸš€ ç™¾åº¦ç«™ç‚¹ç®¡ç†</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://analytics.google.com/analytics/web/"><span>ğŸš€ è°·æ­Œåˆ†æ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://search.google.com/search-console?hl=zh-cn"><span>ğŸš€ è°·æ­Œç«™ç‚¹ç®¡ç†</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.google.com/adsense/new/u/0/pub-1375421173355613/home"><span>ğŸš€ è°·æ­Œå¹¿å‘Šè”ç›Ÿ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.algolia.com/"><span>ğŸš€ Algolia</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://sms-activate.org/cn/"><span>ğŸš€ Sms-activate</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chatgpt.com/"><span>ğŸš€ ChatGPT</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://gemini.google.com/"><span>ğŸš€ Gemini</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://poe.com/"><span>ğŸš€ Poeèšåˆ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.idc.net/clientarea"><span>ğŸš€ åæµªäº‘</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.west.cn/"><span>ğŸš€ è¥¿éƒ¨æ•°æ®</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://shandianpro.com/#/dashboard"><span>ğŸš€ é—ªç”µ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.huojian.homes/"><span>ğŸš€ å°ç«ç®­</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/winston779/gougou"><span>ğŸš€ ç‹—ç‹—åŠ é€Ÿ</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/nba-logo23.jpg)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">å°äº”çš„ä¸ªäººæ‚è´§é“º</span></a><a class="nav-page-title" href="/"><span class="site-name">elasticsearchçš„dslä½¿ç”¨</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i> <span>è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/github/"><i class="fa-fw fa-solid fa-address-card"></i> <span>å…³äºæˆ‘</span></a></div><div class="menus_item"><a class="site-page" href="/ac/"><i class="fa-fw fa-solid fa-wind"></i> <span>ä¾¿æºå°ç©ºè°ƒ</span></a></div><div class="menus_item"><a class="site-page" href="/talking/"><i class="fa-fw fa-solid fa-walkie-talkie"></i> <span>åšå®¢çŸ­è®°</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i> <span>ç›®å½•</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-otter"></i> <span>æ‚è®°</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/songs/"><i class="fa-fw fas fa-music"></i> <span>éŸ³ä¹</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>å›¾åº“</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa-solid fa-film"></i> <span>å½±è§†|ç•ªå‰§</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book faa-fload"></i> <span>ä¹¦å•</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad faa-fload"></i> <span>æ¸¸æˆ</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-bilibili"></i> <span>BiliBiliè¿½ç•ª</span></a></li><li><a class="site-page child" href="/cinemas/"><i class="fa-fw fa-solid fa-video"></i> <span>BiliBiliè¿½å‰§</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i> <span>ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-user-group"></i> <span>å‹é“¾</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-mug-saucer"></i> <span>Website Memo</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://console.leancloud.app/apps"><span>ğŸš€ LeanCloud</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.com/dashboard"><span>ğŸš€ Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://tongji.baidu.com/main/overview/10000432799/overview/index"><span>ğŸš€ ç™¾åº¦ç»Ÿè®¡</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://ziyuan.baidu.com/dashboard/index"><span>ğŸš€ ç™¾åº¦ç«™ç‚¹ç®¡ç†</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://analytics.google.com/analytics/web/"><span>ğŸš€ è°·æ­Œåˆ†æ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://search.google.com/search-console?hl=zh-cn"><span>ğŸš€ è°·æ­Œç«™ç‚¹ç®¡ç†</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.google.com/adsense/new/u/0/pub-1375421173355613/home"><span>ğŸš€ è°·æ­Œå¹¿å‘Šè”ç›Ÿ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.algolia.com/"><span>ğŸš€ Algolia</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://sms-activate.org/cn/"><span>ğŸš€ Sms-activate</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chatgpt.com/"><span>ğŸš€ ChatGPT</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://gemini.google.com/"><span>ğŸš€ Gemini</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://poe.com/"><span>ğŸš€ Poeèšåˆ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.idc.net/clientarea"><span>ğŸš€ åæµªäº‘</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.west.cn/"><span>ğŸš€ è¥¿éƒ¨æ•°æ®</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://shandianpro.com/#/dashboard"><span>ğŸš€ é—ªç”µ</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.huojian.homes/"><span>ğŸš€ å°ç«ç®­</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/winston779/gougou"><span>ğŸš€ ç‹—ç‹—åŠ é€Ÿ</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">elasticsearchçš„dslä½¿ç”¨<a class="post-edit-link" href="https://github.com/wang-xiaowu/wang-xiaowu.github.io/issues/new?_posts/elasticsearch/elasticsearchçš„dslä½¿ç”¨.md" rel="external nofollow noreferrer" title="ç¼–è¾‘" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2021-09-19T16:00:00.000Z" title="å‘è¡¨äº 2021-09-20 00:00:00">2021-09-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-06-16T02:13:02.000Z" title="æ›´æ–°äº 2023-06-16 10:13:02">2023-06-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/elasticsearch/">elasticsearch</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">8.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>32åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;è·ç¦»ä¸Šä¸€æ¬¡æ›´æ–°è¯¥æ–‡ç« å·²ç»è¿‡äº†&quot;,&quot;messageNext&quot;:&quot;å¤©ï¼Œæ–‡ç« æ‰€æè¿°çš„å…§å®¹å¯èƒ½å·²ç»å‘ç”Ÿå˜åŒ–ï¼Œè¯·ç•™æ„ã€‚&quot;,&quot;postUpdate&quot;:&quot;2023-06-16 10:13:02&quot;}" hidden></div><h1 id="1-DSLæŸ¥è¯¢æ–‡æ¡£"><a href="#1-DSLæŸ¥è¯¢æ–‡æ¡£" class="headerlink" title="1.DSLæŸ¥è¯¢æ–‡æ¡£"></a>1.DSLæŸ¥è¯¢æ–‡æ¡£</h1><p>elasticsearchçš„æŸ¥è¯¢ä¾ç„¶æ˜¯åŸºäºJSONé£æ ¼çš„DSLæ¥å®ç°çš„ã€‚</p><h2 id="1-1-DSLæŸ¥è¯¢åˆ†ç±»"><a href="#1-1-DSLæŸ¥è¯¢åˆ†ç±»" class="headerlink" title="1.1.DSLæŸ¥è¯¢åˆ†ç±»"></a>1.1.DSLæŸ¥è¯¢åˆ†ç±»</h2><p>Elasticsearchæä¾›äº†åŸºäºJSONçš„DSLï¼ˆ<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html">Domain Specific Language</a>ï¼‰æ¥å®šä¹‰æŸ¥è¯¢ã€‚å¸¸è§çš„æŸ¥è¯¢ç±»å‹åŒ…æ‹¬ï¼š</p><ul><li><p><strong>æŸ¥è¯¢æ‰€æœ‰</strong>ï¼šæŸ¥è¯¢å‡ºæ‰€æœ‰æ•°æ®ï¼Œä¸€èˆ¬æµ‹è¯•ç”¨ã€‚ä¾‹å¦‚ï¼šmatch_all</p></li><li><p><strong>å…¨æ–‡æ£€ç´¢ï¼ˆfull textï¼‰æŸ¥è¯¢</strong>ï¼šåˆ©ç”¨åˆ†è¯å™¨å¯¹ç”¨æˆ·è¾“å…¥å†…å®¹åˆ†è¯ï¼Œç„¶åå»å€’æ’ç´¢å¼•åº“ä¸­åŒ¹é…ã€‚ä¾‹å¦‚ï¼š</p><ul><li>match_query</li><li>multi_match_query</li></ul></li><li><p><strong>ç²¾ç¡®æŸ¥è¯¢</strong>ï¼šæ ¹æ®ç²¾ç¡®è¯æ¡å€¼æŸ¥æ‰¾æ•°æ®ï¼Œä¸€èˆ¬æ˜¯æŸ¥æ‰¾keywordã€æ•°å€¼ã€æ—¥æœŸã€booleanç­‰ç±»å‹å­—æ®µã€‚ä¾‹å¦‚ï¼š</p><ul><li>ids</li><li>range</li><li>term</li></ul></li><li><p><strong>åœ°ç†ï¼ˆgeoï¼‰æŸ¥è¯¢</strong>ï¼šæ ¹æ®ç»çº¬åº¦æŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼š</p><ul><li>geo_distance</li><li>geo_bounding_box</li></ul></li><li><p><strong>å¤åˆï¼ˆcompoundï¼‰æŸ¥è¯¢</strong>ï¼šå¤åˆæŸ¥è¯¢å¯ä»¥å°†ä¸Šè¿°å„ç§æŸ¥è¯¢æ¡ä»¶ç»„åˆèµ·æ¥ï¼Œåˆå¹¶æŸ¥è¯¢æ¡ä»¶ã€‚ä¾‹å¦‚ï¼š</p><ul><li>bool</li><li>function_score</li></ul></li></ul><p>æŸ¥è¯¢çš„è¯­æ³•åŸºæœ¬ä¸€è‡´ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;æŸ¥è¯¢ç±»å‹&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;æŸ¥è¯¢æ¡ä»¶&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ¡ä»¶å€¼&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä»¥æŸ¥è¯¢æ‰€æœ‰ä¸ºä¾‹ï¼Œå…¶ä¸­ï¼š</p><ul><li>æŸ¥è¯¢ç±»å‹ä¸ºmatch_all</li><li>æ²¡æœ‰æŸ¥è¯¢æ¡ä»¶</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥è¯¢æ‰€æœ‰</span></span><br><span class="line">GET /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å…¶å®ƒæŸ¥è¯¢æ— éå°±æ˜¯<strong>æŸ¥è¯¢ç±»å‹</strong>ã€<strong>æŸ¥è¯¢æ¡ä»¶</strong>çš„å˜åŒ–ã€‚</p><h2 id="1-2-å…¨æ–‡æ£€ç´¢æŸ¥è¯¢"><a href="#1-2-å…¨æ–‡æ£€ç´¢æŸ¥è¯¢" class="headerlink" title="1.2.å…¨æ–‡æ£€ç´¢æŸ¥è¯¢"></a>1.2.å…¨æ–‡æ£€ç´¢æŸ¥è¯¢</h2><h3 id="1-2-1-ä½¿ç”¨åœºæ™¯"><a href="#1-2-1-ä½¿ç”¨åœºæ™¯" class="headerlink" title="1.2.1.ä½¿ç”¨åœºæ™¯"></a>1.2.1.ä½¿ç”¨åœºæ™¯</h3><p>å…¨æ–‡æ£€ç´¢æŸ¥è¯¢çš„åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å¯¹ç”¨æˆ·æœç´¢çš„å†…å®¹åšåˆ†è¯ï¼Œå¾—åˆ°è¯æ¡</li><li>æ ¹æ®è¯æ¡å»å€’æ’ç´¢å¼•åº“ä¸­åŒ¹é…ï¼Œå¾—åˆ°æ–‡æ¡£id</li><li>æ ¹æ®æ–‡æ¡£idæ‰¾åˆ°æ–‡æ¡£ï¼Œè¿”å›ç»™ç”¨æˆ·</li></ul><p>æ¯”è¾ƒå¸¸ç”¨çš„åœºæ™¯åŒ…æ‹¬ï¼š</p><ul><li>å•†åŸçš„è¾“å…¥æ¡†æœç´¢</li><li>ç™¾åº¦è¾“å…¥æ¡†æœç´¢</li></ul><p>ä¾‹å¦‚äº¬ä¸œï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721165326938.png" title="image-20210721165326938"><p>å› ä¸ºæ˜¯æ‹¿ç€è¯æ¡å»åŒ¹é…ï¼Œå› æ­¤å‚ä¸æœç´¢çš„å­—æ®µä¹Ÿå¿…é¡»æ˜¯å¯åˆ†è¯çš„textç±»å‹çš„å­—æ®µã€‚</p><h3 id="1-2-2-åŸºæœ¬è¯­æ³•"><a href="#1-2-2-åŸºæœ¬è¯­æ³•" class="headerlink" title="1.2.2.åŸºæœ¬è¯­æ³•"></a>1.2.2.åŸºæœ¬è¯­æ³•</h3><p>å¸¸è§çš„å…¨æ–‡æ£€ç´¢æŸ¥è¯¢åŒ…æ‹¬ï¼š</p><ul><li>matchæŸ¥è¯¢ï¼šå•å­—æ®µæŸ¥è¯¢</li><li>multi_matchæŸ¥è¯¢ï¼šå¤šå­—æ®µæŸ¥è¯¢ï¼Œä»»æ„ä¸€ä¸ªå­—æ®µç¬¦åˆæ¡ä»¶å°±ç®—ç¬¦åˆæŸ¥è¯¢æ¡ä»¶</li></ul><p>matchæŸ¥è¯¢è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span> <span class="string">&quot;TEXT&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>mulit_matchè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;multi_match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="string">&quot;TEXT&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;FIELD1&quot;</span><span class="punctuation">,</span> <span class="string">&quot; FIELD12&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="1-2-3-ç¤ºä¾‹"><a href="#1-2-3-ç¤ºä¾‹" class="headerlink" title="1.2.3.ç¤ºä¾‹"></a>1.2.3.ç¤ºä¾‹</h3><p>matchæŸ¥è¯¢ç¤ºä¾‹ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721170455419.png" title="image-20210721170455419"><p>multi_matchæŸ¥è¯¢ç¤ºä¾‹ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721170720691.png" title="image-20210721170720691"><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ç§æŸ¥è¯¢ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p><p>å› ä¸ºæˆ‘ä»¬å°†brandã€nameã€businesså€¼éƒ½åˆ©ç”¨copy_toå¤åˆ¶åˆ°äº†allå­—æ®µä¸­ã€‚å› æ­¤ä½ æ ¹æ®ä¸‰ä¸ªå­—æ®µæœç´¢ï¼Œå’Œæ ¹æ®allå­—æ®µæœç´¢æ•ˆæœå½“ç„¶ä¸€æ ·äº†ã€‚</p><p>ä½†æ˜¯ï¼Œæœç´¢å­—æ®µè¶Šå¤šï¼Œå¯¹æŸ¥è¯¢æ€§èƒ½å½±å“è¶Šå¤§ï¼Œå› æ­¤å»ºè®®é‡‡ç”¨copy_toï¼Œç„¶åå•å­—æ®µæŸ¥è¯¢çš„æ–¹å¼ã€‚</p><h3 id="1-2-4-match-phrase"><a href="#1-2-4-match-phrase" class="headerlink" title="1.2.4 match_phrase"></a>1.2.4 match_phrase</h3><blockquote><p>match_phrase:çŸ­è¯­åŒ¹é…</p><p>çŸ­è¯­åŒ¹é…ï¼ŒæŸ¥è¯¢æ¯”è¾ƒä¸¥æ ¼ï¼ŒæŸ¥è¯¢çš„ç²¾åº¦è¾ƒé«˜ã€‚ä¸€èˆ¬éœ€è¦è·Ÿ<strong>slop</strong>åç§»é‡é…åˆä½¿ç”¨ï¼Œå¢åŠ å¬å›æˆåŠŸç‡ã€‚</p><p>æ¯”å¦‚æœ‰æ–‡æ¡£4æ¡ï¼š1.<code>å…³æ³¨æˆ‘,ç³»ç»Ÿå­¦ç¼–ç¨‹</code>ï¼Œ2.<code>ç³»ç»Ÿå­¦ç¼–ç¨‹,å…³æ³¨æˆ‘</code>, 3.<code>ç³»ç»Ÿç¼–ç¨‹,å…³æ³¨æˆ‘</code> 4, <code>å…³æ³¨æˆ‘,é—´éš”ç³»ç»Ÿå­¦ç¼–ç¨‹</code></p><p>é‚£ä¹ˆæœç´¢<code>å…³æ³¨æˆ‘,ç³»ç»Ÿå­¦</code>å°±åªèƒ½æœåˆ°1ï¼Œè€Œmatchå¯ä»¥æŸ¥è¯¢åˆ°æ‰€æœ‰æ–‡æ¡£</p><p>å«ä¹‰ï¼šç›¸æ¯”matchï¼Œæ›´å¼ºè°ƒå¤šä¸ªåˆ†è¯<strong>é¡ºåºå’Œæ£€ç´¢è¯ä¸€è‡´ï¼Œä¸”è¿ç»­</strong>ï¼Œéƒ½è¦å®Œæ•´åŒ¹é…æ‰èƒ½æ£€ç´¢åˆ°ã€‚</p><p>åœºæ™¯ï¼šå®æˆ˜åº”ç”¨ä¸­ä¼šè¾ƒå¤šä½¿ç”¨ï¼Œç»“åˆslopè°ƒæ•´é¡ºåºå’Œç²¾åº¦</p></blockquote><h3 id="1-2-5-dis-max"><a href="#1-2-5-dis-max" class="headerlink" title="1.2.5 dis_max"></a>1.2.5 dis_max</h3><blockquote><p>æœ‰ä¸¤æ¡docæ•°æ®</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">POST</span> <span class="string">/book/_doc/1</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;body&quot;:</span> <span class="string">&quot;elasticsearch filter&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;title&quot;:</span> <span class="string">&quot;elasticsearch basic query&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">POST</span> <span class="string">/book/_doc/2</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;body&quot;:</span> <span class="string">&quot;single value search&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;title&quot;:</span> <span class="string">&quot;elasticsearch aggs query&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ä¸ä½¿ç”¨dis-maxæŸ¥è¯¢"><a href="#ä¸ä½¿ç”¨dis-maxæŸ¥è¯¢" class="headerlink" title="ä¸ä½¿ç”¨dis_maxæŸ¥è¯¢"></a>ä¸ä½¿ç”¨<code>dis_max</code>æŸ¥è¯¢</h4><p>å¾—åˆ°çš„ç»“æœæ˜¯: <strong>ç›¸å…³æ€§å¾—åˆ†ç¼ºå¤±æ–‡æ¡£1é«˜äºæ–‡æ¡£2</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /book/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;bool&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;should&quot;</span>: [</span><br><span class="line">        &#123;<span class="string">&quot;match&quot;</span>: &#123;<span class="string">&quot;body&quot;</span>: <span class="string">&quot;elasticsearch aggs&quot;</span>&#125;&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;match&quot;</span>: &#123;<span class="string">&quot;title&quot;</span>: <span class="string">&quot;elasticsearch aggs&quot;</span>&#125;&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸å…³æ€§å¾—åˆ†è®¡ç®—è¿‡ç¨‹æ˜¯ï¼š</p><ol><li>ä½¿ç”¨matchæŸ¥è¯¢&quot;elasticsearch aggs&quot;æ—¶ï¼Œé¦–å…ˆä¼šè¢«æ‹†åˆ†ä¸ºelasticsearchå’Œaggsä¸¤ä¸ªåˆ†è¯ï¼›</li><li>ç„¶åä½¿ç”¨shouldé‡Œé¢çš„æ¯ä¸ªå­å¥å»æŸ¥è¯¢åŒä¸€ä¸ªæ–‡æ¡£ï¼š</li><li>æ–‡æ¡£1çš„bodyå’Œtitleéƒ½å‘½ä¸­elasticsearchï¼Œæ»¡è¶³shouldä¸­çš„ä¸¤ä¸ªå­å¥ï¼Œæ–‡æ¡£å¾—2åˆ†ï¼›</li><li>æ–‡æ¡£2çš„titleå‘½ä¸­elasticsearchå’Œaggsï¼Œä½†æ˜¯åªæ»¡è¶³äº†shouldä¸­å…³äºtitleçš„å­å¥ï¼Œæ–‡æ¡£å¾—1åˆ†ï¼Œ</li><li>æ‰€ä»¥æœ€åæ–‡æ¡£1çš„å¾—åˆ†é«˜äºæ–‡æ¡£2ï¼Œå°½ç®¡æ–‡æ¡£2çš„åŒ¹é…åº¦æ›´é«˜ã€‚</li></ol><h4 id="ä½¿ç”¨dis-maxæŸ¥è¯¢"><a href="#ä½¿ç”¨dis-maxæŸ¥è¯¢" class="headerlink" title="ä½¿ç”¨dis_maxæŸ¥è¯¢"></a>ä½¿ç”¨dis_maxæŸ¥è¯¢</h4><blockquote><p>è¯ é‡Š: <strong>ä»¥æœ€ä½³åŒ¹é…çš„å­å¥çš„å¾—åˆ†ä½œä¸ºæ•´ä¸ªæ–‡æ¡£çš„ç›¸å…³æ€§å¾—åˆ†ã€‚</strong></p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">POST</span> <span class="string">/book/_search</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;dis_max&quot;:</span> &#123;</span><br><span class="line">      <span class="attr">&quot;tie_breaker&quot;:</span> <span class="number">0.3</span>,</span><br><span class="line">      <span class="attr">&quot;queries&quot;:</span> [</span><br><span class="line">        &#123;<span class="attr">&quot;match&quot;:</span> &#123;<span class="attr">&quot;body&quot;:</span> <span class="string">&quot;elasticsearch aggs&quot;</span>&#125;&#125;,</span><br><span class="line">        &#123;<span class="attr">&quot;match&quot;:</span> &#123;<span class="attr">&quot;title&quot;:</span> <span class="string">&quot;elasticsearch aggs&quot;</span>&#125;&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼Œdis_maxæŸ¥è¯¢è¿‡ç¨‹ä¸­æ–‡æ¡£1å’Œæ–‡æ¡£2çš„å¾—åˆ†è®¡ç®—è¿‡ç¨‹ä¸ºï¼š</p><ol><li>ä½¿ç”¨matchæŸ¥è¯¢&quot;elasticsearch aggs&quot;æ—¶ï¼Œé¦–å…ˆä¼šè¢«æ‹†åˆ†ä¸ºelasticsearchå’Œaggsä¸¤ä¸ªåˆ†è¯ï¼›</li><li>ç„¶åä½¿ç”¨shouldé‡Œé¢çš„æ¯ä¸ªå­å¥å»æŸ¥è¯¢åŒä¸€ä¸ªæ–‡æ¡£ï¼š</li><li>æ–‡æ¡£1çš„bodyå’Œtitleéƒ½å‘½ä¸­elasticsearchï¼Œbodyå­å¥å¾—1åˆ†ï¼Œtitleå­å¥ä¹Ÿæ˜¯1åˆ†ï¼Œæœ€åå–ä¸¤ä¸ªå­å¥ä¸­çš„æœ€é«˜åˆ†ä½œä¸ºæ–‡æ¡£1çš„æœ€åå¾—åˆ†ï¼Œå³æœ€åæ–‡æ¡£1çš„ç›¸å…³æ€§å¾—åˆ†ä¸º1åˆ†ï¼›</li><li>æ–‡æ¡£2çš„titleå‘½ä¸­elasticsearchå’Œaggsï¼Œbodyæ²¡æœ‰å‘½ä¸­ä»»ä½•åˆ†è¯ï¼Œæ‰€ä»¥titleå­å¥å¾—åˆ†ä¸º2åˆ†ï¼Œbodyå­å¥å¾—åˆ†ä¸º0åˆ†ï¼Œæœ€åå»bodyå’Œtitleå­å¥çš„æœ€é«˜åˆ†ä½œä¸ºæ–‡æ¡£2çš„æœ€åçš„å¾—åˆ†ï¼Œå³æ–‡æ¡£2å¾—2åˆ†ï¼›</li><li>æ‰€ä»¥æœ€åæ–‡æ¡£2çš„å¾—åˆ†é«˜äºæ–‡æ¡£1ï¼Œç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ã€‚</li></ol><h4 id="å…³äºtie-breaker"><a href="#å…³äºtie-breaker" class="headerlink" title="å…³äºtie_breaker"></a>å…³äºtie_breaker</h4><blockquote><p>ä¸‹é¢ä»å®è§‚ä¸Šæ¥è®²çš„ç®€å•å…¬å¼ï¼š</p><p>score&#x3D;best_field.score Ã— boost + other_fields Ã— boost.score Ã— tie_breaker</p><p>å®é™…è®¡ç®—è¿œæ¯”è¿™ä¸ªå…¬å¼å¤æ‚å¾—å¤šï¼Œè¿˜è¦è€ƒè™‘åˆ†ç‰‡å› ç´ ã€å‡ºç°ä½ç½®ã€æ–‡æ¡£é•¿çŸ­ç­‰ã€‚</p><p>è¯„åˆ†ç®—æ³•è¯·å‚è€ƒï¼š<a target="_blank" rel="noopener external nofollow noreferrer" href="http://m.blog.csdn.net/article/details?id=50623948%E3%80%82">http://m.blog.csdn.net/article/details?id=50623948ã€‚</a></p><p>å­—æ®µä»‹ç»å‚è€ƒ: <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cnblogs.com/lovezhr/p/15094388.html">https://www.cnblogs.com/lovezhr/p/15094388.html</a></p><p><strong>tie_breaker</strong>çš„å‚æ•°å€¼è¦åŒæ—¶è€ƒè™‘åˆ°æœ€ä½³matchå’Œæ‰€æœ‰matchï¼Œæ¨è0.1---0.4ï¼Œå¦‚æœæ˜¯0çš„è¯ï¼Œå°±åªè€ƒè™‘æœ€ä½³matchäº†</p></blockquote><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>matchå’Œmulti_matchçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>matchï¼šæ ¹æ®ä¸€ä¸ªå­—æ®µæŸ¥è¯¢</li><li>multi_matchï¼šæ ¹æ®å¤šä¸ªå­—æ®µæŸ¥è¯¢ï¼Œå‚ä¸æŸ¥è¯¢å­—æ®µè¶Šå¤šï¼ŒæŸ¥è¯¢æ€§èƒ½è¶Šå·®</li></ul><h2 id="1-3-ç²¾å‡†æŸ¥è¯¢"><a href="#1-3-ç²¾å‡†æŸ¥è¯¢" class="headerlink" title="1.3.ç²¾å‡†æŸ¥è¯¢"></a>1.3.ç²¾å‡†æŸ¥è¯¢</h2><p>ç²¾ç¡®æŸ¥è¯¢ä¸€èˆ¬æ˜¯æŸ¥æ‰¾keywordã€æ•°å€¼ã€æ—¥æœŸã€booleanç­‰ç±»å‹å­—æ®µã€‚æ‰€ä»¥<strong>ä¸ä¼š</strong>å¯¹æœç´¢æ¡ä»¶åˆ†è¯ã€‚å¸¸è§çš„æœ‰ï¼š</p><ul><li>termï¼šæ ¹æ®è¯æ¡ç²¾ç¡®å€¼æŸ¥è¯¢</li><li>rangeï¼šæ ¹æ®å€¼çš„èŒƒå›´æŸ¥è¯¢</li></ul><h3 id="1-3-1-termæŸ¥è¯¢"><a href="#1-3-1-termæŸ¥è¯¢" class="headerlink" title="1.3.1.termæŸ¥è¯¢"></a>1.3.1.termæŸ¥è¯¢</h3><p>å› ä¸ºç²¾ç¡®æŸ¥è¯¢çš„å­—æ®µæœæ˜¯ä¸åˆ†è¯çš„å­—æ®µï¼Œå› æ­¤æŸ¥è¯¢çš„æ¡ä»¶ä¹Ÿå¿…é¡»æ˜¯<strong>ä¸åˆ†è¯</strong>çš„è¯æ¡ã€‚æŸ¥è¯¢æ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„å†…å®¹è·Ÿè‡ªåŠ¨å€¼å®Œå…¨åŒ¹é…æ—¶æ‰è®¤ä¸ºç¬¦åˆæ¡ä»¶ã€‚å¦‚æœç”¨æˆ·è¾“å…¥çš„å†…å®¹è¿‡å¤šï¼Œåè€Œæœç´¢ä¸åˆ°æ•°æ®ã€‚</p><p>è¯­æ³•è¯´æ˜ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// termæŸ¥è¯¢</span></span><br><span class="line">GET /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;VALUE&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><p>å½“æˆ‘æœç´¢çš„æ˜¯ç²¾ç¡®è¯æ¡æ—¶ï¼Œèƒ½æ­£ç¡®æŸ¥è¯¢å‡ºç»“æœï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721171655308.png" title="image-20210721171655308"><p>ä½†æ˜¯ï¼Œå½“æˆ‘æœç´¢çš„å†…å®¹ä¸æ˜¯è¯æ¡ï¼Œè€Œæ˜¯å¤šä¸ªè¯è¯­å½¢æˆçš„çŸ­è¯­æ—¶ï¼Œåè€Œæœç´¢ä¸åˆ°ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721171838378.png" title="image-20210721171838378"><h3 id="1-3-2-rangeæŸ¥è¯¢"><a href="#1-3-2-rangeæŸ¥è¯¢" class="headerlink" title="1.3.2.rangeæŸ¥è¯¢"></a>1.3.2.rangeæŸ¥è¯¢</h3><p>èŒƒå›´æŸ¥è¯¢ï¼Œä¸€èˆ¬åº”ç”¨åœ¨å¯¹æ•°å€¼ç±»å‹åšèŒƒå›´è¿‡æ»¤çš„æ—¶å€™ã€‚æ¯”å¦‚åšä»·æ ¼èŒƒå›´è¿‡æ»¤ã€‚</p><p>åŸºæœ¬è¯­æ³•ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// rangeæŸ¥è¯¢</span></span><br><span class="line">GET /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span> <span class="comment">// è¿™é‡Œçš„gteä»£è¡¨å¤§äºç­‰äºï¼Œgtåˆ™ä»£è¡¨å¤§äº</span></span><br><span class="line">        <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="number">20</span> <span class="comment">// lteä»£è¡¨å°äºç­‰äºï¼Œltåˆ™ä»£è¡¨å°äº</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721172307172.png" title="image-20210721172307172"><h3 id="1-3-3-æ€»ç»“"><a href="#1-3-3-æ€»ç»“" class="headerlink" title="1.3.3.æ€»ç»“"></a>1.3.3.æ€»ç»“</h3><p>ç²¾ç¡®æŸ¥è¯¢å¸¸è§çš„æœ‰å“ªäº›ï¼Ÿ</p><ul><li>termæŸ¥è¯¢ï¼šæ ¹æ®è¯æ¡ç²¾ç¡®åŒ¹é…ï¼Œä¸€èˆ¬æœç´¢keywordç±»å‹ã€æ•°å€¼ç±»å‹ã€å¸ƒå°”ç±»å‹ã€æ—¥æœŸç±»å‹å­—æ®µ</li><li>rangeæŸ¥è¯¢ï¼šæ ¹æ®æ•°å€¼èŒƒå›´æŸ¥è¯¢ï¼Œå¯ä»¥æ˜¯æ•°å€¼ã€æ—¥æœŸçš„èŒƒå›´</li></ul><h2 id="1-4-åœ°ç†åæ ‡æŸ¥è¯¢"><a href="#1-4-åœ°ç†åæ ‡æŸ¥è¯¢" class="headerlink" title="1.4.åœ°ç†åæ ‡æŸ¥è¯¢"></a>1.4.åœ°ç†åæ ‡æŸ¥è¯¢</h2><p>æ‰€è°“çš„åœ°ç†åæ ‡æŸ¥è¯¢ï¼Œå…¶å®å°±æ˜¯æ ¹æ®ç»çº¬åº¦æŸ¥è¯¢ï¼Œå®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/geo-queries.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/geo-queries.html</a></p><p>å¸¸è§çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ï¼š</p><ul><li>æºç¨‹ï¼šæœç´¢æˆ‘é™„è¿‘çš„é…’åº—</li><li>æ»´æ»´ï¼šæœç´¢æˆ‘é™„è¿‘çš„å‡ºç§Ÿè½¦</li><li>å¾®ä¿¡ï¼šæœç´¢æˆ‘é™„è¿‘çš„äºº</li></ul><p>é™„è¿‘çš„é…’åº—ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721172645103.png" title="image-20210721172645103"><p>é™„è¿‘çš„è½¦ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721172654880.png" title="image-20210721172654880"><h3 id="1-4-1-çŸ©å½¢èŒƒå›´æŸ¥è¯¢"><a href="#1-4-1-çŸ©å½¢èŒƒå›´æŸ¥è¯¢" class="headerlink" title="1.4.1.çŸ©å½¢èŒƒå›´æŸ¥è¯¢"></a>1.4.1.çŸ©å½¢èŒƒå›´æŸ¥è¯¢</h3><p>çŸ©å½¢èŒƒå›´æŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯geo_bounding_boxæŸ¥è¯¢ï¼ŒæŸ¥è¯¢åæ ‡è½åœ¨æŸä¸ªçŸ©å½¢èŒƒå›´çš„æ‰€æœ‰æ–‡æ¡£ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/DKV9HZbVS6.gif" title="DKV9HZbVS6"><p>æŸ¥è¯¢æ—¶ï¼Œéœ€è¦æŒ‡å®šçŸ©å½¢çš„<strong>å·¦ä¸Š</strong>ã€<strong>å³ä¸‹</strong>ä¸¤ä¸ªç‚¹çš„åæ ‡ï¼Œç„¶åç”»å‡ºä¸€ä¸ªçŸ©å½¢ï¼Œè½åœ¨è¯¥çŸ©å½¢å†…çš„éƒ½æ˜¯ç¬¦åˆæ¡ä»¶çš„ç‚¹ã€‚</p><p>è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// geo_bounding_boxæŸ¥è¯¢</span></span><br><span class="line">GET /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;geo_bounding_box&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              # å·¦ä¸Šç‚¹</span><br><span class="line">              <span class="attr">&quot;top_left&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;lat&quot;</span><span class="punctuation">:</span> <span class="number">31.1</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;lon&quot;</span><span class="punctuation">:</span> <span class="number">121.5</span></span><br><span class="line">              <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">              # å³ä¸‹ç‚¹</span><br><span class="line">              <span class="attr">&quot;bottom_right&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;lat&quot;</span><span class="punctuation">:</span> <span class="number">30.9</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;lon&quot;</span><span class="punctuation">:</span> <span class="number">121.7</span></span><br><span class="line">              <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™ç§å¹¶ä¸ç¬¦åˆâ€œé™„è¿‘çš„äººâ€è¿™æ ·çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸åšäº†ã€‚</p><h3 id="1-4-2-é™„è¿‘æŸ¥è¯¢"><a href="#1-4-2-é™„è¿‘æŸ¥è¯¢" class="headerlink" title="1.4.2.é™„è¿‘æŸ¥è¯¢"></a>1.4.2.é™„è¿‘æŸ¥è¯¢</h3><p>é™„è¿‘æŸ¥è¯¢ï¼Œä¹Ÿå«åšè·ç¦»æŸ¥è¯¢ï¼ˆgeo_distanceï¼‰ï¼šæŸ¥è¯¢åˆ°æŒ‡å®šä¸­å¿ƒç‚¹å°äºæŸä¸ªè·ç¦»å€¼çš„æ‰€æœ‰æ–‡æ¡£ã€‚</p><p>æ¢å¥è¯æ¥è¯´ï¼Œåœ¨åœ°å›¾ä¸Šæ‰¾ä¸€ä¸ªç‚¹ä½œä¸ºåœ†å¿ƒï¼Œä»¥æŒ‡å®šè·ç¦»ä¸ºåŠå¾„ï¼Œç”»ä¸€ä¸ªåœ†ï¼Œè½åœ¨åœ†å†…çš„åæ ‡éƒ½ç®—ç¬¦åˆæ¡ä»¶ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/vZrdKAh19C.gif" title="vZrdKAh19C"><p>è¯­æ³•è¯´æ˜ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// geo_distance æŸ¥è¯¢</span></span><br><span class="line">GET /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;geo_distance&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;distance&quot;</span><span class="punctuation">:</span> <span class="string">&quot;15km&quot;</span><span class="punctuation">,</span> <span class="comment">// åŠå¾„</span></span><br><span class="line">      <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span> <span class="string">&quot;31.21,121.5&quot;</span> <span class="comment">// åœ†å¿ƒ</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><p>æˆ‘ä»¬å…ˆæœç´¢é™†å®¶å˜´é™„è¿‘15kmçš„é…’åº—ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721175443234.png" title="image-20210721175443234"><p>å‘ç°å…±æœ‰47å®¶é…’åº—ã€‚</p><p>ç„¶åæŠŠåŠå¾„ç¼©çŸ­åˆ°3å…¬é‡Œï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721182031475.png" title="image-20210721182031475"><p>å¯ä»¥å‘ç°ï¼Œæœç´¢åˆ°çš„é…’åº—æ•°é‡å‡å°‘åˆ°äº†5å®¶ã€‚</p><h2 id="1-5-å¤åˆæŸ¥è¯¢"><a href="#1-5-å¤åˆæŸ¥è¯¢" class="headerlink" title="1.5.å¤åˆæŸ¥è¯¢"></a>1.5.å¤åˆæŸ¥è¯¢</h2><p>å¤åˆï¼ˆcompoundï¼‰æŸ¥è¯¢ï¼šå¤åˆæŸ¥è¯¢å¯ä»¥å°†å…¶å®ƒç®€å•æŸ¥è¯¢ç»„åˆèµ·æ¥ï¼Œå®ç°æ›´å¤æ‚çš„æœç´¢é€»è¾‘ã€‚å¸¸è§çš„æœ‰ä¸¤ç§ï¼š</p><ul><li>fuction scoreï¼šç®—åˆ†å‡½æ•°æŸ¥è¯¢ï¼Œå¯ä»¥æ§åˆ¶æ–‡æ¡£ç›¸å…³æ€§ç®—åˆ†ï¼Œæ§åˆ¶æ–‡æ¡£æ’å</li><li>bool queryï¼šå¸ƒå°”æŸ¥è¯¢ï¼Œåˆ©ç”¨é€»è¾‘å…³ç³»ç»„åˆå¤šä¸ªå…¶å®ƒçš„æŸ¥è¯¢ï¼Œå®ç°å¤æ‚æœç´¢</li></ul><h3 id="1-5-1-ç›¸å…³æ€§ç®—åˆ†"><a href="#1-5-1-ç›¸å…³æ€§ç®—åˆ†" class="headerlink" title="1.5.1.ç›¸å…³æ€§ç®—åˆ†"></a>1.5.1.ç›¸å…³æ€§ç®—åˆ†</h3><p>å½“æˆ‘ä»¬åˆ©ç”¨matchæŸ¥è¯¢æ—¶ï¼Œæ–‡æ¡£ç»“æœä¼šæ ¹æ®ä¸æœç´¢è¯æ¡çš„å…³è”åº¦æ‰“åˆ†ï¼ˆ_scoreï¼‰ï¼Œè¿”å›ç»“æœæ—¶æŒ‰ç…§åˆ†å€¼é™åºæ’åˆ—ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœç´¢ &quot;è™¹æ¡¥å¦‚å®¶&quot;ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;_score&quot;</span> <span class="punctuation">:</span> <span class="number">17.850193</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;è™¹æ¡¥å¦‚å®¶é…’åº—çœŸä¸é”™&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;_score&quot;</span> <span class="punctuation">:</span> <span class="number">12.259849</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;å¤–æ»©å¦‚å®¶é…’åº—çœŸä¸é”™&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;_score&quot;</span> <span class="punctuation">:</span> <span class="number">11.91091</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;è¿ªå£«å°¼å¦‚å®¶é…’åº—çœŸä¸é”™&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>åœ¨elasticsearchä¸­ï¼Œæ—©æœŸä½¿ç”¨çš„æ‰“åˆ†ç®—æ³•æ˜¯TF-IDFç®—æ³•ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721190152134.png" title="image-20210721190152134"><p>åœ¨åæ¥çš„5.1ç‰ˆæœ¬å‡çº§ä¸­ï¼Œelasticsearchå°†ç®—æ³•æ”¹è¿›ä¸ºBM25ç®—æ³•ï¼Œå…¬å¼å¦‚ä¸‹ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721190416214.png" title="image-20210721190416214"><p>TF-IDFç®—æ³•æœ‰ä¸€ä¸ªç¼ºé™·ï¼Œå°±æ˜¯è¯æ¡é¢‘ç‡è¶Šé«˜ï¼Œæ–‡æ¡£å¾—åˆ†ä¹Ÿä¼šè¶Šé«˜ï¼Œå•ä¸ªè¯æ¡å¯¹æ–‡æ¡£å½±å“è¾ƒå¤§ã€‚è€ŒBM25åˆ™ä¼šè®©å•ä¸ªè¯æ¡çš„ç®—åˆ†æœ‰ä¸€ä¸ªä¸Šé™ï¼Œæ›²çº¿æ›´åŠ å¹³æ»‘ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721190907320.png" title="image-20210721190907320"><p>å°ç»“ï¼šelasticsearchä¼šæ ¹æ®è¯æ¡å’Œæ–‡æ¡£çš„ç›¸å…³åº¦åšæ‰“åˆ†ï¼Œç®—æ³•ç”±ä¸¤ç§ï¼š</p><ul><li>TF-IDFç®—æ³•</li><li>BM25ç®—æ³•ï¼Œelasticsearch5.1ç‰ˆæœ¬åé‡‡ç”¨çš„ç®—æ³•</li></ul><h3 id="1-5-2-ç®—åˆ†å‡½æ•°æŸ¥è¯¢"><a href="#1-5-2-ç®—åˆ†å‡½æ•°æŸ¥è¯¢" class="headerlink" title="1.5.2.ç®—åˆ†å‡½æ•°æŸ¥è¯¢"></a>1.5.2.ç®—åˆ†å‡½æ•°æŸ¥è¯¢</h3><p>æ ¹æ®ç›¸å…³åº¦æ‰“åˆ†æ˜¯æ¯”è¾ƒåˆç†çš„éœ€æ±‚ï¼Œä½†<strong>åˆç†çš„ä¸ä¸€å®šæ˜¯äº§å“ç»ç†éœ€è¦</strong>çš„ã€‚</p><p>ä»¥ç™¾åº¦ä¸ºä¾‹ï¼Œä½ æœç´¢çš„ç»“æœä¸­ï¼Œå¹¶ä¸æ˜¯ç›¸å…³åº¦è¶Šé«˜æ’åè¶Šé å‰ï¼Œè€Œæ˜¯è°æçš„é’±å¤šæ’åå°±è¶Šé å‰ã€‚å¦‚å›¾ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721191144560.png" title="image-20210721191144560"><p>è¦æƒ³ä¸ºæ§åˆ¶ç›¸å…³æ€§ç®—åˆ†ï¼Œå°±éœ€è¦åˆ©ç”¨elasticsearchä¸­çš„function score æŸ¥è¯¢äº†ã€‚</p><h4 id="1ï¼‰è¯­æ³•è¯´æ˜"><a href="#1ï¼‰è¯­æ³•è¯´æ˜" class="headerlink" title="1ï¼‰è¯­æ³•è¯´æ˜"></a>1ï¼‰è¯­æ³•è¯´æ˜</h4><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721191544750.png" title="image-20210721191544750"><p>function score æŸ¥è¯¢ä¸­åŒ…å«å››éƒ¨åˆ†å†…å®¹ï¼š</p><ul><li><strong>åŸå§‹æŸ¥è¯¢</strong>æ¡ä»¶ï¼šqueryéƒ¨åˆ†ï¼ŒåŸºäºè¿™ä¸ªæ¡ä»¶æœç´¢æ–‡æ¡£ï¼Œå¹¶ä¸”åŸºäºBM25ç®—æ³•ç»™æ–‡æ¡£æ‰“åˆ†ï¼Œ<strong>åŸå§‹ç®—åˆ†</strong>ï¼ˆquery score)</li><li><strong>è¿‡æ»¤æ¡ä»¶</strong>ï¼šfilteréƒ¨åˆ†ï¼Œç¬¦åˆè¯¥æ¡ä»¶çš„æ–‡æ¡£æ‰ä¼šé‡æ–°ç®—åˆ†</li><li><strong>ç®—åˆ†å‡½æ•°</strong>ï¼šç¬¦åˆfilteræ¡ä»¶çš„æ–‡æ¡£è¦æ ¹æ®è¿™ä¸ªå‡½æ•°åšè¿ç®—ï¼Œå¾—åˆ°çš„<strong>å‡½æ•°ç®—åˆ†</strong>ï¼ˆfunction scoreï¼‰ï¼Œæœ‰å››ç§å‡½æ•°<ul><li>weightï¼šå‡½æ•°ç»“æœæ˜¯å¸¸é‡</li><li>field_value_factorï¼šä»¥æ–‡æ¡£ä¸­çš„æŸä¸ªå­—æ®µå€¼ä½œä¸ºå‡½æ•°ç»“æœ</li><li>random_scoreï¼šä»¥éšæœºæ•°ä½œä¸ºå‡½æ•°ç»“æœ</li><li>script_scoreï¼šè‡ªå®šä¹‰ç®—åˆ†å‡½æ•°ç®—æ³•</li></ul></li><li><strong>è¿ç®—æ¨¡å¼</strong>ï¼šç®—åˆ†å‡½æ•°çš„ç»“æœã€åŸå§‹æŸ¥è¯¢çš„ç›¸å…³æ€§ç®—åˆ†ï¼Œä¸¤è€…ä¹‹é—´çš„è¿ç®—æ–¹å¼ï¼ŒåŒ…æ‹¬ï¼š<ul><li>multiplyï¼šç›¸ä¹˜</li><li>replaceï¼šç”¨function scoreæ›¿æ¢query score</li><li>å…¶å®ƒï¼Œä¾‹å¦‚ï¼šsumã€avgã€maxã€min</li></ul></li></ul><p>function scoreçš„è¿è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>1ï¼‰æ ¹æ®<strong>åŸå§‹æ¡ä»¶</strong>æŸ¥è¯¢æœç´¢æ–‡æ¡£ï¼Œå¹¶ä¸”è®¡ç®—ç›¸å…³æ€§ç®—åˆ†ï¼Œç§°ä¸º<strong>åŸå§‹ç®—åˆ†</strong>ï¼ˆquery scoreï¼‰</li><li>2ï¼‰æ ¹æ®<strong>è¿‡æ»¤æ¡ä»¶</strong>ï¼Œè¿‡æ»¤æ–‡æ¡£</li><li>3ï¼‰ç¬¦åˆ<strong>è¿‡æ»¤æ¡ä»¶</strong>çš„æ–‡æ¡£ï¼ŒåŸºäº<strong>ç®—åˆ†å‡½æ•°</strong>è¿ç®—ï¼Œå¾—åˆ°<strong>å‡½æ•°ç®—åˆ†</strong>ï¼ˆfunction scoreï¼‰</li><li>4ï¼‰å°†<strong>åŸå§‹ç®—åˆ†</strong>ï¼ˆquery scoreï¼‰å’Œ<strong>å‡½æ•°ç®—åˆ†</strong>ï¼ˆfunction scoreï¼‰åŸºäº<strong>è¿ç®—æ¨¡å¼</strong>åšè¿ç®—ï¼Œå¾—åˆ°æœ€ç»ˆç»“æœï¼Œä½œä¸ºç›¸å…³æ€§ç®—åˆ†ã€‚</li></ul><p>å› æ­¤ï¼Œå…¶ä¸­çš„å…³é”®ç‚¹æ˜¯ï¼š</p><ul><li>è¿‡æ»¤æ¡ä»¶ï¼šå†³å®šå“ªäº›æ–‡æ¡£çš„ç®—åˆ†è¢«ä¿®æ”¹</li><li>ç®—åˆ†å‡½æ•°ï¼šå†³å®šå‡½æ•°ç®—åˆ†çš„ç®—æ³•</li><li>è¿ç®—æ¨¡å¼ï¼šå†³å®šæœ€ç»ˆç®—åˆ†ç»“æœ</li></ul><h4 id="2ï¼‰ç¤ºä¾‹"><a href="#2ï¼‰ç¤ºä¾‹" class="headerlink" title="2ï¼‰ç¤ºä¾‹"></a>2ï¼‰ç¤ºä¾‹</h4><p>éœ€æ±‚ï¼šç»™â€œå¦‚å®¶â€è¿™ä¸ªå“ç‰Œçš„é…’åº—æ’åé å‰ä¸€äº›</p><p>ç¿»è¯‘ä¸€ä¸‹è¿™ä¸ªéœ€æ±‚ï¼Œè½¬æ¢ä¸ºä¹‹å‰è¯´çš„å››ä¸ªè¦ç‚¹ï¼š</p><ul><li>åŸå§‹æ¡ä»¶ï¼šä¸ç¡®å®šï¼Œå¯ä»¥ä»»æ„å˜åŒ–</li><li>è¿‡æ»¤æ¡ä»¶ï¼šbrand &#x3D; &quot;å¦‚å®¶&quot;</li><li>ç®—åˆ†å‡½æ•°ï¼šå¯ä»¥ç®€å•ç²—æš´ï¼Œç›´æ¥ç»™å›ºå®šçš„ç®—åˆ†ç»“æœï¼Œweight</li><li>è¿ç®—æ¨¡å¼ï¼šæ¯”å¦‚æ±‚å’Œ</li></ul><p>å› æ­¤æœ€ç»ˆçš„DSLè¯­å¥å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;function_score&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>  .... <span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="comment">// åŸå§‹æŸ¥è¯¢ï¼Œå¯ä»¥æ˜¯ä»»æ„æ¡ä»¶</span></span><br><span class="line">      <span class="attr">&quot;functions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="comment">// ç®—åˆ†å‡½æ•°</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">// æ»¡è¶³çš„æ¡ä»¶ï¼Œå“ç‰Œå¿…é¡»æ˜¯å¦‚å®¶</span></span><br><span class="line">            <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="string">&quot;å¦‚å®¶&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;weight&quot;</span><span class="punctuation">:</span> <span class="number">2</span> <span class="comment">// ç®—åˆ†æƒé‡ä¸º2</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;boost_mode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sum&quot;</span> <span class="comment">// åŠ æƒæ¨¡å¼ï¼Œæ±‚å’Œ</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼Œåœ¨æœªæ·»åŠ ç®—åˆ†å‡½æ•°æ—¶ï¼Œå¦‚å®¶å¾—åˆ†å¦‚ä¸‹ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721193152520.png" title="image-20210721193152520"><p>æ·»åŠ äº†ç®—åˆ†å‡½æ•°åï¼Œå¦‚å®¶å¾—åˆ†å°±æå‡äº†ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721193458182.png" title="image-20210721193458182"><h4 id="3ï¼‰å°ç»“"><a href="#3ï¼‰å°ç»“" class="headerlink" title="3ï¼‰å°ç»“"></a>3ï¼‰å°ç»“</h4><p>function score queryå®šä¹‰çš„ä¸‰è¦ç´ æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>è¿‡æ»¤æ¡ä»¶ï¼šå“ªäº›æ–‡æ¡£è¦åŠ åˆ†</li><li>ç®—åˆ†å‡½æ•°ï¼šå¦‚ä½•è®¡ç®—function score</li><li>åŠ æƒæ–¹å¼ï¼šfunction score ä¸ query scoreå¦‚ä½•è¿ç®—</li></ul><h3 id="1-5-3-å¸ƒå°”æŸ¥è¯¢"><a href="#1-5-3-å¸ƒå°”æŸ¥è¯¢" class="headerlink" title="1.5.3.å¸ƒå°”æŸ¥è¯¢"></a>1.5.3.å¸ƒå°”æŸ¥è¯¢</h3><p>å¸ƒå°”æŸ¥è¯¢æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæŸ¥è¯¢å­å¥çš„ç»„åˆï¼Œæ¯ä¸€ä¸ªå­å¥å°±æ˜¯ä¸€ä¸ª<strong>å­æŸ¥è¯¢</strong>ã€‚å­æŸ¥è¯¢çš„ç»„åˆæ–¹å¼æœ‰ï¼š</p><ul><li>mustï¼šå¿…é¡»åŒ¹é…æ¯ä¸ªå­æŸ¥è¯¢ï¼Œç±»ä¼¼â€œä¸â€</li><li>shouldï¼šé€‰æ‹©æ€§åŒ¹é…å­æŸ¥è¯¢ï¼Œç±»ä¼¼â€œæˆ–â€</li><li>must_notï¼šå¿…é¡»ä¸åŒ¹é…ï¼Œ<strong>ä¸å‚ä¸ç®—åˆ†</strong>ï¼Œç±»ä¼¼â€œéâ€</li><li>filterï¼šå¿…é¡»åŒ¹é…ï¼Œ<strong>ä¸å‚ä¸ç®—åˆ†</strong></li></ul><p>æ¯”å¦‚åœ¨æœç´¢é…’åº—æ—¶ï¼Œé™¤äº†å…³é”®å­—æœç´¢å¤–ï¼Œæˆ‘ä»¬è¿˜å¯èƒ½æ ¹æ®å“ç‰Œã€ä»·æ ¼ã€åŸå¸‚ç­‰å­—æ®µåšè¿‡æ»¤ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721193822848.png" title="image-20210721193822848"><p>æ¯ä¸€ä¸ªä¸åŒçš„å­—æ®µï¼Œå…¶æŸ¥è¯¢çš„æ¡ä»¶ã€æ–¹å¼éƒ½ä¸ä¸€æ ·ï¼Œå¿…é¡»æ˜¯å¤šä¸ªä¸åŒçš„æŸ¥è¯¢ï¼Œè€Œè¦ç»„åˆè¿™äº›æŸ¥è¯¢ï¼Œå°±å¿…é¡»ç”¨boolæŸ¥è¯¢äº†ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœç´¢æ—¶ï¼Œå‚ä¸<strong>æ‰“åˆ†çš„å­—æ®µè¶Šå¤šï¼ŒæŸ¥è¯¢çš„æ€§èƒ½ä¹Ÿè¶Šå·®</strong>ã€‚å› æ­¤è¿™ç§å¤šæ¡ä»¶æŸ¥è¯¢æ—¶ï¼Œå»ºè®®è¿™æ ·åšï¼š</p><ul><li>æœç´¢æ¡†çš„å…³é”®å­—æœç´¢ï¼Œæ˜¯å…¨æ–‡æ£€ç´¢æŸ¥è¯¢ï¼Œä½¿ç”¨mustæŸ¥è¯¢ï¼Œå‚ä¸ç®—åˆ†</li><li>å…¶å®ƒè¿‡æ»¤æ¡ä»¶ï¼Œé‡‡ç”¨filteræŸ¥è¯¢ã€‚ä¸å‚ä¸ç®—åˆ†</li></ul><h4 id="1ï¼‰è¯­æ³•ç¤ºä¾‹ï¼š"><a href="#1ï¼‰è¯­æ³•ç¤ºä¾‹ï¼š" class="headerlink" title="1ï¼‰è¯­æ³•ç¤ºä¾‹ï¼š"></a>1ï¼‰è¯­æ³•ç¤ºä¾‹ï¼š</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;city&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä¸Šæµ·&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;should&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="string">&quot;çš‡å† å‡æ—¥&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;brand&quot;</span><span class="punctuation">:</span> <span class="string">&quot;åç¾è¾¾&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;must_not&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;lte&quot;</span><span class="punctuation">:</span> <span class="number">500</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;filter&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span> <span class="attr">&quot;range&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;score&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="attr">&quot;gte&quot;</span><span class="punctuation">:</span> <span class="number">45</span> <span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="2ï¼‰ç¤ºä¾‹-1"><a href="#2ï¼‰ç¤ºä¾‹-1" class="headerlink" title="2ï¼‰ç¤ºä¾‹"></a>2ï¼‰ç¤ºä¾‹</h4><p>éœ€æ±‚ï¼šæœç´¢åå­—åŒ…å«â€œå¦‚å®¶â€ï¼Œä»·æ ¼ä¸é«˜äº400ï¼Œåœ¨åæ ‡31.21,121.5å‘¨å›´10kmèŒƒå›´å†…çš„é…’åº—ã€‚</p><p>åˆ†æï¼š</p><ul><li>åç§°æœç´¢ï¼Œå±äºå…¨æ–‡æ£€ç´¢æŸ¥è¯¢ï¼Œåº”è¯¥å‚ä¸ç®—åˆ†ã€‚æ”¾åˆ°mustä¸­</li><li>ä»·æ ¼ä¸é«˜äº400ï¼Œç”¨rangeæŸ¥è¯¢ï¼Œå±äºè¿‡æ»¤æ¡ä»¶ï¼Œä¸å‚ä¸ç®—åˆ†ã€‚æ”¾åˆ°must_notä¸­</li><li>å‘¨å›´10kmèŒƒå›´å†…ï¼Œç”¨geo_distanceæŸ¥è¯¢ï¼Œå±äºè¿‡æ»¤æ¡ä»¶ï¼Œä¸å‚ä¸ç®—åˆ†ã€‚æ”¾åˆ°filterä¸­</li></ul><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721194744183.png" title="image-20210721194744183"><h4 id="3ï¼‰å°ç»“-1"><a href="#3ï¼‰å°ç»“-1" class="headerlink" title="3ï¼‰å°ç»“"></a>3ï¼‰å°ç»“</h4><p>boolæŸ¥è¯¢æœ‰å‡ ç§é€»è¾‘å…³ç³»ï¼Ÿ</p><ul><li>mustï¼šå¿…é¡»åŒ¹é…çš„æ¡ä»¶ï¼Œå¯ä»¥ç†è§£ä¸ºâ€œä¸â€</li><li>shouldï¼šé€‰æ‹©æ€§åŒ¹é…çš„æ¡ä»¶ï¼Œå¯ä»¥ç†è§£ä¸ºâ€œæˆ–â€</li><li>must_notï¼šå¿…é¡»ä¸åŒ¹é…çš„æ¡ä»¶ï¼Œä¸å‚ä¸æ‰“åˆ†</li><li>filterï¼šå¿…é¡»åŒ¹é…çš„æ¡ä»¶ï¼Œä¸å‚ä¸æ‰“åˆ†</li></ul><h2 id="1-6-update-by-query-delete-by-query"><a href="#1-6-update-by-query-delete-by-query" class="headerlink" title="1.6 update_by_query&#x2F;delete_by_query"></a>1.6 update_by_query&#x2F;delete_by_query</h2><h3 id="1-6-1-updateçš„å†…å®¹ä¸ºæ·»åŠ çš„å†…å®¹"><a href="#1-6-1-updateçš„å†…å®¹ä¸ºæ·»åŠ çš„å†…å®¹" class="headerlink" title="1.6.1 updateçš„å†…å®¹ä¸ºæ·»åŠ çš„å†…å®¹"></a>1.6.1 <strong>updateçš„å†…å®¹ä¸ºæ·»åŠ çš„å†…å®¹</strong></h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">POST device_search_20200716/_update_by_query?conflicts=proceed&amp;timeout=<span class="number">1</span>d&amp;&amp;slices=<span class="number">5</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;script&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="comment">// labels æ˜¯ä¸€çº§å­—æ®µ paramsæ˜¯ä¸‹è¾¹å®šä¹‰çš„ï¼Œé‡Œè¾¹å­˜æ”¾ç€äºŒçº§å­—æ®µï¼Œå’ŒäºŒçº§å­—æ®µçš„å€¼</span></span><br><span class="line">    <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ctx._source.put(&#x27;labels&#x27;,params.labels)&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lang&quot;</span><span class="punctuation">:</span> <span class="string">&quot;painless&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;params&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;labels&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;hasSoftType&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;exists&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;deviceInfo.deviceType&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;must_not&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;labels.hasSoftType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="1-6-2-updateçš„å†…å®¹ä¸ºä¿®æ”¹çš„å†…å®¹"><a href="#1-6-2-updateçš„å†…å®¹ä¸ºä¿®æ”¹çš„å†…å®¹" class="headerlink" title="1.6.2 updateçš„å†…å®¹ä¸ºä¿®æ”¹çš„å†…å®¹"></a>1.6.2 <strong>updateçš„å†…å®¹ä¸ºä¿®æ”¹çš„å†…å®¹</strong></h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">POST device_search_20200716/_update_by_query?conflicts=proceed</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;script&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ctx._source[&#x27;labels&#x27;].hasSoftType=&#x27;2&#x27;;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lang&quot;</span><span class="punctuation">:</span> <span class="string">&quot;painless&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;bool&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;must&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;exists&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;field&quot;</span><span class="punctuation">:</span> <span class="string">&quot;deviceInfo.deviceType&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;must_not&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;term&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;labels.hasSoftType&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="1-6-3-delete-by-query"><a href="#1-6-3-delete-by-query" class="headerlink" title="1.6.3 delete_by_query"></a>1.6.3 delete_by_query</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST index_name/_delete_by_query</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">//è¿™äº›æ˜¯è‡ªå®šä¹‰æŸ¥è¯¢æ¡ä»¶ï¼Œæ ¹æ®æŸ¥è¯¢æ¡ä»¶å»æ‰¹é‡åˆ é™¤</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="comment">//è¯·æ±‚ä½“è·ŸSearch APIæ˜¯ä¸€æ ·çš„</span></span><br><span class="line">      <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;some message&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h1 id="2-æœç´¢ç»“æœå¤„ç†"><a href="#2-æœç´¢ç»“æœå¤„ç†" class="headerlink" title="2.æœç´¢ç»“æœå¤„ç†"></a>2.æœç´¢ç»“æœå¤„ç†</h1><p>æœç´¢çš„ç»“æœå¯ä»¥æŒ‰ç…§ç”¨æˆ·æŒ‡å®šçš„æ–¹å¼å»å¤„ç†æˆ–å±•ç¤ºã€‚</p><h2 id="2-1-æ’åº"><a href="#2-1-æ’åº" class="headerlink" title="2.1.æ’åº"></a>2.1.æ’åº</h2><p>elasticsearché»˜è®¤æ˜¯æ ¹æ®ç›¸å…³åº¦ç®—åˆ†ï¼ˆ_scoreï¼‰æ¥æ’åºï¼Œä½†æ˜¯ä¹Ÿæ”¯æŒè‡ªå®šä¹‰æ–¹å¼å¯¹æœç´¢<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/sort-search-results.html">ç»“æœæ’åº</a>ã€‚å¯ä»¥æ’åºå­—æ®µç±»å‹æœ‰ï¼škeywordç±»å‹ã€æ•°å€¼ç±»å‹ã€åœ°ç†åæ ‡ç±»å‹ã€æ—¥æœŸç±»å‹ç­‰ã€‚</p><h3 id="2-1-1-æ™®é€šå­—æ®µæ’åº"><a href="#2-1-1-æ™®é€šå­—æ®µæ’åº" class="headerlink" title="2.1.1.æ™®é€šå­—æ®µæ’åº"></a>2.1.1.æ™®é€šå­—æ®µæ’åº</h3><p>keywordã€æ•°å€¼ã€æ—¥æœŸç±»å‹æ’åºçš„è¯­æ³•åŸºæœ¬ä¸€è‡´ã€‚</p><p><strong>è¯­æ³•</strong>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span> <span class="string">&quot;desc&quot;</span>  <span class="comment">// æ’åºå­—æ®µã€æ’åºæ–¹å¼ASCã€DESC</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æ’åºæ¡ä»¶æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å†™å¤šä¸ªæ’åºæ¡ä»¶ã€‚æŒ‰ç…§å£°æ˜çš„é¡ºåºï¼Œå½“ç¬¬ä¸€ä¸ªæ¡ä»¶ç›¸ç­‰æ—¶ï¼Œå†æŒ‰ç…§ç¬¬äºŒä¸ªæ¡ä»¶æ’åºï¼Œä»¥æ­¤ç±»æ¨</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><p>éœ€æ±‚æè¿°ï¼šé…’åº—æ•°æ®æŒ‰ç…§ç”¨æˆ·è¯„ä»·ï¼ˆscore)é™åºæ’åºï¼Œè¯„ä»·ç›¸åŒçš„æŒ‰ç…§ä»·æ ¼(price)å‡åºæ’åº</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721195728306.png" title="image-20210721195728306"><h3 id="2-1-2-åœ°ç†åæ ‡æ’åº"><a href="#2-1-2-åœ°ç†åæ ‡æ’åº" class="headerlink" title="2.1.2.åœ°ç†åæ ‡æ’åº"></a>2.1.2.åœ°ç†åæ ‡æ’åº</h3><p>åœ°ç†åæ ‡æ’åºç•¥æœ‰ä¸åŒã€‚</p><p><strong>è¯­æ³•è¯´æ˜</strong>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;_geo_distance&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;FIELD&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;çº¬åº¦ï¼Œç»åº¦&quot;</span><span class="punctuation">,</span> <span class="comment">// æ–‡æ¡£ä¸­geo_pointç±»å‹çš„å­—æ®µåã€ç›®æ ‡åæ ‡ç‚¹</span></span><br><span class="line">          <span class="attr">&quot;order&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;asc&quot;</span><span class="punctuation">,</span> <span class="comment">// æ’åºæ–¹å¼</span></span><br><span class="line">          <span class="attr">&quot;unit&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;km&quot;</span> <span class="comment">// æ’åºçš„è·ç¦»å•ä½</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæŸ¥è¯¢çš„å«ä¹‰æ˜¯ï¼š</p><ul><li>æŒ‡å®šä¸€ä¸ªåæ ‡ï¼Œä½œä¸ºç›®æ ‡ç‚¹</li><li>è®¡ç®—æ¯ä¸€ä¸ªæ–‡æ¡£ä¸­ï¼ŒæŒ‡å®šå­—æ®µï¼ˆå¿…é¡»æ˜¯geo_pointç±»å‹ï¼‰çš„åæ ‡ åˆ°ç›®æ ‡ç‚¹çš„è·ç¦»æ˜¯å¤šå°‘</li><li>æ ¹æ®è·ç¦»æ’åº</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET /indexName/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;_script&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;number&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;script&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;source&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="string">&quot;def val = doc[&#x27;xxx&#x27;].value;</span></span><br><span class="line"><span class="string">                       int slashIndex = val.indexOf(&#x27;L&#x27;);</span></span><br><span class="line"><span class="string">                       return slashIndex;</span></span><br><span class="line"><span class="string">          &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;order&quot;</span><span class="punctuation">:</span> <span class="string">&quot;asc&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è„šæœ¬è¿›è¡ŒæŸ¥è¯¢, è¿™ä¸ªæŸ¥è¯¢çš„å«ä¹‰æ˜¯ï¼š</p><ul><li>æŒ‰ç…§æŸ¥è¯¢å­—æ®µ<code>xxx</code>çš„<code>L</code>å€¼å‡ºç°çš„ä½ç½®è¿›è¡Œæ’åº,å‡ºç°çš„ä½ç½®è¶Šé å‰åˆ™scoreè¶Šé«˜</li></ul><p><strong>ç¤ºä¾‹ï¼š</strong></p><p>éœ€æ±‚æè¿°ï¼šå®ç°å¯¹é…’åº—æ•°æ®æŒ‰ç…§åˆ°ä½ çš„ä½ç½®åæ ‡çš„è·ç¦»å‡åºæ’åº</p><p>æç¤ºï¼šè·å–ä½ çš„ä½ç½®çš„ç»çº¬åº¦çš„æ–¹å¼ï¼š<a target="_blank" rel="noopener external nofollow noreferrer" href="https://lbs.amap.com/demo/jsapi-v2/example/map/click-to-get-lnglat/">https://lbs.amap.com/demo/jsapi-v2/example/map/click-to-get-lnglat/</a></p><p>å‡è®¾æˆ‘çš„ä½ç½®æ˜¯ï¼š31.034661ï¼Œ121.612282ï¼Œå¯»æ‰¾æˆ‘å‘¨å›´è·ç¦»æœ€è¿‘çš„é…’åº—ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721200214690.png" title="image-20210721200214690"><h2 id="2-2-åˆ†é¡µ"><a href="#2-2-åˆ†é¡µ" class="headerlink" title="2.2.åˆ†é¡µ"></a>2.2.åˆ†é¡µ</h2><p>elasticsearch é»˜è®¤æƒ…å†µä¸‹åªè¿”å›top10çš„æ•°æ®ã€‚è€Œå¦‚æœè¦æŸ¥è¯¢æ›´å¤šæ•°æ®å°±éœ€è¦ä¿®æ”¹åˆ†é¡µå‚æ•°äº†ã€‚elasticsearchä¸­é€šè¿‡ä¿®æ”¹fromã€sizeå‚æ•°æ¥æ§åˆ¶è¦è¿”å›çš„åˆ†é¡µç»“æœï¼š</p><ul><li>fromï¼šä»ç¬¬å‡ ä¸ªæ–‡æ¡£å¼€å§‹</li><li>sizeï¼šæ€»å…±æŸ¥è¯¢å‡ ä¸ªæ–‡æ¡£</li></ul><p>ç±»ä¼¼äºmysqlä¸­çš„<code>limit ?, ?</code></p><h3 id="2-2-1-åŸºæœ¬çš„åˆ†é¡µ"><a href="#2-2-1-åŸºæœ¬çš„åˆ†é¡µ" class="headerlink" title="2.2.1.åŸºæœ¬çš„åˆ†é¡µ"></a>2.2.1.åŸºæœ¬çš„åˆ†é¡µ</h3><p>åˆ†é¡µçš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span> <span class="comment">// åˆ†é¡µå¼€å§‹çš„ä½ç½®ï¼Œé»˜è®¤ä¸º0</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span> <span class="comment">// æœŸæœ›è·å–çš„æ–‡æ¡£æ€»æ•°</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="string">&quot;asc&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="2-2-2-æ·±åº¦åˆ†é¡µé—®é¢˜"><a href="#2-2-2-æ·±åº¦åˆ†é¡µé—®é¢˜" class="headerlink" title="2.2.2.æ·±åº¦åˆ†é¡µé—®é¢˜"></a>2.2.2.æ·±åº¦åˆ†é¡µé—®é¢˜</h3><p>ç°åœ¨ï¼Œæˆ‘è¦æŸ¥è¯¢990~1000çš„æ•°æ®ï¼ŒæŸ¥è¯¢é€»è¾‘è¦è¿™ä¹ˆå†™ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match_all&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="number">990</span><span class="punctuation">,</span> <span class="comment">// åˆ†é¡µå¼€å§‹çš„ä½ç½®ï¼Œé»˜è®¤ä¸º0</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span> <span class="comment">// æœŸæœ›è·å–çš„æ–‡æ¡£æ€»æ•°</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="string">&quot;asc&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯æŸ¥è¯¢990å¼€å§‹çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ ç¬¬990~ç¬¬1000æ¡ æ•°æ®ã€‚</p><p>ä¸è¿‡ï¼Œelasticsearchå†…éƒ¨åˆ†é¡µæ—¶ï¼Œå¿…é¡»å…ˆæŸ¥è¯¢ 0~1000æ¡ï¼Œç„¶åæˆªå–å…¶ä¸­çš„990 ~ 1000çš„è¿™10æ¡ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721200643029.png" title="image-20210721200643029"><p>æŸ¥è¯¢TOP1000ï¼Œå¦‚æœesæ˜¯å•ç‚¹æ¨¡å¼ï¼Œè¿™å¹¶æ— å¤ªå¤§å½±å“ã€‚</p><p>ä½†æ˜¯elasticsearchå°†æ¥ä¸€å®šæ˜¯é›†ç¾¤ï¼Œä¾‹å¦‚æˆ‘é›†ç¾¤æœ‰5ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘è¦æŸ¥è¯¢TOP1000çš„æ•°æ®ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªèŠ‚ç‚¹æŸ¥è¯¢200æ¡å°±å¯ä»¥äº†ã€‚</p><p>å› ä¸ºèŠ‚ç‚¹Açš„TOP200ï¼Œåœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹å¯èƒ½æ’åˆ°10000åä»¥å¤–äº†ã€‚</p><p>å› æ­¤è¦æƒ³è·å–æ•´ä¸ªé›†ç¾¤çš„TOP1000ï¼Œå¿…é¡»å…ˆæŸ¥è¯¢å‡ºæ¯ä¸ªèŠ‚ç‚¹çš„TOP1000ï¼Œæ±‡æ€»ç»“æœåï¼Œé‡æ–°æ’åï¼Œé‡æ–°æˆªå–TOP1000ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721201003229.png" title="image-20210721201003229"><p>é‚£å¦‚æœæˆ‘è¦æŸ¥è¯¢9900~10000çš„æ•°æ®å‘¢ï¼Ÿæ˜¯ä¸æ˜¯è¦å…ˆæŸ¥è¯¢TOP10000å‘¢ï¼Ÿé‚£æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦æŸ¥è¯¢10000æ¡ï¼Ÿæ±‡æ€»åˆ°å†…å­˜ä¸­ï¼Ÿ</p><p>å½“æŸ¥è¯¢åˆ†é¡µæ·±åº¦è¾ƒå¤§æ—¶ï¼Œæ±‡æ€»æ•°æ®è¿‡å¤šï¼Œå¯¹å†…å­˜å’ŒCPUä¼šäº§ç”Ÿéå¸¸å¤§çš„å‹åŠ›ï¼Œå› æ­¤elasticsearchä¼šç¦æ­¢from+ size è¶…è¿‡10000çš„è¯·æ±‚ã€‚</p><p>é’ˆå¯¹æ·±åº¦åˆ†é¡µï¼ŒESæä¾›äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œ<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/paginate-search-results.html">å®˜æ–¹æ–‡æ¡£</a>ï¼š</p><ul><li>search afterï¼šåˆ†é¡µæ—¶éœ€è¦æ’åºï¼ŒåŸç†æ˜¯ä»ä¸Šä¸€æ¬¡çš„æ’åºå€¼å¼€å§‹ï¼ŒæŸ¥è¯¢ä¸‹ä¸€é¡µæ•°æ®ã€‚å®˜æ–¹æ¨èä½¿ç”¨çš„æ–¹å¼ã€‚</li><li>scrollï¼šåŸç†å°†æ’åºåçš„æ–‡æ¡£idå½¢æˆå¿«ç…§ï¼Œä¿å­˜åœ¨å†…å­˜ã€‚å®˜æ–¹å·²ç»ä¸æ¨èä½¿ç”¨ã€‚</li></ul><h3 id="2-2-3-å°ç»“"><a href="#2-2-3-å°ç»“" class="headerlink" title="2.2.3.å°ç»“"></a>2.2.3.å°ç»“</h3><p>åˆ†é¡µæŸ¥è¯¢çš„å¸¸è§å®ç°æ–¹æ¡ˆä»¥åŠä¼˜ç¼ºç‚¹ï¼š</p><ul><li><p><code>from + size</code>ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šæ”¯æŒéšæœºç¿»é¡µ</li><li>ç¼ºç‚¹ï¼šæ·±åº¦åˆ†é¡µé—®é¢˜ï¼Œé»˜è®¤æŸ¥è¯¢ä¸Šé™ï¼ˆfrom + sizeï¼‰æ˜¯10000</li><li>åœºæ™¯ï¼šç™¾åº¦ã€äº¬ä¸œã€è°·æ­Œã€æ·˜å®è¿™æ ·çš„éšæœºç¿»é¡µæœç´¢</li></ul></li><li><p><code>after search</code>ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šæ²¡æœ‰æŸ¥è¯¢ä¸Šé™ï¼ˆå•æ¬¡æŸ¥è¯¢çš„sizeä¸è¶…è¿‡10000ï¼‰</li><li>ç¼ºç‚¹ï¼šåªèƒ½å‘åé€é¡µæŸ¥è¯¢ï¼Œä¸æ”¯æŒéšæœºç¿»é¡µ</li><li>åœºæ™¯ï¼šæ²¡æœ‰éšæœºç¿»é¡µéœ€æ±‚çš„æœç´¢ï¼Œä¾‹å¦‚æ‰‹æœºå‘ä¸‹æ»šåŠ¨ç¿»é¡µ</li></ul></li><li><p><code>scroll</code>ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šæ²¡æœ‰æŸ¥è¯¢ä¸Šé™ï¼ˆå•æ¬¡æŸ¥è¯¢çš„sizeä¸è¶…è¿‡10000ï¼‰</li><li>ç¼ºç‚¹ï¼šä¼šæœ‰é¢å¤–å†…å­˜æ¶ˆè€—ï¼Œå¹¶ä¸”æœç´¢ç»“æœæ˜¯éå®æ—¶çš„</li><li>åœºæ™¯ï¼šæµ·é‡æ•°æ®çš„è·å–å’Œè¿ç§»ã€‚ä»ES7.1å¼€å§‹ä¸æ¨èï¼Œå»ºè®®ç”¨ after searchæ–¹æ¡ˆã€‚</li></ul></li></ul><h2 id="2-3-é«˜äº®"><a href="#2-3-é«˜äº®" class="headerlink" title="2.3.é«˜äº®"></a>2.3.é«˜äº®</h2><h3 id="2-3-1-é«˜äº®åŸç†"><a href="#2-3-1-é«˜äº®åŸç†" class="headerlink" title="2.3.1.é«˜äº®åŸç†"></a>2.3.1.é«˜äº®åŸç†</h3><p>ä»€ä¹ˆæ˜¯é«˜äº®æ˜¾ç¤ºå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬åœ¨ç™¾åº¦ï¼Œäº¬ä¸œæœç´¢æ—¶ï¼Œå…³é”®å­—ä¼šå˜æˆçº¢è‰²ï¼Œæ¯”è¾ƒé†’ç›®ï¼Œè¿™å«é«˜äº®æ˜¾ç¤ºï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721202705030.png" title="image-20210721202705030"><p>é«˜äº®æ˜¾ç¤ºçš„å®ç°åˆ†ä¸ºä¸¤æ­¥ï¼š</p><ul><li>1ï¼‰ç»™æ–‡æ¡£ä¸­çš„æ‰€æœ‰å…³é”®å­—éƒ½æ·»åŠ ä¸€ä¸ªæ ‡ç­¾ï¼Œä¾‹å¦‚<code>&lt;em&gt;</code>æ ‡ç­¾</li><li>2ï¼‰é¡µé¢ç»™<code>&lt;em&gt;</code>æ ‡ç­¾ç¼–å†™CSSæ ·å¼</li></ul><h3 id="2-3-2-å®ç°é«˜äº®"><a href="#2-3-2-å®ç°é«˜äº®" class="headerlink" title="2.3.2.å®ç°é«˜äº®"></a>2.3.2.å®ç°é«˜äº®</h3><p><strong>é«˜äº®çš„è¯­æ³•</strong>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /hotel/_search</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;query&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;match&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span> <span class="string">&quot;TEXT&quot;</span> <span class="comment">// æŸ¥è¯¢æ¡ä»¶ï¼Œé«˜äº®ä¸€å®šè¦ä½¿ç”¨å…¨æ–‡æ£€ç´¢æŸ¥è¯¢</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;highlight&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;fields&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">// æŒ‡å®šè¦é«˜äº®çš„å­—æ®µ</span></span><br><span class="line">      <span class="attr">&quot;FIELD&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;pre_tags&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;em&gt;&quot;</span><span class="punctuation">,</span>  <span class="comment">// ç”¨æ¥æ ‡è®°é«˜äº®å­—æ®µçš„å‰ç½®æ ‡ç­¾</span></span><br><span class="line">        <span class="attr">&quot;post_tags&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;/em&gt;&quot;</span> <span class="comment">// ç”¨æ¥æ ‡è®°é«˜äº®å­—æ®µçš„åç½®æ ‡ç­¾</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>é«˜äº®æ˜¯å¯¹å…³é”®å­—é«˜äº®ï¼Œå› æ­¤<strong>æœç´¢æ¡ä»¶å¿…é¡»å¸¦æœ‰å…³é”®å­—</strong>ï¼Œè€Œä¸èƒ½æ˜¯èŒƒå›´è¿™æ ·çš„æŸ¥è¯¢ã€‚</li><li>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>é«˜äº®çš„å­—æ®µï¼Œå¿…é¡»ä¸æœç´¢æŒ‡å®šçš„å­—æ®µä¸€è‡´</strong>ï¼Œå¦åˆ™æ— æ³•é«˜äº®</li><li>å¦‚æœè¦å¯¹éæœç´¢å­—æ®µé«˜äº®ï¼Œåˆ™éœ€è¦æ·»åŠ ä¸€ä¸ªå±æ€§ï¼šrequired_field_match&#x3D;false</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721203349633.png" title="image-20210721203349633"><h2 id="2-4-è¾“å‡ºç»“æœå¤„ç†"><a href="#2-4-è¾“å‡ºç»“æœå¤„ç†" class="headerlink" title="2.4.è¾“å‡ºç»“æœå¤„ç†"></a>2.4.è¾“å‡ºç»“æœå¤„ç†</h2><h3 id="2-4-1-æ ¼å¼åŒ–è¾“å‡º"><a href="#2-4-1-æ ¼å¼åŒ–è¾“å‡º" class="headerlink" title="2.4.1.æ ¼å¼åŒ–è¾“å‡º"></a>2.4.1.æ ¼å¼åŒ–è¾“å‡º</h3><p>æ ¼å¼åŒ–è¾“å‡ºæŒ‡è®©esçš„è¿”å›ç»“æœæ›´å…·æœ‰å¯è¯»æ€§ã€‚ä¸»è¦æœ‰ä¸¤ä¸ª<code>pretty=true</code>å’Œ<code>v</code></p><ul><li><code>http://&#123;&#123; _.es_url &#125;&#125;/_cat/indices?v</code>åœ¨urlå‚æ•°æ·»åŠ ä¸€ä¸ªvå­—æ¯å¯ä»¥è®©è¾“å‡ºç»“æœå¸¦æœ‰è¡¨å¤´ã€‚æ¯”å¦‚ä¸Šä¸€èŠ‚åœ¨è®²eså…ƒä¿¡æ¯æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¯ä»¥çœ‹åˆ°ä¸€èˆ¬éƒ½æœ‰å¸¦vå­—æ¯å‚æ•°ï¼Œå°±æ˜¯ä¸ºäº†è®©è¿”å›ç»“æœæœ‰è¡¨å¤´</li><li><code>http://&#123;&#123; _.es_url &#125;&#125;/zhy-detect-2021*/_search?pretty=true</code>ã€‚prettyå‚æ•°æ˜¯ä¸ºäº†è®©è¿”å›çš„jsonå­—ç¬¦ä¸²èƒ½æ›´åŠ å¯è¯»ã€‚</li></ul><h3 id="2-4-2-å±•å¹³é…ç½®ä¿¡æ¯"><a href="#2-4-2-å±•å¹³é…ç½®ä¿¡æ¯" class="headerlink" title="2.4.2. å±•å¹³é…ç½®ä¿¡æ¯"></a>2.4.2. å±•å¹³é…ç½®ä¿¡æ¯</h3><p><code>flat_settings=true</code>å‚æ•°å¯ä»¥è®©é…ç½®ä¿¡æ¯å±•å¹³ï¼Œè€Œä¸æ˜¯ä¸€å±‚å¥—ä¸€å±‚çš„jsonå¯¹è±¡ã€‚è¿™ä¸ªå‚æ•°ä¹Ÿåªæœ‰å¯¹é…ç½®ä¿¡æ¯æœ‰ç”¨ï¼Œå¯¹æ™®é€šè¿”å›ç»“æœæ²¡æœ‰ç”¨ã€‚<br>å¦‚ï¼ŒæŸ¥è¯¢é…ç½®apiï¼š<code>http://&#123;&#123; _.es_url &#125;&#125;/test-20201127/_settings?flat_settings=true</code><br>è¿”å›ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;test-20201127&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;settings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;index.codec&quot;</span><span class="punctuation">:</span> <span class="string">&quot;best_compression&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.creation_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1606406411188&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.lifecycle.name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test-dd&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.mapping.total_fields.limit&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10000&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.merge.policy.max_merged_segment&quot;</span><span class="punctuation">:</span> <span class="string">&quot;128m&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.number_of_replicas&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.number_of_shards&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.priority&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.provided_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test-20201127&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.refresh_interval&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1h&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.routing.allocation.total_shards_per_node&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.translog.flush_threshold_size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1g&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lgc28_OzT6qiJjDp9r5KNA&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;index.version.created&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7090399&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="2-4-3-è¿”å›ä¿¡æ¯è¿‡æ»¤"><a href="#2-4-3-è¿”å›ä¿¡æ¯è¿‡æ»¤" class="headerlink" title="2.4.3.è¿”å›ä¿¡æ¯è¿‡æ»¤"></a>2.4.3.è¿”å›ä¿¡æ¯è¿‡æ»¤</h3><p>åœ¨è¿›è¡ŒesæŸ¥è¯¢çš„æ—¶å€™ä¼šè¿”å›å¾ˆå¤šä¿¡æ¯ï¼Œå¦‚æœç”¨æƒ¯äº†SQLï¼Œä¼šå‘ç°ESå’‹è¿”å›è¿™ä¹ˆå¤šæ— ç”¨çš„æ•°æ®å‘¢ï¼Œå¦‚æœè§‰å¾—æœ‰äº›æ•°æ®æ— ç”¨ï¼Œå¯ä»¥å°†å…¶è¿‡æ»¤æ‰ï¼Œä½¿ç”¨<code>filter_path</code>å­—æ®µ,å¦‚<code>http://&#123;&#123; _.es_url &#125;&#125;/test-20201220/_search?filter_path=-**.blob,-**.blob1</code><br>ä½¿ç”¨è¯¥å­—æ®µè¿‡æ»¤çš„æ—¶å€™éœ€è¦æ³¨æ„ä»¥ä¸‹ç»†èŠ‚ï¼š</p><ul><li>ä»–çš„è¿‡æ»¤æ˜¯å¯ä»¥æœ‰å±‚çº§çš„ã€‚æ¯”å¦‚å¦‚æœåªè¦è¿”å›hitså­—æ®µï¼Œå¯ä»¥å†™<code>filter_path=hits</code>ï¼Œå¦‚æœéœ€è¦è¿”å›hitså­—æ®µä¸­çš„hitsï¼Œå¯ä»¥å†™<code>filter_path=hits.hits</code>ï¼Œå³é€šè¿‡ç‚¹(.)çš„æ–¹å¼æŒ‡å®šè¿”å›å±‚çº§ã€‚</li><li>å¦‚æœhitsè¿”å›çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ è¿˜æœ‰sourceå­—æ®µï¼Œè¿˜å¯ä»¥æŒ‡å®š<code>filter_path=hits.hits._source</code>ã€‚è¿™æ ·è¿”å›çš„æ•°ç»„çš„å¯¹è±¡åªåŒ…å«sourceå­—æ®µã€‚</li><li>å¦‚æœæŒ‡å®šçš„è¿‡æ»¤å­—æ®µä¸å­˜åœ¨ä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªç©ºå¯¹è±¡ï¼ˆè¿™å¾ˆå®¹æ˜“ç†è§£ï¼‰</li><li>å¦‚æœéœ€è¦æŒ‡å®šè¿‡æ»¤å¤šä¸ªå­—æ®µï¼Œå¤šä¸ªå­—æ®µç›´æ¥ç”¨é€—å·(,)åˆ†å‰²ï¼Œå°±åƒï¼šfilter_path&#x3D;hits.hits,tookè¿˜å¯ä»¥é€šè¿‡é€šé…ç¬¦åŒ¹é…å­—æ®µï¼Œæ¯”å¦‚è¦åŒ¹é…hitså­—æ®µä¸‹ä»»æ„å­—æ®µä¸‹çš„_sourceå­—æ®µï¼Œå¯ä»¥ä½¿ç”¨<code>&lt;filter_path=hits.*._source&gt;</code>æ¥åŒ¹é…</li><li>å¦‚æœæ˜¯ä¸¤ä¸ª<code>*</code>ï¼Œå³<code>**</code>ï¼Œå¯ä»¥åŒ¹é…ä»»æ„æ·±åº¦çš„è·¯å¾„ï¼Œæ¯”å¦‚è¿˜æ˜¯è¦æŸ¥è¯¢_sourceå­—æ®µï¼Œä½†æ˜¯è¿™æ¬¡ä¸çŸ¥é“ä»–çš„å…·ä½“çˆ¶è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨<code>&lt;filter_path=**._source&gt;</code>æ¥åŒ¹é…</li><li>ä¸Šé¢è¯´çš„æ‰€æœ‰æƒ…å†µéƒ½æ˜¯è¿‡æ»¤è¦ç•™ä¸‹çš„å­—æ®µï¼Œè€Œä¸æ˜¯æ’é™¤çš„å­—æ®µã€‚å¦‚æœè¦æ’é™¤å­—æ®µï¼Œä¸Šé¢æ‰€æœ‰è§„åˆ™ä¾ç„¶ç”Ÿæ•ˆï¼Œåªæ˜¯åœ¨è¦æ’é™¤çš„å­—æ®µå‰é¢åŠ ä¸€ä¸ªå‡å·(-)ï¼Œæ¯”å¦‚è¦æ’é™¤ä»»æ„æ·±åº¦ä¸‹çš„_sourceå­å­—æ®µåªéœ€è¦å†™<code>&lt;filter_path=-**._source&gt;</code>å³å¯ï¼Œæ³¨æ„ï¼Œå‰é¢æ˜¯æœ‰å‡å·çš„ï¼Œæ²¡æœ‰å‡å·è¡¨ç¤ºåªä¿ç•™è¿™ä¸ªå­—æ®µã€‚</li></ul><h3 id="2-4-4-è¿”å›åŒ¹é…æ–‡æ¡£æ•°"><a href="#2-4-4-è¿”å›åŒ¹é…æ–‡æ¡£æ•°" class="headerlink" title="2.4.4.è¿”å›åŒ¹é…æ–‡æ¡£æ•°"></a>2.4.4.è¿”å›åŒ¹é…æ–‡æ¡£æ•°</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœåŒ¹é…åˆ°çš„æ–‡æ¡£æ•°å¤§äº10000ï¼Œä¼šä»¥10000æ˜¾ç¤ºã€‚æ˜¾ç„¶è¿™åœ¨å¾ˆå¤šæƒ…å†µä¸‹ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ä¸ºäº†è·å–çœŸå®åŒ¹é…åˆ°çš„æ–‡æ¡£æ•°ï¼Œå¯ä»¥ä½¿ç”¨<code>track_total_hits=true</code>å‚æ•°ã€‚ï¼Œå¦‚<code>http://&#123;&#123; _.es_url &#125;&#125;/test-2021*/_search?track_total_hits=true</code>,è¿”å›ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="number">2843</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;relation&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eq&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><h2 id="2-5-æ€»ç»“"><a href="#2-5-æ€»ç»“" class="headerlink" title="2.5.æ€»ç»“"></a>2.5.æ€»ç»“</h2><p>æŸ¥è¯¢çš„DSLæ˜¯ä¸€ä¸ªå¤§çš„JSONå¯¹è±¡ï¼ŒåŒ…å«ä¸‹åˆ—å±æ€§ï¼š</p><ul><li>queryï¼šæŸ¥è¯¢æ¡ä»¶</li><li>fromå’Œsizeï¼šåˆ†é¡µæ¡ä»¶</li><li>sortï¼šæ’åºæ¡ä»¶</li><li>highlightï¼šé«˜äº®æ¡ä»¶</li></ul><p>ç¤ºä¾‹ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721203657850.png" title="image-20210721203657850"><h1 id="3-RestClientæŸ¥è¯¢æ–‡æ¡£"><a href="#3-RestClientæŸ¥è¯¢æ–‡æ¡£" class="headerlink" title="3.RestClientæŸ¥è¯¢æ–‡æ¡£"></a>3.RestClientæŸ¥è¯¢æ–‡æ¡£</h1><p>æ–‡æ¡£çš„æŸ¥è¯¢åŒæ ·é€‚ç”¨æ˜¨å¤©å­¦ä¹ çš„ RestHighLevelClientå¯¹è±¡ï¼ŒåŸºæœ¬æ­¥éª¤åŒ…æ‹¬ï¼š</p><ul><li>1ï¼‰å‡†å¤‡Requestå¯¹è±¡</li><li>2ï¼‰å‡†å¤‡è¯·æ±‚å‚æ•°</li><li>3ï¼‰å‘èµ·è¯·æ±‚</li><li>4ï¼‰è§£æå“åº”</li></ul><h2 id="3-1-å¿«é€Ÿå…¥é—¨"><a href="#3-1-å¿«é€Ÿå…¥é—¨" class="headerlink" title="3.1.å¿«é€Ÿå…¥é—¨"></a>3.1.å¿«é€Ÿå…¥é—¨</h2><p>æˆ‘ä»¬ä»¥match_allæŸ¥è¯¢ä¸ºä¾‹</p><h3 id="3-1-1-å‘èµ·æŸ¥è¯¢è¯·æ±‚"><a href="#3-1-1-å‘èµ·æŸ¥è¯¢è¯·æ±‚" class="headerlink" title="3.1.1.å‘èµ·æŸ¥è¯¢è¯·æ±‚"></a>3.1.1.å‘èµ·æŸ¥è¯¢è¯·æ±‚</h3><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721203950559.png" title="image-20210721203950559"><p>ä»£ç è§£è¯»ï¼š</p><ul><li><p>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»º<code>SearchRequest</code>å¯¹è±¡ï¼ŒæŒ‡å®šç´¢å¼•åº“å</p></li><li><p>ç¬¬äºŒæ­¥ï¼Œåˆ©ç”¨<code>request.source()</code>æ„å»ºDSLï¼ŒDSLä¸­å¯ä»¥åŒ…å«æŸ¥è¯¢ã€åˆ†é¡µã€æ’åºã€é«˜äº®ç­‰</p><ul><li><code>query()</code>ï¼šä»£è¡¨æŸ¥è¯¢æ¡ä»¶ï¼Œåˆ©ç”¨<code>QueryBuilders.matchAllQuery()</code>æ„å»ºä¸€ä¸ªmatch_allæŸ¥è¯¢çš„DSL</li></ul></li><li><p>ç¬¬ä¸‰æ­¥ï¼Œåˆ©ç”¨client.search()å‘é€è¯·æ±‚ï¼Œå¾—åˆ°å“åº”</p></li></ul><p>è¿™é‡Œå…³é”®çš„APIæœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯<code>request.source()</code>ï¼Œå…¶ä¸­åŒ…å«äº†æŸ¥è¯¢ã€æ’åºã€åˆ†é¡µã€é«˜äº®ç­‰æ‰€æœ‰åŠŸèƒ½ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721215640790.png" title="image-20210721215640790"><p>å¦ä¸€ä¸ªæ˜¯<code>QueryBuilders</code>ï¼Œå…¶ä¸­åŒ…å«matchã€termã€function_scoreã€boolç­‰å„ç§æŸ¥è¯¢ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721215729236.png" title="image-20210721215729236"><h3 id="3-1-2-è§£æå“åº”"><a href="#3-1-2-è§£æå“åº”" class="headerlink" title="3.1.2.è§£æå“åº”"></a>3.1.2.è§£æå“åº”</h3><p>å“åº”ç»“æœçš„è§£æï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721214221057.png" title="image-20210721214221057"><p>elasticsearchè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªJSONå­—ç¬¦ä¸²ï¼Œç»“æ„åŒ…å«ï¼š</p><ul><li><code>hits</code>ï¼šå‘½ä¸­çš„ç»“æœ<ul><li><code>total</code>ï¼šæ€»æ¡æ•°ï¼Œå…¶ä¸­çš„valueæ˜¯å…·ä½“çš„æ€»æ¡æ•°å€¼</li><li><code>max_score</code>ï¼šæ‰€æœ‰ç»“æœä¸­å¾—åˆ†æœ€é«˜çš„æ–‡æ¡£çš„ç›¸å…³æ€§ç®—åˆ†</li><li><code>hits</code>ï¼šæœç´¢ç»“æœçš„æ–‡æ¡£æ•°ç»„ï¼Œå…¶ä¸­çš„æ¯ä¸ªæ–‡æ¡£éƒ½æ˜¯ä¸€ä¸ªjsonå¯¹è±¡<ul><li><code>_source</code>ï¼šæ–‡æ¡£ä¸­çš„åŸå§‹æ•°æ®ï¼Œä¹Ÿæ˜¯jsonå¯¹è±¡</li></ul></li></ul></li></ul><p>å› æ­¤ï¼Œæˆ‘ä»¬è§£æå“åº”ç»“æœï¼Œå°±æ˜¯é€å±‚è§£æJSONå­—ç¬¦ä¸²ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li><code>SearchHits</code>ï¼šé€šè¿‡response.getHits()è·å–ï¼Œå°±æ˜¯JSONä¸­çš„æœ€å¤–å±‚çš„hitsï¼Œä»£è¡¨å‘½ä¸­çš„ç»“æœ<ul><li><code>SearchHits#getTotalHits().value</code>ï¼šè·å–æ€»æ¡æ•°ä¿¡æ¯</li><li><code>SearchHits#getHits()</code>ï¼šè·å–SearchHitæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯æ–‡æ¡£æ•°ç»„<ul><li><code>SearchHit#getSourceAsString()</code>ï¼šè·å–æ–‡æ¡£ç»“æœä¸­çš„_sourceï¼Œä¹Ÿå°±æ˜¯åŸå§‹çš„jsonæ–‡æ¡£æ•°æ®</li></ul></li></ul></li></ul><h3 id="3-1-3-å®Œæ•´ä»£ç "><a href="#3-1-3-å®Œæ•´ä»£ç " class="headerlink" title="3.1.3.å®Œæ•´ä»£ç "></a>3.1.3.å®Œæ•´ä»£ç </h3><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMatchAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">    request.source()</span><br><span class="line">        .query(QueryBuilders.matchAllQuery());</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleResponse</span><span class="params">(SearchResponse response)</span> &#123;</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line">    <span class="comment">// 4.1.è·å–æ€»æ¡æ•°</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> searchHits.getTotalHits().value;</span><br><span class="line">    System.out.println(<span class="string">&quot;å…±æœç´¢åˆ°&quot;</span> + total + <span class="string">&quot;æ¡æ•°æ®&quot;</span>);</span><br><span class="line">    <span class="comment">// 4.2.æ–‡æ¡£æ•°ç»„</span></span><br><span class="line">    SearchHit[] hits = searchHits.getHits();</span><br><span class="line">    <span class="comment">// 4.3.éå†</span></span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">        <span class="comment">// è·å–æ–‡æ¡£source</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">        <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;hotelDoc = &quot;</span> + hotelDoc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-1-4-å°ç»“"><a href="#3-1-4-å°ç»“" class="headerlink" title="3.1.4.å°ç»“"></a>3.1.4.å°ç»“</h3><p>æŸ¥è¯¢çš„åŸºæœ¬æ­¥éª¤æ˜¯ï¼š</p><ol><li><p>åˆ›å»ºSearchRequestå¯¹è±¡</p></li><li><p>å‡†å¤‡Request.source()ï¼Œä¹Ÿå°±æ˜¯DSLã€‚</p><p>â‘  QueryBuildersæ¥æ„å»ºæŸ¥è¯¢æ¡ä»¶</p><p>â‘¡ ä¼ å…¥Request.source() çš„ query() æ–¹æ³•</p></li><li><p>å‘é€è¯·æ±‚ï¼Œå¾—åˆ°ç»“æœ</p></li><li><p>è§£æç»“æœï¼ˆå‚è€ƒJSONç»“æœï¼Œä»å¤–åˆ°å†…ï¼Œé€å±‚è§£æï¼‰</p></li></ol><h2 id="3-2-matchæŸ¥è¯¢"><a href="#3-2-matchæŸ¥è¯¢" class="headerlink" title="3.2.matchæŸ¥è¯¢"></a>3.2.matchæŸ¥è¯¢</h2><p>å…¨æ–‡æ£€ç´¢çš„matchå’Œmulti_matchæŸ¥è¯¢ä¸match_allçš„APIåŸºæœ¬ä¸€è‡´ã€‚å·®åˆ«æ˜¯æŸ¥è¯¢æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯queryçš„éƒ¨åˆ†ã€‚</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721215923060.png" title="image-20210721215923060"><p>å› æ­¤ï¼ŒJavaä»£ç ä¸Šçš„å·®å¼‚ä¸»è¦æ˜¯request.source().query()ä¸­çš„å‚æ•°äº†ã€‚åŒæ ·æ˜¯åˆ©ç”¨QueryBuildersæä¾›çš„æ–¹æ³•ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721215843099.png" title="image-20210721215843099"><p>è€Œç»“æœè§£æä»£ç åˆ™å®Œå…¨ä¸€è‡´ï¼Œå¯ä»¥æŠ½å–å¹¶å…±äº«ã€‚</p><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testMatch</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">    request.source()</span><br><span class="line">        .query(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, <span class="string">&quot;å¦‚å®¶&quot;</span>));</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-3-ç²¾ç¡®æŸ¥è¯¢"><a href="#3-3-ç²¾ç¡®æŸ¥è¯¢" class="headerlink" title="3.3.ç²¾ç¡®æŸ¥è¯¢"></a>3.3.ç²¾ç¡®æŸ¥è¯¢</h2><p>ç²¾ç¡®æŸ¥è¯¢ä¸»è¦æ˜¯ä¸¤è€…ï¼š</p><ul><li>termï¼šè¯æ¡ç²¾ç¡®åŒ¹é…</li><li>rangeï¼šèŒƒå›´æŸ¥è¯¢</li></ul><p>ä¸ä¹‹å‰çš„æŸ¥è¯¢ç›¸æ¯”ï¼Œå·®å¼‚åŒæ ·åœ¨æŸ¥è¯¢æ¡ä»¶ï¼Œå…¶å®ƒéƒ½ä¸€æ ·ã€‚</p><p>æŸ¥è¯¢æ¡ä»¶æ„é€ çš„APIå¦‚ä¸‹ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721220305140.png" title="image-20210721220305140"><h2 id="3-4-å¸ƒå°”æŸ¥è¯¢"><a href="#3-4-å¸ƒå°”æŸ¥è¯¢" class="headerlink" title="3.4.å¸ƒå°”æŸ¥è¯¢"></a>3.4.å¸ƒå°”æŸ¥è¯¢</h2><p>å¸ƒå°”æŸ¥è¯¢æ˜¯ç”¨mustã€must_notã€filterç­‰æ–¹å¼ç»„åˆå…¶å®ƒæŸ¥è¯¢ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721220927286.png" title="image-20210721220927286"><p>å¯ä»¥çœ‹åˆ°ï¼ŒAPIä¸å…¶å®ƒæŸ¥è¯¢çš„å·®åˆ«åŒæ ·æ˜¯åœ¨æŸ¥è¯¢æ¡ä»¶çš„æ„å»ºï¼ŒQueryBuildersï¼Œç»“æœè§£æç­‰å…¶ä»–ä»£ç å®Œå…¨ä¸å˜ã€‚</p><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBool</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">    <span class="comment">// 2.1.å‡†å¤‡BooleanQuery</span></span><br><span class="line">    <span class="type">BoolQueryBuilder</span> <span class="variable">boolQuery</span> <span class="operator">=</span> QueryBuilders.boolQuery();</span><br><span class="line">    <span class="comment">// 2.2.æ·»åŠ term</span></span><br><span class="line">    boolQuery.must(QueryBuilders.termQuery(<span class="string">&quot;city&quot;</span>, <span class="string">&quot;æ­å·&quot;</span>));</span><br><span class="line">    <span class="comment">// 2.3.æ·»åŠ range</span></span><br><span class="line">    boolQuery.filter(QueryBuilders.rangeQuery(<span class="string">&quot;price&quot;</span>).lte(<span class="number">250</span>));</span><br><span class="line"></span><br><span class="line">    request.source().query(boolQuery);</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-5-æ’åºã€åˆ†é¡µ"><a href="#3-5-æ’åºã€åˆ†é¡µ" class="headerlink" title="3.5.æ’åºã€åˆ†é¡µ"></a>3.5.æ’åºã€åˆ†é¡µ</h2><p>æœç´¢ç»“æœçš„æ’åºå’Œåˆ†é¡µæ˜¯ä¸queryåŒçº§çš„å‚æ•°ï¼Œå› æ­¤åŒæ ·æ˜¯ä½¿ç”¨request.source()æ¥è®¾ç½®ã€‚</p><p>å¯¹åº”çš„APIå¦‚ä¸‹ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721221121266.png" title="image-20210721221121266"><p>å®Œæ•´ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testPageAndSort</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// é¡µç ï¼Œæ¯é¡µå¤§å°</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">page</span> <span class="operator">=</span> <span class="number">1</span>, size = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">    <span class="comment">// 2.1.query</span></span><br><span class="line">    request.source().query(QueryBuilders.matchAllQuery());</span><br><span class="line">    <span class="comment">// 2.2.æ’åº sort</span></span><br><span class="line">    request.source().sort(<span class="string">&quot;price&quot;</span>, SortOrder.ASC);</span><br><span class="line">    <span class="comment">// 2.3.åˆ†é¡µ fromã€size</span></span><br><span class="line">    request.source().from((page - <span class="number">1</span>) * size).size(<span class="number">5</span>);</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-6-é«˜äº®"><a href="#3-6-é«˜äº®" class="headerlink" title="3.6.é«˜äº®"></a>3.6.é«˜äº®</h2><p>é«˜äº®çš„ä»£ç ä¸ä¹‹å‰ä»£ç å·®å¼‚è¾ƒå¤§ï¼Œæœ‰ä¸¤ç‚¹ï¼š</p><ul><li>æŸ¥è¯¢çš„DSLï¼šå…¶ä¸­é™¤äº†æŸ¥è¯¢æ¡ä»¶ï¼Œè¿˜éœ€è¦æ·»åŠ é«˜äº®æ¡ä»¶ï¼ŒåŒæ ·æ˜¯ä¸queryåŒçº§ã€‚</li><li>ç»“æœè§£æï¼šç»“æœé™¤äº†è¦è§£æ_sourceæ–‡æ¡£æ•°æ®ï¼Œè¿˜è¦è§£æé«˜äº®ç»“æœ</li></ul><h3 id="3-6-1-é«˜äº®è¯·æ±‚æ„å»º"><a href="#3-6-1-é«˜äº®è¯·æ±‚æ„å»º" class="headerlink" title="3.6.1.é«˜äº®è¯·æ±‚æ„å»º"></a>3.6.1.é«˜äº®è¯·æ±‚æ„å»º</h3><p>é«˜äº®è¯·æ±‚çš„æ„å»ºAPIå¦‚ä¸‹ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721221744883.png" title="image-20210721221744883"><p>ä¸Šè¿°ä»£ç çœç•¥äº†æŸ¥è¯¢æ¡ä»¶éƒ¨åˆ†ï¼Œä½†æ˜¯å¤§å®¶ä¸è¦å¿˜äº†ï¼šé«˜äº®æŸ¥è¯¢å¿…é¡»ä½¿ç”¨å…¨æ–‡æ£€ç´¢æŸ¥è¯¢ï¼Œå¹¶ä¸”è¦æœ‰æœç´¢å…³é”®å­—ï¼Œå°†æ¥æ‰å¯ä»¥å¯¹å…³é”®å­—é«˜äº®ã€‚</p><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testHighlight</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 1.å‡†å¤‡Request</span></span><br><span class="line">    <span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SearchRequest</span>(<span class="string">&quot;hotel&quot;</span>);</span><br><span class="line">    <span class="comment">// 2.å‡†å¤‡DSL</span></span><br><span class="line">    <span class="comment">// 2.1.query</span></span><br><span class="line">    request.source().query(QueryBuilders.matchQuery(<span class="string">&quot;all&quot;</span>, <span class="string">&quot;å¦‚å®¶&quot;</span>));</span><br><span class="line">    <span class="comment">// 2.2.é«˜äº®</span></span><br><span class="line">    request.source().highlighter(<span class="keyword">new</span> <span class="title class_">HighlightBuilder</span>().field(<span class="string">&quot;name&quot;</span>).requireFieldMatch(<span class="literal">false</span>));</span><br><span class="line">    <span class="comment">// 3.å‘é€è¯·æ±‚</span></span><br><span class="line">    <span class="type">SearchResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.search(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    handleResponse(response);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-6-2-é«˜äº®ç»“æœè§£æ"><a href="#3-6-2-é«˜äº®ç»“æœè§£æ" class="headerlink" title="3.6.2.é«˜äº®ç»“æœè§£æ"></a>3.6.2.é«˜äº®ç»“æœè§£æ</h3><p>é«˜äº®çš„ç»“æœä¸æŸ¥è¯¢çš„æ–‡æ¡£ç»“æœé»˜è®¤æ˜¯åˆ†ç¦»çš„ï¼Œå¹¶ä¸åœ¨ä¸€èµ·ã€‚</p><p>å› æ­¤è§£æé«˜äº®çš„ä»£ç éœ€è¦é¢å¤–å¤„ç†ï¼š</p><img src="/img/loading.gif" data-lazy-src="/posts/4bb6b4d2/image-20210721222057212.png" title="image-20210721222057212"><p>ä»£ç è§£è¯»ï¼š</p><ul><li>ç¬¬ä¸€æ­¥ï¼šä»ç»“æœä¸­è·å–sourceã€‚hit.getSourceAsString()ï¼Œè¿™éƒ¨åˆ†æ˜¯éé«˜äº®ç»“æœï¼Œjsonå­—ç¬¦ä¸²ã€‚è¿˜éœ€è¦ååºåˆ—ä¸ºHotelDocå¯¹è±¡</li><li>ç¬¬äºŒæ­¥ï¼šè·å–é«˜äº®ç»“æœã€‚hit.getHighlightFields()ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªMapï¼Œkeyæ˜¯é«˜äº®å­—æ®µåç§°ï¼Œå€¼æ˜¯HighlightFieldå¯¹è±¡ï¼Œä»£è¡¨é«˜äº®å€¼</li><li>ç¬¬ä¸‰æ­¥ï¼šä»mapä¸­æ ¹æ®é«˜äº®å­—æ®µåç§°ï¼Œè·å–é«˜äº®å­—æ®µå€¼å¯¹è±¡HighlightField</li><li>ç¬¬å››æ­¥ï¼šä»HighlightFieldä¸­è·å–Fragmentsï¼Œå¹¶ä¸”è½¬ä¸ºå­—ç¬¦ä¸²ã€‚è¿™éƒ¨åˆ†å°±æ˜¯çœŸæ­£çš„é«˜äº®å­—ç¬¦ä¸²äº†</li><li>ç¬¬äº”æ­¥ï¼šç”¨é«˜äº®çš„ç»“æœæ›¿æ¢HotelDocä¸­çš„éé«˜äº®ç»“æœ</li></ul><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handleResponse</span><span class="params">(SearchResponse response)</span> &#123;</span><br><span class="line">    <span class="comment">// 4.è§£æå“åº”</span></span><br><span class="line">    <span class="type">SearchHits</span> <span class="variable">searchHits</span> <span class="operator">=</span> response.getHits();</span><br><span class="line">    <span class="comment">// 4.1.è·å–æ€»æ¡æ•°</span></span><br><span class="line">    <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> searchHits.getTotalHits().value;</span><br><span class="line">    System.out.println(<span class="string">&quot;å…±æœç´¢åˆ°&quot;</span> + total + <span class="string">&quot;æ¡æ•°æ®&quot;</span>);</span><br><span class="line">    <span class="comment">// 4.2.æ–‡æ¡£æ•°ç»„</span></span><br><span class="line">    SearchHit[] hits = searchHits.getHits();</span><br><span class="line">    <span class="comment">// 4.3.éå†</span></span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit : hits) &#123;</span><br><span class="line">        <span class="comment">// è·å–æ–‡æ¡£source</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> hit.getSourceAsString();</span><br><span class="line">        <span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="type">HotelDoc</span> <span class="variable">hotelDoc</span> <span class="operator">=</span> JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">        <span class="comment">// è·å–é«˜äº®ç»“æœ</span></span><br><span class="line">        Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields();</span><br><span class="line">        <span class="keyword">if</span> (!CollectionUtils.isEmpty(highlightFields)) &#123;</span><br><span class="line">            <span class="comment">// æ ¹æ®å­—æ®µåè·å–é«˜äº®ç»“æœ</span></span><br><span class="line">            <span class="type">HighlightField</span> <span class="variable">highlightField</span> <span class="operator">=</span> highlightFields.get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (highlightField != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// è·å–é«˜äº®å€¼</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> highlightField.getFragments()[<span class="number">0</span>].string();</span><br><span class="line">                <span class="comment">// è¦†ç›–éé«˜äº®ç»“æœ</span></span><br><span class="line">                hotelDoc.setName(name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;hotelDoc = &quot;</span> + hotelDoc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…:</span> <span class="post-copyright-info"><a href="https://xiaowu95.wang">å°äº”</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥:</span> <span class="post-copyright-info"><a href="https://xiaowu95.wang/posts/4bb6b4d2/">https://xiaowu95.wang/posts/4bb6b4d2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜:</span> <span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://xiaowu95.wang" target="_blank">å°äº”çš„ä¸ªäººæ‚è´§é“º</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/elasticsearch/">elasticsearch</a><a class="post-meta__tags" href="/tags/elastic-stack/">elastic stack</a></div><div class="post-share"><div class="social-share" data-image="/img/nba-logo23.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>æ„Ÿè°¢æ”¯æŒ</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wxpay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-lazy-src="/img/wxpay.jpg" alt="å¾®ä¿¡"></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-lazy-src="/img/alipay.jpg" alt="æ”¯ä»˜å®"></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/ca003542/" title="Elasticsearchçš„åŸºæœ¬ä½¿ç”¨"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo14.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">Elasticsearchçš„åŸºæœ¬ä½¿ç”¨</div></div><div class="info-2"><div class="info-item-1">1 äº†è§£ES1.1.1.elasticsearchçš„ä½œç”¨elasticsearchæ˜¯ä¸€æ¬¾éå¸¸å¼ºå¤§çš„å¼€æºæœç´¢å¼•æ“ï¼Œå…·å¤‡éå¸¸å¤šå¼ºå¤§åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ä»æµ·é‡æ•°æ®ä¸­å¿«é€Ÿæ‰¾åˆ°éœ€è¦çš„å†…å®¹ 1.1.2.ELKæŠ€æœ¯æ ˆelasticsearchç»“åˆkibanaã€Logstashã€Beatsï¼Œä¹Ÿå°±æ˜¯elastic stackï¼ˆELKï¼‰ã€‚è¢«å¹¿æ³›åº”ç”¨åœ¨æ—¥å¿—æ•°æ®åˆ†æã€å®æ—¶ç›‘æ§ç­‰é¢†åŸŸï¼š è€Œelasticsearchæ˜¯elastic stackçš„æ ¸å¿ƒï¼Œè´Ÿè´£å­˜å‚¨ã€æœç´¢ã€åˆ†ææ•°æ®ã€‚ 1.1.3.elasticsearchå’Œluceneelasticsearchåº•å±‚æ˜¯åŸºäºluceneæ¥å®ç°çš„ã€‚ Luceneæ˜¯ä¸€ä¸ªJavaè¯­è¨€çš„æœç´¢å¼•æ“ç±»åº“ï¼Œæ˜¯Apacheå…¬å¸çš„é¡¶çº§é¡¹ç›®ï¼Œç”±DougCuttingäº1999å¹´ç ”å‘ã€‚å®˜ç½‘åœ°å€ï¼šhttps://lucene.apache.org/ ã€‚ elasticsearchçš„å‘å±•å†å²ï¼š 2004å¹´Shay BanonåŸºäºLuceneå¼€å‘äº†Compass 2010å¹´Shay Banon é‡å†™äº†Compassï¼Œå–åä¸ºElasticsearchã€‚ 1....</div></div></div></a><a class="pagination-related" href="/posts/f2c14b21/" title="esä¸­çš„å„ç§åˆ†è¯å™¨"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo27.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">esä¸­çš„å„ç§åˆ†è¯å™¨</div></div><div class="info-2"><div class="info-item-1">ESå†…ç½®çš„Analyzeråˆ†æå™¨esè‡ªå¸¦äº†è®¸å¤šå†…ç½®çš„Analyzeråˆ†æå™¨ï¼Œæ— éœ€é…ç½®å°±å¯ä»¥ç›´æ¥åœ¨indexä¸­ä½¿ç”¨ï¼š æ ‡å‡†åˆ†è¯å™¨ï¼ˆstandardï¼‰ï¼šä»¥å•è¯è¾¹ç•Œåˆ‡åˆ†å­—ç¬¦ä¸²ä¸ºtermsï¼Œæ ¹æ®Unicodeæ–‡æœ¬åˆ†å‰²ç®—æ³•ã€‚å®ƒä¼šç§»é™¤å¤§éƒ¨åˆ†çš„æ ‡ç‚¹ç¬¦å·ï¼Œå°å†™åˆ†è¯åçš„termï¼Œæ”¯æŒåœç”¨è¯ã€‚ ç®€å•åˆ†è¯å™¨ï¼ˆsimpleï¼‰ï¼šè¯¥åˆ†è¯å™¨ä¼šåœ¨é‡åˆ°éå­—æ¯æ—¶åˆ‡åˆ†å­—ç¬¦ä¸²ï¼Œå°å†™æ‰€æœ‰çš„termã€‚ ç©ºæ ¼åˆ†è¯å™¨ï¼ˆwhitespaceï¼‰ï¼šé‡åˆ°ç©ºæ ¼å­—ç¬¦æ—¶åˆ‡åˆ†å­—ç¬¦ä¸²ï¼Œ åœç”¨è¯åˆ†è¯å™¨ï¼ˆstopï¼‰ï¼šç±»ä¼¼ç®€å•åˆ†è¯å™¨ï¼ŒåŒæ—¶æ”¯æŒç§»é™¤åœç”¨è¯ã€‚ å…³é”®è¯åˆ†è¯å™¨ï¼ˆkeywordï¼‰ï¼šæ— æ“ä½œåˆ†è¯å™¨ï¼Œä¼šè¾“å‡ºä¸è¾“å…¥ç›¸åŒçš„å†…å®¹ä½œä¸ºä¸€ä¸ªsingle termã€‚ æ¨¡å¼åˆ†è¯å™¨ï¼ˆpatternï¼‰ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è®²å­—ç¬¦ä¸²ä¸”åˆ†ä¸ºtermsã€‚æ”¯æŒå°å†™å­—æ¯å’Œåœç”¨è¯ã€‚ è¯­è¨€åˆ†è¯å™¨ï¼ˆlanguageï¼‰ï¼šæ”¯æŒè®¸å¤šåŸºäºç‰¹å®šè¯­è¨€çš„åˆ†è¯å™¨ï¼Œæ¯”å¦‚englishæˆ–frenchã€‚ ç­¾ååˆ†è¯å™¨ï¼ˆfingerprintï¼‰ï¼šæ˜¯ä¸€ä¸ªä¸“å®¶åˆ†è¯å™¨ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªç­¾åï¼Œå¯ä»¥ç”¨äºå»é‡æ£€æµ‹ã€‚ è‡ªå®šä¹‰åˆ†è¯å™¨ï¼šå¦‚æœå†…ç½®åˆ†è¯å™¨æ— æ³•æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œå¯ä»¥è‡ªå®šä¹‰customåˆ†è¯å™¨ï¼Œæ ¹æ®ä¸åŒçš„character filte...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/d88b52f3/" title="Too many dynamic script compilations within, max[75&#x2F;5m];"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo8.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2023-06-16</div><div class="info-item-2">Too many dynamic script compilations within, max[75&#x2F;5m];</div></div><div class="info-2"><div class="info-item-1">ResponseError: search_phase_execution_exception: [circuit_breaking_exception] Reason: [script] Too many dynamic script compilations within, max: [75/5m]; please use indexed, or scripts with parameters instead; this limit can be changed by the [script.context.number_sort.max_compilations_rate] setting</div></div></div></a><a class="pagination-related" href="/posts/9c544337/" title="Elasticsearchï¼šSnapshotå¤‡ä»½ä¸æ¢å¤"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo18.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2023-10-30</div><div class="info-item-2">Elasticsearchï¼šSnapshotå¤‡ä»½ä¸æ¢å¤</div></div><div class="info-2"><div class="info-item-1">SnapshotElasticsearchæ–‡æ¡£é‡Œå¯¹äºsnapshotæœ‰å¦‚ä¸‹æè¿°ï¼š 1The index snapshot process is incremental. In the process of making the index snapshot Elasticsearch analyses the list of the index files that are already stored in the repository and copies only files that were created or changed since the last snapshot. è¿™é‡Œè¯´snapshotæ˜¯å¢é‡å¤‡ä»½çš„ï¼Œæ¯æ¬¡snapshotï¼ŒEsä¼šåˆ†æindexæ–‡ä»¶ï¼Œå¹¶ä¸”åªå¤‡ä»½å¢é‡éƒ¨åˆ†ã€‚ snapshotæ˜¯å¢é‡å¤‡ä»½ï¼Œå¯¹æœªå‘ç”Ÿå˜åŒ–çš„indexé‡å¤å¤‡ä»½å‡ ä¹æ²¡æœ‰èµ„æºæ¶ˆè€—ï¼› åˆ é™¤snapshotä¸ä¼šå¯¹å…¶å®ƒsnapshotäº§ç”Ÿå½±å“ï¼› snapshotæ˜¯å¢é‡å¤‡ä»½ï¼Œå¯¹æœªå‘ç”Ÿå˜åŒ–çš„indexé‡å¤å¤‡ä»½å‡ ä¹æ²¡æœ‰èµ„æºæ¶ˆè€— åˆ é™¤æŸä¸ªsnapshotä¸ä¼šå¯¹å…¶å®ƒsnapshotäº§ç”Ÿå½±å“ã€‚ æ“ä½œå»ºä»“...</div></div></div></a><a class="pagination-related" href="/posts/3cc5542c/" title="Elasticsearchä¹‹ç¼“å­˜"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo12.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2024-07-19</div><div class="info-item-2">Elasticsearchä¹‹ç¼“å­˜</div></div><div class="info-2"><div class="info-item-1">è½¬è‡ªï¼šhttps://www.jianshu.com/p/1ec202148189 Elasticsearch åŒ…å«ä¸‰ä¸ªç±»å‹çš„ç¼“å­˜ï¼Œåˆ†åˆ«ä¸ºï¼š Node Query Cache ã€ Shard Request Cache ã€ Fielddata Cacheã€‚ Node Query Cacheä½œç”¨åŸŸQuery Cacheæ˜¯Nodeçº§åˆ«çš„ï¼Œè¢«æ‰€æœ‰shardå…±äº«ã€‚ æ—©æœŸç‰ˆæœ¬ä¹Ÿå«åšä¸ºFilter Cacheï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¯¹è¿‡æ»¤å™¨çš„æ‰§è¡Œç»“æœè¿›è¡Œç¼“å­˜ã€‚ Query Cacheç¼“å­˜çš„æ˜¯å‹ç¼©è¿‡çš„bitsetï¼Œå¯¹åº”æ»¡è¶³Queryæ¡ä»¶çš„docIDåˆ—è¡¨ã€‚æ·»åŠ cacheçš„æ—¶å€™ï¼Œä¼šæ³¨å†Œä¸€ä¸ªå›è°ƒï¼Œå¦‚æœSegmentè¢«åˆå¹¶æˆ–è€…åˆ é™¤ï¼Œé‚£ä¹ˆå°±ä¼šè¢«ç§»é™¤ç¼“å­˜ ç®€å•æ¥çœ‹å¯ä»¥è¿™æ ·ç†è§£ï¼Œä¸€ä¸ªESçš„æŸ¥è¯¢ä¼šå…ˆè¢«parse æˆä¸€ç³»åˆ—Lucene çš„phraseï¼Œè¿™äº›phrases ä¸­çš„filterè¯­å¥ï¼Œå¦‚æœå¯¹äºæŸ¥è¯¢æ¡ä»¶æ˜¯ä¸€æ ·çš„æ—¶å€™ï¼Œå…¶å®ç»“æœé›†æ˜¯å·²å®šçš„ï¼Œé‚£ä¹ˆè¿™äº›phrase å…¶å®å°±æ˜¯å¯ä»¥å­˜æ”¾åœ¨ä¸€ä¸ªåœ°æ–¹å½“åšcacheç”¨ï¼Œè¿™ä¸ªå°±æ˜¯ query cacheã€‚ é…ç½®å‚æ•°æ—¢ç„¶æ˜¯ç¼“å­˜ï¼Œè‚¯å®šä¼šå¯¹æ•°é‡å’Œå†…å­˜æœ‰é™åˆ¶ã€‚é€šè¿‡_nodes/stat...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-lazy-src="/img/avatar.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">å°äº”</div><div class="author-info-description">Tomorrow will be better,Everything will be fine</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">554</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">168</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">55</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/wang-xiaowu"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons"><a class="social-icon" href="/random" target="_blank" title="éšä¾¿é€›é€›"><i class="fa-solid fa-shuffle"></i></a><a class="social-icon" href="mailto:wangxiaowu950330@foxmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/30655189?spm_id_from=333.1007.0.0" rel="external nofollow noreferrer" target="_blank" title="BiliBili"><i class="fa-brands fa-bilibili"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa-solid fa-rss"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-DSL%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="toc-number">1.</span> <span class="toc-text">1.DSLæŸ¥è¯¢æ–‡æ¡£</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-DSL%E6%9F%A5%E8%AF%A2%E5%88%86%E7%B1%BB"><span class="toc-number">1.1.</span> <span class="toc-text">1.1.DSLæŸ¥è¯¢åˆ†ç±»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.</span> <span class="toc-text">1.2.å…¨æ–‡æ£€ç´¢æŸ¥è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1.ä½¿ç”¨åœºæ™¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2.2.åŸºæœ¬è¯­æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.2.3.ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-4-match-phrase"><span class="toc-number">1.2.4.</span> <span class="toc-text">1.2.4 match_phrase</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-5-dis-max"><span class="toc-number">1.2.5.</span> <span class="toc-text">1.2.5 dis_max</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E4%BD%BF%E7%94%A8dis-max%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">ä¸ä½¿ç”¨dis_maxæŸ¥è¯¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8dis-max%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.5.2.</span> <span class="toc-text">ä½¿ç”¨dis_maxæŸ¥è¯¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Etie-breaker"><span class="toc-number">1.2.5.3.</span> <span class="toc-text">å…³äºtie_breaker</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.2.6.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E7%B2%BE%E5%87%86%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.</span> <span class="toc-text">1.3.ç²¾å‡†æŸ¥è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1-term%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.3.1.termæŸ¥è¯¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2-range%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.2.</span> <span class="toc-text">1.3.2.rangeæŸ¥è¯¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-3-%E6%80%BB%E7%BB%93"><span class="toc-number">1.3.3.</span> <span class="toc-text">1.3.3.æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E5%9C%B0%E7%90%86%E5%9D%90%E6%A0%87%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.</span> <span class="toc-text">1.4.åœ°ç†åæ ‡æŸ¥è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-1-%E7%9F%A9%E5%BD%A2%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.1.</span> <span class="toc-text">1.4.1.çŸ©å½¢èŒƒå›´æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-2-%E9%99%84%E8%BF%91%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.4.2.</span> <span class="toc-text">1.4.2.é™„è¿‘æŸ¥è¯¢</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-%E5%A4%8D%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.5.</span> <span class="toc-text">1.5.å¤åˆæŸ¥è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-1-%E7%9B%B8%E5%85%B3%E6%80%A7%E7%AE%97%E5%88%86"><span class="toc-number">1.5.1.</span> <span class="toc-text">1.5.1.ç›¸å…³æ€§ç®—åˆ†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-2-%E7%AE%97%E5%88%86%E5%87%BD%E6%95%B0%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.5.2.</span> <span class="toc-text">1.5.2.ç®—åˆ†å‡½æ•°æŸ¥è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E8%AF%AD%E6%B3%95%E8%AF%B4%E6%98%8E"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">1ï¼‰è¯­æ³•è¯´æ˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">2ï¼‰ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E5%B0%8F%E7%BB%93"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">3ï¼‰å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-3-%E5%B8%83%E5%B0%94%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.5.3.</span> <span class="toc-text">1.5.3.å¸ƒå°”æŸ¥è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E8%AF%AD%E6%B3%95%E7%A4%BA%E4%BE%8B%EF%BC%9A"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">1ï¼‰è¯­æ³•ç¤ºä¾‹ï¼š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E7%A4%BA%E4%BE%8B-1"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">2ï¼‰ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E5%B0%8F%E7%BB%93-1"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">3ï¼‰å°ç»“</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-update-by-query-delete-by-query"><span class="toc-number">1.6.</span> <span class="toc-text">1.6 update_by_query&#x2F;delete_by_query</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-1-update%E7%9A%84%E5%86%85%E5%AE%B9%E4%B8%BA%E6%B7%BB%E5%8A%A0%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">1.6.1.</span> <span class="toc-text">1.6.1 updateçš„å†…å®¹ä¸ºæ·»åŠ çš„å†…å®¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-2-update%E7%9A%84%E5%86%85%E5%AE%B9%E4%B8%BA%E4%BF%AE%E6%94%B9%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">1.6.2.</span> <span class="toc-text">1.6.2 updateçš„å†…å®¹ä¸ºä¿®æ”¹çš„å†…å®¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-3-delete-by-query"><span class="toc-number">1.6.3.</span> <span class="toc-text">1.6.3 delete_by_query</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C%E5%A4%84%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">2.æœç´¢ç»“æœå¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E6%8E%92%E5%BA%8F"><span class="toc-number">2.1.</span> <span class="toc-text">2.1.æ’åº</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-%E6%99%AE%E9%80%9A%E5%AD%97%E6%AE%B5%E6%8E%92%E5%BA%8F"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1.æ™®é€šå­—æ®µæ’åº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-%E5%9C%B0%E7%90%86%E5%9D%90%E6%A0%87%E6%8E%92%E5%BA%8F"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2.åœ°ç†åæ ‡æ’åº</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%88%86%E9%A1%B5"><span class="toc-number">2.2.</span> <span class="toc-text">2.2.åˆ†é¡µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%88%86%E9%A1%B5"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1.åŸºæœ¬çš„åˆ†é¡µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E6%B7%B1%E5%BA%A6%E5%88%86%E9%A1%B5%E9%97%AE%E9%A2%98"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2.æ·±åº¦åˆ†é¡µé—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-%E5%B0%8F%E7%BB%93"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.2.3.å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E9%AB%98%E4%BA%AE"><span class="toc-number">2.3.</span> <span class="toc-text">2.3.é«˜äº®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-%E9%AB%98%E4%BA%AE%E5%8E%9F%E7%90%86"><span class="toc-number">2.3.1.</span> <span class="toc-text">2.3.1.é«˜äº®åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E5%AE%9E%E7%8E%B0%E9%AB%98%E4%BA%AE"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.3.2.å®ç°é«˜äº®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C%E5%A4%84%E7%90%86"><span class="toc-number">2.4.</span> <span class="toc-text">2.4.è¾“å‡ºç»“æœå¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA"><span class="toc-number">2.4.1.</span> <span class="toc-text">2.4.1.æ ¼å¼åŒ–è¾“å‡º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-%E5%B1%95%E5%B9%B3%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"><span class="toc-number">2.4.2.</span> <span class="toc-text">2.4.2. å±•å¹³é…ç½®ä¿¡æ¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-3-%E8%BF%94%E5%9B%9E%E4%BF%A1%E6%81%AF%E8%BF%87%E6%BB%A4"><span class="toc-number">2.4.3.</span> <span class="toc-text">2.4.3.è¿”å›ä¿¡æ¯è¿‡æ»¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-4-%E8%BF%94%E5%9B%9E%E5%8C%B9%E9%85%8D%E6%96%87%E6%A1%A3%E6%95%B0"><span class="toc-number">2.4.4.</span> <span class="toc-text">2.4.4.è¿”å›åŒ¹é…æ–‡æ¡£æ•°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E6%80%BB%E7%BB%93"><span class="toc-number">2.5.</span> <span class="toc-text">2.5.æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-RestClient%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="toc-number">3.</span> <span class="toc-text">3.RestClientæŸ¥è¯¢æ–‡æ¡£</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">3.1.</span> <span class="toc-text">3.1.å¿«é€Ÿå…¥é—¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E5%8F%91%E8%B5%B7%E6%9F%A5%E8%AF%A2%E8%AF%B7%E6%B1%82"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1.å‘èµ·æŸ¥è¯¢è¯·æ±‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-%E8%A7%A3%E6%9E%90%E5%93%8D%E5%BA%94"><span class="toc-number">3.1.2.</span> <span class="toc-text">3.1.2.è§£æå“åº”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-3-%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">3.1.3.</span> <span class="toc-text">3.1.3.å®Œæ•´ä»£ç </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-4-%E5%B0%8F%E7%BB%93"><span class="toc-number">3.1.4.</span> <span class="toc-text">3.1.4.å°ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-match%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.2.</span> <span class="toc-text">3.2.matchæŸ¥è¯¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E7%B2%BE%E7%A1%AE%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.3.</span> <span class="toc-text">3.3.ç²¾ç¡®æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E5%B8%83%E5%B0%94%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.4.</span> <span class="toc-text">3.4.å¸ƒå°”æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-%E6%8E%92%E5%BA%8F%E3%80%81%E5%88%86%E9%A1%B5"><span class="toc-number">3.5.</span> <span class="toc-text">3.5.æ’åºã€åˆ†é¡µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-%E9%AB%98%E4%BA%AE"><span class="toc-number">3.6.</span> <span class="toc-text">3.6.é«˜äº®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-1-%E9%AB%98%E4%BA%AE%E8%AF%B7%E6%B1%82%E6%9E%84%E5%BB%BA"><span class="toc-number">3.6.1.</span> <span class="toc-text">3.6.1.é«˜äº®è¯·æ±‚æ„å»º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-2-%E9%AB%98%E4%BA%AE%E7%BB%93%E6%9E%9C%E8%A7%A3%E6%9E%90"><span class="toc-number">3.6.2.</span> <span class="toc-text">3.6.2.é«˜äº®ç»“æœè§£æ</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/d31147a5/" title="Clawdbotå®Œæ•´é…ç½®æŒ‡å—"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo16.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Clawdbotå®Œæ•´é…ç½®æŒ‡å—"></a><div class="content"><a class="title" href="/posts/d31147a5/" title="Clawdbotå®Œæ•´é…ç½®æŒ‡å—">Clawdbotå®Œæ•´é…ç½®æŒ‡å—</a><time datetime="2026-02-11T10:15:08.000Z" title="å‘è¡¨äº 2026-02-11 18:15:08">2026-02-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4d3a9a89/" title="å¤„ç† Rancher è¿æ¥èŠ‚ç‚¹ &quot;Cluster agent is not connected&quot;"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo29.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="å¤„ç† Rancher è¿æ¥èŠ‚ç‚¹ &quot;Cluster agent is not connected&quot;"></a><div class="content"><a class="title" href="/posts/4d3a9a89/" title="å¤„ç† Rancher è¿æ¥èŠ‚ç‚¹ &quot;Cluster agent is not connected&quot;">å¤„ç† Rancher è¿æ¥èŠ‚ç‚¹ &quot;Cluster agent is not connected&quot;</a><time datetime="2026-02-03T06:02:28.000Z" title="å‘è¡¨äº 2026-02-03 14:02:28">2026-02-03</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/nba-logo23.jpg)"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2019 - 2026 By å°äº”</span><span class="framework-info"><span>æ¡†æ¶</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>ä¸»é¢˜</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.1</a></span></div><div class="footer_custom_text"><a href="https://www.foreverblog.cn/" rel="external nofollow noreferrer" target="_blank"><img src="/img/loading.gif" data-lazy-src="https://img.foreverblog.cn/logo_en_default.png" alt="åå¹´ä¹‹çº¦" style="width:auto;height:16px"></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.1/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.1/source/js/main.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.1/source/js/tw_cn.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(()=>{const e=()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");if(0===e.length)return;const t=()=>(e=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";e.forEach(((e,n)=>{const d=e.firstElementChild,a=`mermaid-${n}`,r=`%%{init:{ 'theme':'${t}'}}%%\n`+d.textContent,i=mermaid.render(a,r),m=e=>{d.insertAdjacentHTML("afterend",e)};"string"==typeof i?m(i):i.then((({svg:e})=>m(e)))}))})(e);btf.addGlobalFn("themeChange",t,"mermaid"),window.loadMermaid?t():btf.getScript("https://cdn.jsdelivr.net/npm/mermaid@11.12.0/dist/mermaid.min.js").then(t)};btf.addGlobalFn("encrypt",e,"mermaid"),window.pjax?e():document.addEventListener("DOMContentLoaded",e)})()</script><script>(()=>{const t=(e,a)=>{"object"==typeof e&&null!==e&&Object.keys(e).forEach((r=>{const n=e[r];"object"==typeof n&&null!==n&&(n[a]?e[r]=n[a]:t(n,a))}))},e=e=>{window.loadChartJS=!0,Array.from(e).forEach(((e,a)=>{const r=e.firstElementChild,n=e.getAttribute("data-chartjs-id")||"chartjs-"+a,d=e.getAttribute("data-width"),o=document.getElementById(n);o&&o.parentNode.remove();const c=r.textContent,l=document.createElement("canvas");l.id=n;const s=document.createElement("div");s.className="chartjs-wrap",d&&(s.style.width=d),s.appendChild(l),r.insertAdjacentElement("afterend",s);const h=document.getElementById(n).getContext("2d"),i=JSON.parse(c),m="dark"===document.documentElement.getAttribute("data-theme")?"dark-mode":"light-mode";(t=>{"dark-mode"===t?(Chart.defaults.color="rgba(255, 255, 255, 0.8)",Chart.defaults.borderColor="rgba(255, 255, 255, 0.2)",Chart.defaults.scale.ticks.backdropColor="transparent"):(Chart.defaults.color="rgba(0, 0, 0, 0.8)",Chart.defaults.borderColor="rgba(0, 0, 0, 0.1)",Chart.defaults.scale.ticks.backdropColor="transparent")})(m),t(i,m),new Chart(h,i)}))},a=()=>{const t=document.querySelectorAll("#article-container .chartjs-container");0!==t.length&&(window.loadChartJS?e(t):btf.getScript("https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.umd.min.js").then((()=>e(t))))};btf.addGlobalFn("themeChange",a,"chartjs"),btf.addGlobalFn("encrypt",a,"chartjs"),window.pjax?a():document.addEventListener("DOMContentLoaded",a)})()</script></div><div class="aplayer no-destroy" data-id="9061017364" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listfolded="false" data-order="random" data-lrctype="1" data-preload="none" data-autoplay="false" muted></div><div class="app-refresh" id="app-refresh"><div class="app-refresh-wrap"><label>ç½‘ç«™å·²æ›´æ–°æœ€æ–°ç‰ˆæœ¬</label> <a href="javascript:void(0)" rel="external nofollow noreferrer" onclick="location.reload()">ç‚¹å‡»åˆ·æ–°</a></div></div><script>function showNotification(){if(GLOBAL_CONFIG.Snackbar){var t="light"===document.documentElement.getAttribute("data-theme")?GLOBAL_CONFIG.Snackbar.bgLight:GLOBAL_CONFIG.Snackbar.bgDark,e=GLOBAL_CONFIG.Snackbar.position;Snackbar.show({text:"å·²æ›´æ–°æœ€æ–°ç‰ˆæœ¬",backgroundColor:t,duration:5e5,pos:e,actionText:"ç‚¹å‡»åˆ·æ–°",actionTextColor:"#fff",onActionClick:function(t){location.reload()}})}else{var o=`top: 0; background: ${"light"===document.documentElement.getAttribute("data-theme")?"#49b1f5":"#1f1f1f"};`;document.getElementById("app-refresh").style.cssText=o}}"serviceWorker"in navigator&&(navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("controllerchange",(function(){showNotification()})),window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js")})))</script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="/js/diytitle.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!0,document.body.addEventListener("input",POWERMODE)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/metingjs/dist/Meting.min.js"></script><script>btf.addGlobalFn("pjaxSend",(()=>{if(window.aplayers)for(let a=0;a<window.aplayers.length;a++)window.aplayers[a].options.fixed||window.aplayers[a].destroy()}),"destroyAplayer"),btf.addGlobalFn("pjaxComplete",loadMeting,"runMetingJS")</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>(()=>{window.pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/talking/"]):not([href="/artitalk/"])',selectors:['meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]','meta[property="og:description"]','link[rel="canonical"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"],cacheBust:!1,analytics:!0,scrollRestoration:!1});const e=e=>{e&&Object.values(e).forEach((e=>{try{e()}catch(e){console.debug("Pjax callback failed:",e)}}))};document.addEventListener("pjax:send",(()=>{btf.removeGlobalFnEvent("pjaxSendOnce"),btf.removeGlobalFnEvent("themeChange");const t=document.body.classList;t.contains("read-mode")&&t.remove("read-mode"),e(window.globalFn.pjaxSend)})),document.addEventListener("pjax:complete",(()=>{btf.removeGlobalFnEvent("pjaxCompleteOnce"),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),a=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(a)),e.parentNode.replaceChild(t,e)})),e(window.globalFn.pjaxComplete)})),document.addEventListener("pjax:error",(e=>{if(404===e.request.status){!0?pjax.loadUrl("/404"):window.location.href="/404"}}))})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div id="algolia-search-input"><div class="ais-SearchBox"><form class="ais-SearchBox-form" action="" role="search" novalidate><input class="ais-SearchBox-input" type="search" placeholder="æœç´¢æ–‡ç« " autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" maxlength="512" aria-label="Search"><button class="ais-SearchBox-submit" type="submit" title="Submit the search query" style="display:none"><svg class="ais-SearchBox-submitIcon" width="10" height="10" viewBox="0 0 40 40" aria-hidden="true"><path d="M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z"></path></svg></button></form></div><hr><div id="algolia-search-results"><div id="algolia-hits"><div id="algolia-hits-empty" style="display:none"></div><div class="ais-Hits" style="display:none"><ol class="ais-Hits-list"></ol></div></div><div class="ais-Pagination" id="algolia-pagination" style="display:none"><ul class="ais-Pagination-list"></ul></div><div id="algolia-info"><span class="ais-Stats-text"></span><a class="algolia-poweredBy" href="https://www.algolia.com/?utm_source=algoliasearch.js&amp;utm_medium=website&amp;utm_content=localhost&amp;utm_campaign=poweredby" target="_blank" aria-label="Search by Algolia" rel="noopener noreferrer"><svg class="ais-PoweredBy-logo" height="1.2em" viewBox="0 0 572 64" style="width:auto"><path fill="#36395A" d="M16 48.3c-3.4 0-6.3-.6-8.7-1.7A12.4 12.4 0 0 1 1.9 42C.6 40 0 38 0 35.4h6.5a6.7 6.7 0 0 0 3.9 6c1.4.7 3.3 1.1 5.6 1.1 2.2 0 4-.3 5.4-1a7 7 0 0 0 3-2.4 6 6 0 0 0 1-3.4c0-1.5-.6-2.8-1.9-3.7-1.3-1-3.3-1.6-5.9-1.8l-4-.4c-3.7-.3-6.6-1.4-8.8-3.4a10 10 0 0 1-3.3-7.9c0-2.4.6-4.6 1.8-6.4a12 12 0 0 1 5-4.3c2.2-1 4.7-1.6 7.5-1.6s5.5.5 7.6 1.6a12 12 0 0 1 5 4.4c1.2 1.8 1.8 4 1.8 6.7h-6.5a6.4 6.4 0 0 0-3.5-5.9c-1-.6-2.6-1-4.4-1s-3.2.3-4.4 1c-1.1.6-2 1.4-2.6 2.4-.5 1-.8 2-.8 3.1a5 5 0 0 0 1.5 3.6c1 1 2.6 1.7 4.7 1.9l4 .3c2.8.2 5.2.8 7.2 1.8 2.1 1 3.7 2.2 4.9 3.8a9.7 9.7 0 0 1 1.7 5.8c0 2.5-.7 4.7-2 6.6a13 13 0 0 1-5.6 4.4c-2.4 1-5.2 1.6-8.4 1.6Zm35.6 0c-2.6 0-4.8-.4-6.7-1.3a13 13 0 0 1-4.7-3.5 17.1 17.1 0 0 1-3.6-10.4v-1c0-2 .3-3.8 1-5.6a13 13 0 0 1 7.3-8.3 15 15 0 0 1 6.3-1.4A13.2 13.2 0 0 1 64 24.3c1 2.2 1.6 4.6 1.6 7.2V34H39.4v-4.3h21.8l-1.8 2.2c0-2-.3-3.7-.9-5.1a7.3 7.3 0 0 0-2.7-3.4c-1.2-.7-2.7-1.1-4.6-1.1s-3.4.4-4.7 1.3a8 8 0 0 0-2.9 3.6c-.6 1.5-.9 3.3-.9 5.4 0 2 .3 3.7 1 5.3a7.9 7.9 0 0 0 2.8 3.7c1.3.8 3 1.3 5 1.3s3.8-.5 5.1-1.3c1.3-1 2.1-2 2.4-3.2h6a11.8 11.8 0 0 1-7 8.7 16 16 0 0 1-6.4 1.2ZM80 48c-2.2 0-4-.3-5.7-1a8.4 8.4 0 0 1-3.7-3.3 9.7 9.7 0 0 1-1.3-5.2c0-2 .5-3.8 1.5-5.2a9 9 0 0 1 4.3-3.1c1.8-.7 4-1 6.7-1H89v4.1h-7.5c-2 0-3.4.5-4.4 1.4-1 1-1.6 2.1-1.6 3.6s.5 2.7 1.6 3.6c1 1 2.5 1.4 4.4 1.4 1.1 0 2.2-.2 3.2-.7 1-.4 1.9-1 2.6-2 .6-1 1-2.4 1-4.2l1.7 2.1c-.2 2-.7 3.8-1.5 5.2a9 9 0 0 1-3.4 3.3 12 12 0 0 1-5.3 1Zm9.5-.7v-8.8h-1v-10c0-1.8-.5-3.2-1.4-4.1-1-1-2.4-1.4-4.2-1.4a142.9 142.9 0 0 0-10.2.4v-5.6a74.8 74.8 0 0 1 8.6-.4c3 0 5.5.4 7.5 1.2s3.4 2 4.4 3.6c1 1.7 1.4 4 1.4 6.7v18.4h-5Zm12.9 0V17.8h5v12.3h-.2c0-4.2 1-7.4 2.8-9.5a11 11 0 0 1 8.3-3.1h1v5.6h-2a9 9 0 0 0-6.3 2.2c-1.5 1.5-2.2 3.6-2.2 6.4v15.6h-6.4Zm34.4 1a15 15 0 0 1-6.6-1.3c-1.9-.9-3.4-2-4.7-3.5a15.5 15.5 0 0 1-2.7-5c-.6-1.7-1-3.6-1-5.4v-1c0-2 .4-3.8 1-5.6a15 15 0 0 1 2.8-4.9c1.3-1.5 2.8-2.6 4.6-3.5a16.4 16.4 0 0 1 13.3.2c2 1 3.5 2.3 4.8 4a12 12 0 0 1 2 6H144c-.2-1.6-1-3-2.2-4.1a7.5 7.5 0 0 0-5.2-1.7 8 8 0 0 0-4.7 1.3 8 8 0 0 0-2.8 3.6 13.8 13.8 0 0 0 0 10.3c.6 1.5 1.5 2.7 2.8 3.6s2.8 1.3 4.8 1.3c1.5 0 2.7-.2 3.8-.8a7 7 0 0 0 2.6-2c.7-1 1-2 1.2-3.2h6.2a11 11 0 0 1-2 6.2 15.1 15.1 0 0 1-11.8 5.5Zm19.7-1v-40h6.4V31h-1.3c0-3 .4-5.5 1.1-7.6a9.7 9.7 0 0 1 3.5-4.8A9.9 9.9 0 0 1 172 17h.3c3.5 0 6 1.1 7.9 3.5 1.7 2.3 2.6 5.7 2.6 10v16.8h-6.4V29.6c0-2.1-.6-3.8-1.8-5a6.4 6.4 0 0 0-4.8-1.8c-2 0-3.7.7-5 2a7.8 7.8 0 0 0-1.9 5.5v17h-6.4Zm63.8 1a12.2 12.2 0 0 1-10.9-6.2 19 19 0 0 1-1.8-7.3h1.4v12.5h-5.1v-40h6.4v19.8l-2 3.5c.2-3.1.8-5.7 1.9-7.7a11 11 0 0 1 4.4-4.5c1.8-1 3.9-1.5 6.1-1.5a13.4 13.4 0 0 1 12.8 9.1c.7 1.9 1 3.8 1 6v1c0 2.2-.3 4.1-1 6a13.6 13.6 0 0 1-13.2 9.4Zm-1.2-5.5a8.4 8.4 0 0 0 7.9-5c.7-1.5 1.1-3.3 1.1-5.3s-.4-3.8-1.1-5.3a8.7 8.7 0 0 0-3.2-3.6 9.6 9.6 0 0 0-9.2-.2 8.5 8.5 0 0 0-3.3 3.2c-.8 1.4-1.3 3-1.3 5v2.3a9 9 0 0 0 1.3 4.8 9 9 0 0 0 3.4 3c1.4.7 2.8 1 4.4 1Zm27.3 3.9-10-28.9h6.5l9.5 28.9h-6Zm-7.5 12.2v-5.7h4.9c1 0 2-.1 2.9-.4a4 4 0 0 0 2-1.4c.4-.7.9-1.6 1.2-2.7l8.6-30.9h6.2l-9.3 32.4a14 14 0 0 1-2.5 5 8.9 8.9 0 0 1-4 2.8c-1.5.6-3.4.9-5.6.9h-4.4Zm9-12.2v-5.2h6.4v5.2H248Z"></path><path fill="#003DFF" d="M534.4 9.1H528a.8.8 0 0 1-.7-.7V1.8c0-.4.2-.7.6-.8l6.5-1c.4 0 .8.2.9.6v7.8c0 .4-.4.7-.8.7zM428 35.2V.8c0-.5-.3-.8-.7-.8h-.2l-6.4 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.5 0 .8-.4.8-.8V43c0-.4-.3-.7-.6-.8-4.5-.5-4.5-6-4.5-7zm106.5-21.8H528c-.4 0-.7.4-.7.8v34c0 .4.3.8.7.8h6.5c.4 0 .8-.4.8-.8v-34c0-.5-.4-.8-.8-.8zm-17.7 21.8V.8c0-.5-.3-.8-.8-.8l-6.5 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.4 0 .8-.4.8-.8V43c0-.4-.3-.7-.7-.8-4.4-.5-4.4-6-4.4-7zm-22.2-20.6a16.5 16.5 0 0 1 8.6 9.3c.8 2.2 1.3 4.8 1.3 7.5a19.4 19.4 0 0 1-4.6 12.6 14.8 14.8 0 0 1-5.2 3.6c-2 .9-5.2 1.4-6.8 1.4a21 21 0 0 1-6.7-1.4 15.4 15.4 0 0 1-8.6-9.3 21.3 21.3 0 0 1 0-14.4 15.2 15.2 0 0 1 8.6-9.3c2-.8 4.3-1.2 6.7-1.2s4.6.4 6.7 1.2zm-6.7 27.6c2.7 0 4.7-1 6.2-3s2.2-4.3 2.2-7.8-.7-6.3-2.2-8.3-3.5-3-6.2-3-4.7 1-6.1 3c-1.5 2-2.2 4.8-2.2 8.3s.7 5.8 2.2 7.8 3.5 3 6.2 3zm-88.8-28.8c-6.2 0-11.7 3.3-14.8 8.2a18.6 18.6 0 0 0 4.8 25.2c1.8 1.2 4 1.8 6.2 1.7s.1 0 .1 0h.9c4.2-.7 8-4 9.1-8.1v7.4c0 .4.3.7.8.7h6.4a.7.7 0 0 0 .7-.7V14.2c0-.5-.3-.8-.7-.8h-13.5zm6.3 26.5a9.8 9.8 0 0 1-5.7 2h-.5a10 10 0 0 1-9.2-14c1.4-3.7 5-6.3 9-6.3h6.4v18.3zm152.3-26.5h13.5c.5 0 .8.3.8.7v33.7c0 .4-.3.7-.8.7h-6.4a.7.7 0 0 1-.8-.7v-7.4c-1.2 4-4.8 7.4-9 8h-.1a4.2 4.2 0 0 1-.5.1h-.9a10.3 10.3 0 0 1-7-2.6c-4-3.3-6.5-8.4-6.5-14.2 0-3.7 1-7.2 3-10 3-5 8.5-8.3 14.7-8.3zm.6 28.4c2.2-.1 4.2-.6 5.7-2V21.7h-6.3a9.8 9.8 0 0 0-9 6.4 10.2 10.2 0 0 0 9.1 13.9h.5zM452.8 13.4c-6.2 0-11.7 3.3-14.8 8.2a18.5 18.5 0 0 0 3.6 24.3 10.4 10.4 0 0 0 13 .6c2.2-1.5 3.8-3.7 4.5-6.1v7.8c0 2.8-.8 5-2.2 6.3-1.5 1.5-4 2.2-7.5 2.2l-6-.3c-.3 0-.7.2-.8.5l-1.6 5.5c-.1.4.1.8.5 1h.1c2.8.4 5.5.6 7 .6 6.3 0 11-1.4 14-4.1 2.7-2.5 4.2-6.3 4.5-11.4V14.2c0-.5-.4-.8-.8-.8h-13.5zm6.3 8.2v18.3a9.6 9.6 0 0 1-5.6 2h-1a10.3 10.3 0 0 1-8.8-14c1.4-3.7 5-6.3 9-6.3h6.4zM291 31.5A32 32 0 0 1 322.8 0h30.8c.6 0 1.2.5 1.2 1.2v61.5c0 1.1-1.3 1.7-2.2 1l-19.2-17a18 18 0 0 1-11 3.4 18.1 18.1 0 1 1 18.2-14.8c-.1.4-.5.7-.9.6-.1 0-.3 0-.4-.2l-3.8-3.4c-.4-.3-.6-.8-.7-1.4a12 12 0 1 0-2.4 8.3c.4-.4 1-.5 1.6-.2l14.7 13.1v-46H323a26 26 0 1 0 10 49.7c.8-.4 1.6-.2 2.3.3l3 2.7c.3.2.3.7 0 1l-.2.2a32 32 0 0 1-47.2-28.6z"></path></svg></a></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@5.39.0/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.1/source/js/search/algolia.min.js"></script></div></div><script data-pjax>if(document.getElementById("recent-posts")&&"/"==location.pathname){var parent=document.getElementById("recent-posts"),child='<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo3.jpg" alt="/img/nba-logo3.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2024-02-02</span><a class="blog-slider__title" href="posts/1bcb0ad4/">å•ç¯å¢ƒ,å¤šåˆ†æ”¯å¹¶è¡Œå¼€å‘æ–¹æ¡ˆ(æµé‡æŸ“è‰²/istio)</a><div class="blog-slider__text">å•ç¯å¢ƒ,å¤šåˆ†æ”¯å¹¶è¡Œå¼€å‘æ–¹æ¡ˆ(æµé‡æŸ“è‰²/istio)</div><a class="blog-slider__button" href="posts/1bcb0ad4/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="/img/nba-logo22.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-06-14</span><a class="blog-slider__title" href="posts/aa43cc95/">è®°å½•k8sç¯å¢ƒä¸‹ç»“åˆalinodeçš„ä½¿ç”¨</a><div class="blog-slider__text">è®°å½•k8sç¯å¢ƒä¸‹ç»“åˆalinodeçš„ä½¿ç”¨</div><a class="blog-slider__button" href="posts/aa43cc95/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo29.jpg" alt="/img/nba-logo29.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-12-13</span><a class="blog-slider__title" href="posts/15957791/">k8sç¯å¢ƒä¸‹,nginxåšwebsocketè´Ÿè½½çš„æ–¹æ¡ˆæ¢³ç†</a><div class="blog-slider__text">k8sç¯å¢ƒä¸‹,nginxåšwebsocketè´Ÿè½½çš„æ–¹æ¡ˆæ¢³ç†</div><a class="blog-slider__button" href="posts/15957791/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="/img/nba-logo22.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-09-26</span><a class="blog-slider__title" href="posts/4ecfb081/">è®°å½•ä¸€æ¬¡k8sç½‘ç»œDNSé—®é¢˜æ’æŸ¥è¿‡ç¨‹</a><div class="blog-slider__text">è®°å½•ä¸€æ¬¡k8sç½‘ç»œDNSé—®é¢˜æ’æŸ¥è¿‡ç¨‹</div><a class="blog-slider__button" href="posts/4ecfb081/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="/img/nba-logo22.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-09-26</span><a class="blog-slider__title" href="posts/37032a87/">k3sé«˜å¯ç”¨å®‰è£…</a><div class="blog-slider__text">k3sé«˜å¯ç”¨å®‰è£…</div><a class="blog-slider__button" href="posts/37032a87/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo5.jpg" alt="/img/nba-logo5.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-11-27</span><a class="blog-slider__title" href="posts/20b19ed4/">åˆ†è¯æœç´¢éœ€æ±‚æ•´ç†</a><div class="blog-slider__text">åˆ†è¯æœç´¢éœ€æ±‚æ•´ç†</div><a class="blog-slider__button" href="posts/20b19ed4/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo26.jpg" alt="/img/nba-logo26.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-12-02</span><a class="blog-slider__title" href="posts/6de14387/">æ•´ç†wsl2é…åˆå¼€å‘çš„ä¸€äº›é…ç½®</a><div class="blog-slider__text">æ•´ç†wsl2é…åˆå¼€å‘çš„ä¸€äº›é…ç½®</div><a class="blog-slider__button" href="posts/6de14387/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo22.jpg" alt="/img/nba-logo22.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-12-11</span><a class="blog-slider__title" href="posts/fb9adcb6/">è®°å½•windows11+wsl2ç¯å¢ƒæ­é…</a><div class="blog-slider__text">windows11+wsl2å¼€å‘ç¯å¢ƒé…ç½®</div><a class="blog-slider__button" href="posts/fb9adcb6/">è¯¦æƒ…</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo26.jpg" alt="/img/nba-logo26.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2026-01-28</span><a class="blog-slider__title" href="posts/2a9d73ff/">æ•™ä½ å¦‚ä½•é›¶æˆæœ¬ä»0åˆ°1ï¼Œå¼€å‘ä¸Šçº¿ä¸€ä¸ªå¯¹æ¥äº†openAIçš„æœºå™¨äºº</a><div class="blog-slider__text">æ•™ä½ å¦‚ä½•é›¶æˆæœ¬ä»0åˆ°1ï¼Œå¼€å‘ä¸Šçº¿ä¸€ä¸ªå¯¹æ¥äº†openAIçš„æœºå™¨äºº</div><a class="blog-slider__button" href="posts/2a9d73ff/">è¯¦æƒ…</a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';console.log("å·²æŒ‚è½½swiper"),parent.insertAdjacentHTML("afterbegin",child)}</script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper@0.18/swiper/swiperindex.js"></script><style></style><script data-pjax>function history_calendar_injector_config(){var i=document.getElementsByClassName("sticky_layout")[0];console.log("å·²æŒ‚è½½history_calendar"),i.insertAdjacentHTML("afterbegin",'<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>é‚£å¹´ä»Šæ—¥</span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>')}document.getElementsByClassName("sticky_layout")[0]&&"/"===location.pathname&&history_calendar_injector_config()</script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"right",width:150,height:300,hOffset:20,vOffset:-20},mobile:{show:!0},log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/"})</script></body></html>