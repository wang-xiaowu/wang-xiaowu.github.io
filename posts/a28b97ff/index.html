<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>EnvoyFilter-ChatGPT译文 | 小五的个人杂货铺</title><meta name="author" content="小五"><meta name="copyright" content="小五"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="介绍 EnvoyFilter 提供了一种机制，可以自定义 Istio Pilot 生成的 Envoy 配置。使用 EnvoyFilter 修改某些字段的值、添加特定过滤器，甚至添加全新的监听器、集群等。这个功能必须小心使用，因为不正确的配置可能会破坏整个网格。与其他 Istio 网络对象不同，EnvoyFilters 是附加应用的。在特定命名空间中给定工作负载可以存在任意数量的 EnvoyFilt"><meta property="og:type" content="article"><meta property="og:title" content="EnvoyFilter-ChatGPT译文"><meta property="og:url" content="https://xiaowu95.wang/posts/a28b97ff/"><meta property="og:site_name" content="小五的个人杂货铺"><meta property="og:description" content="介绍 EnvoyFilter 提供了一种机制，可以自定义 Istio Pilot 生成的 Envoy 配置。使用 EnvoyFilter 修改某些字段的值、添加特定过滤器，甚至添加全新的监听器、集群等。这个功能必须小心使用，因为不正确的配置可能会破坏整个网格。与其他 Istio 网络对象不同，EnvoyFilters 是附加应用的。在特定命名空间中给定工作负载可以存在任意数量的 EnvoyFilt"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://xiaowu95.wang/img/nba-logo26.jpg"><meta property="article:published_time" content="2024-02-02T07:43:36.000Z"><meta property="article:modified_time" content="2024-02-02T07:43:36.000Z"><meta property="article:author" content="小五"><meta property="article:tag" content="云原生"><meta property="article:tag" content="k8s"><meta property="article:tag" content="istio"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://xiaowu95.wang/img/nba-logo26.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://xiaowu95.wang/posts/a28b97ff/"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="kHfLZxYQ7y3s3AR7gyJDdJkQvGNjQsvopp6N3gEEx0s"><meta name="baidu-site-verification" content="codeva-aVS4F6wAjS"><link rel="manifest" href="/wang-xiaowu/pwa/site.webmanifest"><meta name="msapplication-TileColor" content="#fff"><link rel="apple-touch-icon" sizes="180x180" href="/wang-xiaowu/pwa/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/wang-xiaowu/pwa/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/wang-xiaowu/pwa/favicon-16x16.png"><link rel="mask-icon" href="/wang-xiaowu/pwa/safari-pinned-tab.svg" color="#5bbad5"><link rel="stylesheet" href="/css/index.css?v=5.2.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise(((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach((([e,t])=>n.setAttribute(e,t))),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)})),getCSS:(e,t)=>new Promise(((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)})),addGlobalFn:(e,t,o=!1,a=window)=>{const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),c=window.matchMedia("(prefers-color-scheme: dark)"),r=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(r.matches)a();else if(c.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}c.addEventListener("change",(()=>{void 0===t.get("theme")&&(e.matches?o():a())}))}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?86cb34987e15c900c39e12ebdf08c50d";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),btf.addGlobalFn("pjaxComplete",(()=>{_hmt.push(["_trackPageview",window.location.pathname])}),"baidu_analytics")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-1MFQ47191J"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-1MFQ47191J"),btf.addGlobalFn("pjaxComplete",(()=>{gtag("config","G-1MFQ47191J",{page_path:window.location.pathname})}),"google_analytics")</script><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"M91QAWRVY4",apiKey:"ecc30a5e06136e1cc491685e39801190",indexName:"xiaowu-blog",hitsPerPage:6,languages:{input_placeholder:"搜索文章",hits_empty:"未找到符合您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"簡"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:400,highlightFullpage:!0,highlightMacStyle:!0},copy:{success:"复制成功",error:"复制失败",noSupport:"浏览器不支持"},relativeDate:{homepage:!0,post:!0},runtime:"天",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:150,languages:{author:"作者: 小五",link:"链接: ",source:"来源: 小五的个人杂货铺",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"已切换为繁体中文",cht_to_chs:"已切换为简体中文",day_to_night:"已切换为深色模式",night_to_day:"已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!0,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"EnvoyFilter-ChatGPT译文",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,isShuoshuo:!1}</script><script src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script src="https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js"></script><link rel="stylesheet" href="/css/font.css"><style>.app-refresh{position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease}.app-refresh-wrap{display:flex;color:#fff;height:100%;align-items:center;justify-content:center}.app-refresh-wrap a{color:#fff;text-decoration:underline;cursor:pointer}</style><link rel="stylesheet" href="/css/titleStyle.css"><link rel="stylesheet" href="/css/mouse.css"><link rel="stylesheet" href="/css/custom.css"><style>.card-announcement .social-button{margin:.6rem 0 0 0;text-align:center}.card-announcement .social-button a{display:block;background-color:var(--btn-bg);color:var(--btn-color);text-align:center;line-height:2.4;margin:4px 0}.card-announcement .social-button a:hover{background-color:var(--btn-hover-color)}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiperstyle.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="alternate" href="/atom.xml" title="小五的个人杂货铺" type="application/atom+xml"></head><body><script>window.paceOptions={restartOnPushState:!1},btf.addGlobalFn("pjaxSend",(()=>{Pace.restart()}),"pace_restart")</script><link rel="stylesheet" href="/css/pace.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/loading.gif" data-lazy-src="/img/avatar.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">550</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">163</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">58</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/github/"><i class="fa-fw fa-solid fa-address-card"></i> <span>关于我</span></a></div><div class="menus_item"><a class="site-page" href="/ac/"><i class="fa-fw fa-solid fa-wind"></i> <span>便携小空调</span></a></div><div class="menus_item"><a class="site-page" href="/talking/"><i class="fa-fw fa-solid fa-walkie-talkie"></i> <span>博客短记</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i> <span>目录</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-otter"></i> <span>杂记</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/songs/"><i class="fa-fw fas fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>图库</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa-solid fa-film"></i> <span>影视|番剧</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book faa-fload"></i> <span>书单</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad faa-fload"></i> <span>游戏</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-bilibili"></i> <span>BiliBili追番</span></a></li><li><a class="site-page child" href="/cinemas/"><i class="fa-fw fa-solid fa-video"></i> <span>BiliBili追剧</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-user-group"></i> <span>友链</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-mug-saucer"></i> <span>Website Memo</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://console.leancloud.app/apps"><span>🚀 LeanCloud</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.com/dashboard"><span>🚀 Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://tongji.baidu.com/main/overview/10000432799/overview/index"><span>🚀 百度统计</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://ziyuan.baidu.com/dashboard/index"><span>🚀 百度站点管理</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://analytics.google.com/analytics/web/"><span>🚀 谷歌分析</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://search.google.com/search-console?hl=zh-cn"><span>🚀 谷歌站点管理</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.google.com/adsense/new/u/0/pub-1375421173355613/home"><span>🚀 谷歌广告联盟</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.algolia.com/"><span>🚀 Algolia</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://sms-activate.org/cn/"><span>🚀 Sms-activate</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chatgpt.com/"><span>🚀 ChatGPT</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://poe.com/"><span>🚀 Poe聚合</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.idc.net/clientarea"><span>🚀 后浪云</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.west.cn/"><span>🚀 西部数据</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://shandianpro.com/#/dashboard"><span>🚀 闪电</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.huojian.homes/"><span>🚀 小火箭</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/winston779/gougou"><span>🚀 狗狗加速</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/nba-logo26.jpg)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">小五的个人杂货铺</span></a><a class="nav-page-title" href="/"><span class="site-name">EnvoyFilter-ChatGPT译文</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/github/"><i class="fa-fw fa-solid fa-address-card"></i> <span>关于我</span></a></div><div class="menus_item"><a class="site-page" href="/ac/"><i class="fa-fw fa-solid fa-wind"></i> <span>便携小空调</span></a></div><div class="menus_item"><a class="site-page" href="/talking/"><i class="fa-fw fa-solid fa-walkie-talkie"></i> <span>博客短记</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-compass"></i> <span>目录</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-otter"></i> <span>杂记</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/songs/"><i class="fa-fw fas fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>图库</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fa-solid fa-film"></i> <span>影视|番剧</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book faa-fload"></i> <span>书单</span></a></li><li><a class="site-page child" href="/games/"><i class="fa-fw fas fa-gamepad faa-fload"></i> <span>游戏</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fa-brands fa-bilibili"></i> <span>BiliBili追番</span></a></li><li><a class="site-page child" href="/cinemas/"><i class="fa-fw fa-solid fa-video"></i> <span>BiliBili追剧</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-comment-dots"></i> <span>留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-user-group"></i> <span>友链</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-mug-saucer"></i> <span>Website Memo</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://console.leancloud.app/apps"><span>🚀 LeanCloud</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.com/dashboard"><span>🚀 Vercel</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://tongji.baidu.com/main/overview/10000432799/overview/index"><span>🚀 百度统计</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://ziyuan.baidu.com/dashboard/index"><span>🚀 百度站点管理</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://analytics.google.com/analytics/web/"><span>🚀 谷歌分析</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://search.google.com/search-console?hl=zh-cn"><span>🚀 谷歌站点管理</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.google.com/adsense/new/u/0/pub-1375421173355613/home"><span>🚀 谷歌广告联盟</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.algolia.com/"><span>🚀 Algolia</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://sms-activate.org/cn/"><span>🚀 Sms-activate</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://chatgpt.com/"><span>🚀 ChatGPT</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://poe.com/"><span>🚀 Poe聚合</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="http://www.idc.net/clientarea"><span>🚀 后浪云</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.west.cn/"><span>🚀 西部数据</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://shandianpro.com/#/dashboard"><span>🚀 闪电</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.huojian.homes/"><span>🚀 小火箭</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/winston779/gougou"><span>🚀 狗狗加速</span></a></li></ul></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">EnvoyFilter-ChatGPT译文<a class="post-edit-link" href="https://github.com/wang-xiaowu/wang-xiaowu.github.io/issues/new?_posts/ServiceMesh/istio/EnvoyFilter.md" rel="external nofollow noreferrer" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-02-02T07:43:36.000Z" title="发表于 2024-02-02 15:43:36">2024-02-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-02-02T07:43:36.000Z" title="更新于 2024-02-02 15:43:36">2024-02-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/istio/">istio</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">5.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>22分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;距离上一次更新该文章已经过了&quot;,&quot;messageNext&quot;:&quot;天，文章所描述的內容可能已经发生变化，请留意。&quot;,&quot;postUpdate&quot;:&quot;2024-02-02 15:43:36&quot;}" hidden></div><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><blockquote><p>EnvoyFilter 提供了一种机制，可以自定义 Istio Pilot 生成的 Envoy 配置。使用 EnvoyFilter 修改某些字段的值、添加特定过滤器，甚至添加全新的监听器、集群等。这个功能必须小心使用，因为不正确的配置可能会破坏整个网格。与其他 Istio 网络对象不同，EnvoyFilters 是附加应用的。在特定命名空间中给定工作负载可以存在任意数量的 EnvoyFilters 。这些 EnvoyFilters 的应用顺序如下：所有位于配置根命名空间中的 EnvoyFilters ，然后是匹配工作负载命名空间中所有匹配到的 EnvoyFilters。</p></blockquote><h2 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h2><p>注意1：此 API 的某些方面与 Istio 网络子系统以及Envoy XDS API 的内部实现密切相关。虽然EnvoyFilter API本身将保持向后兼容性，但通过此机制提供的任何 envoy 配置都应该在Istio代理版本升级时进行仔细监控，以确保已弃用字段被适当地删除和替换。</p><p>注意2：当多个Envoy Filters 绑定到给定名称空间中相同工作负载时，在创建时间顺序上按顺序处理所有补丁。如果多个Envoy Filter 配置彼此冲突，则行为未定义。</p><p>注意3：要将一个Envoyer Filter 资源应用于系统中的所有工作负载（sidecars 和 gateways），请在配置根命名空间中定义该资源，而不使用 workloadSelector。</p><h2 id="样例"><a href="#样例" class="headerlink" title="样例"></a>样例</h2><h3 id="下面的示例在根命名空间-istio-config-中声明了一个全局默认-EnvoyFilter-资源，它将自定义协议过滤器添加到系统中所有-sidecar-的出站端口-9307-上。该过滤器应该在终止-tcp-proxy-过滤器之前添加以生效。此外，它为网关和-sidecar-中的所有-HTTP-连接设置了30秒的闲置超时时间。"><a href="#下面的示例在根命名空间-istio-config-中声明了一个全局默认-EnvoyFilter-资源，它将自定义协议过滤器添加到系统中所有-sidecar-的出站端口-9307-上。该过滤器应该在终止-tcp-proxy-过滤器之前添加以生效。此外，它为网关和-sidecar-中的所有-HTTP-连接设置了30秒的闲置超时时间。" class="headerlink" title="下面的示例在根命名空间 istio-config 中声明了一个全局默认 EnvoyFilter 资源，它将自定义协议过滤器添加到系统中所有 sidecar 的出站端口 9307 上。该过滤器应该在终止 tcp_proxy 过滤器之前添加以生效。此外，它为网关和 sidecar 中的所有 HTTP 连接设置了30秒的闲置超时时间。"></a>下面的示例在根命名空间 istio-config 中声明了一个全局默认 EnvoyFilter 资源，它将自定义协议过滤器添加到系统中所有 sidecar 的出站端口 9307 上。该过滤器应该在终止 tcp_proxy 过滤器之前添加以生效。此外，它为网关和 sidecar 中的所有 HTTP 连接设置了30秒的闲置超时时间。</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">EnvoyFilter</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">custom-protocol</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">istio-config</span> <span class="comment"># as defined in meshConfig resource.</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">configPatches:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">applyTo:</span> <span class="string">NETWORK_FILTER</span></span><br><span class="line">    <span class="attr">match:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">SIDECAR_OUTBOUND</span> <span class="comment"># will match outbound listeners in all sidecars</span></span><br><span class="line">      <span class="attr">listener:</span></span><br><span class="line">        <span class="attr">portNumber:</span> <span class="number">9307</span></span><br><span class="line">        <span class="attr">filterChain:</span></span><br><span class="line">          <span class="attr">filter:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">&quot;envoy.filters.network.tcp_proxy&quot;</span></span><br><span class="line">    <span class="attr">patch:</span></span><br><span class="line">      <span class="attr">operation:</span> <span class="string">INSERT_BEFORE</span></span><br><span class="line">      <span class="attr">value:</span></span><br><span class="line">        <span class="comment"># This is the full filter config including the name and typed_config section.</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;envoy.extensions.filters.network.mongo_proxy&quot;</span></span><br><span class="line">        <span class="attr">typed_config:</span></span><br><span class="line">          <span class="string">&quot;@type&quot;</span><span class="string">:</span> <span class="string">&quot;type.googleapis.com/envoy.extensions.filters.network.mongo_proxy.v3.MongoProxy&quot;</span></span><br><span class="line">          <span class="string">...</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">applyTo:</span> <span class="string">NETWORK_FILTER</span> <span class="comment"># http connection manager is a filter in Envoy</span></span><br><span class="line">    <span class="attr">match:</span></span><br><span class="line">      <span class="comment"># context omitted so that this applies to both sidecars and gateways</span></span><br><span class="line">      <span class="attr">listener:</span></span><br><span class="line">        <span class="attr">filterChain:</span></span><br><span class="line">          <span class="attr">filter:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">&quot;envoy.filters.network.http_connection_manager&quot;</span></span><br><span class="line">    <span class="attr">patch:</span></span><br><span class="line">      <span class="attr">operation:</span> <span class="string">MERGE</span></span><br><span class="line">      <span class="attr">value:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;envoy.filters.network.http_connection_manager&quot;</span></span><br><span class="line">        <span class="attr">typed_config:</span></span><br><span class="line">          <span class="string">&quot;@type&quot;</span><span class="string">:</span> <span class="string">&quot;type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager&quot;</span></span><br><span class="line">          <span class="attr">common_http_protocol_options:</span></span><br><span class="line">            <span class="attr">idle_timeout:</span> <span class="string">30s</span></span><br></pre></td></tr></table></figure><h3 id="以下示例启用了Envoy的Lua过滤器，用于在bookinfo命名空间中具有标签“app：reviews”的reviews服务pod的服务端口8080上到达的所有入站HTTP调用。lua过滤器调用外部服务internal-org-net-8888，该服务需要envoy中特殊集群定义。此配置还将该集群添加到sidecar中。"><a href="#以下示例启用了Envoy的Lua过滤器，用于在bookinfo命名空间中具有标签“app：reviews”的reviews服务pod的服务端口8080上到达的所有入站HTTP调用。lua过滤器调用外部服务internal-org-net-8888，该服务需要envoy中特殊集群定义。此配置还将该集群添加到sidecar中。" class="headerlink" title="以下示例启用了Envoy的Lua过滤器，用于在bookinfo命名空间中具有标签“app：reviews”的reviews服务pod的服务端口8080上到达的所有入站HTTP调用。lua过滤器调用外部服务internal.org.net:8888，该服务需要envoy中特殊集群定义。此配置还将该集群添加到sidecar中。"></a>以下示例启用了Envoy的Lua过滤器，用于在bookinfo命名空间中具有标签“app：reviews”的reviews服务pod的服务端口8080上到达的所有入站HTTP调用。lua过滤器调用外部服务internal.org.net:8888，该服务需要envoy中特殊集群定义。此配置还将该集群添加到sidecar中。</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">EnvoyFilter</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">reviews-lua</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">bookinfo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">workloadSelector:</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">reviews</span></span><br><span class="line">  <span class="attr">configPatches:</span></span><br><span class="line">    <span class="comment"># The first patch adds the lua filter to the listener/http connection manager</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">applyTo:</span> <span class="string">HTTP_FILTER</span></span><br><span class="line">    <span class="attr">match:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">SIDECAR_INBOUND</span></span><br><span class="line">      <span class="attr">listener:</span></span><br><span class="line">        <span class="attr">portNumber:</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">filterChain:</span></span><br><span class="line">          <span class="attr">filter:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">&quot;envoy.filters.network.http_connection_manager&quot;</span></span><br><span class="line">            <span class="attr">subFilter:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">&quot;envoy.filters.http.router&quot;</span></span><br><span class="line">    <span class="attr">patch:</span></span><br><span class="line">      <span class="attr">operation:</span> <span class="string">INSERT_BEFORE</span></span><br><span class="line">      <span class="attr">value:</span> <span class="comment"># lua filter specification</span></span><br><span class="line">       <span class="attr">name:</span> <span class="string">envoy.filters.http.lua</span></span><br><span class="line">       <span class="attr">typed_config:</span></span><br><span class="line">          <span class="string">&quot;@type&quot;</span><span class="string">:</span> <span class="string">&quot;type.googleapis.com/envoy.extensions.filters.http.lua.v3.Lua&quot;</span></span><br><span class="line">          <span class="attr">inlineCode:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            function envoy_on_request(request_handle)</span></span><br><span class="line"><span class="string">              -- Make an HTTP call to an upstream host with the following headers, body, and timeout.</span></span><br><span class="line"><span class="string">              local headers, body = request_handle:httpCall(</span></span><br><span class="line"><span class="string">               &quot;lua_cluster&quot;,</span></span><br><span class="line"><span class="string">               &#123;</span></span><br><span class="line"><span class="string">                [&quot;:method&quot;] = &quot;POST&quot;,</span></span><br><span class="line"><span class="string">                [&quot;:path&quot;] = &quot;/acl&quot;,</span></span><br><span class="line"><span class="string">                [&quot;:authority&quot;] = &quot;internal.org.net&quot;</span></span><br><span class="line"><span class="string">               &#125;,</span></span><br><span class="line"><span class="string">              &quot;authorize call&quot;,</span></span><br><span class="line"><span class="string">              5000)</span></span><br><span class="line"><span class="string">            end</span></span><br><span class="line"><span class="string"></span>  <span class="comment"># The second patch adds the cluster that is referenced by the lua code</span></span><br><span class="line">  <span class="comment"># cds match is omitted as a new cluster is being added</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">applyTo:</span> <span class="string">CLUSTER</span></span><br><span class="line">    <span class="attr">match:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">SIDECAR_OUTBOUND</span></span><br><span class="line">    <span class="attr">patch:</span></span><br><span class="line">      <span class="attr">operation:</span> <span class="string">ADD</span></span><br><span class="line">      <span class="attr">value:</span> <span class="comment"># cluster specification</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;lua_cluster&quot;</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">STRICT_DNS</span></span><br><span class="line">        <span class="attr">connect_timeout:</span> <span class="number">0.</span><span class="string">5s</span></span><br><span class="line">        <span class="attr">lb_policy:</span> <span class="string">ROUND_ROBIN</span></span><br><span class="line">        <span class="attr">load_assignment:</span></span><br><span class="line">          <span class="attr">cluster_name:</span> <span class="string">lua_cluster</span></span><br><span class="line">          <span class="attr">endpoints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">lb_endpoints:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">endpoint:</span></span><br><span class="line">                <span class="attr">address:</span></span><br><span class="line">                  <span class="attr">socket_address:</span></span><br><span class="line">                    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">                    <span class="attr">address:</span> <span class="string">&quot;internal.org.net&quot;</span></span><br><span class="line">                    <span class="attr">port_value:</span> <span class="number">8888</span></span><br></pre></td></tr></table></figure><h3 id="以下示例覆盖了istio-system命名空间中入口网关上的侦听器中HTTP连接管理器中的某些字段（HTTP闲置超时和X-Forward-For受信任跳数），用于SNI主机app-example-com："><a href="#以下示例覆盖了istio-system命名空间中入口网关上的侦听器中HTTP连接管理器中的某些字段（HTTP闲置超时和X-Forward-For受信任跳数），用于SNI主机app-example-com：" class="headerlink" title="以下示例覆盖了istio-system命名空间中入口网关上的侦听器中HTTP连接管理器中的某些字段（HTTP闲置超时和X-Forward-For受信任跳数），用于SNI主机app.example.com："></a>以下示例覆盖了istio-system命名空间中入口网关上的侦听器中HTTP连接管理器中的某些字段（HTTP闲置超时和X-Forward-For受信任跳数），用于SNI主机app.example.com：</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">EnvoyFilter</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hcm-tweaks</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">istio-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">workloadSelector:</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">istio:</span> <span class="string">ingressgateway</span></span><br><span class="line">  <span class="attr">configPatches:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">applyTo:</span> <span class="string">NETWORK_FILTER</span> <span class="comment"># http connection manager is a filter in Envoy</span></span><br><span class="line">    <span class="attr">match:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">GATEWAY</span></span><br><span class="line">      <span class="attr">listener:</span></span><br><span class="line">        <span class="attr">filterChain:</span></span><br><span class="line">          <span class="attr">sni:</span> <span class="string">app.example.com</span></span><br><span class="line">          <span class="attr">filter:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">&quot;envoy.filters.network.http_connection_manager&quot;</span></span><br><span class="line">    <span class="attr">patch:</span></span><br><span class="line">      <span class="attr">operation:</span> <span class="string">MERGE</span></span><br><span class="line">      <span class="attr">value:</span></span><br><span class="line">        <span class="attr">typed_config:</span></span><br><span class="line">          <span class="string">&quot;@type&quot;</span><span class="string">:</span> <span class="string">&quot;type.googleapis.com/envoy.extensions.filters.network.http_connection_manager.v3.HttpConnectionManager&quot;</span></span><br><span class="line">          <span class="attr">xff_num_trusted_hops:</span> <span class="number">5</span></span><br><span class="line">          <span class="attr">common_http_protocol_options:</span></span><br><span class="line">            <span class="attr">idle_timeout:</span> <span class="string">30s</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="以下示例插入了一个-attributegen-过滤器，该过滤器生成-istio-operationId-属性，该属性由-istio-stats-过滤器使用。filterClass-STATS-编码了这种依赖关系。"><a href="#以下示例插入了一个-attributegen-过滤器，该过滤器生成-istio-operationId-属性，该属性由-istio-stats-过滤器使用。filterClass-STATS-编码了这种依赖关系。" class="headerlink" title="以下示例插入了一个 attributegen 过滤器，该过滤器生成 istio_operationId 属性，该属性由 istio.stats 过滤器使用。filterClass: STATS 编码了这种依赖关系。"></a>以下示例插入了一个 attributegen 过滤器，该过滤器生成 istio_operationId 属性，该属性由 istio.stats 过滤器使用。filterClass: STATS 编码了这种依赖关系。</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">EnvoyFilter</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">reviews-request-operation</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">myns</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">workloadSelector:</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">reviews</span></span><br><span class="line">  <span class="attr">configPatches:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">applyTo:</span> <span class="string">HTTP_FILTER</span></span><br><span class="line">    <span class="attr">match:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">SIDECAR_INBOUND</span></span><br><span class="line">    <span class="attr">patch:</span></span><br><span class="line">      <span class="attr">operation:</span> <span class="string">ADD</span></span><br><span class="line">      <span class="attr">filterClass:</span> <span class="string">STATS</span> <span class="comment"># This filter will run *before* the Istio stats filter.</span></span><br><span class="line">      <span class="attr">value:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">istio.request_operation</span></span><br><span class="line">        <span class="attr">typed_config:</span></span><br><span class="line">         <span class="string">&quot;@type&quot;</span><span class="string">:</span> <span class="string">type.googleapis.com/udpa.type.v1.TypedStruct</span></span><br><span class="line">         <span class="attr">type_url:</span> <span class="string">type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm</span></span><br><span class="line">         <span class="attr">value:</span></span><br><span class="line">           <span class="attr">config:</span></span><br><span class="line">             <span class="attr">configuration:</span> <span class="string">|</span></span><br><span class="line"><span class="string">               &#123;</span></span><br><span class="line"><span class="string">                 &quot;attributes&quot;: [</span></span><br><span class="line"><span class="string">                   &#123;</span></span><br><span class="line"><span class="string">                     &quot;output_attribute&quot;: &quot;istio_operationId&quot;,</span></span><br><span class="line"><span class="string">                     &quot;match&quot;: [</span></span><br><span class="line"><span class="string">                       &#123;</span></span><br><span class="line"><span class="string">                         &quot;value&quot;: &quot;ListReviews&quot;,</span></span><br><span class="line"><span class="string">                         &quot;condition&quot;: &quot;request.url_path == &#x27;/reviews&#x27; &amp;&amp; request.method == &#x27;GET&#x27;&quot;</span></span><br><span class="line"><span class="string">                       &#125;]</span></span><br><span class="line"><span class="string">                   &#125;]</span></span><br><span class="line"><span class="string">               &#125;</span></span><br><span class="line"><span class="string"></span>             <span class="attr">vm_config:</span></span><br><span class="line">               <span class="attr">runtime:</span> <span class="string">envoy.wasm.runtime.null</span></span><br><span class="line">               <span class="attr">code:</span></span><br><span class="line">                 <span class="attr">local:</span> &#123; <span class="attr">inline_string:</span> <span class="string">&quot;envoy.wasm.attributegen&quot;</span> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="以下示例将在myns命名空间中插入一个http-ext-authz过滤器。"><a href="#以下示例将在myns命名空间中插入一个http-ext-authz过滤器。" class="headerlink" title="以下示例将在myns命名空间中插入一个http ext_authz过滤器。"></a>以下示例将在myns命名空间中插入一个http ext_authz过滤器。</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">EnvoyFilter</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myns-ext-authz</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">myns</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">configPatches:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">applyTo:</span> <span class="string">HTTP_FILTER</span></span><br><span class="line">    <span class="attr">match:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">SIDECAR_INBOUND</span></span><br><span class="line">    <span class="attr">patch:</span></span><br><span class="line">      <span class="attr">operation:</span> <span class="string">ADD</span></span><br><span class="line">      <span class="attr">filterClass:</span> <span class="string">AUTHZ</span> <span class="comment"># This filter will run *after* the Istio authz filter.</span></span><br><span class="line">      <span class="attr">value:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">envoy.filters.http.ext_authz</span></span><br><span class="line">        <span class="attr">typed_config:</span></span><br><span class="line">          <span class="string">&quot;@type&quot;</span><span class="string">:</span> <span class="string">type.googleapis.com/envoy.extensions.filters.http.ext_authz.v3.ExtAuthz</span></span><br><span class="line">          <span class="attr">grpc_service:</span></span><br><span class="line">            <span class="attr">envoy_grpc:</span></span><br><span class="line">              <span class="attr">cluster_name:</span> <span class="string">acme-ext-authz</span></span><br><span class="line">            <span class="attr">initial_metadata:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">foo</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">myauth.acme</span> <span class="comment"># required by local ext auth server.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="在-myns-命名空间中的工作负载需要访问一个不接受初始元数据的不同-ext-auth-服务器。由于-proto-合并不能删除字段，因此以下配置使用-REPLACE-操作。如果您不需要继承字段，则-REPLACE-优先于-MERGE。"><a href="#在-myns-命名空间中的工作负载需要访问一个不接受初始元数据的不同-ext-auth-服务器。由于-proto-合并不能删除字段，因此以下配置使用-REPLACE-操作。如果您不需要继承字段，则-REPLACE-优先于-MERGE。" class="headerlink" title="在 myns 命名空间中的工作负载需要访问一个不接受初始元数据的不同 ext_auth 服务器。由于 proto 合并不能删除字段，因此以下配置使用 REPLACE 操作。如果您不需要继承字段，则 REPLACE 优先于 MERGE。"></a>在 myns 命名空间中的工作负载需要访问一个不接受初始元数据的不同 ext_auth 服务器。由于 proto 合并不能删除字段，因此以下配置使用 REPLACE 操作。如果您不需要继承字段，则 REPLACE 优先于 MERGE。</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">EnvoyFilter</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mysvc-ext-authz</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">myns</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">workloadSelector:</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">mysvc</span></span><br><span class="line">  <span class="attr">configPatches:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">applyTo:</span> <span class="string">HTTP_FILTER</span></span><br><span class="line">    <span class="attr">match:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">SIDECAR_INBOUND</span></span><br><span class="line">    <span class="attr">patch:</span></span><br><span class="line">      <span class="attr">operation:</span> <span class="string">REPLACE</span></span><br><span class="line">      <span class="attr">value:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">envoy.filters.http.ext_authz</span></span><br><span class="line">        <span class="attr">typed_config:</span></span><br><span class="line">          <span class="string">&quot;@type&quot;</span><span class="string">:</span> <span class="string">type.googleapis.com/envoy.extensions.filters.http.ext_authz.v3.ExtAuthz</span></span><br><span class="line">          <span class="attr">grpc_service:</span></span><br><span class="line">            <span class="attr">envoy_grpc:</span></span><br><span class="line">              <span class="attr">cluster_name:</span> <span class="string">acme-ext-authz-alt</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="以下示例为所有入站sidecar-HTTP-请求部署了一个-Wasm-扩展。"><a href="#以下示例为所有入站sidecar-HTTP-请求部署了一个-Wasm-扩展。" class="headerlink" title="以下示例为所有入站sidecar HTTP 请求部署了一个 Wasm 扩展。"></a>以下示例为所有入站sidecar HTTP 请求部署了一个 Wasm 扩展。</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">EnvoyFilter</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">wasm-example</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">myns</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">configPatches:</span></span><br><span class="line">  <span class="comment"># The first patch defines a named Wasm extension and provides a URL to fetch Wasm binary from,</span></span><br><span class="line">  <span class="comment"># and the binary configuration. It should come before the next patch that applies it.</span></span><br><span class="line">  <span class="comment"># This resource is visible to all proxies in the namespace &quot;myns&quot;. It is possible to provide</span></span><br><span class="line">  <span class="comment"># multiple definitions for the same name &quot;my-wasm-extension&quot; in multiple namespaces. We recommend that:</span></span><br><span class="line">  <span class="comment"># - if overriding is desired, then the root level definition can be overriden per namespace with REPLACE.</span></span><br><span class="line">  <span class="comment"># - if overriding is not desired, then the name should be qualified with the namespace &quot;myns/my-wasm-extension&quot;,</span></span><br><span class="line">  <span class="comment">#   to avoid accidental name collisions.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">applyTo:</span> <span class="string">EXTENSION_CONFIG</span></span><br><span class="line">    <span class="attr">patch:</span></span><br><span class="line">      <span class="attr">operation:</span> <span class="string">ADD</span> <span class="comment"># REPLACE is also supported, and would override a cluster level resource with the same name.</span></span><br><span class="line">      <span class="attr">value:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">my-wasm-extension</span></span><br><span class="line">        <span class="attr">typed_config:</span></span><br><span class="line">          <span class="string">&quot;@type&quot;</span><span class="string">:</span> <span class="string">type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm</span></span><br><span class="line">          <span class="attr">config:</span></span><br><span class="line">            <span class="attr">root_id:</span> <span class="string">my-wasm-root-id</span></span><br><span class="line">            <span class="attr">vm_config:</span></span><br><span class="line">              <span class="attr">vm_id:</span> <span class="string">my-wasm-vm-id</span></span><br><span class="line">              <span class="attr">runtime:</span> <span class="string">envoy.wasm.runtime.v8</span></span><br><span class="line">              <span class="attr">code:</span></span><br><span class="line">                <span class="attr">remote:</span></span><br><span class="line">                  <span class="attr">http_uri:</span></span><br><span class="line">                    <span class="attr">uri:</span> <span class="string">http://my-wasm-binary-uri</span></span><br><span class="line">            <span class="attr">configuration:</span></span><br><span class="line">              <span class="string">&quot;@type&quot;</span><span class="string">:</span> <span class="string">&quot;type.googleapis.com/google.protobuf.StringValue&quot;</span></span><br><span class="line">              <span class="attr">value:</span> <span class="string">|</span></span><br><span class="line"><span class="string">                &#123;&#125;</span></span><br><span class="line"><span class="string"></span>  <span class="comment"># The second patch instructs to apply the above Wasm filter to the listener/http connection manager.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">applyTo:</span> <span class="string">HTTP_FILTER</span></span><br><span class="line">    <span class="attr">match:</span></span><br><span class="line">      <span class="attr">listener:</span></span><br><span class="line">        <span class="attr">filterChain:</span></span><br><span class="line">          <span class="attr">filter:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">envoy.filters.network.http_connection_manager</span></span><br><span class="line">            <span class="attr">subFilter:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">envoy.filters.http.router</span></span><br><span class="line">    <span class="attr">patch:</span></span><br><span class="line">      <span class="attr">operation:</span> <span class="string">INSERT_BEFORE</span></span><br><span class="line">      <span class="attr">value:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">my-wasm-extension</span> <span class="comment"># This must match the name above</span></span><br><span class="line">        <span class="attr">config_discovery:</span></span><br><span class="line">          <span class="attr">config_source:</span></span><br><span class="line">            <span class="attr">ads:</span> &#123;&#125;</span><br><span class="line">          <span class="attr">type_urls:</span> [<span class="string">&quot;type.googleapis.com/envoy.extensions.filters.http.wasm.v3.Wasm&quot;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="以下示例为所有代理添加了一个-Wasm-服务扩展，使用本地可用的-Wasm-文件。单例-Wasm-扩展用于在执行-Wasm-过滤器的工作程序之间维护共享状态。例如，本地速率限制扩展将依赖于单例来限制所有工作程序中的请求。另一个示例是授权-Wasm-扩展可以使用单例来维护帐户数据库。"><a href="#以下示例为所有代理添加了一个-Wasm-服务扩展，使用本地可用的-Wasm-文件。单例-Wasm-扩展用于在执行-Wasm-过滤器的工作程序之间维护共享状态。例如，本地速率限制扩展将依赖于单例来限制所有工作程序中的请求。另一个示例是授权-Wasm-扩展可以使用单例来维护帐户数据库。" class="headerlink" title="以下示例为所有代理添加了一个 Wasm 服务扩展，使用本地可用的 Wasm 文件。单例 Wasm 扩展用于在执行 Wasm 过滤器的工作程序之间维护共享状态。例如，本地速率限制扩展将依赖于单例来限制所有工作程序中的请求。另一个示例是授权 Wasm 扩展可以使用单例来维护帐户数据库。"></a>以下示例为所有代理添加了一个 Wasm 服务扩展，使用本地可用的 Wasm 文件。单例 Wasm 扩展用于在执行 Wasm 过滤器的工作程序之间维护共享状态。例如，本地速率限制扩展将依赖于单例来限制所有工作程序中的请求。另一个示例是授权 Wasm 扩展可以使用单例来维护帐户数据库。</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">EnvoyFilter</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">listener-filter-example</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">myns</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">configPatches:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">applyTo:</span> <span class="string">LISTENER_FILTER</span></span><br><span class="line">    <span class="attr">patch:</span></span><br><span class="line">      <span class="attr">operation:</span> <span class="string">MERGE</span></span><br><span class="line">      <span class="attr">value:</span></span><br><span class="line">        <span class="attr">bootstrap_extensions:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">envoy.bootstrap.wasm</span></span><br><span class="line">          <span class="attr">typed_config:</span></span><br><span class="line">            <span class="string">&quot;@type&quot;</span><span class="string">:</span> <span class="string">type.googleapis.com/envoy.extensions.wasm.v3.WasmService</span></span><br><span class="line">            <span class="attr">singleton:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">config:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">my_plugin</span></span><br><span class="line">              <span class="attr">configuration:</span></span><br><span class="line">                <span class="string">&quot;@type&quot;</span><span class="string">:</span> <span class="string">type.googleapis.com/google.protobuf.StringValue</span></span><br><span class="line">                <span class="attr">value:</span> <span class="string">|</span></span><br><span class="line"><span class="string">                  &#123;&#125;</span></span><br><span class="line"><span class="string"></span>              <span class="attr">vm_config:</span></span><br><span class="line">                <span class="attr">runtime:</span> <span class="string">&quot;envoy.wasm.runtime.v8&quot;</span></span><br><span class="line">                <span class="attr">code:</span></span><br><span class="line">                  <span class="attr">local:</span></span><br><span class="line">                    <span class="attr">filename:</span> <span class="string">&quot;/etc/envoy_filter_http_wasm_example.wasm&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="以下示例在-envoy-filters-listener-tls-inspector-之前插入了一个-envoy-filters-listener-proxy-protocol-监听器过滤器。"><a href="#以下示例在-envoy-filters-listener-tls-inspector-之前插入了一个-envoy-filters-listener-proxy-protocol-监听器过滤器。" class="headerlink" title="以下示例在 envoy.filters.listener.tls_inspector 之前插入了一个 envoy.filters.listener.proxy_protocol 监听器过滤器。"></a>以下示例在 envoy.filters.listener.tls_inspector 之前插入了一个 envoy.filters.listener.proxy_protocol 监听器过滤器。</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">EnvoyFilter</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">wasm-service</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">myns</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">configPatches:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">applyTo:</span> <span class="string">LISTENER_FILTER</span></span><br><span class="line">    <span class="attr">match:</span></span><br><span class="line">      <span class="attr">context:</span> <span class="string">SIDECAR_INBOUND</span> <span class="comment"># will match outbound listeners in all sidecars</span></span><br><span class="line">      <span class="attr">listener:</span></span><br><span class="line">        <span class="attr">portNumber:</span> <span class="number">15006</span></span><br><span class="line">        <span class="attr">listenerFilter:</span> <span class="string">&quot;envoy.filters.listener.tls_inspector&quot;</span></span><br><span class="line">    <span class="attr">patch:</span></span><br><span class="line">      <span class="attr">operation:</span> <span class="string">INSERT_BEFORE</span></span><br><span class="line">      <span class="attr">value:</span></span><br><span class="line">        <span class="comment"># This is the full filter config including the name and typed_config section.</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;envoy.filters.listener.proxy_protocol&quot;</span></span><br><span class="line">        <span class="attr">typed_config:</span></span><br><span class="line">          <span class="string">&quot;@type&quot;</span><span class="string">:</span> <span class="string">&quot;type.googleapis.com/envoy.extensions.filters.listener.proxy_protocol.v3.ProxyProtocol&quot;</span></span><br></pre></td></tr></table></figure><h3 id="以下示例匹配为判断请求来源是否是test-com，然后对应添加project-version-header"><a href="#以下示例匹配为判断请求来源是否是test-com，然后对应添加project-version-header" class="headerlink" title="以下示例匹配为判断请求来源是否是test.com，然后对应添加project-version header"></a>以下示例匹配为判断请求来源是否是test.com，然后对应添加project-version header</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">EnvoyFilter</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">header-envoy-filter</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">configPatches:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">applyTo:</span> <span class="string">HTTP_FILTER</span></span><br><span class="line">      <span class="attr">match:</span></span><br><span class="line">        <span class="attr">context:</span> <span class="string">SIDECAR_INBOUND</span></span><br><span class="line">        <span class="attr">listener:</span></span><br><span class="line">          <span class="attr">filterChain:</span></span><br><span class="line">            <span class="attr">filter:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">envoy.filters.network.http_connection_manager</span></span><br><span class="line">              <span class="attr">subFilter:</span></span><br><span class="line">                <span class="attr">name:</span> <span class="string">envoy.filters.http.router</span></span><br><span class="line">      <span class="attr">patch:</span></span><br><span class="line">        <span class="attr">operation:</span> <span class="string">INSERT_BEFORE</span></span><br><span class="line">        <span class="attr">value:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">envoy.filters.http.lua</span></span><br><span class="line">          <span class="attr">typed_config:</span></span><br><span class="line">            <span class="string">&#x27;@type&#x27;</span><span class="string">:</span> <span class="string">type.googleapis.com/envoy.extensions.filters.http.lua.v3.Lua</span></span><br><span class="line">            <span class="attr">inlineCode:</span> <span class="string">|</span></span><br><span class="line"><span class="string">              function envoy_on_request(request_handle)</span></span><br><span class="line"><span class="string">                local authority = request_handle:headers():get(&quot;:authority&quot;)</span></span><br><span class="line"><span class="string">                local version_header = request_handle:headers():get(&quot;project-version&quot;)</span></span><br><span class="line"><span class="string">                if authority == &quot;testaaa.com&quot; then</span></span><br><span class="line"><span class="string">                    if version_header == nil then</span></span><br><span class="line"><span class="string">                        request_handle:headers():add(&quot;project-version&quot;, &quot;master&quot;)</span></span><br><span class="line"><span class="string">                    end</span></span><br><span class="line"><span class="string">                elseif authority == &#x27;testbbb.com&#x27; then</span></span><br><span class="line"><span class="string">                    if version_header == nil then</span></span><br><span class="line"><span class="string">                        request_handle:headers():add(&quot;project-version&quot;, &quot;master&quot;)</span></span><br><span class="line"><span class="string">                    end</span></span><br><span class="line"><span class="string">                end</span></span><br><span class="line"><span class="string">              end</span></span><br><span class="line"><span class="string"></span>  <span class="attr">workloadSelector:</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">orange</span></span><br></pre></td></tr></table></figure><h2 id="EnvoyFilter"><a href="#EnvoyFilter" class="headerlink" title="EnvoyFilter"></a>EnvoyFilter</h2><p>EnvoyFilter 提供了一种机制，可以定制由 Istio Pilot 生成的 Envoy 配置。</p><table><thead><tr><th>Field</th><th>Type</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>workloadSelector</code></td><td><code>WorkloadSelector</code></td><td>用于选择应用此补丁配置的特定Pods&#x2F;VMs集合的标准。如果省略，则该配置中的所有补丁将应用于同一命名空间中的所有工作负载实例。如果省略，则<code>EnvoyFilter</code>补丁将应用于同一命名空间中的所有工作负载。如果在配置根命名空间中存在<code>EnvoyFilter</code>，则它将被应用于任何命名空间中适用的工作负载。</td><td>No</td></tr><tr><td><code>configPatches</code></td><td><code>EnvoyConfigObjectPatch[]</code></td><td>一个或多个带有匹配条件的补丁。</td><td>Yes</td></tr><tr><td><code>priority</code></td><td><code>int32</code></td><td>优先级定义了在上下文中应用补丁集的顺序。当一个补丁依赖于另一个补丁时，补丁应用的顺序非常重要。API 提供了两种主要方式来排序补丁。根命名空间中的补丁集会在工作负载命名空间中的补丁集之前被应用。同一补丁集内部的修复程序按照它们在 <code>configPatches</code> 列表中出现的顺序进行处理。优先级默认值为 0，范围为 [min-int32, max-int32]。具有负优先级的修复程序集将在默认值之前处理；具有正优先级的修复程序集将在默认值之后处理。建议从10倍数开始设置优先级以留出插入更多项所需的空间。 补丁集按以下升序键排序：优先级、创建时间、完全限定资源名称。</td><td>No</td></tr></tbody></table><h2 id="EnvoyFilter-ProxyMatch"><a href="#EnvoyFilter-ProxyMatch" class="headerlink" title="EnvoyFilter.ProxyMatch"></a>EnvoyFilter.ProxyMatch</h2><p>要匹配的代理的一个或多个属性。</p><table><thead><tr><th>Field</th><th>Type</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>proxyVersion</code></td><td><code>string</code></td><td>一个使用特定版本的Istio代理选择代理的golang正则表达式（RE2）格式。给定代理的Istio版本是从节点元数据字段<code>ISTIO_VERSION</code>中获取的，该字段由连接到Pilot时提供的代理提供。此值作为环境变量（<code>ISTIO_META_ISTIO_VERSION</code>）嵌入在Istio代理docker镜像中。自定义代理实现应提供此元数据变量以利用Istio版本检查选项。</td><td>No</td></tr><tr><td><code>metadata</code></td><td><code>map&lt;string, string&gt;</code></td><td>连接到Istio Pilot时，根据代理提供的节点元数据进行匹配。请注意，虽然Envoy的节点元数据是Struct类型，但Pilot仅处理字符串键值对。元数据中指定的所有键都必须与确切值匹配。如果任何指定的键不存在或值不匹配，则匹配将失败。</td><td>No</td></tr></tbody></table><h2 id="EnvoyFilter-ClusterMatch"><a href="#EnvoyFilter-ClusterMatch" class="headerlink" title="EnvoyFilter.ClusterMatch"></a>EnvoyFilter.ClusterMatch</h2><p>必须满足 ClusterMatch 中指定的条件，才能将补丁应用于集群。</p><table><thead><tr><th>Field</th><th>Type</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>portNumber</code></td><td><code>uint32</code></td><td>生成此集群的服务端口。如果省略，则适用于任何端口的集群。<strong>注意：</strong>对于入站集群，它是服务目标端口。</td><td>No</td></tr><tr><td><code>service</code></td><td><code>string</code></td><td>此集群的完全限定服务名称。如果省略，则适用于任何服务的集群。对于通过服务条目定义的服务，服务名称与在服务条目中定义的主机相同。<strong>注意：</strong> 对于入站集群，此项将被忽略。</td><td>No</td></tr><tr><td><code>subset</code></td><td><code>string</code></td><td>与服务相关联的子集。如果省略，则适用于任何服务子集的群集。</td><td>No</td></tr><tr><td><code>name</code></td><td><code>string</code></td><td>要匹配的集群的确切名称。要按名称匹配特定集群（例如内部生成的“Passthrough”集群），请将clusterMatch中除名称以外的所有字段留空。</td><td>No</td></tr></tbody></table><h2 id="EnvoyFilter-RouteConfigurationMatch"><a href="#EnvoyFilter-RouteConfigurationMatch" class="headerlink" title="EnvoyFilter.RouteConfigurationMatch"></a>EnvoyFilter.RouteConfigurationMatch</h2><p>必须满足 RouteConfigurationMatch 中指定的条件，才能将补丁应用于路由配置对象或路由配置中特定的虚拟主机。</p><table><thead><tr><th>Field</th><th>Type</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>portNumber</code></td><td><code>uint32</code></td><td>生成此路由配置的服务端口号或网关服务器端口号。如果省略，则适用于所有端口的路由配置。</td><td>No</td></tr><tr><td><code>portName</code></td><td><code>string</code></td><td>仅适用于GATEWAY上下文。生成此路由配置的网关服务器端口名称。</td><td>No</td></tr><tr><td><code>gateway</code></td><td><code>string</code></td><td>此路由配置生成的 Istio 网关配置的命名空间&#x2F;名称。仅适用于上下文为 GATEWAY 的情况。应采用命名空间&#x2F;名称格式。与 <code>portNumber</code> 和 <code>portName</code> 结合使用，以准确选择网关配置对象中特定 HTTPS 服务器的 Envoy 路由配置。</td><td>No</td></tr><tr><td><code>vhost</code></td><td><code>VirtualHostMatch</code></td><td>在路由配置中匹配特定的虚拟主机，并将补丁应用于该虚拟主机。</td><td>No</td></tr><tr><td><code>name</code></td><td><code>string</code></td><td>要匹配的路由配置名称。可以使用名称来匹配特定的路由配置，例如所有 sidecar 的内部生成的 <code>http_proxy</code> 路由配置。</td><td>No</td></tr></tbody></table><h2 id="EnvoyFilter-ListenerMatch"><a href="#EnvoyFilter-ListenerMatch" class="headerlink" title="EnvoyFilter.ListenerMatch"></a>EnvoyFilter.ListenerMatch</h2><p>指定在监听器匹配中的条件必须满足，才能将补丁应用于特定监听器上的所有过滤器链或监听器内的特定过滤器链。</p><table><thead><tr><th>Field</th><th>Type</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>portNumber</code></td><td><code>uint32</code></td><td>服务端口&#x2F;网关端口，用于发送&#x2F;接收流量。如果未指定，则匹配所有侦听器。尽管为实例&#x2F;pod 端口生成了入站侦听器，但只应使用服务端口来匹配侦听器。</td><td>No</td></tr><tr><td><code>filterChain</code></td><td><code>FilterChainMatch</code></td><td>在监听器中匹配特定的过滤器链。如果指定了，则补丁将应用于过滤器链（如果指定了特定的过滤器）而不是应用于监听器中的其他过滤器链。</td><td>No</td></tr><tr><td><code>listenerFilter</code></td><td><code>string</code></td><td>匹配特定的监听器过滤器。如果指定，则补丁将应用于监听器过滤器。</td><td>No</td></tr><tr><td><code>name</code></td><td><code>string</code></td><td>按名称匹配特定的监听器。Pilot 生成的侦听器通常以 IP:Port 命名。</td><td>No</td></tr></tbody></table><h2 id="EnvoyFilter-Patch"><a href="#EnvoyFilter-Patch" class="headerlink" title="EnvoyFilter.Patch"></a>EnvoyFilter.Patch</h2><p>Patch指定了应如何修改所选对象。</p><table><thead><tr><th>Field</th><th>Type</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>operation</code></td><td><code>Operation</code></td><td>确定如何应用补丁。</td><td>No</td></tr><tr><td><code>value</code></td><td><code>Struct</code></td><td>被修补对象的 JSON 配置。这将使用 proto 合并语义与路径中现有的 proto 进行合并。</td><td>No</td></tr><tr><td><code>filterClass</code></td><td><code>FilterClass</code></td><td>确定过滤器插入顺序。</td><td>No</td></tr></tbody></table><h2 id="EnvoyFilter-EnvoyConfigObjectMatch"><a href="#EnvoyFilter-EnvoyConfigObjectMatch" class="headerlink" title="EnvoyFilter.EnvoyConfigObjectMatch"></a>EnvoyFilter.EnvoyConfigObjectMatch</h2><p>在为给定代理生成的配置应用补丁之前，必须满足一个或多个匹配条件。</p><table><thead><tr><th>Field</th><th>Type</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>context</code></td><td><code>PatchContext</code></td><td>要匹配的特定配置生成上下文。Istio Pilot在网关、进入sidecar的流量和从sidecar出发的流量的上下文中生成envoy配置。</td><td>No</td></tr><tr><td><code>proxy</code></td><td><code>ProxyMatch</code></td><td>根据代理关联的属性进行匹配。</td><td>No</td></tr><tr><td><code>listener</code></td><td><code>ListenerMatch (oneof)</code></td><td>根据 Envoy 监听器属性进行匹配。</td><td>No</td></tr><tr><td><code>routeConfiguration</code></td><td><code>RouteConfigurationMatch (oneof)</code></td><td>在 Envoy 的 HTTP 路由配置属性上匹配。</td><td>No</td></tr><tr><td><code>cluster</code></td><td><code>ClusterMatch (oneof)</code></td><td>根据 Envoy 集群属性进行匹配。</td><td>No</td></tr></tbody></table><h2 id="EnvoyFilter-EnvoyConfigObjectPatch"><a href="#EnvoyFilter-EnvoyConfigObjectPatch" class="headerlink" title="EnvoyFilter.EnvoyConfigObjectPatch"></a>EnvoyFilter.EnvoyConfigObjectPatch</h2><p>需要对各种使者配置对象进行更改。</p><table><thead><tr><th>Field</th><th>Type</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>applyTo</code></td><td><code>ApplyTo</code></td><td>指定在Envoy配置中应用补丁的位置。匹配条件应基于applyTo选择适当的对象。例如，具有“HTTP_FILTER”的applyTo预计会在侦听器上具有匹配条件，在<code>envoy.filters.network.http_connection_manager</code>上选择网络过滤器，并在相对于插入操作的HTTP过滤器上进行子过滤器选择。同样，对于“CLUSTER”的applyTo应该在集群上（如果提供了）进行匹配，而不是在侦听器上进行匹配。</td><td>No</td></tr><tr><td><code>match</code></td><td><code>EnvoyConfigObjectMatch</code></td><td>在侦听器&#x2F;路由配置&#x2F;集群上匹配。</td><td>No</td></tr><tr><td><code>patch</code></td><td><code>Patch</code></td><td>需要在操作过程中应用的补丁。</td><td>No</td></tr></tbody></table><h2 id="EnvoyFilter-RouteConfigurationMatch-RouteMatch"><a href="#EnvoyFilter-RouteConfigurationMatch-RouteMatch" class="headerlink" title="EnvoyFilter.RouteConfigurationMatch.RouteMatch"></a>EnvoyFilter.RouteConfigurationMatch.RouteMatch</h2><p>在路由配置中，匹配虚拟主机内的特定路由。</p><table><thead><tr><th>Field</th><th>Type</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>name</code></td><td><code>string</code></td><td>默认生成的路由对象名称为 default。使用虚拟服务生成的路由对象将携带虚拟服务 HTTP 路由中使用的名称。</td><td>No</td></tr><tr><td><code>action</code></td><td><code>Action</code></td><td>将路由与特定的操作类型匹配。</td><td>No</td></tr></tbody></table><h2 id="EnvoyFilter-RouteConfigurationMatch-VirtualHostMatch"><a href="#EnvoyFilter-RouteConfigurationMatch-VirtualHostMatch" class="headerlink" title="EnvoyFilter.RouteConfigurationMatch.VirtualHostMatch"></a>EnvoyFilter.RouteConfigurationMatch.VirtualHostMatch</h2><p>在路由配置中匹配特定的虚拟主机。</p><table><thead><tr><th>Field</th><th>Type</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>name</code></td><td><code>string</code></td><td>Istio生成的VirtualHosts对象命名为host:port，其中host通常对应于VirtualService的主机字段或注册表中服务的主机名。</td><td>No</td></tr><tr><td><code>route</code></td><td><code>RouteMatch</code></td><td>在虚拟主机中匹配特定路由。</td><td>No</td></tr></tbody></table><h2 id="EnvoyFilter-ListenerMatch-FilterChainMatch"><a href="#EnvoyFilter-ListenerMatch-FilterChainMatch" class="headerlink" title="EnvoyFilter.ListenerMatch.FilterChainMatch"></a>EnvoyFilter.ListenerMatch.FilterChainMatch</h2><p>对于具有多个过滤器链的侦听器（例如，带有宽松mTLS的sidecar上的入站侦听器，具有多个SNI匹配项的网关侦听器），可以使用过滤器链匹配来选择要修补的特定过滤器链。</p><table><thead><tr><th>Field</th><th>Type</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>name</code></td><td><code>string</code></td><td>分配给过滤器链的名称。</td><td>No</td></tr><tr><td><code>sni</code></td><td><code>string</code></td><td>过滤器链匹配条件使用的SNI值。如果过滤器链没有SNI匹配，则此条件将评估为false。</td><td>No</td></tr><tr><td><code>transportProtocol</code></td><td><code>string</code></td><td>仅适用于SIDECAR_INBOUND上下文。如果非空，则在确定过滤器链匹配时要考虑的传输协议。当tls_inspector监听器过滤器检测到新连接时，将比较此值与新连接的传输协议。<br><br>接受的值包括：<br><br>raw_buffer-默认情况下，在未检测到传输协议时使用。<br>tls-当TLS协议被TLS检查器检测到时设置。</td><td>No</td></tr><tr><td><code>applicationProtocols</code></td><td><code>string</code></td><td>仅适用于sidecar。如果非空，则是一组以逗号分隔的应用程序协议，用于确定过滤器链匹配时考虑的内容。当由诸如http_inspector之类的侦听器过滤器检测到新连接时，将比较此值与新连接的应用程序协议。<br><br>接受的值包括：h2、http&#x2F;1.1、http&#x2F;1.0</td><td>No</td></tr><tr><td><code>filter</code></td><td><code>FilterMatch</code></td><td>要应用补丁的特定过滤器名称。将其设置为envoy.filters.network.http_connection_manager以添加过滤器或对HTTP连接管理器应用补丁。</td><td>No</td></tr><tr><td><code>destinationPort</code></td><td><code>uint32</code></td><td>destination_port” 值是过滤器链匹配条件中使用的值。如果过滤器链没有“destination_port”匹配，则此条件将评估为 false。</td><td>No</td></tr></tbody></table><h2 id="EnvoyFilter-ListenerMatch-FilterMatch"><a href="#EnvoyFilter-ListenerMatch-FilterMatch" class="headerlink" title="EnvoyFilter.ListenerMatch.FilterMatch"></a>EnvoyFilter.ListenerMatch.FilterMatch</h2><p>在过滤器链中匹配特定过滤器的条件。</p><table><thead><tr><th>Field</th><th>Type</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>name</code></td><td><code>string</code></td><td>要匹配的过滤器名称。对于标准Envoy过滤器，应使用规范化的过滤器名称。</td><td>No</td></tr><tr><td><code>subFilter</code></td><td><code>SubFilterMatch</code></td><td>此过滤器中匹配的下一级过滤器。通常用于HTTP连接管理器过滤器和Thrift过滤器。</td><td>No</td></tr></tbody></table><h2 id="EnvoyFilter-ListenerMatch-SubFilterMatch"><a href="#EnvoyFilter-ListenerMatch-SubFilterMatch" class="headerlink" title="EnvoyFilter.ListenerMatch.SubFilterMatch"></a>EnvoyFilter.ListenerMatch.SubFilterMatch</h2><p>在另一个过滤器中匹配特定过滤器的条件。该字段通常用于在envoy.filters.network.http_connection_manager网络过滤器内匹配HTTP过滤器。这也适用于thrift过滤器。</p><table><thead><tr><th>Field</th><th>Type</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td><code>name</code></td><td><code>string</code></td><td>要匹配的过滤器名称。</td><td>No</td></tr></tbody></table><h2 id="EnvoyFilter-RouteConfigurationMatch-RouteMatch-Action"><a href="#EnvoyFilter-RouteConfigurationMatch-RouteMatch-Action" class="headerlink" title="EnvoyFilter.RouteConfigurationMatch.RouteMatch.Action"></a>EnvoyFilter.RouteConfigurationMatch.RouteMatch.Action</h2><p>Action” 指的是当 HTTP 路由匹配时 Envoy 所采取的路由行动。</p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>ANY</code></td><td>所有三个路线行动</td></tr><tr><td><code>ROUTE</code></td><td>将流量路由到一个集群&#x2F;加权集群。</td></tr><tr><td><code>REDIRECT</code></td><td>重定向请求。</td></tr><tr><td><code>DIRECT_RESPONSE</code></td><td>直接回复请求并附带特定有效载荷。</td></tr></tbody></table><h2 id="EnvoyFilter-Patch-Operation"><a href="#EnvoyFilter-Patch-Operation" class="headerlink" title="EnvoyFilter.Patch.Operation"></a>EnvoyFilter.Patch.Operation</h2><p>操作表示如何将补丁应用于所选配置。</p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>INVALID</code></td><td></td></tr><tr><td><code>MERGE</code></td><td>使用 proto 合并语义将提供的配置与生成的配置合并。如果您要完全指定配置，请使用 REPLACE。</td></tr><tr><td><code>ADD</code></td><td>将提供的配置添加到现有列表中（侦听器、集群、虚拟主机、网络过滤器或HTTP过滤器）。当applyTo设置为ROUTE_CONFIGURATION或HTTP_ROUTE时，此操作将被忽略。</td></tr><tr><td><code>REMOVE</code></td><td>从列表中删除所选对象（侦听器、集群、虚拟主机、网络过滤器、路由或HTTP过滤器）。不需要指定值。当applyTo设置为ROUTE_CONFIGURATION或HTTP_ROUTE时，此操作将被忽略。</td></tr><tr><td><code>INSERT_BEFORE</code></td><td>对命名对象数组进行插入操作。此操作通常仅在过滤器或路由的上下文中有用，其中元素的顺序很重要。路由应基于最具体匹配标准从高到低排序，因为选择第一个匹配元素。对于集群和虚拟主机，数组中元素的顺序并不重要。在所选过滤器或子过滤器之前插入。如果未选择任何过滤器，则指定的过滤器将被插入到列表的开头。</td></tr><tr><td><code>INSERT_AFTER</code></td><td>对命名对象数组进行插入操作。此操作通常仅在过滤器或路由的上下文中有用，其中元素的顺序很重要。路由应基于最具体匹配标准从高到低排序，因为选择第一个匹配元素。对于集群和虚拟主机，数组中元素的顺序并不重要。在所选过滤器或子过滤器之后插入。如果未选择任何过滤器，则指定的过滤器将被插入到列表末尾。</td></tr><tr><td><code>INSERT_FIRST</code></td><td>对命名对象数组进行插入操作。此操作通常仅在过滤器或路由的上下文中有用，其中元素的顺序很重要。路由应基于最具体匹配标准从高到低排序，因为选择第一个匹配元素。对于集群和虚拟主机，数组中元素的顺序并不重要。根据所选过滤器的存在与否，在列表中首先插入。当您希望根据Match子句中指定的匹配条件将筛选器放在列表中的第一位时，这是特别有用的。</td></tr><tr><td><code>REPLACE</code></td><td>用新内容替换命名过滤器的内容。REPLACE操作仅适用于HTTP_FILTER和NETWORK_FILTER。如果未找到命名过滤器，则此操作无效。</td></tr></tbody></table><h2 id="EnvoyFilter-Patch-FilterClass"><a href="#EnvoyFilter-Patch-FilterClass" class="headerlink" title="EnvoyFilter.Patch.FilterClass"></a>EnvoyFilter.Patch.FilterClass</h2><p>FilterClass 确定过滤器在与控制平面隐式插入的过滤器相对的过滤器链中的插入点。它与 ADD 操作一起使用。这是添加过滤器的首选插入机制，而不是 INSERT_* 操作，因为这些操作依赖于可能不稳定的过滤器名称。如果您的过滤器依赖于或影响了过滤器链中另一个过滤器的功能，则需要注意过滤器排序。在一个 FilterClass 中，按处理顺序插入各个 filter 。</p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>UNSPECIFIED</code></td><td>控制平面决定在哪里插入过滤器。如果该过滤器独立于其他过滤器，请不要指定FilterClass。</td></tr><tr><td><code>AUTHN</code></td><td>在 Istio 认证过滤器之后插入过滤器。</td></tr><tr><td><code>AUTHZ</code></td><td>在 Istio 授权过滤器之后插入过滤器。</td></tr><tr><td><code>STATS</code></td><td>在 Istio 统计过滤器之前插入过滤器。</td></tr></tbody></table><h2 id="EnvoyFilter-ApplyTo"><a href="#EnvoyFilter-ApplyTo" class="headerlink" title="EnvoyFilter.ApplyTo"></a>EnvoyFilter.ApplyTo</h2><p>ApplyTo指定了在Envoy配置中应该应用给定补丁的位置。</p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>INVALID</code></td><td></td></tr><tr><td><code>LISTENER</code></td><td>将补丁应用到监听器。</td></tr><tr><td><code>FILTER_CHAIN</code></td><td>将补丁应用于过滤器链。</td></tr><tr><td><code>NETWORK_FILTER</code></td><td>将补丁应用于网络过滤器链，以修改现有的过滤器或添加新的过滤器。</td></tr><tr><td><code>HTTP_FILTER</code></td><td>将补丁应用于HTTP连接管理器中的HTTP过滤器链，以修改现有过滤器或添加新的过滤器。</td></tr><tr><td><code>ROUTE_CONFIGURATION</code></td><td>将补丁应用于HTTP连接管理器中的路由配置（rds输出）。这不适用于虚拟主机。目前，仅允许在路由配置对象上执行MERGE操作。</td></tr><tr><td><code>VIRTUAL_HOST</code></td><td>将补丁应用于路由配置内的虚拟主机。</td></tr><tr><td><code>HTTP_ROUTE</code></td><td>将补丁应用于路由配置中匹配的虚拟主机内的路由对象。</td></tr><tr><td><code>CLUSTER</code></td><td>将补丁应用于 CDS 输出中的集群。也可用于添加新的集群。</td></tr><tr><td><code>EXTENSION_CONFIG</code></td><td>将补丁应用于或在 ECDS 输出中添加扩展配置。请注意，ECDS 仅受 HTTP 过滤器支持。</td></tr><tr><td><code>BOOTSTRAP</code></td><td>将补丁应用于引导配置。</td></tr><tr><td><code>LISTENER_FILTER</code></td><td>将补丁应用于监听器过滤器。</td></tr></tbody></table><h2 id="EnvoyFilter-PatchContext"><a href="#EnvoyFilter-PatchContext" class="headerlink" title="EnvoyFilter.PatchContext"></a>EnvoyFilter.PatchContext</h2><p>PatchContext根据流量方向和工作负载类型选择配置类别。</p><table><thead><tr><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>ANY</code></td><td>两个sidecar和网关中的所有听众&#x2F;路由器&#x2F;集群。</td></tr><tr><td><code>SIDECAR_INBOUND</code></td><td>sidecar中的入站监听器&#x2F;路由&#x2F;集群。</td></tr><tr><td><code>SIDECAR_OUTBOUND</code></td><td>侧车中的出站监听器&#x2F;路由&#x2F;集群。</td></tr><tr><td><code>GATEWAY</code></td><td>网关监听器&#x2F;路由&#x2F;集群。</td></tr></tbody></table></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者:</span> <span class="post-copyright-info"><a href="https://xiaowu95.wang">小五</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接:</span> <span class="post-copyright-info"><a href="https://xiaowu95.wang/posts/a28b97ff/">https://xiaowu95.wang/posts/a28b97ff/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://xiaowu95.wang" target="_blank">小五的个人杂货铺</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/">云原生</a><a class="post-meta__tags" href="/tags/k8s/">k8s</a><a class="post-meta__tags" href="/tags/istio/">istio</a></div><div class="post-share"><div class="social-share" data-image="/img/nba-logo26.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>感谢支持</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wxpay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-lazy-src="/img/wxpay.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-lazy-src="/img/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/fa103d3a/" title="idea添加对istio的智能提示"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo2.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">idea添加对istio的智能提示</div></div><div class="info-2"><div class="info-item-1">转自: https://blog.51cto.com/u_15127588/3305078 JetBrains 系列 IDE 有一个非常好用的 Kubernetes 的官方插件：JetBrains Kubernetes Plugin 。该插件支持资源对象关键字的自动补全和语法检查，这对于编写或者修改 YAML 文件非常方便。但是此前版本不支持 自定义的 CRD 对象，这对于该插件的易用性来说，略有一些遗憾。 现在新版的 Kubernetes 插件已经支持通过文件导入或者 URL 导入 CRD 定义文件，从而支持任意 CRD 资源对象的关键字自动补全和语法检查。 12Custom resource definition (CRD) supportCustom resources can be validated by providing complementary OpenAPI 2.0 files with CRD schemas and/or CRD resource definitions (YAML) (limited support). 下面以服务网格 Istio...</div></div></div></a><a class="pagination-related" href="/posts/11d812fd/" title="Nginx给网站添加用户认证配置"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo6.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Nginx给网站添加用户认证配置</div></div><div class="info-2"><div class="info-item-1">Nginx给网站添加用户认证配置（ Basic HTTP authentication） 说明：ngx_http_auth_basic_module模块实现让访问者只有输入正确的用户密码才允许访问web内容。web上的一些内容不想被其他人知道，但是又想让部分人看到。nginx的http auth模块以及Apache http auth都是很好的解决方案。 默认情况下nginx已经安装了ngx_http_auth_basic_module模块。 Nginx认证配置实例生成认证文件123# printf &quot;test:$(openssl passwd -crypt 123456)\n&quot; &gt;&gt; /home/htpasswd# cat /home/htpasswd test:xyJkVhXGAZ8tM 注意：这里账号：test，密码：123456，记住认证文件路径 配置网站conf文件123456789101112131415server&#123; listen 80; server_name ...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/fa103d3a/" title="idea添加对istio的智能提示"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2024-02-02</div><div class="info-item-2">idea添加对istio的智能提示</div></div><div class="info-2"><div class="info-item-1">转自: https://blog.51cto.com/u_15127588/3305078 JetBrains 系列 IDE 有一个非常好用的 Kubernetes 的官方插件：JetBrains Kubernetes Plugin 。该插件支持资源对象关键字的自动补全和语法检查，这对于编写或者修改 YAML 文件非常方便。但是此前版本不支持 自定义的 CRD 对象，这对于该插件的易用性来说，略有一些遗憾。 现在新版的 Kubernetes 插件已经支持通过文件导入或者 URL 导入 CRD 定义文件，从而支持任意 CRD 资源对象的关键字自动补全和语法检查。 12Custom resource definition (CRD) supportCustom resources can be validated by providing complementary OpenAPI 2.0 files with CRD schemas and/or CRD resource definitions (YAML) (limited support). 下面以服务网格 Istio...</div></div></div></a><a class="pagination-related" href="/posts/46b7d67b/" title="关于Sidecar注入以及问题记录"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo28.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2024-05-29</div><div class="info-item-2">关于Sidecar注入以及问题记录</div></div><div class="info-2"><div class="info-item-1">安装 Sidecar注入为了充分利用 Istio 的所有特性，网格中的 Pod 必须运行一个 Istio Sidecar 代理。 下面的章节描述了向 Pod 中注入 Istio Sidecar 的两种方法：使用 istioctl 手动注入或启用 Pod 所属命名空间的 Istio Sidecar 注入器自动注入。 当 Pod 所属命名空间启用自动注入后，自动注入器会使用准入控制器在创建 Pod 时自动注入代理配置。 手动注入直接修改配置，如 Deployment，并将代理配置注入其中。 如果您不确定使用哪一种方法，建议使用自动注入。 自动注入 Sidecar使用 Istio 提供的准入控制器变更 Webhook， 可以将 Sidecar 自动添加到可用的 Kubernetes Pod 中。 虽然准入控制器默认情况下是启用的，但一些 Kubernetes 发行版会禁用这些控制器。 如果出现这种情况，根据指示说明来启用准入控制器。 当您在一个命名空间中设置了 istio-injection=enabled 标签，且 Injection Webhook 被启用后，任何新的 Pod...</div></div></div></a><a class="pagination-related" href="/posts/43409a5/" title="利用istio实现灰度发布"><img class="cover" src="/img/loading.gif" data-lazy-src="/img/nba-logo28.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="fas fa-history fa-fw"></i> 2024-02-02</div><div class="info-item-2">利用istio实现灰度发布</div></div><div class="info-2"><div class="info-item-1">Kubernetes 中如何实现灰度发布当你Kubernetes 集群中部署业务时，可以利用 Kubernetes 原生提供的灰度发布的方式去上线业务。这种方式是通过在旧版本和新版本的服务之间，定义一个差异化的 Label，根据不同版本之间的公共 Label 负载流量到后端 Pod，最终实现根据 Pod 的副本数控制流量的百分比。 如下图所示：用户定义了两个 Deployment 对象，其中旧版本名为 frontend-stable，有3个副本。新版本为 frontend-canary，有1个副本。此时定义了一个 Service 对象，使用它们之间公共的 Label 进行选择。这就使得用户访问 frontend 这个 Service 时，能以 3:1 的比例同时访问到两个版本。并且还可以通过调整副本数持续控制流量比例，最终达到完整上线。 Kubernetes 默认的实现方式在简单的部署场景下很有效，但是在一些复杂场景中，仍然会有较大的局限，如： 业务配置自动伸缩后，会直接影响灰度发布的流量比例 低百分比的流量控制占用资源高，如 1 % 的流量到达新版本，则至少需要 100...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/loading.gif" data-lazy-src="/img/avatar.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">小五</div><div class="author-info-description">Tomorrow will be better,Everything will be fine</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">550</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">163</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">58</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/wang-xiaowu"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons"><a class="social-icon" href="/random" target="_blank" title="随便逛逛"><i class="fa-solid fa-shuffle"></i></a><a class="social-icon" href="mailto:wangxiaowu950330@foxmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/30655189?spm_id_from=333.1007.0.0" rel="external nofollow noreferrer" target="_blank" title="BiliBili"><i class="fa-brands fa-bilibili"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS"><i class="fa-solid fa-rss"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="toc-number">2.</span> <span class="toc-text">注意点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B7%E4%BE%8B"><span class="toc-number">3.</span> <span class="toc-text">样例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E9%9D%A2%E7%9A%84%E7%A4%BA%E4%BE%8B%E5%9C%A8%E6%A0%B9%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4-istio-config-%E4%B8%AD%E5%A3%B0%E6%98%8E%E4%BA%86%E4%B8%80%E4%B8%AA%E5%85%A8%E5%B1%80%E9%BB%98%E8%AE%A4-EnvoyFilter-%E8%B5%84%E6%BA%90%EF%BC%8C%E5%AE%83%E5%B0%86%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8D%8F%E8%AE%AE%E8%BF%87%E6%BB%A4%E5%99%A8%E6%B7%BB%E5%8A%A0%E5%88%B0%E7%B3%BB%E7%BB%9F%E4%B8%AD%E6%89%80%E6%9C%89-sidecar-%E7%9A%84%E5%87%BA%E7%AB%99%E7%AB%AF%E5%8F%A3-9307-%E4%B8%8A%E3%80%82%E8%AF%A5%E8%BF%87%E6%BB%A4%E5%99%A8%E5%BA%94%E8%AF%A5%E5%9C%A8%E7%BB%88%E6%AD%A2-tcp-proxy-%E8%BF%87%E6%BB%A4%E5%99%A8%E4%B9%8B%E5%89%8D%E6%B7%BB%E5%8A%A0%E4%BB%A5%E7%94%9F%E6%95%88%E3%80%82%E6%AD%A4%E5%A4%96%EF%BC%8C%E5%AE%83%E4%B8%BA%E7%BD%91%E5%85%B3%E5%92%8C-sidecar-%E4%B8%AD%E7%9A%84%E6%89%80%E6%9C%89-HTTP-%E8%BF%9E%E6%8E%A5%E8%AE%BE%E7%BD%AE%E4%BA%8630%E7%A7%92%E7%9A%84%E9%97%B2%E7%BD%AE%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4%E3%80%82"><span class="toc-number">3.1.</span> <span class="toc-text">下面的示例在根命名空间 istio-config 中声明了一个全局默认 EnvoyFilter 资源，它将自定义协议过滤器添加到系统中所有 sidecar 的出站端口 9307 上。该过滤器应该在终止 tcp_proxy 过滤器之前添加以生效。此外，它为网关和 sidecar 中的所有 HTTP 连接设置了30秒的闲置超时时间。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E4%B8%8B%E7%A4%BA%E4%BE%8B%E5%90%AF%E7%94%A8%E4%BA%86Envoy%E7%9A%84Lua%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%9C%A8bookinfo%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%AD%E5%85%B7%E6%9C%89%E6%A0%87%E7%AD%BE%E2%80%9Capp%EF%BC%9Areviews%E2%80%9D%E7%9A%84reviews%E6%9C%8D%E5%8A%A1pod%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A38080%E4%B8%8A%E5%88%B0%E8%BE%BE%E7%9A%84%E6%89%80%E6%9C%89%E5%85%A5%E7%AB%99HTTP%E8%B0%83%E7%94%A8%E3%80%82lua%E8%BF%87%E6%BB%A4%E5%99%A8%E8%B0%83%E7%94%A8%E5%A4%96%E9%83%A8%E6%9C%8D%E5%8A%A1internal-org-net-8888%EF%BC%8C%E8%AF%A5%E6%9C%8D%E5%8A%A1%E9%9C%80%E8%A6%81envoy%E4%B8%AD%E7%89%B9%E6%AE%8A%E9%9B%86%E7%BE%A4%E5%AE%9A%E4%B9%89%E3%80%82%E6%AD%A4%E9%85%8D%E7%BD%AE%E8%BF%98%E5%B0%86%E8%AF%A5%E9%9B%86%E7%BE%A4%E6%B7%BB%E5%8A%A0%E5%88%B0sidecar%E4%B8%AD%E3%80%82"><span class="toc-number">3.2.</span> <span class="toc-text">以下示例启用了Envoy的Lua过滤器，用于在bookinfo命名空间中具有标签“app：reviews”的reviews服务pod的服务端口8080上到达的所有入站HTTP调用。lua过滤器调用外部服务internal.org.net:8888，该服务需要envoy中特殊集群定义。此配置还将该集群添加到sidecar中。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E4%B8%8B%E7%A4%BA%E4%BE%8B%E8%A6%86%E7%9B%96%E4%BA%86istio-system%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%AD%E5%85%A5%E5%8F%A3%E7%BD%91%E5%85%B3%E4%B8%8A%E7%9A%84%E4%BE%A6%E5%90%AC%E5%99%A8%E4%B8%ADHTTP%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86%E5%99%A8%E4%B8%AD%E7%9A%84%E6%9F%90%E4%BA%9B%E5%AD%97%E6%AE%B5%EF%BC%88HTTP%E9%97%B2%E7%BD%AE%E8%B6%85%E6%97%B6%E5%92%8CX-Forward-For%E5%8F%97%E4%BF%A1%E4%BB%BB%E8%B7%B3%E6%95%B0%EF%BC%89%EF%BC%8C%E7%94%A8%E4%BA%8ESNI%E4%B8%BB%E6%9C%BAapp-example-com%EF%BC%9A"><span class="toc-number">3.3.</span> <span class="toc-text">以下示例覆盖了istio-system命名空间中入口网关上的侦听器中HTTP连接管理器中的某些字段（HTTP闲置超时和X-Forward-For受信任跳数），用于SNI主机app.example.com：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E4%B8%8B%E7%A4%BA%E4%BE%8B%E6%8F%92%E5%85%A5%E4%BA%86%E4%B8%80%E4%B8%AA-attributegen-%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%8C%E8%AF%A5%E8%BF%87%E6%BB%A4%E5%99%A8%E7%94%9F%E6%88%90-istio-operationId-%E5%B1%9E%E6%80%A7%EF%BC%8C%E8%AF%A5%E5%B1%9E%E6%80%A7%E7%94%B1-istio-stats-%E8%BF%87%E6%BB%A4%E5%99%A8%E4%BD%BF%E7%94%A8%E3%80%82filterClass-STATS-%E7%BC%96%E7%A0%81%E4%BA%86%E8%BF%99%E7%A7%8D%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E3%80%82"><span class="toc-number">3.4.</span> <span class="toc-text">以下示例插入了一个 attributegen 过滤器，该过滤器生成 istio_operationId 属性，该属性由 istio.stats 过滤器使用。filterClass: STATS 编码了这种依赖关系。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E4%B8%8B%E7%A4%BA%E4%BE%8B%E5%B0%86%E5%9C%A8myns%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%AD%E6%8F%92%E5%85%A5%E4%B8%80%E4%B8%AAhttp-ext-authz%E8%BF%87%E6%BB%A4%E5%99%A8%E3%80%82"><span class="toc-number">3.5.</span> <span class="toc-text">以下示例将在myns命名空间中插入一个http ext_authz过滤器。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-myns-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%AD%E7%9A%84%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD%E9%9C%80%E8%A6%81%E8%AE%BF%E9%97%AE%E4%B8%80%E4%B8%AA%E4%B8%8D%E6%8E%A5%E5%8F%97%E5%88%9D%E5%A7%8B%E5%85%83%E6%95%B0%E6%8D%AE%E7%9A%84%E4%B8%8D%E5%90%8C-ext-auth-%E6%9C%8D%E5%8A%A1%E5%99%A8%E3%80%82%E7%94%B1%E4%BA%8E-proto-%E5%90%88%E5%B9%B6%E4%B8%8D%E8%83%BD%E5%88%A0%E9%99%A4%E5%AD%97%E6%AE%B5%EF%BC%8C%E5%9B%A0%E6%AD%A4%E4%BB%A5%E4%B8%8B%E9%85%8D%E7%BD%AE%E4%BD%BF%E7%94%A8-REPLACE-%E6%93%8D%E4%BD%9C%E3%80%82%E5%A6%82%E6%9E%9C%E6%82%A8%E4%B8%8D%E9%9C%80%E8%A6%81%E7%BB%A7%E6%89%BF%E5%AD%97%E6%AE%B5%EF%BC%8C%E5%88%99-REPLACE-%E4%BC%98%E5%85%88%E4%BA%8E-MERGE%E3%80%82"><span class="toc-number">3.6.</span> <span class="toc-text">在 myns 命名空间中的工作负载需要访问一个不接受初始元数据的不同 ext_auth 服务器。由于 proto 合并不能删除字段，因此以下配置使用 REPLACE 操作。如果您不需要继承字段，则 REPLACE 优先于 MERGE。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E4%B8%8B%E7%A4%BA%E4%BE%8B%E4%B8%BA%E6%89%80%E6%9C%89%E5%85%A5%E7%AB%99sidecar-HTTP-%E8%AF%B7%E6%B1%82%E9%83%A8%E7%BD%B2%E4%BA%86%E4%B8%80%E4%B8%AA-Wasm-%E6%89%A9%E5%B1%95%E3%80%82"><span class="toc-number">3.7.</span> <span class="toc-text">以下示例为所有入站sidecar HTTP 请求部署了一个 Wasm 扩展。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E4%B8%8B%E7%A4%BA%E4%BE%8B%E4%B8%BA%E6%89%80%E6%9C%89%E4%BB%A3%E7%90%86%E6%B7%BB%E5%8A%A0%E4%BA%86%E4%B8%80%E4%B8%AA-Wasm-%E6%9C%8D%E5%8A%A1%E6%89%A9%E5%B1%95%EF%BC%8C%E4%BD%BF%E7%94%A8%E6%9C%AC%E5%9C%B0%E5%8F%AF%E7%94%A8%E7%9A%84-Wasm-%E6%96%87%E4%BB%B6%E3%80%82%E5%8D%95%E4%BE%8B-Wasm-%E6%89%A9%E5%B1%95%E7%94%A8%E4%BA%8E%E5%9C%A8%E6%89%A7%E8%A1%8C-Wasm-%E8%BF%87%E6%BB%A4%E5%99%A8%E7%9A%84%E5%B7%A5%E4%BD%9C%E7%A8%8B%E5%BA%8F%E4%B9%8B%E9%97%B4%E7%BB%B4%E6%8A%A4%E5%85%B1%E4%BA%AB%E7%8A%B6%E6%80%81%E3%80%82%E4%BE%8B%E5%A6%82%EF%BC%8C%E6%9C%AC%E5%9C%B0%E9%80%9F%E7%8E%87%E9%99%90%E5%88%B6%E6%89%A9%E5%B1%95%E5%B0%86%E4%BE%9D%E8%B5%96%E4%BA%8E%E5%8D%95%E4%BE%8B%E6%9D%A5%E9%99%90%E5%88%B6%E6%89%80%E6%9C%89%E5%B7%A5%E4%BD%9C%E7%A8%8B%E5%BA%8F%E4%B8%AD%E7%9A%84%E8%AF%B7%E6%B1%82%E3%80%82%E5%8F%A6%E4%B8%80%E4%B8%AA%E7%A4%BA%E4%BE%8B%E6%98%AF%E6%8E%88%E6%9D%83-Wasm-%E6%89%A9%E5%B1%95%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E5%8D%95%E4%BE%8B%E6%9D%A5%E7%BB%B4%E6%8A%A4%E5%B8%90%E6%88%B7%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%82"><span class="toc-number">3.8.</span> <span class="toc-text">以下示例为所有代理添加了一个 Wasm 服务扩展，使用本地可用的 Wasm 文件。单例 Wasm 扩展用于在执行 Wasm 过滤器的工作程序之间维护共享状态。例如，本地速率限制扩展将依赖于单例来限制所有工作程序中的请求。另一个示例是授权 Wasm 扩展可以使用单例来维护帐户数据库。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E4%B8%8B%E7%A4%BA%E4%BE%8B%E5%9C%A8-envoy-filters-listener-tls-inspector-%E4%B9%8B%E5%89%8D%E6%8F%92%E5%85%A5%E4%BA%86%E4%B8%80%E4%B8%AA-envoy-filters-listener-proxy-protocol-%E7%9B%91%E5%90%AC%E5%99%A8%E8%BF%87%E6%BB%A4%E5%99%A8%E3%80%82"><span class="toc-number">3.9.</span> <span class="toc-text">以下示例在 envoy.filters.listener.tls_inspector 之前插入了一个 envoy.filters.listener.proxy_protocol 监听器过滤器。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E4%B8%8B%E7%A4%BA%E4%BE%8B%E5%8C%B9%E9%85%8D%E4%B8%BA%E5%88%A4%E6%96%AD%E8%AF%B7%E6%B1%82%E6%9D%A5%E6%BA%90%E6%98%AF%E5%90%A6%E6%98%AFtest-com%EF%BC%8C%E7%84%B6%E5%90%8E%E5%AF%B9%E5%BA%94%E6%B7%BB%E5%8A%A0project-version-header"><span class="toc-number">3.10.</span> <span class="toc-text">以下示例匹配为判断请求来源是否是test.com，然后对应添加project-version header</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter"><span class="toc-number">4.</span> <span class="toc-text">EnvoyFilter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter-ProxyMatch"><span class="toc-number">5.</span> <span class="toc-text">EnvoyFilter.ProxyMatch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter-ClusterMatch"><span class="toc-number">6.</span> <span class="toc-text">EnvoyFilter.ClusterMatch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter-RouteConfigurationMatch"><span class="toc-number">7.</span> <span class="toc-text">EnvoyFilter.RouteConfigurationMatch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter-ListenerMatch"><span class="toc-number">8.</span> <span class="toc-text">EnvoyFilter.ListenerMatch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter-Patch"><span class="toc-number">9.</span> <span class="toc-text">EnvoyFilter.Patch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter-EnvoyConfigObjectMatch"><span class="toc-number">10.</span> <span class="toc-text">EnvoyFilter.EnvoyConfigObjectMatch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter-EnvoyConfigObjectPatch"><span class="toc-number">11.</span> <span class="toc-text">EnvoyFilter.EnvoyConfigObjectPatch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter-RouteConfigurationMatch-RouteMatch"><span class="toc-number">12.</span> <span class="toc-text">EnvoyFilter.RouteConfigurationMatch.RouteMatch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter-RouteConfigurationMatch-VirtualHostMatch"><span class="toc-number">13.</span> <span class="toc-text">EnvoyFilter.RouteConfigurationMatch.VirtualHostMatch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter-ListenerMatch-FilterChainMatch"><span class="toc-number">14.</span> <span class="toc-text">EnvoyFilter.ListenerMatch.FilterChainMatch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter-ListenerMatch-FilterMatch"><span class="toc-number">15.</span> <span class="toc-text">EnvoyFilter.ListenerMatch.FilterMatch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter-ListenerMatch-SubFilterMatch"><span class="toc-number">16.</span> <span class="toc-text">EnvoyFilter.ListenerMatch.SubFilterMatch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter-RouteConfigurationMatch-RouteMatch-Action"><span class="toc-number">17.</span> <span class="toc-text">EnvoyFilter.RouteConfigurationMatch.RouteMatch.Action</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter-Patch-Operation"><span class="toc-number">18.</span> <span class="toc-text">EnvoyFilter.Patch.Operation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter-Patch-FilterClass"><span class="toc-number">19.</span> <span class="toc-text">EnvoyFilter.Patch.FilterClass</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter-ApplyTo"><span class="toc-number">20.</span> <span class="toc-text">EnvoyFilter.ApplyTo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EnvoyFilter-PatchContext"><span class="toc-number">21.</span> <span class="toc-text">EnvoyFilter.PatchContext</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/c75c82a0/" title="使用 TypeScript 创建 Koa 服务器"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo16.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="使用 TypeScript 创建 Koa 服务器"></a><div class="content"><a class="title" href="/posts/c75c82a0/" title="使用 TypeScript 创建 Koa 服务器">使用 TypeScript 创建 Koa 服务器</a><time datetime="2025-10-11T06:00:11.000Z" title="发表于 2025-10-11 14:00:11">2025-10-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/c9d8bfa7/" title="Nodejs应用提取heap并加以分析的一些常用方法"><img src="/img/loading.gif" data-lazy-src="/img/nba-logo24.jpg" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Nodejs应用提取heap并加以分析的一些常用方法"></a><div class="content"><a class="title" href="/posts/c9d8bfa7/" title="Nodejs应用提取heap并加以分析的一些常用方法">Nodejs应用提取heap并加以分析的一些常用方法</a><time datetime="2025-09-28T07:54:43.000Z" title="发表于 2025-09-28 15:54:43">2025-09-28</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/nba-logo26.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By 小五</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a href="https://www.foreverblog.cn/" rel="external nofollow noreferrer" target="_blank"><img src="/img/loading.gif" data-lazy-src="https://img.foreverblog.cn/logo_en_default.png" alt="十年之约" style="width:auto;height:16px"></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.2.2/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.2.2/source/js/main.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.2.2/source/js/tw_cn.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.36/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(()=>{const e=()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");if(0===e.length)return;const t=()=>(e=>{window.loadMermaid=!0;const t="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";e.forEach(((e,n)=>{const d=e.firstElementChild,a=`mermaid-${n}`,r=`%%{init:{ 'theme':'${t}'}}%%\n`+d.textContent,i=mermaid.render(a,r),m=e=>{d.insertAdjacentHTML("afterend",e)};"string"==typeof i?m(i):i.then((({svg:e})=>m(e)))}))})(e);btf.addGlobalFn("themeChange",t,"mermaid"),window.loadMermaid?t():btf.getScript("https://cdn.jsdelivr.net/npm/mermaid@11.4.0/dist/mermaid.min.js").then(t)};btf.addGlobalFn("encrypt",e,"mermaid"),window.pjax?e():document.addEventListener("DOMContentLoaded",e)})()</script><script>(()=>{const t=document.querySelectorAll("#article-container .chartjs-container");if(0===t.length)return;const e=(t,a)=>{"object"==typeof t&&null!==t&&Object.keys(t).forEach((r=>{const n=t[r];"object"==typeof n&&null!==n&&(n[a]?t[r]=n[a]:e(n,a))}))},a=()=>{window.loadChartJS=!0,Array.from(t).forEach(((t,a)=>{const r=t.firstElementChild,n=t.getAttribute("data-chartjs-id")||"chartjs-"+a,d=t.getAttribute("data-width"),o=document.getElementById(n);o&&o.parentNode.remove();const c=r.textContent,l=document.createElement("canvas");l.id=n;const s=document.createElement("div");s.className="chartjs-wrap",d&&(s.style.width=d),s.appendChild(l),r.insertAdjacentElement("afterend",s);const h=document.getElementById(n).getContext("2d"),i=JSON.parse(c),m="dark"===document.documentElement.getAttribute("data-theme")?"dark-mode":"light-mode";(t=>{"dark-mode"===t?(Chart.defaults.color="rgba(255, 255, 255, 0.8)",Chart.defaults.borderColor="rgba(255, 255, 255, 0.2)",Chart.defaults.scale.ticks.backdropColor="transparent"):(Chart.defaults.color="rgba(0, 0, 0, 0.8)",Chart.defaults.borderColor="rgba(0, 0, 0, 0.1)",Chart.defaults.scale.ticks.backdropColor="transparent")})(m),e(i,m),new Chart(h,i)}))},r=()=>{window.loadChartJS?a():btf.getScript("https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js").then(a)};btf.addGlobalFn("themeChange",a,"chartjs"),btf.addGlobalFn("encrypt",a,"chartjs"),window.pjax?r():document.addEventListener("DOMContentLoaded",r)})()</script></div><div class="aplayer no-destroy" data-id="9061017364" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listfolded="false" data-order="random" data-lrctype="1" data-preload="none" data-autoplay="false" muted></div><div class="app-refresh" id="app-refresh"><div class="app-refresh-wrap"><label>网站已更新最新版本</label> <a href="javascript:void(0)" rel="external nofollow noreferrer" onclick="location.reload()">点击刷新</a></div></div><script>function showNotification(){if(GLOBAL_CONFIG.Snackbar){var t="light"===document.documentElement.getAttribute("data-theme")?GLOBAL_CONFIG.Snackbar.bgLight:GLOBAL_CONFIG.Snackbar.bgDark,e=GLOBAL_CONFIG.Snackbar.position;Snackbar.show({text:"已更新最新版本",backgroundColor:t,duration:5e5,pos:e,actionText:"点击刷新",actionTextColor:"#fff",onActionClick:function(t){location.reload()}})}else{var o=`top: 0; background: ${"light"===document.documentElement.getAttribute("data-theme")?"#49b1f5":"#1f1f1f"};`;document.getElementById("app-refresh").style.cssText=o}}"serviceWorker"in navigator&&(navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("controllerchange",(function(){showNotification()})),window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js")})))</script><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="/js/diytitle.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!0,document.body.addEventListener("input",POWERMODE)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/metingjs/dist/Meting.min.js"></script><script>btf.addGlobalFn("pjaxSend",(()=>{if(window.aplayers)for(let a=0;a<window.aplayers.length;a++)window.aplayers[a].options.fixed||window.aplayers[a].destroy()}),"destroyAplayer"),btf.addGlobalFn("pjaxComplete",loadMeting,"runMetingJS")</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>(()=>{window.pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/talking/"]):not([href="/artitalk/"])',selectors:['link[rel="canonical"]','meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"],cacheBust:!1,analytics:!0,scrollRestoration:!1});const e=e=>{e&&Object.values(e).forEach((e=>e()))};document.addEventListener("pjax:send",(()=>{btf.removeGlobalFnEvent("pjaxSendOnce"),btf.removeGlobalFnEvent("themeChange");const t=document.body.classList;t.contains("read-mode")&&t.remove("read-mode"),e(window.globalFn.pjaxSend)})),document.addEventListener("pjax:complete",(()=>{btf.removeGlobalFnEvent("pjaxCompleteOnce"),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),a=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(a)),e.parentNode.replaceChild(t,e)})),e(window.globalFn.pjaxComplete)})),document.addEventListener("pjax:error",(e=>{404===e.request.status&&pjax.loadUrl("/404")}))})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@5.12.0/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4.75.3/dist/instantsearch.production.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.2.2/source/js/search/algolia.min.js"></script></div></div><script data-pjax>if(document.getElementById("recent-posts")&&"/"==location.pathname){var parent=document.getElementById("recent-posts"),child='<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo25.jpg" alt="/img/nba-logo25.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2024-02-02</span><a class="blog-slider__title" href="posts/1bcb0ad4/">单环境,多分支并行开发方案(流量染色/istio)</a><div class="blog-slider__text">单环境,多分支并行开发方案(流量染色/istio)</div><a class="blog-slider__button" href="posts/1bcb0ad4/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo15.jpg" alt="/img/nba-logo15.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-04-06</span><a class="blog-slider__title" href="posts/2a9d73ff/">教你如何零成本从0到1，开发上线一个对接了openAI的机器人</a><div class="blog-slider__text">教你如何零成本从0到1，开发上线一个对接了openAI的机器人</div><a class="blog-slider__button" href="posts/2a9d73ff/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo3.jpg" alt="/img/nba-logo3.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-06-14</span><a class="blog-slider__title" href="posts/aa43cc95/">记录k8s环境下结合alinode的使用</a><div class="blog-slider__text">记录k8s环境下结合alinode的使用</div><a class="blog-slider__button" href="posts/aa43cc95/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo29.jpg" alt="/img/nba-logo29.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-12-13</span><a class="blog-slider__title" href="posts/15957791/">k8s环境下,nginx做websocket负载的方案梳理</a><div class="blog-slider__text">k8s环境下,nginx做websocket负载的方案梳理</div><a class="blog-slider__button" href="posts/15957791/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo12.jpg" alt="/img/nba-logo12.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-09-26</span><a class="blog-slider__title" href="posts/4ecfb081/">记录一次k8s网络DNS问题排查过程</a><div class="blog-slider__text">记录一次k8s网络DNS问题排查过程</div><a class="blog-slider__button" href="posts/4ecfb081/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo12.jpg" alt="/img/nba-logo12.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2023-09-26</span><a class="blog-slider__title" href="posts/37032a87/">k3s高可用安装</a><div class="blog-slider__text">k3s高可用安装</div><a class="blog-slider__button" href="posts/37032a87/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo17.jpg" alt="/img/nba-logo17.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-11-27</span><a class="blog-slider__title" href="posts/20b19ed4/">分词搜索需求整理</a><div class="blog-slider__text">分词搜索需求整理</div><a class="blog-slider__button" href="posts/20b19ed4/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo9.jpg" alt="/img/nba-logo9.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2022-12-02</span><a class="blog-slider__title" href="posts/6de14387/">整理wsl2配合开发的一些配置</a><div class="blog-slider__text">整理wsl2配合开发的一些配置</div><a class="blog-slider__button" href="posts/6de14387/">详情</a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms"><div class="blog-slider__img"><img src= "/img/loading.gif" data-lazy-src="/img/nba-logo30.jpg" alt="/img/nba-logo30.jpg"/></div><div class="blog-slider__content"><span class="blog-slider__code">2021-12-11</span><a class="blog-slider__title" href="posts/fb9adcb6/">记录windows11+wsl2环境搭配</a><div class="blog-slider__text">windows11+wsl2开发环境配置</div><a class="blog-slider__button" href="posts/fb9adcb6/">详情</a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';console.log("已挂载swiper"),parent.insertAdjacentHTML("afterbegin",child)}</script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper/swiper/swiper.min.js"></script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-swiper@0.18/swiper/swiperindex.js"></script><style></style><script data-pjax>function history_calendar_injector_config(){var i=document.getElementsByClassName("sticky_layout")[0];console.log("已挂载history_calendar"),i.insertAdjacentHTML("afterbegin",'<div class="card-widget card-history"><div class="card-content"><div class="item-headline"><i class="fas fa-clock fa-spin"></i><span>那年今日</span></div><div id="history-baidu" style="height: 100px;overflow: hidden"><div class="history_swiper-container" id="history-container" style="width: 100%;height: 100%"><div class="swiper-wrapper" id="history_container_wrapper" style="height:20px"></div></div></div></div>')}document.getElementsByClassName("sticky_layout")[0]&&"/"===location.pathname&&history_calendar_injector_config()</script><script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/wanko.model.json"},display:{position:"right",width:150,height:300,hOffset:20,vOffset:-20},mobile:{show:!0},log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/"})</script></body></html>